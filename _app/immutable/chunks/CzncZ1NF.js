import"./DsnmJJEf.js";import"./C3FPqVk7.js";import{F as bt,I as mt,B as K,o as V,k as x,p as Ee,y as H,a2 as Me,O as Se,w as I,v as Ce,j as R,q as v,u as _,L as qe,A as f,ad as tt,x as s,t as F,n as Fe,z as xt,b7 as _t}from"./CeF9Pysg.js";import{I as re,s as ae}from"./DhGkR45b.js";import{l as ne,s as ie,p as z,i as Z}from"./dZMd9PJ3.js";import{d as Be,f as rt,s as D,q as at,e as Re,o as yt,r as wt}from"./CG7HK1rV.js";import{s as ve,e as Te,i as nt,$ as it,k as At,a as Ie,g as Ge,r as Mt}from"./BdIRB7Hx.js";import{a as ot,s as He}from"./CIaeXpBv.js";import{M as $t,P as st,X as lt,T as It}from"./BsLGdO_u.js";import{k as $e,z as Et,A as Ct,b as Nt}from"./DOdbJzaW.js";import{t as Lt,s as Pt}from"./xr51uyWC.js";import{b as Oe}from"./CWVXqVlC.js";import{C as St}from"./DPDeLwY0.js";function Bt(h,n,l){bt(()=>{var d=mt(()=>n(h,l?.())||{});if(d?.destroy)return()=>d.destroy()})}function Tr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 18V5"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"}]];re(h,ie({name:"brain"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Or(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]];re(h,ie({name:"camera"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Dr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"m15 18-6-6 6-6"}]];re(h,ie({name:"chevron-left"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function zr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];re(h,ie({name:"clock"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Rt(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"}],["path",{d:"M6 18h.01"}],["path",{d:"M10 14h.01"}],["path",{d:"M15 6h.01"}],["path",{d:"M18 9h.01"}]];re(h,ie({name:"dices"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Ur(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];re(h,ie({name:"eye"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function jr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M9 10h.01"}],["path",{d:"M15 10h.01"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"}]];re(h,ie({name:"ghost"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Ve(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}],["path",{d:"M12 7v5l4 2"}]];re(h,ie({name:"history"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Fr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1"}]];re(h,ie({name:"layout-dashboard"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function dt(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M5 12h14"}]];re(h,ie({name:"minus"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Gr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];re(h,ie({name:"rotate-ccw"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Hr(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"m11 19-6-6"}],["path",{d:"m5 21-2-2"}],["path",{d:"m8 16-4 4"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5"}]];re(h,ie({name:"sword"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Tt(h,n){const l=ne(n,["children","$$slots","$$events","$$legacy"]);const d=[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]];re(h,ie({name:"zoom-in"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,n,"default",{}),x(u,c)},$$slots:{default:!0}}))}const kr={Blinded:{effect:"Make rolls with 3 banes. No sight reactions. Speed halved.",speedMult:.5,rollMod:-3},Confused:{effect:"No reactions. Intellect and Will rolls with 1 bane.",rollMod:-1,attributes:["int","wil"]},Controlled:{effect:"Controller decides your turn. Regard source as ally."},Cursed:{effect:"Luck rolls with 1 bane."},Deafened:{effect:"No hearing reactions. Immune to hearing effects."},Frightened:{effect:"Attribute rolls with 1 bane (while in LOS). Grant 1 boon on rolls against you.",rollMod:-1},Held:{effect:"Speed 0. Cannot increase Speed. Auto-fail Agility defense rolls.",speedFixed:0},Impaired:{effect:"Roll with 1 bane for specified attribute. Grant 1 boon against that attribute.",rollMod:-1},Incapacitated:{effect:"Damage equals or exceeds Health. You cannot use actions or reactions. Speed 0.",speedFixed:0},"On Fire":{effect:"Take 1d6 damage at end of round. Action/Luck roll to extinguish."},Poisoned:{effect:"Attribute rolls with 1 bane. Grant 1 boon against you. Lose 1d6 Health end of round.",rollMod:-1},Prone:{effect:"No reactions. Grant 1 boon to melee vs you, impose 1 bane to ranged vs you."},Slowed:{effect:"Speed drops to 2 (if higher). Cannot benefit from Speed increases.",speedCap:2},Stunned:{effect:"No actions/reactions. Speed 0. Grant 2 boons against you. Attribute rolls with 2 banes.",speedFixed:0,rollMod:-2},Unconscious:{effect:"No actions/reactions. Speed 0. Grant 3 boons against you. Auto-fail attribute rolls.",speedFixed:0,autoFail:!0},Vulnerable:{effect:"Grant 1 boon on attacks/rolls against you."},Weakened:{effect:"Strength/Agility rolls with 1 bane. Grant 1 boon vs Str/Agi. Speed halved.",speedMult:.5,attributes:["str","agi"],rollMod:-1}},Wr={OFF:"Off",ONE:"One",TWO:"Two"},Zr=["NIMBLE","FIREARM","THROWN","BRUTAL","BLUDGEONING","SLASHING","DISARMING","RANGE","SPECIAL","MISFIRE","LARGE","SLOW","LIGHT","LONG","AMMUNITION","PIERCING","RELOAD","VERSATILE"],qr={ANCESTRY:"Ancestry",NOVICE:"Novice",EXPERT:"Expert",MASTER:"Master"};var Ot=R('<div class="w-2 h-2 bg-white rounded-sm"></div>'),Dt=R('<span class="text-[9px] text-slate-400 bg-slate-800 px-1 rounded"> </span>'),zt=R('<div class="flex flex-wrap gap-1 mt-1"></div>'),Ut=R('<button><div class="flex items-center gap-3"><div><!></div> <div><span class="text-sm font-bold text-slate-200 block leading-tight"> </span> <!></div></div></button>'),jt=R('<div class="space-y-2"><h4 class="text-xs font-bold text-slate-500 uppercase px-1"> </h4> <div class="grid grid-cols-1 gap-2 max-h-[150px] overflow-y-auto pr-1 custom-scrollbar"></div></div>'),Ft=R('<div class="space-y-6"><div class="bg-slate-900/50 p-6 rounded-2xl border border-white/5 text-center shadow-inner relative overflow-hidden group"><div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div> <div class="flex justify-center items-center gap-8 mb-4 relative z-10"><button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-red-500/20 text-slate-300 hover:text-red-400 border border-slate-700 hover:border-red-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg" aria-label="Diminuir"><!></button> <div class="flex flex-col items-center min-w-[100px]"><span> </span></div> <button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-green-500/20 text-slate-300 hover:text-green-400 border border-slate-700 hover:border-green-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg" aria-label="Aumentar"><!></button></div> <div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] relative z-10"> </div></div> <!> <!> <button class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-black py-4 rounded-xl flex items-center justify-center gap-3 shadow-lg shadow-indigo-600/20 transition-all active:scale-[0.98] uppercase tracking-widest text-sm"><!> </button></div>');function Vr(h,n){Ee(n,!0);const l=()=>He(it,"$t",d),[d,u]=ot();let m=z(n,"initialModifier",3,0),c=z(n,"label",3,"Boons / Banes"),g=z(n,"rollLabel",3,"ROLAR"),E=z(n,"effects",19,()=>[]),L=H(0),w=H(Me([]));Se(()=>{n.isOpen?(I(L,m()),I(w,E().map(C=>C.id),!0)):I(w,[],!0)});function N(C){s(w).includes(C)?I(w,s(w).filter(b=>b!==C),!0):I(w,[...s(w),C],!0)}var y=K(),P=V(y);{var O=C=>{$t(C,{get isOpen(){return n.isOpen},get onClose(){return n.onClose},get title(){return n.title},children:(b,o)=>{var i=Ft(),t=v(i),e=_(v(t),2),a=v(e);a.__click=()=>qe(L,-1);var r=v(a);dt(r,{size:24}),f(a);var S=_(a,2),U=v(S),W=v(U);f(U),f(S);var X=_(S,2);X.__click=()=>qe(L);var ce=v(X);st(ce,{size:24}),f(X),f(e);var J=_(e,2),ge=v(J,!0);f(J),f(t);var B=_(t,2);{var A=Y=>{var ee=jt(),ue=v(ee),Ne=v(ue,!0);f(ue);var _e=_(ue,2);Te(_e,21,E,pe=>pe.id,(pe,te)=>{var he=Ut();he.__click=()=>N(s(te).id);var fe=v(he),be=v(fe),oe=v(be);{var le=k=>{var $=Ot();x(k,$)};Z(oe,k=>{s(w).includes(s(te).id)&&k(le)})}f(be);var Ae=_(be,2),ye=v(Ae),p=v(ye,!0);f(ye);var T=_(ye,2);{var j=k=>{var $=zt();Te($,21,()=>s(te).modifiers,nt,(G,de)=>{var we=Dt(),me=v(we);f(we),F(()=>D(me,`${s(de).target??""}: ${s(de).value??""}`)),x(G,we)}),f($),x(k,$)};Z(T,k=>{s(te).modifiers&&s(te).modifiers.length>0&&k(j)})}f(Ae),f(fe),f(he),F((k,$)=>{ve(he,1,`flex items-center justify-between p-3 rounded-lg border transition-all text-left ${k??""}`),ve(be,1,`w-4 h-4 rounded border flex items-center justify-center transition-colors ${$??""}`),D(p,s(te).name)},[()=>s(w).includes(s(te).id)?"bg-indigo-900/30 border-indigo-500/50 shadow-sm":"bg-slate-900/50 border-slate-800 opacity-60 hover:opacity-100 hover:border-slate-700",()=>s(w).includes(s(te).id)?"bg-indigo-500 border-indigo-400":"border-slate-600 bg-slate-900"]),x(pe,he)}),f(_e),f(ee),F(pe=>D(Ne,pe),[()=>l()("character.effects.active")]),x(Y,ee)};Z(B,Y=>{E().length>0&&Y(A)})}var M=_(B,2);rt(M,()=>n.children??tt);var q=_(M,2);q.__click=()=>{const Y=E().filter(ee=>s(w).includes(ee.id));n.onRoll(s(L),Y)};var Q=v(q);Rt(Q,{size:18});var se=_(Q);f(q),f(i),F(()=>{ve(U,1,`text-5xl font-black ${s(L)>0?"text-green-400":s(L)<0?"text-red-400":"text-slate-500"} tabular-nums drop-shadow-sm transition-colors duration-300`),D(W,`${s(L)>0?"+":""}${s(L)??""}`),D(ge,c()),D(se,` ${g()??""}`)}),x(b,i)},$$slots:{default:!0}})};Z(P,C=>{n.isOpen&&C(O)})}x(h,y),Ce(),u()}Be(["click"]);var Ue={exports:{}},Xe;function Gt(){return Xe||(Xe=1,(function(h,n){(function(l){h.exports=l()})(function(l){var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function u(o,i){var t=o[0],e=o[1],a=o[2],r=o[3];t+=(e&a|~e&r)+i[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[1]-389564586|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[2]+606105819|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[3]-1044525330|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+i[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[6]-1473231341|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[7]-45705983|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+i[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[10]-42063|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[11]-1990404162|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+i[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[13]-40341101|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[14]-1502002290|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[15]+1236535329|0,e=(e<<22|e>>>10)+a|0,t+=(e&r|a&~r)+i[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[11]+643717713|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[0]-373897302|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+i[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[10]+38016083|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[15]-660478335|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[4]-405537848|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+i[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[3]-187363961|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[8]+1163531501|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+i[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[2]-51403784|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[7]+1735328473|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[12]-1926607734|0,e=(e<<20|e>>>12)+a|0,t+=(e^a^r)+i[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[11]+1839030562|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[14]-35309556|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+i[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[7]-155497632|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[10]-1094730640|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+i[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[0]-358537222|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[3]-722521979|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[6]+76029189|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+i[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[12]-421815835|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[15]+530742520|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[2]-995338651|0,e=(e<<23|e>>>9)+a|0,t+=(a^(e|~r))+i[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[14]-1416354905|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[5]-57434055|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+i[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[10]-1051523|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[1]-2054922799|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+i[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[15]-30611744|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[6]-1560198380|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[13]+1309151649|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+i[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[2]+718787259|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[9]-343485551|0,e=(e<<21|e>>>11)+a|0,o[0]=t+o[0]|0,o[1]=e+o[1]|0,o[2]=a+o[2]|0,o[3]=r+o[3]|0}function m(o){var i=[],t;for(t=0;t<64;t+=4)i[t>>2]=o.charCodeAt(t)+(o.charCodeAt(t+1)<<8)+(o.charCodeAt(t+2)<<16)+(o.charCodeAt(t+3)<<24);return i}function c(o){var i=[],t;for(t=0;t<64;t+=4)i[t>>2]=o[t]+(o[t+1]<<8)+(o[t+2]<<16)+(o[t+3]<<24);return i}function g(o){var i=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,S,U,W;for(e=64;e<=i;e+=64)u(t,m(o.substring(e-64,e)));for(o=o.substring(e-64),a=o.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=o.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return S=i*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),U=parseInt(S[2],16),W=parseInt(S[1],16)||0,r[14]=U,r[15]=W,u(t,r),t}function E(o){var i=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,S,U,W;for(e=64;e<=i;e+=64)u(t,c(o.subarray(e-64,e)));for(o=e-64<i?o.subarray(e-64):new Uint8Array(0),a=o.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=o[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return S=i*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),U=parseInt(S[2],16),W=parseInt(S[1],16)||0,r[14]=U,r[15]=W,u(t,r),t}function L(o){var i="",t;for(t=0;t<4;t+=1)i+=d[o>>t*8+4&15]+d[o>>t*8&15];return i}function w(o){var i;for(i=0;i<o.length;i+=1)o[i]=L(o[i]);return o.join("")}w(g("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function o(i,t){return i=i|0||0,i<0?Math.max(i+t,0):Math.min(i,t)}ArrayBuffer.prototype.slice=function(i,t){var e=this.byteLength,a=o(i,e),r=e,S,U,W,X;return t!==l&&(r=o(t,e)),a>r?new ArrayBuffer(0):(S=r-a,U=new ArrayBuffer(S),W=new Uint8Array(U),X=new Uint8Array(this,a,S),W.set(X),U)}})();function N(o){return/[\u0080-\uFFFF]/.test(o)&&(o=unescape(encodeURIComponent(o))),o}function y(o,i){var t=o.length,e=new ArrayBuffer(t),a=new Uint8Array(e),r;for(r=0;r<t;r+=1)a[r]=o.charCodeAt(r);return i?a:e}function P(o){return String.fromCharCode.apply(null,new Uint8Array(o))}function O(o,i,t){var e=new Uint8Array(o.byteLength+i.byteLength);return e.set(new Uint8Array(o)),e.set(new Uint8Array(i),o.byteLength),e}function C(o){var i=[],t=o.length,e;for(e=0;e<t-1;e+=2)i.push(parseInt(o.substr(e,2),16));return String.fromCharCode.apply(String,i)}function b(){this.reset()}return b.prototype.append=function(o){return this.appendBinary(N(o)),this},b.prototype.appendBinary=function(o){this._buff+=o,this._length+=o.length;var i=this._buff.length,t;for(t=64;t<=i;t+=64)u(this._hash,m(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},b.prototype.end=function(o){var i=this._buff,t=i.length,e,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)a[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(a,t),r=w(this._hash),o&&(r=C(r)),this.reset(),r},b.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},b.prototype.setState=function(o){return this._buff=o.buff,this._length=o.length,this._hash=o.hash,this},b.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},b.prototype._finish=function(o,i){var t=i,e,a,r;if(o[t>>2]|=128<<(t%4<<3),t>55)for(u(this._hash,o),t=0;t<16;t+=1)o[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(e[2],16),r=parseInt(e[1],16)||0,o[14]=a,o[15]=r,u(this._hash,o)},b.hash=function(o,i){return b.hashBinary(N(o),i)},b.hashBinary=function(o,i){var t=g(o),e=w(t);return i?C(e):e},b.ArrayBuffer=function(){this.reset()},b.ArrayBuffer.prototype.append=function(o){var i=O(this._buff.buffer,o),t=i.length,e;for(this._length+=o.byteLength,e=64;e<=t;e+=64)u(this._hash,c(i.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(i.buffer.slice(e-64)):new Uint8Array(0),this},b.ArrayBuffer.prototype.end=function(o){var i=this._buff,t=i.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a,r;for(a=0;a<t;a+=1)e[a>>2]|=i[a]<<(a%4<<3);return this._finish(e,t),r=w(this._hash),o&&(r=C(r)),this.reset(),r},b.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.ArrayBuffer.prototype.getState=function(){var o=b.prototype.getState.call(this);return o.buff=P(o.buff),o},b.ArrayBuffer.prototype.setState=function(o){return o.buff=y(o.buff,!0),b.prototype.setState.call(this,o)},b.ArrayBuffer.prototype.destroy=b.prototype.destroy,b.ArrayBuffer.prototype._finish=b.prototype._finish,b.ArrayBuffer.hash=function(o,i){var t=E(new Uint8Array(o)),e=w(t);return i?C(e):e},b})})(Ue)),Ue.exports}var Ht=Gt();const kt=At(Ht),Ye=5;async function Xr(h){if(h.size>Ye*1024*1024)throw new Error(`Imagem muito grande. Máximo de ${Ye}MB.`);const n=await h.arrayBuffer(),l=kt.ArrayBuffer.hash(n);if($e.has(l))return l;const d=new FileReader,m=await new Promise((c,g)=>{d.onload=()=>c(d.result),d.onerror=g,d.readAsDataURL(h)});return $e.set(l,m),l}function Wt(h,n){if(!h)return n(void 0),()=>{};n($e.get(h));const l=d=>{const u=$e.get(h);n(u)};return $e.observe(l),()=>{$e.unobserve(l)}}var Zt=R('<img class="w-full h-full object-cover rounded-full border border-white/10 shadow-sm"/>'),qt=R('<div class="w-full h-full bg-slate-800 rounded-full border border-white/10 flex items-center justify-center font-black text-slate-500 shadow-sm"> </div>'),Vt=R("<div><!></div>");function Yr(h,n){Ee(n,!0);let l=z(n,"size",3,"md"),d=z(n,"fallbackText",3,"?"),u=H(void 0),m;Se(()=>{m&&m(),n.hash?m=Wt(n.hash,N=>{I(u,N,!0)}):I(u,void 0)}),at(()=>{m&&m()});const c={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-16 h-16 text-lg",xl:"w-20 h-20 text-xl",custom:"w-full h-full"};var g=Vt(),E=v(g);{var L=N=>{var y=Zt();F(()=>{Ie(y,"src",s(u)),Ie(y,"alt",n.alt)}),x(N,y)},w=N=>{var y=qt(),P=v(y,!0);f(y),F(()=>D(P,d())),x(N,y)};Z(E,N=>{s(u)?N(L):N(w,!1)})}f(g),F(()=>ve(g,1,`${c[l()]??""} relative flex-shrink-0`)),x(h,g),Ce()}var Xt=R('<div class="absolute z-50 bottom-full left-1/2 mb-2 w-max max-w-[200px] p-2 bg-slate-800 border border-indigo-500 rounded-lg shadow-xl shadow-black/50 text-[10px] text-slate-300 leading-relaxed text-center pointer-events-none whitespace-normal -translate-x-1/2" style="margin-left: var(--x-offset);"> <div class="absolute -bottom-1 left-1/2 w-2 h-2 bg-slate-800 border-r border-b border-indigo-500 -translate-x-1/2" style="transform: translateX(calc(-50% - var(--x-offset))) rotate(45deg);"></div></div>'),Yt=R('<div role="button" tabindex="0"><!> <!></div>');function Kr(h,n){let l=z(n,"text",3,""),d=z(n,"class",3,""),u=H(!1),m=!1,c=H(0),g,E=H(void 0);function L(){if(!g||!s(E))return;const b=g.getBoundingClientRect(),i=s(E).getBoundingClientRect().width/2;I(c,0);const t=b.left+b.width/2-i;t<10&&I(c,10-t);const e=b.left+b.width/2+i;e>window.innerWidth-10&&I(c,window.innerWidth-10-e)}async function w(){m||(I(u,!0),setTimeout(L,0))}function N(b){m&&(s(u)?I(u,!1):(I(u,!0),setTimeout(L,0)))}var y=Yt();y.__touchstart=()=>m=!0,y.__click=N,y.__keydown=b=>{(b.key==="Enter"||b.key===" ")&&I(u,!s(u))};var P=v(y);rt(P,()=>n.children??tt);var O=_(P,2);{var C=b=>{var o=Xt(),i=v(o);Fe(),f(o),Oe(o,t=>I(E,t),()=>s(E)),F(()=>D(i,`${l()??""} `)),Lt(3,o,()=>Pt,()=>({duration:150,start:.95})),x(b,o)};Z(O,b=>{s(u)&&l()&&b(C)})}f(y),Oe(y,b=>g=b,()=>g),F(()=>{ve(y,1,`relative inline-flex ${d()??""}`),Ge(y,`--x-offset: ${s(c)??""}px;`)}),Re("mouseenter",y,w),Re("mouseleave",y,()=>!m&&I(u,!1)),x(h,y)}Be(["touchstart","click","keydown"]);var Kt=R('<div class="fixed inset-0 bg-black/50 z-[90] lg:hidden backdrop-blur-sm" role="button" tabindex="-1"></div>'),Jt=R('<div class="flex flex-col items-center justify-center h-full text-slate-600 opacity-50"><div class="w-16 h-16 border-2 border-dashed border-slate-800 rounded-full flex items-center justify-center mb-4"><!></div> <p class="text-sm font-bold uppercase tracking-widest italic"> </p></div>'),Qt=R('<span class="text-[10px] text-white/50 font-black uppercase tracking-tighter"> </span>'),er=R('<div class="text-[10px] text-slate-400 font-medium italic mt-1 leading-relaxed opacity-80 whitespace-pre-wrap"> </div>'),tr=R('<span class="text-[8px] font-black uppercase tracking-widest bg-indigo-500/10 text-indigo-300 px-2 py-0.5 rounded-full border border-indigo-500/20"> </span>'),rr=R('<div class="flex flex-wrap gap-1 mb-3"></div>'),ar=R('<div class="absolute inset-0 bg-yellow-400/5 animate-pulse"></div>'),nr=R('<span class="text-[10px] animate-bounce">✨</span>'),ir=R('<div class="relative bg-black/40 rounded-xl p-3 flex justify-between items-center border border-white/5 group-hover:border-white/10 transition-colors overflow-hidden"><!> <div class="flex flex-col"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div class="text-xs font-mono text-indigo-300 font-bold"> </div></div> <div class="flex flex-col items-end"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div> <!></div></div></div>'),or=R('<div class="relative bg-slate-800/40 hover:bg-slate-800/60 transition-colors rounded-2xl border border-white/5 p-4 shadow-xl overflow-hidden group animate-in slide-in-from-right-8 duration-300"><div></div> <div class="flex justify-between items-start mb-3"><div class="flex flex-col"><div class="flex items-center gap-2"><span> </span> <!></div></div> <span class="text-[9px] text-slate-500 font-black tracking-widest uppercase"> </span></div> <div class="flex items-center gap-3 mb-2"><div class="flex-1"><div class="font-black text-white text-sm uppercase tracking-tight leading-snug"> </div> <!></div></div> <!> <!></div>'),sr=R('<!> <aside><div class="px-6 py-5 border-b border-white/5 flex justify-between items-center bg-slate-950/50"><div class="flex items-center gap-3"><div class="p-2 bg-indigo-500/10 rounded-lg border border-indigo-500/20"><!></div> <div><h3 class="font-black text-white uppercase tracking-widest text-sm"> </h3> <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter"> </p></div></div> <button class="p-2 hover:bg-white/5 rounded-full text-slate-400 hover:text-white transition-all active:scale-90"><!></button></div> <div class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 custom-scrollbar"><!> <!></div> <div class="p-6 border-t border-white/5 bg-slate-950/80"><button class="w-full py-3 text-xs font-black uppercase tracking-[0.2em] text-red-400/70 hover:text-red-400 border border-red-900/30 rounded-xl hover:bg-red-900/20 transition-all flex items-center justify-center gap-3 active:scale-[0.98]"><!> </button></div></aside>',1);function Jr(h,n){Ee(n,!0);const l=()=>He(it,"$t",u),d=()=>He(Ct,"$rollHistory",u),[u,m]=ot();let c=z(n,"isOpen",3,!1);var g=sr(),E=V(g);{var L=B=>{var A=Kt();A.__click=function(...M){n.onClose?.apply(this,M)},F(M=>Ie(A,"aria-label",M),[()=>l()("character.history.close")]),x(B,A)};Z(E,B=>{c()&&B(L)})}var w=_(E,2),N=v(w),y=v(N),P=v(y),O=v(P);Ve(O,{size:20,class:"text-indigo-400"}),f(P);var C=_(P,2),b=v(C),o=v(b,!0);f(b);var i=_(b,2),t=v(i);f(i),f(C),f(y);var e=_(y,2);e.__click=function(...B){n.onClose?.apply(this,B)};var a=v(e);lt(a,{size:24}),f(e),f(N);var r=_(N,2),S=v(r);{var U=B=>{var A=Jt(),M=v(A),q=v(M);Ve(q,{size:32}),f(M);var Q=_(M,2),se=v(Q,!0);f(Q),f(A),F(Y=>D(se,Y),[()=>l()("character.history.none")]),x(B,A)};Z(S,B=>{d().length===0&&B(U)})}var W=_(S,2);Te(W,1,d,B=>B.id,(B,A)=>{const M=xt(()=>s(A).source?.toLowerCase());var q=or(),Q=v(q),se=_(Q,2),Y=v(se),ee=v(Y),ue=v(ee),Ne=v(ue,!0);f(ue);var _e=_(ue,2);{var pe=$=>{var G=Qt(),de=v(G,!0);f(G),F(()=>D(de,s(A).charName)),x($,G)};Z(_e,$=>{s(A).charName&&s(A).charName!==s(A).source&&$(pe)})}f(ee),f(Y);var te=_(Y,2),he=v(te,!0);f(te),f(se);var fe=_(se,2),be=v(fe),oe=v(be),le=v(oe,!0);f(oe);var Ae=_(oe,2);{var ye=$=>{var G=er(),de=v(G,!0);f(G),F(()=>D(de,s(A).description)),x($,G)};Z(Ae,$=>{s(A).description&&$(ye)})}f(be),f(fe);var p=_(fe,2);{var T=$=>{var G=rr();Te(G,21,()=>s(A).effectsApplied,nt,(de,we)=>{var me=tr(),Le=v(me,!0);f(me),F(()=>D(Le,s(we))),x(de,me)}),f(G),x($,G)};Z(p,$=>{s(A).effectsApplied?.length>0&&$(T)})}var j=_(p,2);{var k=$=>{var G=ir(),de=v(G);{var we=xe=>{var Pe=ar();x(xe,Pe)};Z(de,xe=>{s(A).crit&&xe(we)})}var me=_(de,2),Le=v(me),ut=v(Le,!0);f(Le);var ke=_(Le,2),ht=v(ke,!0);f(ke),f(me);var We=_(me,2),De=v(We),ft=v(De,!0);f(De);var ze=_(De,2),Ze=v(ze),vt=_(Ze);{var gt=xe=>{var Pe=nr();x(xe,Pe)};Z(vt,xe=>{s(A).crit&&xe(gt)})}f(ze),f(We),f(G),F((xe,Pe,pt)=>{D(ut,xe),D(ht,Pe),D(ft,pt),ve(ze,1,`text-3xl font-black font-mono leading-none flex items-baseline gap-1 ${s(A).crit?"text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.3)]":"text-white"}`),D(Ze,`${s(A).total??""} `)},[()=>l()("character.history.formula"),()=>s(A).formula||l()("character.history.fixed"),()=>l()("character.history.total")]),x($,G)};Z(j,$=>{(s(A).formula||s(A).total!==void 0)&&$(k)})}f(q),F(($,G)=>{ve(Q,1,`absolute left-0 top-0 bottom-0 w-1 ${s(A).source==="GM"?"bg-indigo-500":"bg-emerald-500"}`),ve(ue,1,`text-[10px] px-1.5 py-0.5 rounded ${s(A).source==="GM"?"bg-indigo-500/20 text-indigo-400":"bg-emerald-500/20 text-emerald-400"} uppercase font-black tracking-widest leading-none border border-current opacity-70`),D(Ne,$),D(he,G),D(le,s(A).name)},[()=>l()(`character.history.source.${s(M)}`,{default:s(A).source}),()=>new Date(s(A).timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),x(B,q)}),f(r);var X=_(r,2),ce=v(X);ce.__click=function(...B){Et.clearHistory?.apply(this,B)};var J=v(ce);It(J,{size:16});var ge=_(J);f(ce),f(X),f(w),F((B,A,M)=>{ve(w,1,`h-full bg-slate-900/95 backdrop-blur-xl border-l border-white/10 transition-all duration-500 ease-out shadow-[0_0_50px_rgba(0,0,0,0.5)] flex flex-col fixed top-0 right-0 z-[100] w-full sm:w-96 ${c()?"translate-x-0":"translate-x-full"}`),D(o,B),D(t,`${d().length??""} ${A??""}`),D(ge,` ${M??""}`)},[()=>l()("character.history.title"),()=>l()("character.history.rolls_count"),()=>l()("character.history.clear")]),x(h,g),Ce(),m()}Be(["click"]);function Ke(h,n,l){return h>=n*l?{width:n*l,height:n}:{width:h,height:h/l}}function je(h,n,l,d){return{x:Je(h.x,n.width,l.width,d),y:Je(h.y,n.height,l.height,d)}}function Je(h,n,l,d){let u=n*d/2-l/2;return d<1&&(u=l/2-n*d/2),Math.min(u,Math.max(h,-u))}function Qe(h,n){return Math.sqrt(Math.pow(h.y-n.y,2)+Math.pow(h.x-n.x,2))}function lr(h,n,l,d,u,m=!0){const c=m?dr:cr,g={x:c(100,((n.width-l.width/u)/2-h.x/u)/n.width*100),y:c(100,((n.height-l.height/u)/2-h.y/u)/n.height*100),width:c(100,l.width/n.width*100/u),height:c(100,l.height/n.height*100/u)},E=c(n.naturalWidth,g.width*n.naturalWidth/100,!0),L=c(n.naturalHeight,g.height*n.naturalHeight/100,!0),N=n.naturalWidth>=n.naturalHeight*d?{width:Math.round(L*d),height:L}:{width:E,height:Math.round(E/d)},y={...N,x:c(n.naturalWidth-N.width,g.x*n.naturalWidth/100,!0),y:c(n.naturalHeight-N.height,g.y*n.naturalHeight/100,!0)};return{croppedAreaPercentages:g,croppedAreaPixels:y}}function dr(h,n,l=!1){const d=l?Math.round(n):n;return Math.min(h,Math.max(0,d))}function cr(h,n){return n}function et(h,n){return{x:(n.x+h.x)/2,y:(n.y+h.y)/2}}var ur=R('<div data-testid="cropper"></div>'),hr=R('<div class="svelte-easy-crop-container svelte-1yetlj5" role="button" data-testid="container"><img class="svelte-easy-crop-image svelte-1yetlj5" alt=""/> <!></div>');function fr(h,n){Ee(n,!0);let l=z(n,"crop",31,()=>Me({x:0,y:0})),d=z(n,"zoom",15,1),u=z(n,"minZoom",11,1),m=z(n,"maxZoom",11,3),c=z(n,"aspect",3,4/3),g=z(n,"cropSize",3,null),E=z(n,"cropShape",3,"rect"),L=z(n,"showGrid",3,!0),w=z(n,"zoomSpeed",3,1),N=z(n,"crossOrigin",3,null),y=z(n,"restrictPosition",3,!0),P=z(n,"tabindex",3,void 0),O=H(null),C=H(Me({width:0,height:0,naturalWidth:0,naturalHeight:0})),b=H(null),o=H(null),i=H(null),t=H(Me({x:0,y:0})),e=H(Me({x:0,y:0})),a=H(0),r=H(null),S=H(null);yt(()=>{s(i)&&s(i).complete&&X(),s(b)&&(s(b).addEventListener("gesturestart",U),s(b).addEventListener("gesturechange",U))}),at(()=>{s(b)&&(s(b).removeEventListener("gesturestart",U),s(b).removeEventListener("gesturechange",U)),W()});const U=p=>p.preventDefault(),W=()=>{typeof document<"u"&&(document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",ee),document.removeEventListener("touchmove",Q),document.removeEventListener("touchend",ee))},X=()=>{J(),fe()},ce=()=>g()?g().width/g().height:c(),J=()=>{s(i)&&(I(C,{width:s(i).width,height:s(i).height,naturalWidth:s(i).naturalWidth,naturalHeight:s(i).naturalHeight},!0),I(O,g()?g():Ke(s(i).width,s(i).height,c()),!0)),s(b)&&I(o,s(b).getBoundingClientRect(),!0)},ge=p=>({x:Number(p.clientX),y:Number(p.clientY)}),B=p=>({x:Number(p.clientX),y:Number(p.clientY)}),A=p=>{p.preventDefault(),document.addEventListener("mousemove",M),document.addEventListener("mouseup",ee),se(ge(p))},M=p=>Y(ge(p)),q=p=>{p.preventDefault(),document.addEventListener("touchmove",Q,{passive:!1}),document.addEventListener("touchend",ee),p.touches.length===2?ue(p):p.touches.length===1&&se(B(p.touches[0]))},Q=p=>{p.preventDefault(),p.touches.length===2?Ne(p):p.touches.length===1&&Y(B(p.touches[0]))},se=({x:p,y:T})=>{I(t,{x:p,y:T},!0),I(e,{x:l().x,y:l().y},!0)},Y=({x:p,y:T})=>{s(r)&&window.cancelAnimationFrame(s(r)),I(r,window.requestAnimationFrame(()=>{if(p===void 0||T===void 0||!s(O))return;const j=p-s(t).x,k=T-s(t).y,$={x:s(e).x+j,y:s(e).y+k};l(y()?je($,s(C),s(O),d()):$)}),!0)},ee=()=>{W(),fe()},ue=p=>{const T=B(p.touches[0]),j=B(p.touches[1]);I(a,Qe(T,j),!0),se(et(T,j))},Ne=p=>{const T=B(p.touches[0]),j=B(p.touches[1]),k=et(T,j);Y(k),s(S)&&window.cancelAnimationFrame(s(S)),I(S,window.requestAnimationFrame(()=>{const $=Qe(T,j),G=d()*($/s(a));he(G,k),I(a,$,!0)}),!0)},_e=p=>{p.preventDefault();const T=ge(p),j=d()-p.deltaY*w()/200;he(j,T)},pe=({x:p,y:T})=>{if(!s(o))throw new Error("The Cropper is not mounted");return{x:s(o).width/2-(p-s(o).left),y:s(o).height/2-(T-s(o).top)}},te=({x:p,y:T})=>({x:(p+l().x)/d(),y:(T+l().y)/d()}),he=(p,T)=>{if(!s(O))return;const j=pe(T),k=te(j);d(Math.min(m(),Math.max(p,u())));const $={x:k.x*d()-j.x,y:k.y*d()-j.y};l(y()?je($,s(C),s(O),d()):$)},fe=()=>{if(!s(O)||s(O).width===0)return;const p=y()?je(l(),s(C),s(O),d()):l(),{croppedAreaPercentages:T,croppedAreaPixels:j}=lr(p,s(C),s(O),ce(),d(),y());n.oncropcomplete?.({percent:T,pixels:j})};Se(()=>{s(i)&&I(O,g()?g():Ke(s(i).width,s(i).height,c()),!0)}),Se(()=>{d()&&fe()});const be=p=>{Se(()=>(p.addEventListener("touchstart",q),p.addEventListener("mousedown",A),p.addEventListener("wheel",_e,{passive:!1}),()=>{p.removeEventListener("touchstart",q),p.removeEventListener("mousedown",A),p.removeEventListener("wheel",_e)}))};var oe=hr();Re("resize",_t,J);var le=v(oe);Oe(le,p=>I(i,p),()=>s(i));var Ae=_(le,2);{var ye=p=>{var T=ur();let j;F(()=>{j=ve(T,1,"svelte-easy-crop-area svelte-1yetlj5",null,j,{"svelte-easy-crop-round":E()==="round","svelte-easy-crop-grid":L()}),Ge(T,`width: ${s(O).width??""}px; height: ${s(O).height??""}px;`)}),x(p,T)};Z(Ae,p=>{s(O)&&p(ye)})}f(oe),Oe(oe,p=>I(b,p),()=>s(b)),Bt(oe,p=>be?.(p)),F(()=>{Ie(oe,"tabindex",P()),Ie(le,"src",n.image),Ge(le,`transform: translate(${l().x??""}px, ${l().y??""}px) scale(${d()??""});`),Ie(le,"crossorigin",N())}),Re("load",le,X),wt(le),x(h,oe),Ce()}const vr=h=>new Promise((n,l)=>{const d=new Image;d.addEventListener("load",()=>n(d)),d.addEventListener("error",u=>l(u)),d.setAttribute("crossOrigin","anonymous"),d.src=h});function ct(h){return h*Math.PI/180}function gr(h,n,l){const d=ct(l);return{width:Math.abs(Math.cos(d)*h)+Math.abs(Math.sin(d)*n),height:Math.abs(Math.sin(d)*h)+Math.abs(Math.cos(d)*n)}}async function pr(h,n,l=0,d={horizontal:!1,vertical:!1}){const u=await vr(h),m=document.createElement("canvas"),c=m.getContext("2d");if(!c)return null;const g=ct(l),{width:E,height:L}=gr(u.width,u.height,l);m.width=E,m.height=L,c.translate(E/2,L/2),c.rotate(g),c.scale(d.horizontal?-1:1,d.vertical?-1:1),c.translate(-u.width/2,-u.height/2),c.drawImage(u,0,0);const w=c.getImageData(n.x,n.y,n.width,n.height);return m.width=n.width,m.height=n.height,c.putImageData(w,0,0),new Promise((N,y)=>{m.toBlob(P=>{N(P)},"image/jpeg",.8)})}var br=R('<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Processando...',1),mr=R("<!> Salvar Foto",1),xr=R('<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4 animate-in fade-in duration-200" role="dialog" aria-modal="true"><div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl flex flex-col shadow-2xl overflow-hidden max-h-[90vh]"><div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950"><h3 class="font-bold text-white flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-indigo-500"></div> Editar Imagem</h3> <button class="text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-800 transition-colors"><!></button></div> <div class="relative flex-1 bg-black min-h-[400px]"><!></div> <div class="p-4 bg-slate-950 border-t border-slate-800 space-y-4"><div class="flex items-center gap-4"><div class="flex items-center gap-2 text-slate-400 w-full px-4"><!> <input type="range" min="1" max="3" step="0.1" class="w-full accent-indigo-500 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer"/></div></div> <div class="flex justify-end gap-3 pt-2"><button class="px-6 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-bold transition-all text-sm border border-slate-700">Cancelar</button> <button class="px-8 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold transition-all text-sm shadow-lg shadow-indigo-900/20 flex items-center gap-2"><!></button></div></div></div></div>');function Qr(h,n){Ee(n,!0);let l=z(n,"isOpen",3,!1),d=z(n,"imageUrl",3,""),u=z(n,"aspectRatio",3,1),m=H(Me({x:0,y:0})),c=H(1),g=H(null),E=H(!1);async function L(){if(console.log("handleSave called",{isProcessing:s(E),pixelCrop:s(g)}),!(s(E)||!s(g))){I(E,!0);try{console.log("Calling getCroppedImg with",{imageUrl:d().substring(0,50)+"...",pixelCrop:s(g)});const P=await pr(d(),s(g),0);console.log("getCroppedImg result:",P),P&&n.onCrop(P)}catch(P){console.error("Error in handleSave:",P)}finally{I(E,!1)}}}var w=K(),N=V(w);{var y=P=>{var O=xr(),C=v(O),b=v(C),o=_(v(b),2);o.__click=function(...M){n.onClose?.apply(this,M)};var i=v(o);lt(i,{size:20}),f(o),f(b);var t=_(b,2),e=v(t);fr(e,{get image(){return d()},get aspect(){return u()},oncropcomplete:M=>{console.log("oncropcomplete prop data:",M),I(g,M.pixels,!0)},showGrid:!0,get crop(){return s(m)},set crop(M){I(m,M,!0)},get zoom(){return s(c)},set zoom(M){I(c,M,!0)}}),f(t);var a=_(t,2),r=v(a),S=v(r),U=v(S);Tt(U,{size:16});var W=_(U,2);Mt(W),f(S),f(r);var X=_(r,2),ce=v(X);ce.__click=function(...M){n.onClose?.apply(this,M)};var J=_(ce,2);J.__click=L;var ge=v(J);{var B=M=>{var q=br();Fe(),x(M,q)},A=M=>{var q=mr(),Q=V(q);St(Q,{size:18}),Fe(),x(M,q)};Z(ge,M=>{s(E)?M(B):M(A,!1)})}f(J),f(X),f(a),f(C),f(O),F(()=>J.disabled=s(E)),Nt(W,()=>s(c),M=>I(c,M)),x(P,O)};Z(N,P=>{l()&&P(y)})}x(h,w),Ce()}Be(["click"]);var _r=R('<span class="text-[10px] text-indigo-300 uppercase font-bold mb-2 block"> </span>'),yr=R('<div><!> <div class="flex items-center justify-between bg-black/40 rounded-xl p-1.5 border border-white/5" role="group" aria-label="Seletor de Tamanho"><button type="button" class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-all active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Diminuir"><!></button> <div class="flex flex-col items-center min-w-[3rem]"><span class="text-2xl font-black text-white leading-none tracking-tighter" data-testid="size-display"> </span></div> <button type="button" class="w-10 h-10 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition-all active:scale-90 shadow-lg shadow-indigo-500/20 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Aumentar"><!></button></div></div>');function ea(h,n){Ee(n,!0);const l=[.125,.5,...Array.from({length:20},(o,i)=>i+1)];function d(){const o=l.indexOf(n.value);if(o>0)n.onUpdate(l[o-1]);else if(o===-1){const i=l.slice().reverse().find(t=>t<n.value);i?n.onUpdate(i):n.onUpdate(l[0])}}function u(){const o=l.indexOf(n.value);if(o!==-1&&o<l.length-1)n.onUpdate(l[o+1]);else if(o===-1){const i=l.find(t=>t>n.value);i?n.onUpdate(i):n.onUpdate(l[l.length-1])}}function m(o){return o===.125?"1/8":o===.5?"1/2":o.toString()}var c=yr(),g=v(c);{var E=o=>{var i=_r(),t=v(i,!0);f(i),F(()=>D(t,n.label)),x(o,i)};Z(g,o=>{n.label&&o(E)})}var L=_(g,2),w=v(L);w.__click=d;var N=v(w);dt(N,{size:18}),f(w);var y=_(w,2),P=v(y),O=v(P,!0);f(P),f(y);var C=_(y,2);C.__click=u;var b=v(C);st(b,{size:18}),f(C),f(L),f(c),F(o=>{w.disabled=n.value<=l[0],D(O,o),C.disabled=n.value>=l[l.length-1]},[()=>m(n.value)]),x(h,c),Ce()}Be(["click"]);export{kr as A,Tr as B,Dr as C,Rt as D,Ur as E,jr as G,Jr as H,Qr as I,Fr as L,dt as M,Gr as R,ea as S,Kr as T,Zr as W,Bt as a,Yr as b,zr as c,Or as d,Hr as e,Ve as f,Vr as g,Wr as h,qr as i,Xr as s};
