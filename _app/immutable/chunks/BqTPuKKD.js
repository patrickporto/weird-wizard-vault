import{bk as Ec,an as kc,u as Sc,r as _c,h as Ac,aT as Xe,bl as xc}from"./COX-Du3q.js";import{q as Bt,w as Vt,g as Qt}from"./B1e8pvGG.js";import{_ as qs}from"./-uljABfF.js";function mf(e,t,n=t){var r=new WeakSet;Ec(e,"input",async s=>{var i=s?e.defaultValue:e.value;if(i=Br(e)?Ur(i):i,n(i),Xe!==null&&r.add(Xe),await kc(),i!==(i=t())){var l=e.selectionStart,f=e.selectionEnd,h=e.value.length;if(e.value=i??"",f!==null){var g=e.value.length;l===f&&f===h&&g>h?(e.selectionStart=g,e.selectionEnd=g):(e.selectionStart=l,e.selectionEnd=Math.min(f,g))}}}),(Ac&&e.defaultValue!==e.value||Sc(t)==null&&e.value)&&(n(Br(e)?Ur(e.value):e.value),Xe!==null&&r.add(Xe)),_c(()=>{var s=t();if(e===document.activeElement){var i=xc??Xe;if(r.has(i))return}Br(e)&&s===Ur(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Br(e){var t=e.type;return t==="number"||t==="range"}function Ur(e){return e===""?null:+e}const Gs=globalThis||void 0||self,mt=()=>new Map,Yr=e=>{const t=mt();return e.forEach((n,r)=>{t.set(r,n)}),t},zt=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Cc=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},Ic=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},de=()=>new Set,Lr=e=>e[e.length-1],Dc=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},ne=Array.from,ps=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},Bi=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},Tc=(e,t)=>{const n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n},dr=Array.isArray;class Rc{constructor(){this._observers=mt()}on(t,n){return zt(this._observers,t,de).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return ne((this._observers.get(t)||mt()).values()).forEach(r=>r(...n))}destroy(){this._observers=mt()}}class Bc{constructor(){this._observers=mt()}on(t,n){zt(this._observers,t,de).add(n)}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return ne((this._observers.get(t)||mt()).values()).forEach(r=>r(...n))}destroy(){this._observers=mt()}}const Nt=Math.floor,jn=Math.abs,Ui=(e,t)=>e<t?e:t,ye=(e,t)=>e>t?e:t,Li=e=>e!==0?e<0:1/e<0,Js=1,Ws=2,vr=4,Mr=8,an=32,Wt=64,Et=128,pr=31,Kr=63,he=127,Uc=2147483647,tr=Number.MAX_SAFE_INTEGER,zs=Number.MIN_SAFE_INTEGER,Lc=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Nt(e)===e),vc=String.fromCharCode,Mc=e=>e.toLowerCase(),Oc=/^\s*/g,Fc=e=>e.replace(Oc,""),Nc=/([A-Z])/g,Ys=(e,t)=>Fc(e.replace(Nc,n=>`${t}${Mc(n)}`)),$c=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},un=typeof TextEncoder<"u"?new TextEncoder:null,Pc=e=>un.encode(e),Vc=un?Pc:$c;let cn=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});cn&&cn.decode(new Uint8Array).length===1&&(cn=null);const jc=(e,t)=>Tc(t,()=>e).join("");class _n{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gr=()=>new _n,Hc=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Ft=e=>{const t=new Uint8Array(Hc(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},qc=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ye(n,t)*2),e.cpos=0)},st=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Xr=st,O=(e,t)=>{for(;t>he;)st(e,Et|he&t),t=Nt(t/128);st(e,he&t)},gs=(e,t)=>{const n=Li(t);for(n&&(t=-t),st(e,(t>Kr?Et:0)|(n?Wt:0)|Kr&t),t=Nt(t/64);t>0;)st(e,(t>he?Et:0)|he&t),t=Nt(t/128)},Zr=new Uint8Array(3e4),Gc=Zr.length/3,Jc=(e,t)=>{if(t.length<Gc){const n=un.encodeInto(t,Zr).written||0;O(e,n);for(let r=0;r<n;r++)st(e,Zr[r])}else yt(e,Vc(t))},Wc=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;O(e,r);for(let s=0;s<r;s++)st(e,n.codePointAt(s))},Re=un&&un.encodeInto?Jc:Wc,mr=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Ui(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ye(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},yt=(e,t)=>{O(e,t.byteLength),mr(e,t)},ms=(e,t)=>{qc(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},zc=(e,t)=>ms(e,4).setFloat32(0,t,!1),Yc=(e,t)=>ms(e,8).setFloat64(0,t,!1),Kc=(e,t)=>ms(e,8).setBigInt64(0,t,!1),Ks=new DataView(new ArrayBuffer(4)),Xc=e=>(Ks.setFloat32(0,e),Ks.getFloat32(0)===e),hn=(e,t)=>{switch(typeof t){case"string":st(e,119),Re(e,t);break;case"number":Lc(t)&&jn(t)<=Uc?(st(e,125),gs(e,t)):Xc(t)?(st(e,124),zc(e,t)):(st(e,123),Yc(e,t));break;case"bigint":st(e,122),Kc(e,t);break;case"object":if(t===null)st(e,126);else if(dr(t)){st(e,117),O(e,t.length);for(let n=0;n<t.length;n++)hn(e,t[n])}else if(t instanceof Uint8Array)st(e,116),yt(e,t);else{st(e,118);const n=Object.keys(t);O(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];Re(e,s),hn(e,t[s])}}break;case"boolean":st(e,t?120:121);break;default:st(e,127)}};class Xs extends _n{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&O(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Zs=e=>{e.count>0&&(gs(e.encoder,e.count===1?e.s:-e.s),e.count>1&&O(e.encoder,e.count-2))};class Hn{constructor(){this.encoder=new _n,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Zs(this),this.count=1,this.s=t)}toUint8Array(){return Zs(this),Ft(this.encoder)}}const Qs=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);gs(e.encoder,t),e.count>1&&O(e.encoder,e.count-2)}};class Or{constructor(){this.encoder=new _n,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Qs(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Qs(this),Ft(this.encoder)}}class Zc{constructor(){this.sarr=[],this.s="",this.lensE=new Hn}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new _n;return this.sarr.push(this.s),this.s="",Re(t,this.sarr.join("")),mr(t,this.lensE.toUint8Array()),Ft(t)}}const Rt=e=>new Error(e),Tt=()=>{throw Rt("Method unimplemented")},Ct=()=>{throw Rt("Unexpected case")},vi=Rt("Unexpected end of array"),Mi=Rt("Integer out of Range");class wr{constructor(t){this.arr=t,this.pos=0}}const qe=e=>new wr(e),Qc=e=>e.pos!==e.arr.length,tl=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},bt=e=>tl(e,B(e)),Fe=e=>e.arr[e.pos++],B=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&he)*n,n*=128,s<Et)return t;if(t>tr)throw Mi}throw vi},ws=e=>{let t=e.arr[e.pos++],n=t&Kr,r=64;const s=(t&Wt)>0?-1:1;if((t&Et)===0)return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&he)*r,r*=128,t<Et)return s*n;if(n>tr)throw Mi}throw vi},el=e=>{let t=B(e);if(t===0)return"";{let n=String.fromCodePoint(Fe(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Fe(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},nl=e=>cn.decode(bt(e)),Be=cn?nl:el,ys=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},rl=e=>ys(e,4).getFloat32(0,!1),sl=e=>ys(e,8).getFloat64(0,!1),il=e=>ys(e,8).getBigInt64(0,!1),ol=[e=>{},e=>null,ws,rl,sl,il,e=>!1,e=>!0,Be,e=>{const t=B(e),n={};for(let r=0;r<t;r++){const s=Be(e);n[s]=fn(e)}return n},e=>{const t=B(e),n=[];for(let r=0;r<t;r++)n.push(fn(e));return n},bt],fn=e=>ol[127-Fe(e)](e);class ti extends wr{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Qc(this)?this.count=B(this)+1:this.count=-1),this.count--,this.s}}class qn extends wr{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=ws(this);const t=Li(this.s);this.count=1,t&&(this.s=-this.s,this.count=B(this)+2)}return this.count--,this.s}}class Fr extends wr{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=ws(this),n=t&1;this.diff=Nt(t/2),this.count=1,n&&(this.count=B(this)+2)}return this.s+=this.diff,this.count--,this.s}}class cl{constructor(t){this.decoder=new qn(t),this.str=Be(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const ll=crypto.getRandomValues.bind(crypto),Oi=()=>ll(new Uint32Array(1))[0],al="10000000-1000-4000-8000"+-1e11,ul=()=>al.replace(/[018]/g,e=>(e^Oi()&15>>e/4).toString(16)),Ne=e=>new Promise(e);Promise.all.bind(Promise);var hl={},yr={};yr.byteLength=pl;yr.toByteArray=ml;yr.fromByteArray=bl;var Ot=[],St=[],fl=typeof Uint8Array<"u"?Uint8Array:Array,Nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var xe=0,dl=Nr.length;xe<dl;++xe)Ot[xe]=Nr[xe],St[Nr.charCodeAt(xe)]=xe;St[45]=62;St[95]=63;function Fi(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function pl(e){var t=Fi(e),n=t[0],r=t[1];return(n+r)*3/4-r}function gl(e,t,n){return(t+n)*3/4-n}function ml(e){var t,n=Fi(e),r=n[0],s=n[1],i=new fl(gl(e,r,s)),l=0,f=s>0?r-4:r,h;for(h=0;h<f;h+=4)t=St[e.charCodeAt(h)]<<18|St[e.charCodeAt(h+1)]<<12|St[e.charCodeAt(h+2)]<<6|St[e.charCodeAt(h+3)],i[l++]=t>>16&255,i[l++]=t>>8&255,i[l++]=t&255;return s===2&&(t=St[e.charCodeAt(h)]<<2|St[e.charCodeAt(h+1)]>>4,i[l++]=t&255),s===1&&(t=St[e.charCodeAt(h)]<<10|St[e.charCodeAt(h+1)]<<4|St[e.charCodeAt(h+2)]>>2,i[l++]=t>>8&255,i[l++]=t&255),i}function wl(e){return Ot[e>>18&63]+Ot[e>>12&63]+Ot[e>>6&63]+Ot[e&63]}function yl(e,t,n){for(var r,s=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(e[i+2]&255),s.push(wl(r));return s.join("")}function bl(e){for(var t,n=e.length,r=n%3,s=[],i=16383,l=0,f=n-r;l<f;l+=i)s.push(yl(e,l,l+i>f?f:l+i));return r===1?(t=e[n-1],s.push(Ot[t>>2]+Ot[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],s.push(Ot[t>>10]+Ot[t>>4&63]+Ot[t<<2&63]+"=")),s.join("")}var bs={};bs.read=function(e,t,n,r,s){var i,l,f=s*8-r-1,h=(1<<f)-1,g=h>>1,u=-7,p=n?s-1:0,w=n?-1:1,b=e[t+p];for(p+=w,i=b&(1<<-u)-1,b>>=-u,u+=f;u>0;i=i*256+e[t+p],p+=w,u-=8);for(l=i&(1<<-u)-1,i>>=-u,u+=r;u>0;l=l*256+e[t+p],p+=w,u-=8);if(i===0)i=1-g;else{if(i===h)return l?NaN:(b?-1:1)*(1/0);l=l+Math.pow(2,r),i=i-g}return(b?-1:1)*l*Math.pow(2,i-r)};bs.write=function(e,t,n,r,s,i){var l,f,h,g=i*8-s-1,u=(1<<g)-1,p=u>>1,w=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=r?0:i-1,k=r?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,l=u):(l=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-l))<1&&(l--,h*=2),l+p>=1?t+=w/h:t+=w*Math.pow(2,1-p),t*h>=2&&(l++,h/=2),l+p>=u?(f=0,l=u):l+p>=1?(f=(t*h-1)*Math.pow(2,s),l=l+p):(f=t*Math.pow(2,p-1)*Math.pow(2,s),l=0));s>=8;e[n+b]=f&255,b+=k,f/=256,s-=8);for(l=l<<s|f,g+=s;g>0;e[n+b]=l&255,b+=k,l/=256,g-=8);e[n+b-k]|=_*128};(function(e){const t=yr,n=bs,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=K,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s;const{Uint8Array:i,ArrayBuffer:l,SharedArrayBuffer:f}=globalThis;u.TYPED_ARRAY_SUPPORT=h(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const a=new i(1),o={foo:function(){return 42}};return Object.setPrototypeOf(o,i.prototype),Object.setPrototypeOf(a,o),a.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function g(a){if(a>s)throw new RangeError('The value "'+a+'" is invalid for option "size"');const o=new i(a);return Object.setPrototypeOf(o,u.prototype),o}function u(a,o,c){if(typeof a=="number"){if(typeof o=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return k(a)}return p(a,o,c)}u.poolSize=8192;function p(a,o,c){if(typeof a=="string")return _(a,o);if(l.isView(a))return lt(a);if(a==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(Ut(a,l)||a&&Ut(a.buffer,l)||typeof f<"u"&&(Ut(a,f)||a&&Ut(a.buffer,f)))return Y(a,o,c);if(typeof a=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const d=a.valueOf&&a.valueOf();if(d!=null&&d!==a)return u.from(d,o,c);const m=C(a);if(m)return m;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof a[Symbol.toPrimitive]=="function")return u.from(a[Symbol.toPrimitive]("string"),o,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}u.from=function(a,o,c){return p(a,o,c)},Object.setPrototypeOf(u.prototype,i.prototype),Object.setPrototypeOf(u,i);function w(a){if(typeof a!="number")throw new TypeError('"size" argument must be of type number');if(a<0)throw new RangeError('The value "'+a+'" is invalid for option "size"')}function b(a,o,c){return w(a),a<=0?g(a):o!==void 0?typeof c=="string"?g(a).fill(o,c):g(a).fill(o):g(a)}u.alloc=function(a,o,c){return b(a,o,c)};function k(a){return w(a),g(a<0?0:T(a)|0)}u.allocUnsafe=function(a){return k(a)},u.allocUnsafeSlow=function(a){return k(a)};function _(a,o){if((typeof o!="string"||o==="")&&(o="utf8"),!u.isEncoding(o))throw new TypeError("Unknown encoding: "+o);const c=dt(a,o)|0;let d=g(c);const m=d.write(a,o);return m!==c&&(d=d.slice(0,m)),d}function F(a){const o=a.length<0?0:T(a.length)|0,c=g(o);for(let d=0;d<o;d+=1)c[d]=a[d]&255;return c}function lt(a){if(Ut(a,i)){const o=new i(a);return Y(o.buffer,o.byteOffset,o.byteLength)}return F(a)}function Y(a,o,c){if(o<0||a.byteLength<o)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<o+(c||0))throw new RangeError('"length" is outside of buffer bounds');let d;return o===void 0&&c===void 0?d=new i(a):c===void 0?d=new i(a,o):d=new i(a,o,c),Object.setPrototypeOf(d,u.prototype),d}function C(a){if(u.isBuffer(a)){const o=T(a.length)|0,c=g(o);return c.length===0||a.copy(c,0,0,o),c}if(a.length!==void 0)return typeof a.length!="number"||Rr(a.length)?g(0):F(a);if(a.type==="Buffer"&&Array.isArray(a.data))return F(a.data)}function T(a){if(a>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return a|0}function K(a){return+a!=a&&(a=0),u.alloc(+a)}u.isBuffer=function(o){return o!=null&&o._isBuffer===!0&&o!==u.prototype},u.compare=function(o,c){if(Ut(o,i)&&(o=u.from(o,o.offset,o.byteLength)),Ut(c,i)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(o)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(o===c)return 0;let d=o.length,m=c.length;for(let y=0,E=Math.min(d,m);y<E;++y)if(o[y]!==c[y]){d=o[y],m=c[y];break}return d<m?-1:m<d?1:0},u.isEncoding=function(o){switch(String(o).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(o,c){if(!Array.isArray(o))throw new TypeError('"list" argument must be an Array of Buffers');if(o.length===0)return u.alloc(0);let d;if(c===void 0)for(c=0,d=0;d<o.length;++d)c+=o[d].length;const m=u.allocUnsafe(c);let y=0;for(d=0;d<o.length;++d){let E=o[d];if(Ut(E,i))y+E.length>m.length?(u.isBuffer(E)||(E=u.from(E)),E.copy(m,y)):i.prototype.set.call(m,E,y);else if(u.isBuffer(E))E.copy(m,y);else throw new TypeError('"list" argument must be an Array of Buffers');y+=E.length}return m};function dt(a,o){if(u.isBuffer(a))return a.length;if(l.isView(a)||Ut(a,l))return a.byteLength;if(typeof a!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);const c=a.length,d=arguments.length>2&&arguments[2]===!0;if(!d&&c===0)return 0;let m=!1;for(;;)switch(o){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return Tr(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return Hs(a).length;default:if(m)return d?-1:Tr(a).length;o=(""+o).toLowerCase(),m=!0}}u.byteLength=dt;function se(a,o,c){let d=!1;if((o===void 0||o<0)&&(o=0),o>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,o>>>=0,c<=o))return"";for(a||(a="utf8");;)switch(a){case"hex":return It(this,o,c);case"utf8":case"utf-8":return x(this,o,c);case"ascii":return at(this,o,c);case"latin1":case"binary":return nt(this,o,c);case"base64":return V(this,o,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,o,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}u.prototype._isBuffer=!0;function pt(a,o,c){const d=a[o];a[o]=a[c],a[c]=d}u.prototype.swap16=function(){const o=this.length;if(o%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<o;c+=2)pt(this,c,c+1);return this},u.prototype.swap32=function(){const o=this.length;if(o%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<o;c+=4)pt(this,c,c+3),pt(this,c+1,c+2);return this},u.prototype.swap64=function(){const o=this.length;if(o%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<o;c+=8)pt(this,c,c+7),pt(this,c+1,c+6),pt(this,c+2,c+5),pt(this,c+3,c+4);return this},u.prototype.toString=function(){const o=this.length;return o===0?"":arguments.length===0?x(this,0,o):se.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(o){if(!u.isBuffer(o))throw new TypeError("Argument must be a Buffer");return this===o?!0:u.compare(this,o)===0},u.prototype.inspect=function(){let o="";const c=e.INSPECT_MAX_BYTES;return o=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(o+=" ... "),"<Buffer "+o+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(o,c,d,m,y){if(Ut(o,i)&&(o=u.from(o,o.offset,o.byteLength)),!u.isBuffer(o))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof o);if(c===void 0&&(c=0),d===void 0&&(d=o?o.length:0),m===void 0&&(m=0),y===void 0&&(y=this.length),c<0||d>o.length||m<0||y>this.length)throw new RangeError("out of range index");if(m>=y&&c>=d)return 0;if(m>=y)return-1;if(c>=d)return 1;if(c>>>=0,d>>>=0,m>>>=0,y>>>=0,this===o)return 0;let E=y-m,U=d-c;const J=Math.min(E,U),H=this.slice(m,y),W=o.slice(c,d);for(let $=0;$<J;++$)if(H[$]!==W[$]){E=H[$],U=W[$];break}return E<U?-1:U<E?1:0};function Se(a,o,c,d,m){if(a.length===0)return-1;if(typeof c=="string"?(d=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Rr(c)&&(c=m?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(m)return-1;c=a.length-1}else if(c<0)if(m)c=0;else return-1;if(typeof o=="string"&&(o=u.from(o,d)),u.isBuffer(o))return o.length===0?-1:ie(a,o,c,d,m);if(typeof o=="number")return o=o&255,typeof i.prototype.indexOf=="function"?m?i.prototype.indexOf.call(a,o,c):i.prototype.lastIndexOf.call(a,o,c):ie(a,[o],c,d,m);throw new TypeError("val must be string, number or Buffer")}function ie(a,o,c,d,m){let y=1,E=a.length,U=o.length;if(d!==void 0&&(d=String(d).toLowerCase(),d==="ucs2"||d==="ucs-2"||d==="utf16le"||d==="utf-16le")){if(a.length<2||o.length<2)return-1;y=2,E/=2,U/=2,c/=2}function J(W,$){return y===1?W[$]:W.readUInt16BE($*y)}let H;if(m){let W=-1;for(H=c;H<E;H++)if(J(a,H)===J(o,W===-1?0:H-W)){if(W===-1&&(W=H),H-W+1===U)return W*y}else W!==-1&&(H-=H-W),W=-1}else for(c+U>E&&(c=E-U),H=c;H>=0;H--){let W=!0;for(let $=0;$<U;$++)if(J(a,H+$)!==J(o,$)){W=!1;break}if(W)return H}return-1}u.prototype.includes=function(o,c,d){return this.indexOf(o,c,d)!==-1},u.prototype.indexOf=function(o,c,d){return Se(this,o,c,d,!0)},u.prototype.lastIndexOf=function(o,c,d){return Se(this,o,c,d,!1)};function _e(a,o,c,d){c=Number(c)||0;const m=a.length-c;d?(d=Number(d),d>m&&(d=m)):d=m;const y=o.length;d>y/2&&(d=y/2);let E;for(E=0;E<d;++E){const U=parseInt(o.substr(E*2,2),16);if(Rr(U))return E;a[c+E]=U}return E}function S(a,o,c,d){return Un(Tr(o,a.length-c),a,c,d)}function A(a,o,c,d){return Un(mc(o),a,c,d)}function R(a,o,c,d){return Un(Hs(o),a,c,d)}function v(a,o,c,d){return Un(wc(o,a.length-c),a,c,d)}u.prototype.write=function(o,c,d,m){if(c===void 0)m="utf8",d=this.length,c=0;else if(d===void 0&&typeof c=="string")m=c,d=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(d)?(d=d>>>0,m===void 0&&(m="utf8")):(m=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const y=this.length-c;if((d===void 0||d>y)&&(d=y),o.length>0&&(d<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");m||(m="utf8");let E=!1;for(;;)switch(m){case"hex":return _e(this,o,c,d);case"utf8":case"utf-8":return S(this,o,c,d);case"ascii":case"latin1":case"binary":return A(this,o,c,d);case"base64":return R(this,o,c,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,o,c,d);default:if(E)throw new TypeError("Unknown encoding: "+m);m=(""+m).toLowerCase(),E=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(a,o,c){return o===0&&c===a.length?t.fromByteArray(a):t.fromByteArray(a.slice(o,c))}function x(a,o,c){c=Math.min(a.length,c);const d=[];let m=o;for(;m<c;){const y=a[m];let E=null,U=y>239?4:y>223?3:y>191?2:1;if(m+U<=c){let J,H,W,$;switch(U){case 1:y<128&&(E=y);break;case 2:J=a[m+1],(J&192)===128&&($=(y&31)<<6|J&63,$>127&&(E=$));break;case 3:J=a[m+1],H=a[m+2],(J&192)===128&&(H&192)===128&&($=(y&15)<<12|(J&63)<<6|H&63,$>2047&&($<55296||$>57343)&&(E=$));break;case 4:J=a[m+1],H=a[m+2],W=a[m+3],(J&192)===128&&(H&192)===128&&(W&192)===128&&($=(y&15)<<18|(J&63)<<12|(H&63)<<6|W&63,$>65535&&$<1114112&&(E=$))}}E===null?(E=65533,U=1):E>65535&&(E-=65536,d.push(E>>>10&1023|55296),E=56320|E&1023),d.push(E),m+=U}return q(d)}const I=4096;function q(a){const o=a.length;if(o<=I)return String.fromCharCode.apply(String,a);let c="",d=0;for(;d<o;)c+=String.fromCharCode.apply(String,a.slice(d,d+=I));return c}function at(a,o,c){let d="";c=Math.min(a.length,c);for(let m=o;m<c;++m)d+=String.fromCharCode(a[m]&127);return d}function nt(a,o,c){let d="";c=Math.min(a.length,c);for(let m=o;m<c;++m)d+=String.fromCharCode(a[m]);return d}function It(a,o,c){const d=a.length;(!o||o<0)&&(o=0),(!c||c<0||c>d)&&(c=d);let m="";for(let y=o;y<c;++y)m+=yc[a[y]];return m}function N(a,o,c){const d=a.slice(o,c);let m="";for(let y=0;y<d.length-1;y+=2)m+=String.fromCharCode(d[y]+d[y+1]*256);return m}u.prototype.slice=function(o,c){const d=this.length;o=~~o,c=c===void 0?d:~~c,o<0?(o+=d,o<0&&(o=0)):o>d&&(o=d),c<0?(c+=d,c<0&&(c=0)):c>d&&(c=d),c<o&&(c=o);const m=this.subarray(o,c);return Object.setPrototypeOf(m,u.prototype),m};function M(a,o,c){if(a%1!==0||a<0)throw new RangeError("offset is not uint");if(a+o>c)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(o,c,d){o=o>>>0,c=c>>>0,d||M(o,c,this.length);let m=this[o],y=1,E=0;for(;++E<c&&(y*=256);)m+=this[o+E]*y;return m},u.prototype.readUintBE=u.prototype.readUIntBE=function(o,c,d){o=o>>>0,c=c>>>0,d||M(o,c,this.length);let m=this[o+--c],y=1;for(;c>0&&(y*=256);)m+=this[o+--c]*y;return m},u.prototype.readUint8=u.prototype.readUInt8=function(o,c){return o=o>>>0,c||M(o,1,this.length),this[o]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(o,c){return o=o>>>0,c||M(o,2,this.length),this[o]|this[o+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(o,c){return o=o>>>0,c||M(o,2,this.length),this[o]<<8|this[o+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(o,c){return o=o>>>0,c||M(o,4,this.length),(this[o]|this[o+1]<<8|this[o+2]<<16)+this[o+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(o,c){return o=o>>>0,c||M(o,4,this.length),this[o]*16777216+(this[o+1]<<16|this[o+2]<<8|this[o+3])},u.prototype.readBigUInt64LE=Zt(function(o){o=o>>>0,Ae(o,"offset");const c=this[o],d=this[o+7];(c===void 0||d===void 0)&&Ke(o,this.length-8);const m=c+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24,y=this[++o]+this[++o]*2**8+this[++o]*2**16+d*2**24;return BigInt(m)+(BigInt(y)<<BigInt(32))}),u.prototype.readBigUInt64BE=Zt(function(o){o=o>>>0,Ae(o,"offset");const c=this[o],d=this[o+7];(c===void 0||d===void 0)&&Ke(o,this.length-8);const m=c*2**24+this[++o]*2**16+this[++o]*2**8+this[++o],y=this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+d;return(BigInt(m)<<BigInt(32))+BigInt(y)}),u.prototype.readIntLE=function(o,c,d){o=o>>>0,c=c>>>0,d||M(o,c,this.length);let m=this[o],y=1,E=0;for(;++E<c&&(y*=256);)m+=this[o+E]*y;return y*=128,m>=y&&(m-=Math.pow(2,8*c)),m},u.prototype.readIntBE=function(o,c,d){o=o>>>0,c=c>>>0,d||M(o,c,this.length);let m=c,y=1,E=this[o+--m];for(;m>0&&(y*=256);)E+=this[o+--m]*y;return y*=128,E>=y&&(E-=Math.pow(2,8*c)),E},u.prototype.readInt8=function(o,c){return o=o>>>0,c||M(o,1,this.length),this[o]&128?(255-this[o]+1)*-1:this[o]},u.prototype.readInt16LE=function(o,c){o=o>>>0,c||M(o,2,this.length);const d=this[o]|this[o+1]<<8;return d&32768?d|4294901760:d},u.prototype.readInt16BE=function(o,c){o=o>>>0,c||M(o,2,this.length);const d=this[o+1]|this[o]<<8;return d&32768?d|4294901760:d},u.prototype.readInt32LE=function(o,c){return o=o>>>0,c||M(o,4,this.length),this[o]|this[o+1]<<8|this[o+2]<<16|this[o+3]<<24},u.prototype.readInt32BE=function(o,c){return o=o>>>0,c||M(o,4,this.length),this[o]<<24|this[o+1]<<16|this[o+2]<<8|this[o+3]},u.prototype.readBigInt64LE=Zt(function(o){o=o>>>0,Ae(o,"offset");const c=this[o],d=this[o+7];(c===void 0||d===void 0)&&Ke(o,this.length-8);const m=this[o+4]+this[o+5]*2**8+this[o+6]*2**16+(d<<24);return(BigInt(m)<<BigInt(32))+BigInt(c+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24)}),u.prototype.readBigInt64BE=Zt(function(o){o=o>>>0,Ae(o,"offset");const c=this[o],d=this[o+7];(c===void 0||d===void 0)&&Ke(o,this.length-8);const m=(c<<24)+this[++o]*2**16+this[++o]*2**8+this[++o];return(BigInt(m)<<BigInt(32))+BigInt(this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+d)}),u.prototype.readFloatLE=function(o,c){return o=o>>>0,c||M(o,4,this.length),n.read(this,o,!0,23,4)},u.prototype.readFloatBE=function(o,c){return o=o>>>0,c||M(o,4,this.length),n.read(this,o,!1,23,4)},u.prototype.readDoubleLE=function(o,c){return o=o>>>0,c||M(o,8,this.length),n.read(this,o,!0,52,8)},u.prototype.readDoubleBE=function(o,c){return o=o>>>0,c||M(o,8,this.length),n.read(this,o,!1,52,8)};function j(a,o,c,d,m,y){if(!u.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(o>m||o<y)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(o,c,d,m){if(o=+o,c=c>>>0,d=d>>>0,!m){const U=Math.pow(2,8*d)-1;j(this,o,c,d,U,0)}let y=1,E=0;for(this[c]=o&255;++E<d&&(y*=256);)this[c+E]=o/y&255;return c+d},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(o,c,d,m){if(o=+o,c=c>>>0,d=d>>>0,!m){const U=Math.pow(2,8*d)-1;j(this,o,c,d,U,0)}let y=d-1,E=1;for(this[c+y]=o&255;--y>=0&&(E*=256);)this[c+y]=o/E&255;return c+d},u.prototype.writeUint8=u.prototype.writeUInt8=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,1,255,0),this[c]=o&255,c+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,2,65535,0),this[c]=o&255,this[c+1]=o>>>8,c+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,2,65535,0),this[c]=o>>>8,this[c+1]=o&255,c+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,4,4294967295,0),this[c+3]=o>>>24,this[c+2]=o>>>16,this[c+1]=o>>>8,this[c]=o&255,c+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,4,4294967295,0),this[c]=o>>>24,this[c+1]=o>>>16,this[c+2]=o>>>8,this[c+3]=o&255,c+4};function G(a,o,c,d,m){js(o,d,m,a,c,7);let y=Number(o&BigInt(4294967295));a[c++]=y,y=y>>8,a[c++]=y,y=y>>8,a[c++]=y,y=y>>8,a[c++]=y;let E=Number(o>>BigInt(32)&BigInt(4294967295));return a[c++]=E,E=E>>8,a[c++]=E,E=E>>8,a[c++]=E,E=E>>8,a[c++]=E,c}function Z(a,o,c,d,m){js(o,d,m,a,c,7);let y=Number(o&BigInt(4294967295));a[c+7]=y,y=y>>8,a[c+6]=y,y=y>>8,a[c+5]=y,y=y>>8,a[c+4]=y;let E=Number(o>>BigInt(32)&BigInt(4294967295));return a[c+3]=E,E=E>>8,a[c+2]=E,E=E>>8,a[c+1]=E,E=E>>8,a[c]=E,c+8}u.prototype.writeBigUInt64LE=Zt(function(o,c=0){return G(this,o,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Zt(function(o,c=0){return Z(this,o,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(o,c,d,m){if(o=+o,c=c>>>0,!m){const J=Math.pow(2,8*d-1);j(this,o,c,d,J-1,-J)}let y=0,E=1,U=0;for(this[c]=o&255;++y<d&&(E*=256);)o<0&&U===0&&this[c+y-1]!==0&&(U=1),this[c+y]=(o/E>>0)-U&255;return c+d},u.prototype.writeIntBE=function(o,c,d,m){if(o=+o,c=c>>>0,!m){const J=Math.pow(2,8*d-1);j(this,o,c,d,J-1,-J)}let y=d-1,E=1,U=0;for(this[c+y]=o&255;--y>=0&&(E*=256);)o<0&&U===0&&this[c+y+1]!==0&&(U=1),this[c+y]=(o/E>>0)-U&255;return c+d},u.prototype.writeInt8=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,1,127,-128),o<0&&(o=255+o+1),this[c]=o&255,c+1},u.prototype.writeInt16LE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,2,32767,-32768),this[c]=o&255,this[c+1]=o>>>8,c+2},u.prototype.writeInt16BE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,2,32767,-32768),this[c]=o>>>8,this[c+1]=o&255,c+2},u.prototype.writeInt32LE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,4,2147483647,-2147483648),this[c]=o&255,this[c+1]=o>>>8,this[c+2]=o>>>16,this[c+3]=o>>>24,c+4},u.prototype.writeInt32BE=function(o,c,d){return o=+o,c=c>>>0,d||j(this,o,c,4,2147483647,-2147483648),o<0&&(o=4294967295+o+1),this[c]=o>>>24,this[c+1]=o>>>16,this[c+2]=o>>>8,this[c+3]=o&255,c+4},u.prototype.writeBigInt64LE=Zt(function(o,c=0){return G(this,o,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Zt(function(o,c=0){return Z(this,o,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Q(a,o,c,d,m,y){if(c+d>a.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function rt(a,o,c,d,m){return o=+o,c=c>>>0,m||Q(a,o,c,4),n.write(a,o,c,d,23,4),c+4}u.prototype.writeFloatLE=function(o,c,d){return rt(this,o,c,!0,d)},u.prototype.writeFloatBE=function(o,c,d){return rt(this,o,c,!1,d)};function kt(a,o,c,d,m){return o=+o,c=c>>>0,m||Q(a,o,c,8),n.write(a,o,c,d,52,8),c+8}u.prototype.writeDoubleLE=function(o,c,d){return kt(this,o,c,!0,d)},u.prototype.writeDoubleBE=function(o,c,d){return kt(this,o,c,!1,d)},u.prototype.copy=function(o,c,d,m){if(!u.isBuffer(o))throw new TypeError("argument should be a Buffer");if(d||(d=0),!m&&m!==0&&(m=this.length),c>=o.length&&(c=o.length),c||(c=0),m>0&&m<d&&(m=d),m===d||o.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(d<0||d>=this.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("sourceEnd out of bounds");m>this.length&&(m=this.length),o.length-c<m-d&&(m=o.length-c+d);const y=m-d;return this===o&&typeof i.prototype.copyWithin=="function"?this.copyWithin(c,d,m):i.prototype.set.call(o,this.subarray(d,m),c),y},u.prototype.fill=function(o,c,d,m){if(typeof o=="string"){if(typeof c=="string"?(m=c,c=0,d=this.length):typeof d=="string"&&(m=d,d=this.length),m!==void 0&&typeof m!="string")throw new TypeError("encoding must be a string");if(typeof m=="string"&&!u.isEncoding(m))throw new TypeError("Unknown encoding: "+m);if(o.length===1){const E=o.charCodeAt(0);(m==="utf8"&&E<128||m==="latin1")&&(o=E)}}else typeof o=="number"?o=o&255:typeof o=="boolean"&&(o=Number(o));if(c<0||this.length<c||this.length<d)throw new RangeError("Out of range index");if(d<=c)return this;c=c>>>0,d=d===void 0?this.length:d>>>0,o||(o=0);let y;if(typeof o=="number")for(y=c;y<d;++y)this[y]=o;else{const E=u.isBuffer(o)?o:u.from(o,m),U=E.length;if(U===0)throw new TypeError('The value "'+o+'" is invalid for argument "value"');for(y=0;y<d-c;++y)this[y+c]=E[y%U]}return this};const ut={};function wt(a,o,c){ut[a]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:o.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${a}]`,this.stack,delete this.name}get code(){return a}set code(m){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:m,writable:!0})}toString(){return`${this.name} [${a}]: ${this.message}`}}}wt("ERR_BUFFER_OUT_OF_BOUNDS",function(a){return a?`${a} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),wt("ERR_INVALID_ARG_TYPE",function(a,o){return`The "${a}" argument must be of type number. Received type ${typeof o}`},TypeError),wt("ERR_OUT_OF_RANGE",function(a,o,c){let d=`The value of "${a}" is out of range.`,m=c;return Number.isInteger(c)&&Math.abs(c)>2**32?m=Rn(String(c)):typeof c=="bigint"&&(m=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(m=Rn(m)),m+="n"),d+=` It must be ${o}. Received ${m}`,d},RangeError);function Rn(a){let o="",c=a.length;const d=a[0]==="-"?1:0;for(;c>=d+4;c-=3)o=`_${a.slice(c-3,c)}${o}`;return`${a.slice(0,c)}${o}`}function Bn(a,o,c){Ae(o,"offset"),(a[o]===void 0||a[o+c]===void 0)&&Ke(o,a.length-(c+1))}function js(a,o,c,d,m,y){if(a>c||a<o){const E=typeof o=="bigint"?"n":"";let U;throw o===0||o===BigInt(0)?U=`>= 0${E} and < 2${E} ** ${(y+1)*8}${E}`:U=`>= -(2${E} ** ${(y+1)*8-1}${E}) and < 2 ** ${(y+1)*8-1}${E}`,new ut.ERR_OUT_OF_RANGE("value",U,a)}Bn(d,m,y)}function Ae(a,o){if(typeof a!="number")throw new ut.ERR_INVALID_ARG_TYPE(o,"number",a)}function Ke(a,o,c){throw Math.floor(a)!==a?(Ae(a,c),new ut.ERR_OUT_OF_RANGE("offset","an integer",a)):o<0?new ut.ERR_BUFFER_OUT_OF_BOUNDS:new ut.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${o}`,a)}const pc=/[^+/0-9A-Za-z-_]/g;function gc(a){if(a=a.split("=")[0],a=a.trim().replace(pc,""),a.length<2)return"";for(;a.length%4!==0;)a=a+"=";return a}function Tr(a,o){o=o||1/0;let c;const d=a.length;let m=null;const y=[];for(let E=0;E<d;++E){if(c=a.charCodeAt(E),c>55295&&c<57344){if(!m){if(c>56319){(o-=3)>-1&&y.push(239,191,189);continue}else if(E+1===d){(o-=3)>-1&&y.push(239,191,189);continue}m=c;continue}if(c<56320){(o-=3)>-1&&y.push(239,191,189),m=c;continue}c=(m-55296<<10|c-56320)+65536}else m&&(o-=3)>-1&&y.push(239,191,189);if(m=null,c<128){if((o-=1)<0)break;y.push(c)}else if(c<2048){if((o-=2)<0)break;y.push(c>>6|192,c&63|128)}else if(c<65536){if((o-=3)<0)break;y.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((o-=4)<0)break;y.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return y}function mc(a){const o=[];for(let c=0;c<a.length;++c)o.push(a.charCodeAt(c)&255);return o}function wc(a,o){let c,d,m;const y=[];for(let E=0;E<a.length&&!((o-=2)<0);++E)c=a.charCodeAt(E),d=c>>8,m=c%256,y.push(m),y.push(d);return y}function Hs(a){return t.toByteArray(gc(a))}function Un(a,o,c,d){let m;for(m=0;m<d&&!(m+c>=o.length||m>=a.length);++m)o[m+c]=a[m];return m}function Ut(a,o){return a instanceof o||a!=null&&a.constructor!=null&&a.constructor.name!=null&&a.constructor.name===o.name}function Rr(a){return a!==a}const yc=(function(){const a="0123456789abcdef",o=new Array(256);for(let c=0;c<16;++c){const d=c*16;for(let m=0;m<16;++m)o[d+m]=a[c]+a[m]}return o})();function Zt(a){return typeof BigInt>"u"?bc:a}function bc(){throw new Error("BigInt not supported")}})(hl);function El(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ni={exports:{}},z=Ni.exports={},vt,Mt;function Qr(){throw new Error("setTimeout has not been defined")}function ts(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?vt=setTimeout:vt=Qr}catch{vt=Qr}try{typeof clearTimeout=="function"?Mt=clearTimeout:Mt=ts}catch{Mt=ts}})();function $i(e){if(vt===setTimeout)return setTimeout(e,0);if((vt===Qr||!vt)&&setTimeout)return vt=setTimeout,setTimeout(e,0);try{return vt(e,0)}catch{try{return vt.call(null,e,0)}catch{return vt.call(this,e,0)}}}function kl(e){if(Mt===clearTimeout)return clearTimeout(e);if((Mt===ts||!Mt)&&clearTimeout)return Mt=clearTimeout,clearTimeout(e);try{return Mt(e)}catch{try{return Mt.call(null,e)}catch{return Mt.call(this,e)}}}var Jt=[],Ue=!1,ae,Gn=-1;function Sl(){!Ue||!ae||(Ue=!1,ae.length?Jt=ae.concat(Jt):Gn=-1,Jt.length&&Pi())}function Pi(){if(!Ue){var e=$i(Sl);Ue=!0;for(var t=Jt.length;t;){for(ae=Jt,Jt=[];++Gn<t;)ae&&ae[Gn].run();Gn=-1,t=Jt.length}ae=null,Ue=!1,kl(e)}}z.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Jt.push(new Vi(e,t)),Jt.length===1&&!Ue&&$i(Pi)};function Vi(e,t){this.fun=e,this.array=t}Vi.prototype.run=function(){this.fun.apply(null,this.array)};z.title="browser";z.browser=!0;z.env={};z.argv=[];z.version="";z.versions={};function Yt(){}z.on=Yt;z.addListener=Yt;z.once=Yt;z.off=Yt;z.removeListener=Yt;z.removeAllListeners=Yt;z.emit=Yt;z.prependListener=Yt;z.prependOnceListener=Yt;z.listeners=function(e){return[]};z.binding=function(e){throw new Error("process.binding is not supported")};z.cwd=function(){return"/"};z.chdir=function(e){throw new Error("process.chdir is not supported")};z.umask=function(){return 0};var _l=Ni.exports;const ce=El(_l),ei=e=>e===void 0?null:e;class Al{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let ji=new Al,xl=!0;try{typeof localStorage<"u"&&localStorage&&(ji=localStorage,xl=!1)}catch{}const Cl=ji,dn=Symbol("Equality"),Hi=(e,t)=>e===t||!!e?.[dn]?.(t)||!1,Il=e=>typeof e=="object",Dl=Object.assign,Tl=Object.keys,Rl=(e,t)=>{for(const n in e)t(e[n],n)},er=e=>Tl(e).length,Bl=e=>{for(const t in e)return!1;return!0},An=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Es=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ul=(e,t)=>e===t||er(e)===er(t)&&An(e,(n,r)=>(n!==void 0||Es(t,r))&&Hi(t[r],n)),Ll=Object.freeze,qi=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&qi(e[t])}return Ll(e)},ks=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&ks(e,t,n+1)}},vl=e=>e,Jn=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(e[dn]!=null)return e[dn](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Jn(e.get(n),t.get(n)))return!1;break}case void 0:case Object:if(er(e)!==er(t))return!1;for(const n in e)if(!Es(e,n)||!Jn(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Jn(e[n],t[n]))return!1;break;default:return!1}return!0},Ml=(e,t)=>t.includes(e);var Gi={};const pn=typeof ce<"u"&&ce.release&&/node|io\.js/.test(ce.release.name)&&Object.prototype.toString.call(typeof ce<"u"?ce:0)==="[object process]";let Lt;const Ol=()=>{if(Lt===void 0)if(pn){Lt=mt();const e=ce.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Lt.set(t,""),t=r):t!==null&&(Lt.set(t,r),t=null)}t!==null&&Lt.set(t,"")}else typeof location=="object"?(Lt=mt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Lt.set(`--${Ys(t,"-")}`,n),Lt.set(`-${Ys(t,"-")}`,n)}})):Lt=mt();return Lt},es=e=>Ol().has(e),nr=e=>ei(pn?Gi[e.toUpperCase().replaceAll("-","_")]:Cl.getItem(e)),Ji=e=>es("--"+e)||nr(e)!==null,Fl=Ji("production"),Nl=pn&&Ml(Gi.FORCE_COLOR,["true","1","2"]),$l=Nl||!es("--no-colors")&&!Ji("no-color")&&(!pn||ce.stdout.isTTY)&&(!pn||es("--color")||nr("COLORTERM")!==null||(nr("TERM")||"").includes("color")),Pl=e=>new Uint8Array(e),Vl=e=>{const t=Pl(e.byteLength);return t.set(e),t};class jl{constructor(t,n){this.left=t,this.right=n}}const jt=(e,t)=>new jl(e,t),ni=e=>e.next()>=.5,$r=(e,t,n)=>Nt(e.next()*(n+1-t)+t),Wi=(e,t,n)=>Nt(e.next()*(n+1-t)+t),Ss=(e,t,n)=>Wi(e,t,n),Hl=e=>vc(Ss(e,97,122)),ql=(e,t=0,n=20)=>{const r=Ss(e,t,n);let s="";for(let i=0;i<r;i++)s+=Hl(e);return s},Pr=(e,t)=>t[Ss(e,0,t.length-1)],Gl=Symbol("0schema");class Jl{constructor(){this._rerrs=[]}extend(t,n,r,s=null){this._rerrs.push({path:t,expected:n,has:r,message:s})}toString(){const t=[];for(let n=this._rerrs.length-1;n>0;n--){const r=this._rerrs[n];t.push(jc(" ",(this._rerrs.length-n)*2)+`${r.path!=null?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return t.join(`
`)}}const ns=(e,t)=>e===t?!0:e==null||t==null||e.constructor!==t.constructor?!1:e[dn]?Hi(e,t):dr(e)?ps(e,n=>Bi(t,r=>ns(n,r))):Il(e)?An(e,(n,r)=>ns(n,t[r])):!1;class ft{static _dilutes=!1;extends(t){let[n,r]=[this.shape,t.shape];return this.constructor._dilutes&&([r,n]=[n,r]),ns(n,r)}equals(t){return this.constructor===t.constructor&&Jn(this.shape,t.shape)}[Gl](){return!0}[dn](t){return this.equals(t)}validate(t){return this.check(t)}check(t,n){Tt()}get nullable(){return Ge(this,_r)}get optional(){return new Ki(this)}cast(t){return ri(t,this),t}expect(t){return ri(t,this),t}}class _s extends ft{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n=void 0){const r=t?.constructor===this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name,t?.constructor!==this.shape?"Constructor match failed":"Check failed"),r}}const X=(e,t=null)=>new _s(e,t);X(_s);class As extends ft{constructor(t){super(),this.shape=t}check(t,n){const r=this.shape(t);return!r&&n?.extend(null,"custom prop",t?.constructor.name,"failed to check custom prop"),r}}const ot=e=>new As(e);X(As);class br extends ft{constructor(t){super(),this.shape=t}check(t,n){const r=this.shape.some(s=>s===t);return!r&&n?.extend(null,this.shape.join(" | "),t.toString()),r}}const Er=(...e)=>new br(e),zi=X(br),Wl=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,t=>"\\"+t)),Yi=e=>{if($e.check(e))return[Wl(e)];if(zi.check(e))return e.shape.map(t=>t+"");if(io.check(e))return["[+-]?\\d+.?\\d*"];if(oo.check(e))return[".*"];if(rr.check(e))return e.shape.map(Yi).flat(1);Ct()};class zl extends ft{constructor(t){super(),this.shape=t,this._r=new RegExp("^"+t.map(Yi).map(n=>`(${n.join("|")})`).join("")+"$")}check(t,n){const r=this._r.exec(t)!=null;return!r&&n?.extend(null,this._r.toString(),t.toString(),"String doesn't match string template."),r}}X(zl);const Yl=Symbol("optional");class Ki extends ft{constructor(t){super(),this.shape=t}check(t,n){const r=t===void 0||this.shape.check(t);return!r&&n?.extend(null,"undefined (optional)","()"),r}get[Yl](){return!0}}const Kl=X(Ki);class Xl extends ft{check(t,n){return n?.extend(null,"never",typeof t),!1}}X(Xl);class kr extends ft{constructor(t,n=!1){super(),this.shape=t,this._isPartial=n}static _dilutes=!0;get partial(){return new kr(this.shape,!0)}check(t,n){return t==null?(n?.extend(null,"object","null"),!1):An(this.shape,(r,s)=>{const i=this._isPartial&&!Es(t,s)||r.check(t[s],n);return!i&&n?.extend(s.toString(),r.toString(),typeof t[s],"Object property does not match"),i})}}const Zl=e=>new kr(e),Ql=X(kr),ta=ot(e=>e!=null&&(e.constructor===Object||e.constructor==null));class Xi extends ft{constructor(t,n){super(),this.shape={keys:t,values:n}}check(t,n){return t!=null&&An(t,(r,s)=>{const i=this.shape.keys.check(s,n);return!i&&n?.extend(s+"","Record",typeof t,i?"Key doesn't match schema":"Value doesn't match value"),i&&this.shape.values.check(r,n)})}}const Zi=(e,t)=>new Xi(e,t),ea=X(Xi);class Qi extends ft{constructor(t){super(),this.shape=t}check(t,n){return t!=null&&An(this.shape,(r,s)=>{const i=r.check(t[s],n);return!i&&n?.extend(s.toString(),"Tuple",typeof r),i})}}const na=(...e)=>new Qi(e);X(Qi);class to extends ft{constructor(t){super(),this.shape=t.length===1?t[0]:new xs(t)}check(t,n){const r=dr(t)&&ps(t,s=>this.shape.check(s));return!r&&n?.extend(null,"Array",""),r}}const eo=(...e)=>new to(e),ra=X(to),sa=ot(e=>dr(e));class no extends ft{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n){const r=t instanceof this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name),r}}const ia=(e,t=null)=>new no(e,t);X(no);const oa=ia(ft);class ca extends ft{constructor(t){super(),this.len=t.length-1,this.args=na(...t.slice(-1)),this.res=t[this.len]}check(t,n){const r=t.constructor===Function&&t.length<=this.len;return!r&&n?.extend(null,"function",typeof t),r}}const la=X(ca),aa=ot(e=>typeof e=="function");class ua extends ft{constructor(t){super(),this.shape=t}check(t,n){const r=ps(this.shape,s=>s.check(t,n));return!r&&n?.extend(null,"Intersectinon",typeof t),r}}X(ua,e=>e.shape.length>0);class xs extends ft{static _dilutes=!0;constructor(t){super(),this.shape=t}check(t,n){const r=Bi(this.shape,s=>s.check(t,n));return n?.extend(null,"Union",typeof t),r}}const Ge=(...e)=>e.findIndex(t=>rr.check(t))>=0?Ge(...e.map(t=>gn(t)).map(t=>rr.check(t)?t.shape:[t]).flat(1)):e.length===1?e[0]:new xs(e),rr=X(xs),ro=()=>!0,sr=ot(ro),ha=X(As,e=>e.shape===ro),Cs=ot(e=>typeof e=="bigint"),fa=ot(e=>e===Cs),so=ot(e=>typeof e=="symbol");ot(e=>e===so);const Le=ot(e=>typeof e=="number"),io=ot(e=>e===Le),$e=ot(e=>typeof e=="string"),oo=ot(e=>e===$e),Sr=ot(e=>typeof e=="boolean"),da=ot(e=>e===Sr),co=Er(void 0);X(br,e=>e.shape.length===1&&e.shape[0]===void 0);Er(void 0);const _r=Er(null),pa=X(br,e=>e.shape.length===1&&e.shape[0]===null);X(Uint8Array);X(_s,e=>e.shape===Uint8Array);const ga=Ge(Le,$e,_r,co,Cs,Sr,so);(()=>{const e=eo(sr),t=Zi($e,sr),n=Ge(Le,$e,_r,Sr,e,t);return e.shape=n,t.shape.values=n,n})();const gn=e=>{if(oa.check(e))return e;if(ta.check(e)){const t={};for(const n in e)t[n]=gn(e[n]);return Zl(t)}else{if(sa.check(e))return Ge(...e.map(gn));if(ga.check(e))return Er(e);if(aa.check(e))return X(e)}Ct()},ri=Fl?()=>{}:(e,t)=>{const n=new Jl;if(!t.check(e,n))throw Rt(`Expected value to be of type ${t.constructor.name}.
${n.toString()}`)};class ma{constructor(t){this.patterns=[],this.$state=t}if(t,n){return this.patterns.push({if:gn(t),h:n}),this}else(t){return this.if(sr,t)}done(){return(t,n)=>{for(let r=0;r<this.patterns.length;r++){const s=this.patterns[r];if(s.if.check(t))return s.h(t,n)}throw Rt("Unhandled pattern")}}}const wa=e=>new ma(e),lo=wa(sr).if(io,(e,t)=>$r(t,zs,tr)).if(oo,(e,t)=>ql(t)).if(da,(e,t)=>ni(t)).if(fa,(e,t)=>BigInt($r(t,zs,tr))).if(rr,(e,t)=>Ce(t,Pr(t,e.shape))).if(Ql,(e,t)=>{const n={};for(const r in e.shape){let s=e.shape[r];if(Kl.check(s)){if(ni(t))continue;s=s.shape}n[r]=lo(s,t)}return n}).if(ra,(e,t)=>{const n=[],r=Wi(t,0,42);for(let s=0;s<r;s++)n.push(Ce(t,e.shape));return n}).if(zi,(e,t)=>Pr(t,e.shape)).if(pa,(e,t)=>null).if(la,(e,t)=>{const n=Ce(t,e.res);return()=>n}).if(ha,(e,t)=>Ce(t,Pr(t,[Le,$e,_r,co,Cs,Sr,eo(Le),Zi(Ge("a","b","c"),Le)]))).if(ea,(e,t)=>{const n={},r=$r(t,0,3);for(let s=0;s<r;s++){const i=Ce(t,e.shape.keys),l=Ce(t,e.shape.values);n[i]=l}return n}).done(),Ce=(e,t)=>lo(gn(t),e),Ar=typeof document<"u"?document:{};ot(e=>e.nodeType===Sa);typeof DOMParser<"u"&&new DOMParser;ot(e=>e.nodeType===ba);ot(e=>e.nodeType===Ea);const ya=e=>Cc(e,(t,n)=>`${n}:${t};`).join(""),ba=Ar.ELEMENT_NODE,Ea=Ar.TEXT_NODE,ka=Ar.DOCUMENT_NODE,Sa=Ar.DOCUMENT_FRAGMENT_NODE;ot(e=>e.nodeType===ka);const Kt=Symbol,ao=Kt(),uo=Kt(),_a=Kt(),Aa=Kt(),xa=Kt(),ho=Kt(),Ca=Kt(),Is=Kt(),Ia=Kt(),Da=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},Ta={[ao]:jt("font-weight","bold"),[uo]:jt("font-weight","normal"),[_a]:jt("color","blue"),[xa]:jt("color","green"),[Aa]:jt("color","grey"),[ho]:jt("color","red"),[Ca]:jt("color","purple"),[Is]:jt("color","orange"),[Ia]:jt("color","black")},Ra=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[],r=mt();let s=[],i=0;for(;i<e.length;i++){const l=e[i],f=Ta[l];if(f!==void 0)r.set(f.left,f.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const h=ya(r);i>0||h.length>0?(t.push("%c"+l),n.push(h)):t.push(l)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const l=e[i];l instanceof Symbol||s.push(l)}return s},fo=$l?Ra:Da,Ba=(...e)=>{console.log(...fo(e)),po.forEach(t=>t.print(e))},Ua=(...e)=>{console.warn(...fo(e)),e.unshift(Is),po.forEach(t=>t.print(e))},po=de(),go=e=>({[Symbol.iterator](){return this},next:e}),La=(e,t)=>go(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Vr=(e,t)=>go(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Ds{constructor(t,n){this.clock=t,this.len=n}}class xn{constructor(){this.clients=new Map}}const mo=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);if(i!=null){const l=i[i.length-1],f=l.id.clock+l.length;for(let h=0,g=r[h];h<r.length&&g.clock<f;g=r[++h])Io(e,i,g.clock,g.len,n)}}),va=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=Nt((n+r)/2),i=e[s],l=i.clock;if(l<=t){if(t<l+i.len)return s;n=s+1}else r=s-1}return null},wo=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&va(n,t.clock)!==null},Ts=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=ye(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},Ma=e=>{const t=new xn;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let l=n+1;l<e.length;l++)Dc(i,e[l].clients.get(s)||[]);t.clients.set(s,i)}});return Ts(t),t},ir=(e,t,n,r)=>{zt(e.clients,t,()=>[]).push(new Ds(n,r))},Oa=()=>new xn,Fa=e=>{const t=Oa();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const l=n[i];if(l.deleted){const f=l.id.clock;let h=l.length;if(i+1<n.length)for(let g=n[i+1];i+1<n.length&&g.deleted;g=n[++i+1])h+=g.length;s.push(new Ds(f,h))}}s.length>0&&t.clients.set(r,s)}),t},Je=(e,t)=>{O(e.restEncoder,t.clients.size),ne(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),O(e.restEncoder,n);const s=r.length;O(e.restEncoder,s);for(let i=0;i<s;i++){const l=r[i];e.writeDsClock(l.clock),e.writeDsLen(l.len)}})},Rs=e=>{const t=new xn,n=B(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=B(e.restDecoder),i=B(e.restDecoder);if(i>0){const l=zt(t.clients,s,()=>[]);for(let f=0;f<i;f++)l.push(new Ds(e.readDsClock(),e.readDsLen()))}}return t},si=(e,t,n)=>{const r=new xn,s=B(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const l=B(e.restDecoder),f=B(e.restDecoder),h=n.clients.get(l)||[],g=it(n,l);for(let u=0;u<f;u++){const p=e.readDsClock(),w=p+e.readDsLen();if(p<g){g<w&&ir(r,l,g,w-g);let b=$t(h,p),k=h[b];for(!k.deleted&&k.id.clock<p&&(h.splice(b+1,0,fr(t,k,p-k.id.clock)),b++);b<h.length&&(k=h[b++],k.id.clock<w);)k.deleted||(w<k.id.clock+k.length&&h.splice(b,0,fr(t,k,w-k.id.clock)),k.delete(t))}else ir(r,l,p,w-p)}}if(r.clients.size>0){const i=new pe;return O(i.restEncoder,0),Je(i,r),i.toUint8Array()}return null},yo=Oi;class We extends Rc{constructor({guid:t=ul(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:l=!1,shouldLoad:f=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=yo(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new xo,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=f,this.autoLoad=l,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ne(g=>{this.on("load",()=>{this.isLoaded=!0,g(this)})});const h=()=>Ne(g=>{const u=p=>{(p===void 0||p===!0)&&(this.off("sync",u),g())};this.on("sync",u)});this.on("sync",g=>{g===!1&&this.isSynced&&(this.whenSynced=h()),this.isSynced=g===void 0||g===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=h()}load(){const t=this._item;t!==null&&!this.shouldLoad&&P(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ne(this.subdocs).map(t=>t.guid))}transact(t,n=null){return P(this,t,n)}get(t,n=ct){const r=zt(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==ct&&s!==n)if(s===ct){const i=new n;i._map=r._map,r._map.forEach(l=>{for(;l!==null;l=l.left)l.parent=i}),i._start=r._start;for(let l=i._start;l!==null;l=l.right)l.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Me)}getText(t=""){return this.get(t,je)}getMap(t=""){return this.get(t,Ve)}getXmlElement(t=""){return this.get(t,He)}getXmlFragment(t=""){return this.get(t,ge)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,ne(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new We({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,P(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class bo{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return B(this.restDecoder)}readDsLen(){return B(this.restDecoder)}}class Eo extends bo{readLeftID(){return L(B(this.restDecoder),B(this.restDecoder))}readRightID(){return L(B(this.restDecoder),B(this.restDecoder))}readClient(){return B(this.restDecoder)}readInfo(){return Fe(this.restDecoder)}readString(){return Be(this.restDecoder)}readParentInfo(){return B(this.restDecoder)===1}readTypeRef(){return B(this.restDecoder)}readLen(){return B(this.restDecoder)}readAny(){return fn(this.restDecoder)}readBuf(){return Vl(bt(this.restDecoder))}readJSON(){return JSON.parse(Be(this.restDecoder))}readKey(){return Be(this.restDecoder)}}class Na{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=B(this.restDecoder),this.dsCurrVal}readDsLen(){const t=B(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Pe extends Na{constructor(t){super(t),this.keys=[],B(t),this.keyClockDecoder=new Fr(bt(t)),this.clientDecoder=new qn(bt(t)),this.leftClockDecoder=new Fr(bt(t)),this.rightClockDecoder=new Fr(bt(t)),this.infoDecoder=new ti(bt(t),Fe),this.stringDecoder=new cl(bt(t)),this.parentInfoDecoder=new ti(bt(t),Fe),this.typeRefDecoder=new qn(bt(t)),this.lenDecoder=new qn(bt(t))}readLeftID(){return new ve(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ve(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fn(this.restDecoder)}readBuf(){return bt(this.restDecoder)}readJSON(){return fn(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class $a{constructor(){this.restEncoder=gr()}toUint8Array(){return Ft(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){O(this.restEncoder,t)}writeDsLen(t){O(this.restEncoder,t)}}class Cn extends $a{writeLeftID(t){O(this.restEncoder,t.client),O(this.restEncoder,t.clock)}writeRightID(t){O(this.restEncoder,t.client),O(this.restEncoder,t.clock)}writeClient(t){O(this.restEncoder,t)}writeInfo(t){Xr(this.restEncoder,t)}writeString(t){Re(this.restEncoder,t)}writeParentInfo(t){O(this.restEncoder,t?1:0)}writeTypeRef(t){O(this.restEncoder,t)}writeLen(t){O(this.restEncoder,t)}writeAny(t){hn(this.restEncoder,t)}writeBuf(t){yt(this.restEncoder,t)}writeJSON(t){Re(this.restEncoder,JSON.stringify(t))}writeKey(t){Re(this.restEncoder,t)}}class Pa{constructor(){this.restEncoder=gr(),this.dsCurrVal=0}toUint8Array(){return Ft(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,O(this.restEncoder,n)}writeDsLen(t){t===0&&Ct(),O(this.restEncoder,t-1),this.dsCurrVal+=t}}class pe extends Pa{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Or,this.clientEncoder=new Hn,this.leftClockEncoder=new Or,this.rightClockEncoder=new Or,this.infoEncoder=new Xs(Xr),this.stringEncoder=new Zc,this.parentInfoEncoder=new Xs(Xr),this.typeRefEncoder=new Hn,this.lenEncoder=new Hn}toUint8Array(){const t=gr();return O(t,0),yt(t,this.keyClockEncoder.toUint8Array()),yt(t,this.clientEncoder.toUint8Array()),yt(t,this.leftClockEncoder.toUint8Array()),yt(t,this.rightClockEncoder.toUint8Array()),yt(t,Ft(this.infoEncoder)),yt(t,this.stringEncoder.toUint8Array()),yt(t,Ft(this.parentInfoEncoder)),yt(t,this.typeRefEncoder.toUint8Array()),yt(t,this.lenEncoder.toUint8Array()),mr(t,Ft(this.restEncoder)),Ft(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){hn(this.restEncoder,t)}writeBuf(t){yt(this.restEncoder,t)}writeJSON(t){hn(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Va=(e,t,n,r)=>{r=ye(r,t[0].id.clock);const s=$t(t,r);O(e.restEncoder,t.length-s),e.writeClient(n),O(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let l=s+1;l<t.length;l++)t[l].write(e,0)},Bs=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{it(t,i)>s&&r.set(i,s)}),Us(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),O(e.restEncoder,r.size),ne(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{Va(e,t.clients.get(s),s,i)})},ja=(e,t)=>{const n=mt(),r=B(e.restDecoder);for(let s=0;s<r;s++){const i=B(e.restDecoder),l=new Array(i),f=e.readClient();let h=B(e.restDecoder);n.set(f,{i:0,refs:l});for(let g=0;g<i;g++){const u=e.readInfo();switch(pr&u){case 0:{const p=e.readLen();l[g]=new At(L(f,h),p),h+=p;break}case 10:{const p=B(e.restDecoder);l[g]=new xt(L(f,h),p),h+=p;break}default:{const p=(u&(Wt|Et))===0,w=new tt(L(f,h),null,(u&Et)===Et?e.readLeftID():null,null,(u&Wt)===Wt?e.readRightID():null,p?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,p&&(u&an)===an?e.readString():null,Jo(e,u));l[g]=w,h+=w.length}}}}return n},Ha=(e,t,n)=>{const r=[];let s=ne(n.keys()).sort((b,k)=>b-k);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let b=n.get(s[s.length-1]);for(;b.refs.length===b.i;)if(s.pop(),s.length>0)b=n.get(s[s.length-1]);else return null;return b};let l=i();if(l===null)return null;const f=new xo,h=new Map,g=(b,k)=>{const _=h.get(b);(_==null||_>k)&&h.set(b,k)};let u=l.refs[l.i++];const p=new Map,w=()=>{for(const b of r){const k=b.id.client,_=n.get(k);_?(_.i--,f.clients.set(k,_.refs.slice(_.i)),n.delete(k),_.i=0,_.refs=[]):f.clients.set(k,[b]),s=s.filter(F=>F!==k)}r.length=0};for(;;){if(u.constructor!==xt){const k=zt(p,u.id.client,()=>it(t,u.id.client))-u.id.clock;if(k<0)r.push(u),g(u.id.client,u.id.clock-1),w();else{const _=u.getMissing(e,t);if(_!==null){r.push(u);const F=n.get(_)||{refs:[],i:0};if(F.refs.length===F.i)g(_,it(t,_)),w();else{u=F.refs[F.i++];continue}}else(k===0||k<u.length)&&(u.integrate(e,k),p.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(l!==null&&l.i<l.refs.length)u=l.refs[l.i++];else{if(l=i(),l===null)break;u=l.refs[l.i++]}}if(f.clients.size>0){const b=new pe;return Bs(b,f,new Map),O(b.restEncoder,0),{missing:h,update:b.toUint8Array()}}return null},qa=(e,t)=>Bs(e,t.doc.store,t.beforeState),Ga=(e,t,n,r=new Pe(e))=>P(t,s=>{s.local=!1;let i=!1;const l=s.doc,f=l.store,h=ja(r,l),g=Ha(s,f,h),u=f.pendingStructs;if(u){for(const[w,b]of u.missing)if(b<it(f,w)){i=!0;break}if(g){for(const[w,b]of g.missing){const k=u.missing.get(w);(k==null||k>b)&&u.missing.set(w,b)}u.update=or([u.update,g.update])}}else f.pendingStructs=g;const p=si(r,s,f);if(f.pendingDs){const w=new Pe(qe(f.pendingDs));B(w.restDecoder);const b=si(w,s,f);p&&b?f.pendingDs=or([p,b]):f.pendingDs=p||b}else f.pendingDs=p;if(i){const w=f.pendingStructs.update;f.pendingStructs=null,ko(s.doc,w)}},n,!1),ko=(e,t,n,r=Pe)=>{const s=qe(t);Ga(s,e,n,new r(s))},Ja=(e,t,n)=>ko(e,t,n,Eo),Wa=(e,t,n=new Map)=>{Bs(e,t.store,n),Je(e,Fa(t.store))},za=(e,t=new Uint8Array([0]),n=new pe)=>{const r=_o(t);Wa(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(ou(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Cn)return su(s.map((i,l)=>l===0?i:lu(i)));if(n.constructor===pe)return or(s)}return s[0]},So=(e,t)=>za(e,t,new Cn),Ya=e=>{const t=new Map,n=B(e.restDecoder);for(let r=0;r<n;r++){const s=B(e.restDecoder),i=B(e.restDecoder);t.set(s,i)}return t},_o=e=>Ya(new bo(qe(e)));class Ka{constructor(){this.l=[]}}const ii=()=>new Ka,oi=(e,t)=>e.l.push(t),ci=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ao=(e,t,n)=>ks(e.l,[t,n]);class ve{constructor(t,n){this.client=t,this.clock=n}}const Ln=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,L=(e,t)=>new ve(e,t),Xa=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Ct()},De=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!wo(t.ds,e.id),rs=(e,t)=>{const n=zt(e.meta,rs,de),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<it(r,i)&&re(e,L(i,s))}),mo(e,t.ds,s=>{}),n.add(t))};class xo{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Us=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},it=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Co=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Ct()}n.push(t)},$t=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let l=Nt(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[l],i=s.id.clock,i<=t){if(t<i+s.length)return l;n=l+1}else r=l-1;l=Nt((n+r)/2)}throw Ct()},Za=(e,t)=>{const n=e.clients.get(t.client);return n[$t(n,t.clock)]},jr=Za,ss=(e,t,n)=>{const r=$t(t,n),s=t[r];return s.id.clock<n&&s instanceof tt?(t.splice(r+1,0,fr(e,s,n-s.id.clock)),r+1):r},re=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[ss(e,n,t.clock)]},li=(e,t,n)=>{const r=t.clients.get(n.client),s=$t(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==At&&r.splice(s+1,0,fr(e,i,n.clock-i.id.clock+1)),i},Qa=(e,t,n)=>{const r=e.clients.get(t.id.client);r[$t(r,t.id.clock)]=n},Io=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let l=ss(e,t,n),f;do f=t[l++],i<f.id.clock+f.length&&ss(e,t,i),s(f);while(l<t.length&&t[l].id.clock<i)};class tu{constructor(t,n,r){this.doc=t,this.deleteSet=new xn,this.beforeState=Us(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ai=(e,t)=>t.deleteSet.clients.size===0&&!Ic(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Ts(t.deleteSet),qa(e,t),Je(e,t.deleteSet),!0),ui=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&zt(e.changed,t,de).add(n)},Wn=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof tt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},eu=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let l=s.length-1;l>=0;l--){const f=s[l],h=f.clock+f.len;for(let g=$t(i,f.clock),u=i[g];g<i.length&&u.id.clock<h;u=i[++g]){const p=i[g];if(f.clock+f.len<=p.id.clock)break;p instanceof tt&&p.deleted&&!p.keep&&n(p)&&p.gc(t,!1)}}}},nu=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const l=n[i],f=Ui(s.length-1,1+$t(s,l.clock+l.len-1));for(let h=f,g=s[h];h>0&&g.id.clock>=l.clock;g=s[h])h-=1+Wn(s,h)}})},Do=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,l=n._mergeStructs;try{Ts(i),n.afterState=Us(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const f=[];n.changed.forEach((h,g)=>f.push(()=>{(g._item===null||!g._item.deleted)&&g._callObserver(n,h)})),f.push(()=>{n.changedParentTypes.forEach((h,g)=>{g._dEH.l.length>0&&(g._item===null||!g._item.deleted)&&(h=h.filter(u=>u.target._item===null||!u.target._item.deleted),h.forEach(u=>{u.currentTarget=g,u._path=null}),h.sort((u,p)=>u.path.length-p.path.length),Ao(g._dEH,h,n))})}),f.push(()=>r.emit("afterTransaction",[n,r])),ks(f,[]),n._needFormattingCleanup&&Su(n)}finally{r.gc&&eu(i,s,r.gcFilter),nu(i,s),n.afterState.forEach((u,p)=>{const w=n.beforeState.get(p)||0;if(w!==u){const b=s.clients.get(p),k=ye($t(b,w),1);for(let _=b.length-1;_>=k;)_-=1+Wn(b,_)}});for(let u=l.length-1;u>=0;u--){const{client:p,clock:w}=l[u].id,b=s.clients.get(p),k=$t(b,w);k+1<b.length&&Wn(b,k+1)>1||k>0&&Wn(b,k)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Ba(Is,ao,"[yjs] ",uo,ho,"Changed the client-id because another client seems to be using it."),r.clientID=yo()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Cn;ai(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new pe;ai(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:f,subdocsLoaded:h,subdocsRemoved:g}=n;(f.size>0||g.size>0||h.size>0)&&(f.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),g.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:h,added:f,removed:g},r,n]),g.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Do(e,t+1)}}},P=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,l=null;e._transaction===null&&(i=!0,e._transaction=new tu(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{l=t(e._transaction)}finally{if(i){const f=e._transaction===s[0];e._transaction=null,f&&Do(s,0)}}return l};function*ru(e){const t=B(e.restDecoder);for(let n=0;n<t;n++){const r=B(e.restDecoder),s=e.readClient();let i=B(e.restDecoder);for(let l=0;l<r;l++){const f=e.readInfo();if(f===10){const h=B(e.restDecoder);yield new xt(L(s,i),h),i+=h}else if((pr&f)!==0){const h=(f&(Wt|Et))===0,g=new tt(L(s,i),null,(f&Et)===Et?e.readLeftID():null,null,(f&Wt)===Wt?e.readRightID():null,h?e.readParentInfo()?e.readString():e.readLeftID():null,h&&(f&an)===an?e.readString():null,Jo(e,f));yield g,i+=g.length}else{const h=e.readLen();yield new At(L(s,i),h),i+=h}}}}class Ls{constructor(t,n){this.gen=ru(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===xt);return this.curr}}class vs{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const su=e=>or(e,Eo,Cn),iu=(e,t)=>{if(e.constructor===At){const{client:n,clock:r}=e.id;return new At(L(n,r+t),e.length-t)}else if(e.constructor===xt){const{client:n,clock:r}=e.id;return new xt(L(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new tt(L(r,s+t),null,L(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},or=(e,t=Pe,n=pe)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(qe(u)));let s=r.map(u=>new Ls(u,!0)),i=null;const l=new n,f=new vs(l);for(;s=s.filter(w=>w.curr!==null),s.sort((w,b)=>{if(w.curr.id.client===b.curr.id.client){const k=w.curr.id.clock-b.curr.id.clock;return k===0?w.curr.constructor===b.curr.constructor?0:w.curr.constructor===xt?1:-1:k}else return b.curr.id.client-w.curr.id.client}),s.length!==0;){const u=s[0],p=u.curr.id.client;if(i!==null){let w=u.curr,b=!1;for(;w!==null&&w.id.clock+w.length<=i.struct.id.clock+i.struct.length&&w.id.client>=i.struct.id.client;)w=u.next(),b=!0;if(w===null||w.id.client!==p||b&&w.id.clock>i.struct.id.clock+i.struct.length)continue;if(p!==i.struct.id.client)te(f,i.struct,i.offset),i={struct:w,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<w.id.clock)if(i.struct.constructor===xt)i.struct.length=w.id.clock+w.length-i.struct.id.clock;else{te(f,i.struct,i.offset);const k=w.id.clock-i.struct.id.clock-i.struct.length;i={struct:new xt(L(p,i.struct.id.clock+i.struct.length),k),offset:0}}else{const k=i.struct.id.clock+i.struct.length-w.id.clock;k>0&&(i.struct.constructor===xt?i.struct.length-=k:w=iu(w,k)),i.struct.mergeWith(w)||(te(f,i.struct,i.offset),i={struct:w,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let w=u.curr;w!==null&&w.id.client===p&&w.id.clock===i.struct.id.clock+i.struct.length&&w.constructor!==xt;w=u.next())te(f,i.struct,i.offset),i={struct:w,offset:0}}i!==null&&(te(f,i.struct,i.offset),i=null),Ms(f);const h=r.map(u=>Rs(u)),g=Ma(h);return Je(l,g),l.toUint8Array()},ou=(e,t,n=Pe,r=pe)=>{const s=_o(t),i=new r,l=new vs(i),f=new n(qe(e)),h=new Ls(f,!1);for(;h.curr;){const u=h.curr,p=u.id.client,w=s.get(p)||0;if(h.curr.constructor===xt){h.next();continue}if(u.id.clock+u.length>w)for(te(l,u,ye(w-u.id.clock,0)),h.next();h.curr&&h.curr.id.client===p;)te(l,h.curr,0),h.next();else for(;h.curr&&h.curr.id.client===p&&h.curr.id.clock+h.curr.length<=w;)h.next()}Ms(l);const g=Rs(f);return Je(i,g),i.toUint8Array()},To=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Ft(e.encoder.restEncoder)}),e.encoder.restEncoder=gr(),e.written=0)},te=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&To(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),O(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Ms=e=>{To(e);const t=e.encoder.restEncoder;O(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];O(t,r.written),mr(t,r.restEncoder)}},cu=(e,t,n,r)=>{const s=new n(qe(e)),i=new Ls(s,!1),l=new r,f=new vs(l);for(let g=i.curr;g!==null;g=i.next())te(f,t(g),0);Ms(f);const h=Rs(s);return Je(l,h),l.toUint8Array()},lu=e=>cu(e,vl,Pe,Cn),hi="You must not compute changes after the event-handler fired.";class xr{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=au(this.currentTarget,this.target))}deletes(t){return wo(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Rt(hi);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let l,f;if(this.adds(i)){let h=i.left;for(;h!==null&&this.adds(h);)h=h.left;if(this.deletes(i))if(h!==null&&this.deletes(h))l="delete",f=Lr(h.content.getContent());else return;else h!==null&&this.deletes(h)?(l="update",f=Lr(h.content.getContent())):(l="add",f=void 0)}else if(this.deletes(i))l="delete",f=Lr(i.content.getContent());else return;t.set(s,{action:l,oldValue:f})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Rt(hi);const n=this.target,r=de(),s=de(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let f=null;const h=()=>{f&&i.push(f)};for(let g=n._start;g!==null;g=g.right)g.deleted?this.deletes(g)&&!this.adds(g)&&((f===null||f.delete===void 0)&&(h(),f={delete:0}),f.delete+=g.length,s.add(g)):this.adds(g)?((f===null||f.insert===void 0)&&(h(),f={insert:[]}),f.insert=f.insert.concat(g.content.getContent()),r.add(g)):((f===null||f.retain===void 0)&&(h(),f={retain:0}),f.retain+=g.length);f!==null&&f.retain===void 0&&h()}this._changes=t}return t}}const au=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},ht=()=>{Ua("Invalid access: Add Yjs type to a document before reading data.")},Ro=80;let Os=0;class uu{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Os++}}const hu=e=>{e.timestamp=Os++},Bo=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Os++},fu=(e,t,n)=>{if(e.length>=Ro){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return Bo(r,t,n),r}else{const r=new uu(t,n);return e.push(r),r}},Cr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,l)=>jn(t-i.index)<jn(t-l.index)?i:l);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,hu(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&jn(n.index-s)<r.parent.length/Ro?(Bo(n,r,s),n):fu(e._searchMarker,r,s)},mn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=ye(t,s.index+n))}},Ir=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;zt(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Ao(r._eH,n,t)};class ct{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ii(),this._dEH=ii(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Tt()}clone(){throw Tt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){oi(this._eH,t)}observeDeep(t){oi(this._dEH,t)}unobserve(t){ci(this._eH,t)}unobserveDeep(t){ci(this._dEH,t)}toJSON(){}}const Uo=(e,t,n)=>{e.doc??ht(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const l=i.content.getContent();if(l.length<=t)t-=l.length;else{for(let f=t;f<l.length&&r>0;f++)s.push(l[f]),r--;t=0}}i=i.right}return s},Lo=e=>{e.doc??ht();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},wn=(e,t)=>{let n=0,r=e._start;for(e.doc??ht();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},vo=(e,t)=>{const n=[];return wn(e,(r,s)=>{n.push(t(r,s,e))}),n},du=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Mo=(e,t)=>{e.doc??ht();const n=Cr(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},cr=(e,t,n,r)=>{let s=n;const i=e.doc,l=i.clientID,f=i.store,h=n===null?t._start:n.right;let g=[];const u=()=>{g.length>0&&(s=new tt(L(l,it(f,l)),s,s&&s.lastId,h,h&&h.id,t,null,new me(g)),s.integrate(e,0),g=[])};r.forEach(p=>{if(p===null)g.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:g.push(p);break;default:switch(u(),p.constructor){case Uint8Array:case ArrayBuffer:s=new tt(L(l,it(f,l)),s,s&&s.lastId,h,h&&h.id,t,null,new In(new Uint8Array(p))),s.integrate(e,0);break;case We:s=new tt(L(l,it(f,l)),s,s&&s.lastId,h,h&&h.id,t,null,new Dn(p)),s.integrate(e,0);break;default:if(p instanceof ct)s=new tt(L(l,it(f,l)),s,s&&s.lastId,h,h&&h.id,t,null,new Xt(p)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Oo=()=>Rt("Length exceeded!"),Fo=(e,t,n,r)=>{if(n>t._length)throw Oo();if(n===0)return t._searchMarker&&mn(t._searchMarker,n,r.length),cr(e,t,null,r);const s=n,i=Cr(t,n);let l=t._start;for(i!==null&&(l=i.p,n-=i.index,n===0&&(l=l.prev,n+=l&&l.countable&&!l.deleted?l.length:0));l!==null;l=l.right)if(!l.deleted&&l.countable){if(n<=l.length){n<l.length&&re(e,L(l.id.client,l.id.clock+n));break}n-=l.length}return t._searchMarker&&mn(t._searchMarker,s,r.length),cr(e,t,l,r)},pu=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,l)=>l.index>i.index?l:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return cr(e,t,s,n)},No=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,l=Cr(t,n);let f=t._start;for(l!==null&&(f=l.p,n-=l.index);f!==null&&n>0;f=f.right)!f.deleted&&f.countable&&(n<f.length&&re(e,L(f.id.client,f.id.clock+n)),n-=f.length);for(;r>0&&f!==null;)f.deleted||(r<f.length&&re(e,L(f.id.client,f.id.clock+r)),f.delete(e),r-=f.length),f=f.right;if(r>0)throw Oo();t._searchMarker&&mn(t._searchMarker,s,-i+r)},lr=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Fs=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,l=i.clientID;let f;if(r==null)f=new me([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:f=new me([r]);break;case Uint8Array:f=new In(r);break;case We:f=new Dn(r);break;default:if(r instanceof ct)f=new Xt(r);else throw new Error("Unexpected content type")}new tt(L(l,it(i.store,l)),s,s&&s.lastId,null,null,t,n,f).integrate(e,0)},Ns=(e,t)=>{e.doc??ht();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},$o=e=>{const t={};return e.doc??ht(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Po=(e,t)=>{e.doc??ht();const n=e._map.get(t);return n!==void 0&&!n.deleted},gu=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&De(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},vn=e=>(e.doc??ht(),La(e._map.entries(),t=>!t[1].deleted));class mu extends xr{}class Me extends ct{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Me;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Me}clone(){const t=new Me;return t.insert(0,this.toArray().map(n=>n instanceof ct?n.clone():n)),t}get length(){return this.doc??ht(),this._length}_callObserver(t,n){super._callObserver(t,n),Ir(this,t,new mu(this,t))}insert(t,n){this.doc!==null?P(this.doc,r=>{Fo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?P(this.doc,n=>{pu(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?P(this.doc,r=>{No(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Mo(this,t)}toArray(){return Lo(this)}slice(t=0,n=this.length){return Uo(this,t,n)}toJSON(){return this.map(t=>t instanceof ct?t.toJSON():t)}map(t){return vo(this,t)}forEach(t){wn(this,t)}[Symbol.iterator](){return du(this)}_write(t){t.writeTypeRef(Vu)}}const wu=e=>new Me;class yu extends xr{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Ve extends ct{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Ve}clone(){const t=new Ve;return this.forEach((n,r)=>{t.set(r,n instanceof ct?n.clone():n)}),t}_callObserver(t,n){Ir(this,t,new yu(this,t,n))}toJSON(){this.doc??ht();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof ct?s.toJSON():s}}),t}get size(){return[...vn(this)].length}keys(){return Vr(vn(this),t=>t[0])}values(){return Vr(vn(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Vr(vn(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??ht(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?P(this.doc,n=>{lr(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?P(this.doc,r=>{Fs(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Ns(this,t)}has(t){return Po(this,t)}clear(){this.doc!==null?P(this.doc,t=>{this.forEach(function(n,r,s){lr(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(ju)}}const bu=e=>new Ve,ee=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Ul(e,t);class is{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Ct(),this.right.content.constructor){case et:this.right.deleted||ze(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const fi=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case et:t.right.deleted||ze(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&re(e,L(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Mn=(e,t,n,r)=>{const s=new Map,i=r?Cr(t,n):null;if(i){const l=new is(i.p.left,i.p,i.index,s);return fi(e,l,n-i.index)}else{const l=new is(null,t._start,0,s);return fi(e,l,n)}},Vo=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===et&&ee(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((l,f)=>{const h=n.left,g=n.right,u=new tt(L(i,it(s.store,i)),h,h&&h.lastId,g,g&&g.id,t,null,new et(f,l));u.integrate(e,0),n.right=u,n.forward()})},ze=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},jo=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===et&&ee(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Ho=(e,t,n,r)=>{const s=e.doc,i=s.clientID,l=new Map;for(const f in r){const h=r[f],g=n.currentAttributes.get(f)??null;if(!ee(g,h)){l.set(f,g);const{left:u,right:p}=n;n.right=new tt(L(i,it(s.store,i)),u,u&&u.lastId,p,p&&p.id,t,null,new et(f,h)),n.right.integrate(e,0),n.forward()}}return l},Hr=(e,t,n,r,s)=>{n.currentAttributes.forEach((w,b)=>{s[b]===void 0&&(s[b]=null)});const i=e.doc,l=i.clientID;jo(n,s);const f=Ho(e,t,n,s),h=r.constructor===String?new Pt(r):r instanceof ct?new Xt(r):new be(r);let{left:g,right:u,index:p}=n;t._searchMarker&&mn(t._searchMarker,n.index,h.getLength()),u=new tt(L(l,it(i.store,l)),g,g&&g.lastId,u,u&&u.id,t,null,h),u.integrate(e,0),n.right=u,n.index=p,n.forward(),Vo(e,t,n,f)},di=(e,t,n,r,s)=>{const i=e.doc,l=i.clientID;jo(n,s);const f=Ho(e,t,n,s);t:for(;n.right!==null&&(r>0||f.size>0&&(n.right.deleted||n.right.content.constructor===et));){if(!n.right.deleted)switch(n.right.content.constructor){case et:{const{key:h,value:g}=n.right.content,u=s[h];if(u!==void 0){if(ee(u,g))f.delete(h);else{if(r===0)break t;f.set(h,g)}n.right.delete(e)}else n.currentAttributes.set(h,g);break}default:r<n.right.length&&re(e,L(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let h="";for(;r>0;r--)h+=`
`;n.right=new tt(L(l,it(i.store,l)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Pt(h)),n.right.integrate(e,0),n.forward()}Vo(e,t,n,f)},qo=(e,t,n,r,s)=>{let i=t;const l=mt();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===et){const g=i.content;l.set(g.key,g)}i=i.right}let f=0,h=!1;for(;t!==i;){if(n===t&&(h=!0),!t.deleted){const g=t.content;switch(g.constructor){case et:{const{key:u,value:p}=g,w=r.get(u)??null;(l.get(u)!==g||w===p)&&(t.delete(e),f++,!h&&(s.get(u)??null)===p&&w!==p&&(w===null?s.delete(u):s.set(u,w))),!h&&!t.deleted&&ze(s,g);break}}}t=t.right}return f},Eu=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===et){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},ku=e=>{let t=0;return P(e.doc,n=>{let r=e._start,s=e._start,i=mt();const l=Yr(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case et:ze(l,s.content);break;default:t+=qo(n,r,s,i,l),i=Yr(l),r=s;break}s=s.right}}),t},Su=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&Io(e,n.store.clients.get(r),i,s,l=>{!l.deleted&&l.content.constructor===et&&l.constructor!==At&&t.add(l.parent)})}P(n,r=>{mo(e,e.deleteSet,s=>{if(s instanceof At||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===et?t.add(i):Eu(r,s)});for(const s of t)ku(s)})},pi=(e,t,n)=>{const r=n,s=Yr(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Xt:case be:case Pt:n<t.right.length&&re(e,L(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&qo(e,i,t.right,s,t.currentAttributes);const l=(t.left||t.right).parent;return l._searchMarker&&mn(l._searchMarker,t.index,-r+n),t};class _u extends xr{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];P(t,r=>{const s=new Map,i=new Map;let l=this.target._start,f=null;const h={};let g="",u=0,p=0;const w=()=>{if(f!==null){let b=null;switch(f){case"delete":p>0&&(b={delete:p}),p=0;break;case"insert":(typeof g=="object"||g.length>0)&&(b={insert:g},s.size>0&&(b.attributes={},s.forEach((k,_)=>{k!==null&&(b.attributes[_]=k)}))),g="";break;case"retain":u>0&&(b={retain:u},Bl(h)||(b.attributes=Dl({},h))),u=0;break}b&&n.push(b),f=null}};for(;l!==null;){switch(l.content.constructor){case Xt:case be:this.adds(l)?this.deletes(l)||(w(),f="insert",g=l.content.getContent()[0],w()):this.deletes(l)?(f!=="delete"&&(w(),f="delete"),p+=1):l.deleted||(f!=="retain"&&(w(),f="retain"),u+=1);break;case Pt:this.adds(l)?this.deletes(l)||(f!=="insert"&&(w(),f="insert"),g+=l.content.str):this.deletes(l)?(f!=="delete"&&(w(),f="delete"),p+=l.length):l.deleted||(f!=="retain"&&(w(),f="retain"),u+=l.length);break;case et:{const{key:b,value:k}=l.content;if(this.adds(l)){if(!this.deletes(l)){const _=s.get(b)??null;ee(_,k)?k!==null&&l.delete(r):(f==="retain"&&w(),ee(k,i.get(b)??null)?delete h[b]:h[b]=k)}}else if(this.deletes(l)){i.set(b,k);const _=s.get(b)??null;ee(_,k)||(f==="retain"&&w(),h[b]=_)}else if(!l.deleted){i.set(b,k);const _=h[b];_!==void 0&&(ee(_,k)?_!==null&&l.delete(r):(f==="retain"&&w(),k===null?delete h[b]:h[b]=k))}l.deleted||(f==="insert"&&w(),ze(s,l.content));break}}l=l.right}for(w();n.length>0;){const b=n[n.length-1];if(b.retain!==void 0&&b.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class je extends ct{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ht(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new je}clone(){const t=new je;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new _u(this,t,n);Ir(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??ht();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Pt&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?P(this.doc,r=>{const s=new is(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const l=t[i];if(l.insert!==void 0){const f=!n&&typeof l.insert=="string"&&i===t.length-1&&s.right===null&&l.insert.slice(-1)===`
`?l.insert.slice(0,-1):l.insert;(typeof f!="string"||f.length>0)&&Hr(r,this,s,f,l.attributes||{})}else l.retain!==void 0?di(r,this,s,l.retain,l.attributes||{}):l.delete!==void 0&&pi(r,s,l.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??ht();const s=[],i=new Map,l=this.doc;let f="",h=this._start;function g(){if(f.length>0){const p={};let w=!1;i.forEach((k,_)=>{w=!0,p[_]=k});const b={insert:f};w&&(b.attributes=p),s.push(b),f=""}}const u=()=>{for(;h!==null;){if(De(h,t)||n!==void 0&&De(h,n))switch(h.content.constructor){case Pt:{const p=i.get("ychange");t!==void 0&&!De(h,t)?(p===void 0||p.user!==h.id.client||p.type!=="removed")&&(g(),i.set("ychange",r?r("removed",h.id):{type:"removed"})):n!==void 0&&!De(h,n)?(p===void 0||p.user!==h.id.client||p.type!=="added")&&(g(),i.set("ychange",r?r("added",h.id):{type:"added"})):p!==void 0&&(g(),i.delete("ychange")),f+=h.content.str;break}case Xt:case be:{g();const p={insert:h.content.getContent()[0]};if(i.size>0){const w={};p.attributes=w,i.forEach((b,k)=>{w[k]=b})}s.push(p);break}case et:De(h,t)&&(g(),ze(i,h.content));break}h=h.right}g()};return t||n?P(l,p=>{t&&rs(p,t),n&&rs(p,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?P(s,i=>{const l=Mn(i,this,t,!r);r||(r={},l.currentAttributes.forEach((f,h)=>{r[h]=f})),Hr(i,this,l,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?P(s,i=>{const l=Mn(i,this,t,!r);Hr(i,this,l,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?P(r,s=>{pi(s,Mn(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?P(s,i=>{const l=Mn(i,this,t,!1);l.right!==null&&di(i,this,l,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?P(this.doc,n=>{lr(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?P(this.doc,r=>{Fs(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Ns(this,t)}getAttributes(){return $o(this)}_write(t){t.writeTypeRef(Hu)}}const Au=e=>new je;class qr{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??ht()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===He||n.constructor===ge)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ge extends ct{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ge}clone(){const t=new ge;return t.insert(0,this.toArray().map(n=>n instanceof ct?n.clone():n)),t}get length(){return this.doc??ht(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new qr(this,t)}querySelector(t){t=t.toUpperCase();const r=new qr(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),ne(new qr(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ir(this,t,new Iu(this,n,t))}toString(){return vo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),wn(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?P(this.doc,r=>{Fo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)P(this.doc,r=>{const s=t&&t instanceof ct?t._item:t;cr(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw Rt("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?P(this.doc,r=>{No(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Lo(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Mo(this,t)}slice(t=0,n=this.length){return Uo(this,t,n)}forEach(t){wn(this,t)}_write(t){t.writeTypeRef(Gu)}}const xu=e=>new ge;class He extends ge{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new He(this.nodeName)}clone(){const t=new He(this.nodeName),n=this.getAttributes();return Rl(n,(r,s)=>{t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof ct?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const f in t)r.push(f);r.sort();const s=r.length;for(let f=0;f<s;f++){const h=r[f];n.push(h+'="'+t[h]+'"')}const i=this.nodeName.toLocaleLowerCase(),l=n.length>0?" "+n.join(" "):"";return`<${i}${l}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?P(this.doc,n=>{lr(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?P(this.doc,r=>{Fs(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Ns(this,t)}hasAttribute(t){return Po(this,t)}getAttributes(t){return t?gu(this,t):$o(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const l in i){const f=i[l];typeof f=="string"&&s.setAttribute(l,f)}return wn(this,l=>{s.appendChild(l.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(qu),t.writeKey(this.nodeName)}}const Cu=e=>new He(e.readKey());class Iu extends xr{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class ar extends Ve{constructor(t){super(),this.hookName=t}_copy(){return new ar(this.hookName)}clone(){const t=new ar(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Ju),t.writeKey(this.hookName)}}const Du=e=>new ar(e.readKey());class ur extends je{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ur}clone(){const t=new ur;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const l in t.attributes[s])i.push({key:l,value:t.attributes[s][l]});i.sort((l,f)=>l.key<f.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let l=0;l<i.attrs.length;l++){const f=i.attrs[l];r+=` ${f.key}="${f.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Wu)}}const Tu=e=>new ur;class $s{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Tt()}mergeWith(t){return!1}write(t,n,r){throw Tt()}integrate(t,n){throw Tt()}}const Ru=0;class At extends $s{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Co(t.doc.store,this)}write(t,n){t.writeInfo(Ru),t.writeLen(this.length-n)}getMissing(t,n){return null}}class In{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new In(this.content)}splice(t){throw Tt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Bu=e=>new In(e.readBuf());class yn{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new yn(this.len)}splice(t){const n=new yn(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){ir(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Uu=e=>new yn(e.readLen()),Go=(e,t)=>new We({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Dn{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Dn(Go(this.doc.guid,this.opts))}splice(t){throw Tt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Lu=e=>new Dn(Go(e.readString(),e.readAny()));class be{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new be(this.embed)}splice(t){throw Tt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const vu=e=>new be(e.readJSON());class et{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new et(this.key,this.value)}splice(t){throw Tt()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Mu=e=>new et(e.readKey(),e.readJSON());class hr{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new hr(this.arr)}splice(t){const n=new hr(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const Ou=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new hr(n)},Fu=nr("node_env")==="development";class me{constructor(t){this.arr=t,Fu&&qi(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new me(this.arr)}splice(t){const n=new me(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const Nu=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new me(n)};class Pt{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Pt(this.str)}splice(t){const n=new Pt(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const $u=e=>new Pt(e.readString()),Pu=[wu,bu,Au,Cu,xu,Du,Tu],Vu=0,ju=1,Hu=2,qu=3,Gu=4,Ju=5,Wu=6;class Xt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Xt(this.type._copy())}splice(t){throw Tt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const zu=e=>new Xt(Pu[e.readTypeRef()](e)),fr=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new tt(L(r,s+n),t,L(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=L(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i};class tt extends $s{constructor(t,n,r,s,i,l,f,h){super(t,h.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=l,this.parentSub=f,this.redone=null,this.content=h,this.info=this.content.isCountable()?Ws:0}set marker(t){(this.info&Mr)>0!==t&&(this.info^=Mr)}get marker(){return(this.info&Mr)>0}get keep(){return(this.info&Js)>0}set keep(t){this.keep!==t&&(this.info^=Js)}get countable(){return(this.info&Ws)>0}get deleted(){return(this.info&vr)>0}set deleted(t){this.deleted!==t&&(this.info^=vr)}markDeleted(){this.info|=vr}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=it(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=it(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ve&&this.id.client!==this.parent.client&&this.parent.clock>=it(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=li(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=re(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===At||this.right&&this.right.constructor===At)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===tt?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===tt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ve){const r=jr(n,this.parent);r.constructor===At?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=li(t,t.doc.store,L(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,l=new Set;for(;s!==null&&s!==this.right;){if(l.add(s),i.add(s),Ln(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Ln(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&l.has(jr(t.doc.store,s.origin)))i.has(jr(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Co(t.doc.store,this),this.content.integrate(t,this),ui(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new At(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:L(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ln(t.origin,this.lastId)&&this.right===t&&Ln(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ir(t.deleteSet,this.id.client,this.id.clock,this.length),ui(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Ct();this.content.gc(t),n?Qa(t,this,new At(this.id,this.length)):this.content=new yn(this.length)}write(t,n){const r=n>0?L(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,l=this.content.getRef()&pr|(r===null?0:Et)|(s===null?0:Wt)|(i===null?0:an);if(t.writeInfo(l),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const f=this.parent;if(f._item!==void 0){const h=f._item;if(h===null){const g=Xa(f);t.writeParentInfo(!0),t.writeString(g)}else t.writeParentInfo(!1),t.writeLeftID(h.id)}else f.constructor===String?(t.writeParentInfo(!0),t.writeString(f)):f.constructor===ve?(t.writeParentInfo(!1),t.writeLeftID(f)):Ct();i!==null&&t.writeString(i)}this.content.write(t,n)}}const Jo=(e,t)=>Yu[t&pr](e),Yu=[()=>{Ct()},Uu,Ou,Bu,$u,vu,Mu,zu,Nu,Lu,()=>{Ct()}],Ku=10;class xt extends $s{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Ct()}write(t,n){t.writeInfo(Ku),O(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Wo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gs<"u"?Gs:{},zo="__ $YJS$ __";Wo[zo]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Wo[zo]=!0;const Ee=e=>Ne((t,n)=>{e.onerror=r=>n(new Error(r.target.error)),e.onsuccess=r=>t(r.target.result)}),Xu=(e,t)=>Ne((n,r)=>{const s=indexedDB.open(e);s.onupgradeneeded=i=>t(i.target.result),s.onerror=i=>r(Rt(i.target.error)),s.onsuccess=i=>{const l=i.target.result;l.onversionchange=()=>{l.close()},n(l)}}),Zu=e=>Ee(indexedDB.deleteDatabase(e)),Qu=(e,t)=>t.forEach(n=>e.createObjectStore.apply(e,n)),en=(e,t,n="readwrite")=>{const r=e.transaction(t,n);return t.map(s=>ch(r,s))},Yo=(e,t)=>Ee(e.count(t)),th=(e,t)=>Ee(e.get(t)),Ko=(e,t)=>Ee(e.delete(t)),eh=(e,t,n)=>Ee(e.put(t,n)),os=(e,t)=>Ee(e.add(t)),nh=(e,t,n)=>Ee(e.getAll(t,n)),rh=(e,t,n)=>{let r=null;return oh(e,t,s=>(r=s,!1),n).then(()=>r)},sh=(e,t=null)=>rh(e,t,"prev"),ih=(e,t)=>Ne((n,r)=>{e.onerror=r,e.onsuccess=async s=>{const i=s.target.result;if(i===null||await t(i)===!1)return n();i.continue()}}),oh=(e,t,n,r="next")=>ih(e.openKeyCursor(t,r),s=>n(s.key)),ch=(e,t)=>e.objectStore(t),lh=(e,t)=>IDBKeyRange.upperBound(e,t),ah=(e,t)=>IDBKeyRange.lowerBound(e,t),Gr="custom",Xo="updates",Zo=500,Qo=(e,t=()=>{},n=()=>{})=>{const[r]=en(e.db,[Xo]);return nh(r,ah(e._dbref,!1)).then(s=>{e._destroyed||(t(r),P(e.doc,()=>{s.forEach(i=>Ja(e.doc,i))},e,!1),n(r))}).then(()=>sh(r).then(s=>{e._dbref=s+1})).then(()=>Yo(r).then(s=>{e._dbsize=s})).then(()=>r)},uh=(e,t=!0)=>Qo(e).then(n=>{(t||e._dbsize>=Zo)&&os(n,So(e.doc)).then(()=>Ko(n,lh(e._dbref,!0))).then(()=>Yo(n).then(r=>{e._dbsize=r}))});class hh extends Bc{constructor(t,n){super(),this.doc=n,this.name=t,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Xu(t,r=>Qu(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Ne(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Qo(this,l=>os(l,So(n)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){const[i]=en(this.db,[Xo]);os(i,r),++this._dbsize>=Zo&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{uh(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},n.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{Zu(this.name)})}get(t){return this._db.then(n=>{const[r]=en(n,[Gr],"readonly");return th(r,t)})}set(t,n){return this._db.then(r=>{const[s]=en(r,[Gr]);return eh(s,n,t)})}del(t){return this._db.then(n=>{const[r]=en(n,[Gr]);return Ko(r,t)})}}const tc="schwalbvault",ke=new We,fh=typeof window<"u",zn=fh?new hh(tc,ke):null,dh=ke.getMap("characters"),nn=ke.getMap("campaigns"),ph=ke.getMap("enemies"),gh=ke.getMap("encounters"),mh=ke.getMap("images"),wh=()=>new Promise(e=>{if(!zn){e();return}zn.synced?e():zn.on("synced",()=>{e()})}),yf=Object.freeze(Object.defineProperty({__proto__:null,campaignsMap:nn,charactersMap:dh,doc:ke,encountersMap:gh,enemiesMap:ph,imagesMap:mh,provider:zn,waitForSync:wh},Symbol.toStringTag,{value:"Module"}));const On="0123456789abcdef";class ue{constructor(t){this.bytes=t}static ofInner(t){if(t.length!==16)throw new TypeError("not 128-bit length");return new ue(t)}static fromFieldsV7(t,n,r,s){if(!Number.isInteger(t)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(s)||t<0||n<0||r<0||s<0||t>0xffffffffffff||n>4095||r>1073741823||s>4294967295)throw new RangeError("invalid field value");const i=new Uint8Array(16);return i[0]=t/2**40,i[1]=t/2**32,i[2]=t/2**24,i[3]=t/2**16,i[4]=t/2**8,i[5]=t,i[6]=112|n>>>8,i[7]=n,i[8]=128|r>>>24,i[9]=r>>>16,i[10]=r>>>8,i[11]=r,i[12]=s>>>24,i[13]=s>>>16,i[14]=s>>>8,i[15]=s,new ue(i)}static parse(t){var n,r,s,i;let l;switch(t.length){case 32:l=(n=/^[0-9a-f]{32}$/i.exec(t))===null||n===void 0?void 0:n[0];break;case 36:l=(r=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))===null||r===void 0?void 0:r.slice(1,6).join("");break;case 38:l=(s=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(t))===null||s===void 0?void 0:s.slice(1,6).join("");break;case 45:l=(i=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))===null||i===void 0?void 0:i.slice(1,6).join("");break}if(l){const f=new Uint8Array(16);for(let h=0;h<16;h+=4){const g=parseInt(l.substring(2*h,2*h+8),16);f[h+0]=g>>>24,f[h+1]=g>>>16,f[h+2]=g>>>8,f[h+3]=g}return new ue(f)}else throw new SyntaxError("could not parse UUID string")}toString(){let t="";for(let n=0;n<this.bytes.length;n++)t+=On.charAt(this.bytes[n]>>>4),t+=On.charAt(this.bytes[n]&15),(n===3||n===5||n===7||n===9)&&(t+="-");return t}toHex(){let t="";for(let n=0;n<this.bytes.length;n++)t+=On.charAt(this.bytes[n]>>>4),t+=On.charAt(this.bytes[n]&15);return t}toJSON(){return this.toString()}getVariant(){const t=this.bytes[8]>>>4;if(t<0)throw new Error("unreachable");if(t<=7)return this.bytes.every(n=>n===0)?"NIL":"VAR_0";if(t<=11)return"VAR_10";if(t<=13)return"VAR_110";if(t<=15)return this.bytes.every(n=>n===255)?"MAX":"VAR_RESERVED";throw new Error("unreachable")}getVersion(){return this.getVariant()==="VAR_10"?this.bytes[6]>>>4:void 0}clone(){return new ue(this.bytes.slice(0))}equals(t){return this.compareTo(t)===0}compareTo(t){for(let n=0;n<16;n++){const r=this.bytes[n]-t.bytes[n];if(r!==0)return Math.sign(r)}return 0}}class yh{constructor(t){this.timestamp_biased=0,this.counter=0,this.random=t??bh()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(t,n){let r=this.generateOrAbortCore(t,n);return r===void 0&&(this.timestamp_biased=0,r=this.generateOrAbortCore(t,n)),r}generateOrAbortCore(t,n){if(!Number.isInteger(t)||t<0||t>0xffffffffffff)throw new RangeError("`unixTsMs` must be a 48-bit unsigned integer");if(n<0||n>0xffffffffffff)throw new RangeError("`rollbackAllowance` out of reasonable range");if(t++,t>this.timestamp_biased)this.timestamp_biased=t,this.resetCounter();else if(t+n>=this.timestamp_biased)this.counter++,this.counter>4398046511103&&(this.timestamp_biased++,this.resetCounter());else return;return ue.fromFieldsV7(this.timestamp_biased-1,Math.trunc(this.counter/2**30),this.counter&2**30-1,this.random.nextUint32())}resetCounter(){this.counter=this.random.nextUint32()*1024+(this.random.nextUint32()&1023)}generateV4(){const t=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return t[6]=64|t[6]>>>4,t[8]=128|t[8]>>>2,ue.ofInner(t)}}const bh=()=>{if(typeof crypto<"u"&&typeof crypto.getRandomValues<"u")return new Eh;if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");return{nextUint32:()=>Math.trunc(Math.random()*65536)*65536+Math.trunc(Math.random()*65536)}};class Eh{constructor(){this.buffer=new Uint32Array(8),this.cursor=65535}nextUint32(){return this.cursor>=this.buffer.length&&(crypto.getRandomValues(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}let gi;const mi=()=>kh().toString(),kh=()=>(gi||(gi=new yh)).generate(),{floor:Sh,random:_h}=Math,bn="Trystero",En=(e,t)=>Array(e).fill().map(t),wi="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",ec=e=>En(e,()=>wi[Sh(_h()*wi.length)]).join(""),Te=ec(20),le=Promise.all.bind(Promise),nc=typeof window<"u",{entries:cs,fromEntries:rc,keys:Ah}=Object,Ht=()=>{},qt=e=>new Error(`${bn}: ${e}`),xh=new TextEncoder,Ch=new TextDecoder,Oe=e=>xh.encode(e),Yn=e=>Ch.decode(e),Fn=(...e)=>e.join("@"),Ih=(e,t,n,r)=>(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||n),kn=JSON.stringify,Sn=JSON.parse,yi=3333,Nn={};let ln=null,ls=null;const Dh=()=>{ln||(ln=new Promise(e=>{ls=e}).finally(()=>{ls=null,ln=null}))},Th=()=>ls?.(),Rh=(e,t)=>{const n={},r=()=>{const s=new WebSocket(e);s.onclose=()=>{if(ln){ln.then(r);return}Nn[e]??=yi,setTimeout(r,Nn[e]),Nn[e]*=2},s.onmessage=i=>t(i.data),n.socket=s,n.url=s.url,n.ready=new Promise(i=>s.onopen=()=>{i(n),Nn[e]=yi}),n.send=i=>{s.readyState===1&&s.send(i)}};return r(),n},Bh=()=>{if(nc){const e=new AbortController;return addEventListener("online",Th,{signal:e.signal}),addEventListener("offline",Dh,{signal:e.signal}),()=>e.abort()}return Ht},Ps="AES-GCM",Uh={},Lh=e=>btoa(String.fromCharCode.apply(null,new Uint8Array(e))),vh=e=>{const t=atob(e);return new Uint8Array(t.length).map((n,r)=>t.charCodeAt(r)).buffer},Mh=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,Oe(t))),rn=async e=>Uh[e]||=Array.from(await Mh("SHA-1",e)).map(t=>t.toString(36)).join(""),Oh=async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Oe(`${e}:${t}:${n}`)),{name:Ps},!1,["encrypt","decrypt"]),sc="$",ic=",",Fh=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));return n.join(ic)+sc+Lh(await crypto.subtle.encrypt({name:Ps,iv:n},await e,Oe(t)))},Nh=async(e,t)=>{const[n,r]=t.split(sc);return Yn(await crypto.subtle.decrypt({name:Ps,iv:new Uint8Array(n.split(ic))},await e,vh(r)))},$h=5e3,bi="icegatheringstatechange",Ei="offer",Ph="answer",ki=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:r})=>{const s=new(n||RTCPeerConnection)({iceServers:Vh.concat(r||[]),...t}),i={};let l=!1,f=!1,h=null;const g=p=>{p.binaryType="arraybuffer",p.bufferedAmountLowThreshold=65535,p.onmessage=w=>i.data?.(w.data),p.onopen=()=>i.connect?.(),p.onclose=()=>i.close?.(),p.onerror=w=>i.error?.(w)},u=p=>Promise.race([new Promise(w=>{const b=()=>{p.iceGatheringState==="complete"&&(p.removeEventListener(bi,b),w())};p.addEventListener(bi,b),b()}),new Promise(w=>setTimeout(w,$h))]).then(()=>({type:p.localDescription.type,sdp:p.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return e?(h=s.createDataChannel("data"),g(h)):s.ondatachannel=({channel:p})=>{h=p,g(p)},s.onnegotiationneeded=async()=>{try{l=!0,await s.setLocalDescription();const p=await u(s);i.signal?.(p)}catch(p){i.error?.(p)}finally{l=!1}},s.onconnectionstatechange=()=>{["disconnected","failed","closed"].includes(s.connectionState)&&i.close?.()},s.ontrack=p=>{i.track?.(p.track,p.streams[0]),i.stream?.(p.streams[0])},s.onremovestream=p=>i.stream?.(p.stream),e&&(s.canTrickleIceCandidates||s.onnegotiationneeded()),{created:Date.now(),connection:s,get channel(){return h},get isDead(){return s.connectionState==="closed"},async signal(p){if(!(h?.readyState==="open"&&!p.sdp?.includes("a=rtpmap")))try{if(p.type===Ei){if(l||s.signalingState!=="stable"&&!f){if(e)return;await le([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(p)])}else await s.setRemoteDescription(p);await s.setLocalDescription();const w=await u(s);return i.signal?.(w),w}else if(p.type===Ph){f=!0;try{await s.setRemoteDescription(p)}finally{f=!1}}}catch(w){i.error?.(w)}},sendData:p=>h.send(p),destroy:()=>{h?.close(),s.close(),l=!1,f=!1},setHandlers:p=>Object.assign(i,p),offerPromise:e?new Promise(p=>i.signal=w=>{w.type===Ei&&p(w)}):Promise.resolve(),addStream:p=>p.getTracks().forEach(w=>s.addTrack(w,p)),removeStream:p=>s.getSenders().filter(w=>p.getTracks().includes(w.track)).forEach(w=>s.removeTrack(w)),addTrack:(p,w)=>s.addTrack(p,w),removeTrack:p=>{const w=s.getSenders().find(b=>b.track===p);w&&s.removeTrack(w)},replaceTrack:(p,w)=>{const b=s.getSenders().find(k=>k.track===p);if(b)return b.replaceTrack(w)}}},Vh=[...En(3,(e,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(e=>({urls:e})),jh=Object.getPrototypeOf(Uint8Array),Kn=12,oc=0,Xn=oc+Kn,Zn=Xn+1,sn=Zn+1,on=sn+1,oe=16*2**10-on,$n=255,Si="bufferedamountlow",Ie=e=>"@_"+e,Hh=(e,t,n)=>{const r={},s={},i={},l={},f={},h={},g={},u={onPeerJoin:Ht,onPeerLeave:Ht,onPeerStream:Ht,onPeerTrack:Ht},p=(S,A)=>(S?Array.isArray(S)?S:[S]:Ah(r)).flatMap(R=>{const v=r[R];return v?A(R,v):(console.warn(`${bn}: no peer with id ${R} found`),[])}),w=S=>{r[S]&&(r[S].destroy(),delete r[S],delete l[S],delete f[S],u.onPeerLeave(S),t(S))},b=S=>{if(s[S])return i[S];if(!S)throw qt("action type argument is required");const A=Oe(S);if(A.byteLength>Kn)throw qt(`action type string "${S}" (${A.byteLength}b) exceeds byte limit (${Kn}). Hint: choose a shorter name.`);const R=new Uint8Array(Kn);R.set(A);let v=0;return s[S]={onComplete:Ht,onProgress:Ht,setOnComplete:V=>s[S]={...s[S],onComplete:V},setOnProgress:V=>s[S]={...s[S],onProgress:V},send:async(V,x,I,q)=>{if(I&&typeof I!="object")throw qt("action meta argument must be an object");const at=typeof V;if(at==="undefined")throw qt("action data cannot be undefined");const nt=at!=="string",It=V instanceof Blob,N=It||V instanceof ArrayBuffer||V instanceof jh;if(I&&!N)throw qt("action meta argument can only be used with binary data");const M=N?new Uint8Array(It?await V.arrayBuffer():V):Oe(nt?kn(V):V),j=I?Oe(kn(I)):null,G=Math.ceil(M.byteLength/oe)+(I?1:0)||1,Z=En(G,(Q,rt)=>{const kt=rt===G-1,ut=I&&rt===0,wt=new Uint8Array(on+(ut?j.byteLength:kt?M.byteLength-oe*(G-(I?2:1)):oe));return wt.set(R),wt.set([v],Xn),wt.set([kt|ut<<1|N<<2|nt<<3],Zn),wt.set([Math.round((rt+1)/G*$n)],sn),wt.set(I?ut?j:M.subarray((rt-1)*oe,rt*oe):M.subarray(rt*oe,(rt+1)*oe),on),wt});return v=v+1&$n,le(p(x,async(Q,rt)=>{const{channel:kt}=rt;let ut=0;for(;ut<G;){const wt=Z[ut];if(kt.bufferedAmount>kt.bufferedAmountLowThreshold&&await new Promise(Rn=>{const Bn=()=>{kt.removeEventListener(Si,Bn),Rn()};kt.addEventListener(Si,Bn)}),!r[Q])break;rt.sendData(wt),ut++,q?.(wt[sn]/$n,Q,I)}}))}},i[S]||=[s[S].send,s[S].setOnComplete,s[S].setOnProgress]},k=(S,A)=>{const R=new Uint8Array(A),v=Yn(R.subarray(oc,Xn)).replaceAll("\0",""),[V]=R.subarray(Xn,Zn),[x]=R.subarray(Zn,sn),[I]=R.subarray(sn,on),q=R.subarray(on),at=!!(x&1),nt=!!(x&2),It=!!(x&4),N=!!(x&8);if(!s[v]){console.warn(`${bn}: received message with unregistered type (${v})`);return}l[S]||={},l[S][v]||={};const M=l[S][v][V]||={chunks:[]};if(nt?M.meta=Sn(Yn(q)):M.chunks.push(q),s[v].onProgress(I/$n,S,M.meta),!at)return;const j=new Uint8Array(M.chunks.reduce((G,Z)=>G+Z.byteLength,0));if(M.chunks.reduce((G,Z)=>(j.set(Z,G),G+Z.byteLength),0),delete l[S][v][V],It)s[v].onComplete(j,S,M.meta);else{const G=Yn(j);s[v].onComplete(N?Sn(G):G,S)}},_=async()=>{await ie(""),await new Promise(S=>setTimeout(S,99)),cs(r).forEach(([S,A])=>{A.destroy(),delete r[S]}),n()},[F,lt]=b(Ie("ping")),[Y,C]=b(Ie("pong")),[T,K]=b(Ie("signal")),[dt,se]=b(Ie("stream")),[pt,Se]=b(Ie("track")),[ie,_e]=b(Ie("leave"));return e((S,A)=>{r[A]||(r[A]=S,S.setHandlers({data:R=>k(A,R),stream:R=>{u.onPeerStream(R,A,h[A]),delete h[A]},track:(R,v)=>{u.onPeerTrack(R,v,A,g[A]),delete g[A]},signal:R=>T(R,A),close:()=>w(A),error:R=>{console.error(R),w(A)}}),u.onPeerJoin(A))}),lt((S,A)=>Y("",A)),C((S,A)=>{f[A]?.(),delete f[A]}),K((S,A)=>r[A]?.signal(S)),se((S,A)=>h[A]=S),Se((S,A)=>g[A]=S),_e((S,A)=>w(A)),nc&&addEventListener("beforeunload",_),{makeAction:b,leave:_,ping:async S=>{if(!S)throw qt("ping() must be called with target peer ID");const A=Date.now();return F("",S),await new Promise(R=>f[S]=R),Date.now()-A},getPeers:()=>rc(cs(r).map(([S,A])=>[S,A.connection])),addStream:(S,A,R)=>p(A,async(v,V)=>{R&&await dt(R,v),V.addStream(S)}),removeStream:(S,A)=>p(A,(R,v)=>v.removeStream(S)),addTrack:(S,A,R,v)=>p(R,async(V,x)=>{v&&await pt(v,V),x.addTrack(S,A)}),removeTrack:(S,A)=>p(A,(R,v)=>v.removeTrack(S)),replaceTrack:(S,A,R,v)=>p(R,async(V,x)=>{v&&await pt(v,V),x.replaceTrack(S,A)}),onPeerJoin:S=>u.onPeerJoin=S,onPeerLeave:S=>u.onPeerLeave=S,onPeerStream:S=>u.onPeerStream=S,onPeerTrack:S=>u.onPeerTrack=S}},qh=20,Gh=5333,_i=57333,Jh=({init:e,subscribe:t,announce:n})=>{const r={};let s=!1,i,l,f,h;return(g,u,p)=>{const{appId:w}=g;if(r[w]?.[u])return r[w][u];const b={},k={},_=Fn(bn,w,u),F=rn(_),lt=rn(Fn(_,Te)),Y=Oh(g.password||"",w,u),C=x=>async I=>({type:I.type,sdp:await x(Y,I.sdp)}),T=C(Nh),K=C(Fh),dt=()=>ki(!0,g),se=(x,I,q)=>{if(k[I]){k[I]!==x&&x.destroy();return}k[I]=x,V(x,I),b[I]?.forEach((at,nt)=>{nt!==q&&at.destroy()}),delete b[I]},pt=(x,I)=>{k[I]===x&&delete k[I]},Se=(x,I)=>{if(k[x])return;const q=b[x]?.[I];q&&(delete b[x][I],q.destroy())},ie=x=>(l.push(...En(x,dt)),le(l.splice(0,x).map(I=>I.offerPromise.then(K).then(q=>({peer:I,offer:q}))))),_e=(x,I)=>p?.({error:`incorrect password (${g.password}) when decrypting ${I}`,appId:w,peerId:x,roomId:u}),S=x=>async(I,q,at)=>{const[nt,It]=await le([F,lt]);if(I!==nt&&I!==It)return;const{peerId:N,offer:M,answer:j,peer:G}=typeof q=="string"?Sn(q):q;if(!(N===Te||k[N])){if(N&&!M&&!j){if(b[N]?.[x])return;const[[{peer:Z,offer:Q}],rt]=await le([ie(1),rn(Fn(_,N))]);b[N]||=[],b[N][x]=Z,setTimeout(()=>Se(N,x),A[x]*.9),Z.setHandlers({connect:()=>se(Z,N,x),close:()=>pt(Z,N)}),at(rt,kn({peerId:Te,offer:Q}))}else if(M){if(b[N]?.[x]&&Te>N)return;const Q=ki(!1,g);Q.setHandlers({connect:()=>se(Q,N,x),close:()=>pt(Q,N)});let rt;try{rt=await T(M)}catch{_e(N,"offer");return}if(Q.isDead)return;const[kt,ut]=await le([rn(Fn(_,N)),Q.signal(rt)]);at(kt,kn({peerId:Te,answer:await K(ut)}))}else if(j){let Z;try{Z=await T(j)}catch{_e(N,"answer");return}if(G)G.setHandlers({connect:()=>se(G,N,x),close:()=>pt(G,N)}),G.signal(Z);else{const Q=b[N]?.[x];Q&&!Q.isDead&&Q.signal(Z)}}}};if(!g)throw qt("requires a config map as the first argument");if(!w&&!g.firebaseApp)throw qt("config map is missing appId field");if(!u)throw qt("roomId argument required");if(!s){const x=e(g);l=En(qh,dt),i=Array.isArray(x)?x:[x],s=!0,f=setInterval(()=>l=l.filter(I=>{const q=Date.now()-I.created<_i;return q||I.destroy(),q}),_i*1.03),h=g.manualRelayReconnection?Ht:Bh()}const A=i.map(()=>Gh),R=[],v=i.map(async(x,I)=>t(await x,await F,await lt,S(I),ie));le([F,lt]).then(([x,I])=>{const q=async(at,nt)=>{const It=await n(at,x,I);typeof It=="number"&&(A[nt]=It),R[nt]=setTimeout(()=>q(at,nt),A[nt])};v.forEach(async(at,nt)=>{await at,q(await i[nt],nt)})});let V=Ht;return r[w]||={},r[w][u]=Hh(x=>V=x,x=>delete k[x],()=>{delete r[w][u],R.forEach(clearTimeout),v.forEach(async x=>(await x)()),clearInterval(f),h(),s=!1})}},Jr={},cc={},Ze={},Qe={},tn={},Ai={},Pn={},Wh="announce",lc=20,xi=10,zh=33333,Yh=120333,Kh=3,Xh=async e=>{if(Jr[e])return Jr[e];const t=(await rn(e)).slice(0,lc);return Jr[e]=t,cc[t]=e,t},Ci=async(e,t,n)=>e.send(kn({action:Wh,info_hash:await Xh(t),peer_id:Te,...n})),Ii=(e,t,n)=>console.warn(`${bn}: torrent tracker ${n?"failure":"warning"} from ${e} - ${t}`),ac=Jh({init:e=>Ih(e,Zh,Kh).map(t=>{const n=Rh(t,s=>{const i=Sn(s),l=i["failure reason"],f=i["warning message"],{interval:h}=i,g=cc[i.info_hash];if(l){Ii(r,l,!0);return}if(f&&Ii(r,f),h&&h*1e3>tn[r]&&Qe[r][g]){const u=Math.min(h*1e3,Yh);clearInterval(Ze[r][g]),tn[r]=u,Ze[r][g]=setInterval(Qe[r][g],u)}Ai[i.offer_id]||(i.offer||i.answer)&&(Ai[i.offer_id]=!0,Pn[r][g]?.(i))}),{url:r}=n;return Pn[r]={},n.ready}),subscribe:(e,t,n,r,s)=>{const{url:i}=e,l=async()=>{const f=rc((await s(xi)).map(h=>[ec(lc),h]));Pn[e.url][t]=h=>{if(h.offer)r(t,{offer:h.offer,peerId:h.peer_id},(g,u)=>Ci(e,t,{answer:Sn(u).answer,offer_id:h.offer_id,to_peer_id:h.peer_id}));else if(h.answer){const g=f[h.offer_id];g&&r(t,{answer:h.answer,peerId:h.peer_id,peer:g.peer})}},Ci(e,t,{numwant:xi,offers:cs(f).map(([h,{offer:g}])=>({offer_id:h,offer:g}))})};return tn[i]=zh,Qe[i]||={},Qe[i][t]=l,Ze[i]||={},Ze[i][t]=setInterval(l,tn[i]),l(),()=>{clearInterval(Ze[i][t]),delete Pn[i][t],delete Qe[i][t]}},announce:e=>tn[e.url]}),Zh=["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.btorrent.xyz","tracker.files.fm:7073/announce"].map(e=>"wss://"+e),bf=["Aeromancy","Alchemy","Alteration","Animism","Astromancy","Chaos","Chronomancy","Conjuration","Cryomancy","Dark Arts","Destruction","Divination","Eldritch","Enchantment","Evocation","Geomancy","Hydromancy","Illusion","Invocation","Necromancy","Oneiromancy","Order","Primal","Protection","Psychomancy","Pyromancy","Shadowmancy","Skullduggery","Spiritualism","Symbolism","Technomancy","Teleportation","War"],Ef={NEXT_ROLL:"Prxima Rolagem",ROUNDS:"Rodadas",MINUTES:"Minutos",HOURS:"Horas",DAYS:"Dias",LUCK_ENDS:"Sorte Encerra",PERMANENT:"Indeterminado"},_t={WEAPON:"Weapon",ARMOR:"Armor",SHIELD:"Shield",CONSUMABLE:"Consumable",EXPLOSIVE:"Explosive",OTHER:"Other"},fe={ADD:"ADD",SET:"SET",MULT:"MULT"},kf={str:"Fora",agi:"Agilidade",int:"Intelecto",wil:"Vontade",defense:"Defesa",speed:"Deslocamento",health:"Vida",damage:"Dano (Dados)",boons:"Boons/Banes"},Sf={Blinded:{effect:"Make rolls with 3 banes. No sight reactions. Speed halved.",speedMult:.5,rollMod:-3},Confused:{effect:"No reactions. Intellect and Will rolls with 1 bane.",rollMod:-1,attributes:["int","wil"]},Controlled:{effect:"Controller decides your turn. Regard source as ally."},Cursed:{effect:"Luck rolls with 1 bane."},Deafened:{effect:"No hearing reactions. Immune to hearing effects."},Frightened:{effect:"Attribute rolls with 1 bane (while in LOS). Grant 1 boon on rolls against you.",rollMod:-1},Held:{effect:"Speed 0. Cannot increase Speed. Auto-fail Agility defense rolls.",speedFixed:0},Impaired:{effect:"Roll with 1 bane for specified attribute. Grant 1 boon against that attribute.",rollMod:-1},Incapacitated:{effect:"Damage equals or exceeds Health. You cannot use actions or reactions. Speed 0.",speedFixed:0},"On Fire":{effect:"Take 1d6 damage at end of round. Action/Luck roll to extinguish."},Poisoned:{effect:"Attribute rolls with 1 bane. Grant 1 boon against you. Lose 1d6 Health end of round.",rollMod:-1},Prone:{effect:"No reactions. Grant 1 boon to melee vs you, impose 1 bane to ranged vs you."},Slowed:{effect:"Speed drops to 2 (if higher). Cannot benefit from Speed increases.",speedCap:2},Stunned:{effect:"No actions/reactions. Speed 0. Grant 2 boons against you. Attribute rolls with 2 banes.",speedFixed:0,rollMod:-2},Unconscious:{effect:"No actions/reactions. Speed 0. Grant 3 boons against you. Auto-fail attribute rolls.",speedFixed:0,autoFail:!0},Vulnerable:{effect:"Grant 1 boon on attacks/rolls against you."},Weakened:{effect:"Strength/Agility rolls with 1 bane. Grant 1 boon vs Str/Agi. Speed halved.",speedMult:.5,attributes:["str","agi"],rollMod:-1}},Qh={OFF:"Off",ONE:"One",TWO:"Two"},_f=["NIMBLE","FIREARM","THROWN","BRUTAL","BLUDGEONING","SLASHING","DISARMING","RANGE","SPECIAL","MISFIRE","LARGE","SLOW","LIGHT","LONG","AMMUNITION","PIERCING","RELOAD","VERSATILE"],Af={ANCESTRY:"Ancestry",NOVICE:"Novice",EXPERT:"Expert",MASTER:"Master"},tf={name:"Alaric, o Errante",level:3,ancestry:"Humano",paths:{novice:"Mago",expert:"Alquimista",master:"-"},attributes:[{name:"Fora",value:10,key:"str"},{name:"Agilidade",value:12,key:"agi"},{name:"Intelecto",value:15,key:"int"},{name:"Vontade",value:11,key:"wil"}],currency:{gp:0,sp:0,cp:0},naturalDefense:10,bonusDamage:0,speed:10,currentRound:1,languages:["Comum","lfico"],afflictions:[],effects:[],notes:"",campaignId:null,campaignName:null,gmName:null,combatActive:!1,initiative:!1,acted:!1,spells:[{id:1,name:"Seta de Energia",tier:"Novice",type:"Ataque",tradition:"Destruction",description:"Causa 1d6 de dano a um alvo em alcance curto.",castings:3,maxCastings:3,effect:null},{id:2,name:"Escudo Mgico",tier:"Novice",type:"Utilidade",tradition:"Protection",description:"+2 em Defesa por 1 minuto.",castings:2,maxCastings:2,effect:{id:999,name:"Escudo Mgico",duration:"MINUTES",roundsLeft:10,initialRounds:10,description:"+2 Defesa",isActive:!0,modifiers:[{target:"defense",type:fe.ADD,value:2}]}}],talents:[{id:1,name:"Sentido Arcano",description:"Voc detecta magia a curto alcance.",uses:0,maxUses:0,isPassive:!0,effect:null},{id:2,name:"Sorte do Principiante",description:"Pode refazer um teste falho.",uses:1,maxUses:1,isPassive:!1,effect:null}],equipment:[{id:1,name:"Cajado",type:_t.WEAPON,quantity:1,price:5,availability:"Common",quality:"Standard",grip:Qh.TWO,range:"Melee",damageDice:1,boonsBanes:0,traits:"Finesse, Versatile",equippedState:null,equipped:!1},{id:2,name:"Poo de Cura",type:_t.CONSUMABLE,quantity:3,price:10,availability:"Common",quality:"Standard",notes:"Recupera Healing Rate",equippedState:null,equipped:!1},{id:3,name:"Granada Alqumica",type:_t.EXPLOSIVE,quantity:2,price:15,availability:"Uncommon",quality:"Standard",damageDice:2,range:"Short",traits:"Blast",description:"Explode em rea curta causando 2d6 de dano.",equippedState:null,equipped:!1},{id:4,name:"Couro Batido",type:_t.ARMOR,quantity:1,price:20,availability:"Common",quality:"Standard",defenseType:"fixed",defenseFixed:12,armorWeight:"Light",equipped:!1,equippedState:null}]},D=Vt(tf),Wr=Vt([]),Vn=Vt({type:null,isOpen:!1,data:null}),xf=Vt("acoes"),Vs=Vt(24),Ye=Vt(24),we=Vt(0),Di=Vt(!1),Tn=Bt(D,e=>{const t=e.effects.filter(r=>r.isActive),n=e.talents.filter(r=>(r.isPassive||r.activityType==="Passive")&&r.effect).map(r=>({...r.effect,id:`talent-effect-${r.id}`,name:r.name,sourceType:"talent",sourceId:r.id}));return[...t,...n]});function Dr(e,t,n){let r=t||0;const s=n.flatMap(h=>Array.isArray(h.modifiers)?h.modifiers:[]),i=s.filter(h=>h.target===e&&h.type===fe.SET);return i.length>0&&(r=i[i.length-1].value),s.filter(h=>h.target===e&&h.type===fe.ADD).forEach(h=>{r+=h.value}),s.filter(h=>h.target===e&&h.type===fe.MULT).forEach(h=>{r*=h.value}),Math.floor(r)}const uc=Bt([D,Tn],([e,t])=>{const n={};return e.attributes.forEach(r=>{n[r.key]=Dr(r.key,r.value,t)}),n}),ef=Bt([Ye,Tn],([e,t])=>Dr("health",e,t)),Cf=Bt([ef,Vs],([e,t])=>Math.max(0,e-t)),If=Bt([we,Ye],([e,t])=>t>0?Math.min(100,e/t*100):100),nf=Bt([we,Ye],([e,t])=>e>=t),Df=Bt([we,Ye,nf],([e,t,n])=>e>=t/2&&!n),Tf=Bt([D,uc,Tn],([e,t,n])=>{let r=Dr("speed",e.speed,n);const s=e.afflictions;return s.includes("Held")||s.includes("Stunned")||s.includes("Unconscious")||s.includes("Incapacitated")?0:((s.includes("Blinded")||s.includes("Weakened"))&&(r=Math.floor(r/2)),s.includes("Slowed")&&(r=Math.min(r,2)),Math.max(0,r))}),Rf=Bt([D,Tn],([e,t])=>{let n=e.naturalDefense,r=0;const s=e.equipment.find(i=>i.type===_t.ARMOR&&i.equipped);if(s){const i=s.defenseFixed||0,l=e.naturalDefense+(s.defenseMod||0);s.defenseFixed&&s.defenseMod?n=Math.max(i,l):s.defenseFixed?n=i:s.defenseMod&&(n=e.naturalDefense+s.defenseMod)}return e.equipment.filter(i=>i.type===_t.SHIELD&&i.equippedState).forEach(i=>{r+=i.defenseMod||0}),Dr("defense",n+r,t)});Bt([D,Tn],([e,t])=>{const r=t.flatMap(s=>Array.isArray(s.modifiers)?s.modifiers:[]).filter(s=>s.target==="damage"&&s.type===fe.ADD).reduce((s,i)=>s+i.value,0);return(e.bonusDamage||0)+r});const Dt={updateCurrency:(e,t)=>{D.update(n=>{let r=n.currency.gp*100+n.currency.sp*10+n.currency.cp,s=0;return e==="gp"&&(s=t*100),e==="sp"&&(s=t*10),e==="cp"&&(s=t),r+=s,r<0&&(r=0),{...n,currency:{gp:Math.floor(r/100),sp:Math.floor(r%100/10),cp:r%100%10}}})},advanceRound:e=>{D.update(t=>{const n=t.currentRound||1;if(e==="next"){const r=(t.effects||[]).map(s=>{if(s.isActive&&s.duration==="ROUNDS"&&s.roundsLeft>0){const i=s.roundsLeft-1;return i<=0?{...s,roundsLeft:0,isActive:!1}:{...s,roundsLeft:i}}return s});return{...t,currentRound:n+1,effects:r}}else return{...t,currentRound:Math.max(1,n-1)}})},addToHistory:(e,t=!0)=>{const n=Qt(D),r=Qt(Wr);if(e.id&&r.find(i=>i.id===e.id))return;const s={id:e.id||mi(),timestamp:e.timestamp||new Date,charName:n.name,...e};Wr.update(i=>[s,...i]),Di.set(!0),t&&n.campaignId&&qs(async()=>{const{syncRoll:i}=await Promise.resolve().then(()=>Ri);return{syncRoll:i}},void 0,import.meta.url).then(({syncRoll:i})=>{i(s)})},clearHistory:()=>Wr.set([]),addItem:e=>D.update(t=>({...t,equipment:[...t.equipment,e]})),updateItem:e=>D.update(t=>({...t,equipment:t.equipment.map(n=>n.id===e.id?e:n)})),deleteItem:e=>D.update(t=>({...t,equipment:t.equipment.filter(n=>n.id!==e)})),useConsumable:e=>{e.quantity>0&&(Dt.updateItem({...e,quantity:e.quantity-1}),Dt.addToHistory({source:"Consumvel",name:e.name,description:`Usou ${e.name} `}))},equipItem:(e,t=null)=>{D.update(n=>{let r=[...n.equipment];return e.type===_t.ARMOR?r=r.map(s=>s.id===e.id?{...s,equipped:!s.equipped}:s.type===_t.ARMOR&&e.type===_t.ARMOR&&!e.equipped?{...s,equipped:!1}:s):(e.type===_t.WEAPON||e.type===_t.SHIELD)&&(r=r.map(s=>s.id===e.id?{...s,equippedState:t}:s)),{...n,equipment:r}})},toggleAffliction:e=>{D.update(t=>t.afflictions.includes(e)?{...t,afflictions:t.afflictions.filter(n=>n!==e)}:{...t,afflictions:[...t.afflictions,e]})},addLanguage:e=>D.update(t=>({...t,languages:[...t.languages,e]})),removeLanguage:e=>D.update(t=>({...t,languages:t.languages.filter((n,r)=>r!==e)})),confirmRest:()=>{D.update(t=>{const n=t.spells.map(s=>({...s,castings:s.maxCastings})),r=t.talents.map(s=>({...s,uses:s.maxUses}));return{...t,spells:n,talents:r}}),we.set(0);const e=Qt(Vs);Ye.set(e),Vn.set({type:null,isOpen:!1,data:null})},finalizeRoll:(e,t,n=[])=>{const r=Qt(D),s=Qt(uc),i=e.type==="weapon_attack",l=e.type==="luck",f=e.type==="weapon_damage",h=e.source,g=h.name||"Ao",u=(p,w)=>p.traits&&p.traits.toLowerCase().includes(w.toLowerCase());if(f){let p=parseInt(h.damageDice)||0;const w=h.grip&&h.grip.toLowerCase()==="two"||h.equippedState&&h.equippedState.toLowerCase()==="two";u(h,"Versatile")&&w&&(p+=1);let b=r.bonusDamage||0;u(h,"Light")&&b>1&&(b-=1);const k=n.flatMap(T=>Array.isArray(T.modifiers)?T.modifiers:[]).filter(T=>T.target==="damage"&&T.type===fe.ADD).reduce((T,K)=>T+K.value,0),_=b+k,F=Math.max(0,p+_+t);let lt=[],Y=0,C=[];for(let T=0;T<F;T++){let K=Math.floor(Math.random()*6)+1;if(K===1&&u(h,"Brutal")){const dt=Math.floor(Math.random()*6)+1;C.push(`1->${dt}`),K=dt}else C.push(`${K}`);lt.push(K),Y+=K}we.set(Y),Dt.addToHistory({source:"Dano",name:h.name,description:`Dano: ${F}d6 ${u(h,"Brutal")?"(Brutal)":""}`,formula:`${F}d6 [${lt.join(", ")}] ${C.some(T=>T.includes("->"))?`(Rolagens: ${C.join(", ")})`:""}`,total:Y,effectsApplied:n.map(T=>T.name)}),h.type===_t.EXPLOSIVE&&Dt.useConsumable(h)}else{const p=Math.floor(Math.random()*20)+1;let w=0,b="Sorte";if(e.type==="attribute")w=(s[e.source.key]||e.source.value)-10,b=e.source.name;else if(i){let C="str",T="Fora";h.range==="Ranged"&&(C="agi",T="Agilidade",u(h,"Thrown")&&(C="str",T="Fora")),u(h,"Nimble")&&(C="agi",T="Agilidade"),w=(s[C]||10)-10,b=T}const k=n.flatMap(C=>Array.isArray(C.modifiers)?C.modifiers:[]).filter(C=>C.target==="boons"&&C.type===fe.ADD).reduce((C,T)=>C+T.value,0);t+=k;let _=0,F="";if(t!==0){const C=Math.abs(t);let T=[];for(let dt=0;dt<C;dt++)T.push(Math.floor(Math.random()*6)+1);const K=Math.max(...T);t>0?(_=K,F=` + ${K} [Boon]`):(_=-K,F=` - ${K} [Bane]`)}const lt=p+w+_;let Y=i?`Ataque (${b})`:l?"Teste de Sorte":`Teste de ${g}`;if(t!==0&&(Y+=` com ${t} boons/banes`),i&&p===20){let C=[];u(h,"Bludgeoning")&&C.push("Vuln"),u(h,"Piercing")&&C.push("Weakened"),u(h,"Slashing")&&C.push("+1d6 Dmg"),C.length>0&&(Y+=`
CRTICO! ${C.join(" ")} `)}Dt.addToHistory({source:i?"Ataque":l?"Sorte":"Atributo",name:g,description:Y,formula:`d20(${p})${w!==0?(w>=0?"+":"")+w:""}${F} `,total:lt,crit:p===20,effectsApplied:n.map(C=>C.name)}),D.update(C=>({...C,effects:C.effects.map(T=>T.isActive&&T.duration==="NEXT_ROLL"?{...T,isActive:!1}:T)})),i&&u(h,"Reload")&&D.update(C=>({...C,equipment:C.equipment.map(T=>T.id===h.id?{...T,isLoaded:!1}:T)}))}Vn.set({type:null,isOpen:!1,data:null}),Di.set(!0)},reloadWeapon:e=>{D.update(t=>({...t,equipment:t.equipment.map(n=>n.id===e.id?{...n,isLoaded:!0}:n)})),Dt.addToHistory({source:"Ao",name:"Recarregar",description:`Recarregou ${e.name}`})},addSpell:e=>D.update(t=>({...t,spells:[...t.spells,e]})),updateSpell:e=>D.update(t=>({...t,spells:t.spells.map(n=>n.id===e.id?e:n)})),deleteSpell:e=>D.update(t=>({...t,spells:t.spells.filter(n=>n.id!==e)})),commitSpellCast:e=>{e.castings>0&&(D.update(t=>({...t,spells:t.spells.map(n=>n.id===e.id?{...n,castings:n.castings-1}:n)})),Dt.addToHistory({source:"Magia",name:e.name,description:e.description}),Vn.set({type:null,isOpen:!1,data:null}))},addTalent:e=>D.update(t=>({...t,talents:[...t.talents,e]})),updateTalent:e=>D.update(t=>({...t,talents:t.talents.map(n=>n.id===e.id?e:n)})),deleteTalent:e=>D.update(t=>({...t,talents:t.talents.filter(n=>n.id!==e)})),commitTalentUse:e=>{e.activityType==="Duration"&&e.duration==="LUCK_ENDS"?D.update(t=>({...t,talents:t.talents.map(n=>n.id===e.id?{...n,uses:0}:n)})):e.maxUses&&D.update(t=>({...t,talents:t.talents.map(n=>n.id===e.id?{...n,uses:n.uses-1}:n)})),Dt.addToHistory({source:"Talento",name:e.name,description:e.description}),Vn.set({type:null,isOpen:!1,data:null})},recoverTalent:e=>{D.update(t=>({...t,talents:t.talents.map(n=>n.id===e&&n.uses<n.maxUses?{...n,uses:n.uses+1}:n)}))},rollLuckTalent:e=>{const t=Math.floor(Math.random()*20)+1,n=t>=10,s=Qt(D).talents.find(i=>i.id===e);Dt.addToHistory({source:"Sorte",name:`Teste de Sorte - ${s?.name||"Talento"}`,formula:`d20(${t})`,total:t,description:`Rolou ${t}. ${n?"Sucesso! Talento recuperado.":"Falha. O talento continua indisponvel."}`}),n&&D.update(i=>({...i,talents:i.talents.map(l=>l.id===e?{...l,uses:1}:l)}))},addEffect:e=>D.update(t=>({...t,effects:[...t.effects,e]})),updateEffect:e=>D.update(t=>({...t,effects:t.effects.map(n=>n.id===e.id?e:n)})),deleteEffect:e=>D.update(t=>({...t,effects:t.effects.filter(n=>n.id!==e)})),toggleEffect:e=>D.update(t=>({...t,effects:t.effects.map(n=>{if(n.id===e){const r=!n.isActive;return{...n,isActive:r,roundsLeft:r&&n.duration==="ROUNDS"&&n.initialRounds||n.roundsLeft}}return n})})),cleanInactiveEffects:()=>D.update(e=>({...e,effects:e.effects.filter(t=>t.isActive)})),applyEffectToCharacter:(e,t)=>{const n=e.name||(t?t.name:"Efeito sem nome"),r=e.description||(t?t.description:""),s={...e,id:mi(),isActive:!0,name:n,description:r};s.duration==="ROUNDS"&&!s.initialRounds&&(s.initialRounds=s.roundsLeft),D.update(i=>({...i,effects:[...i.effects,s]}))},checkLuckEnds:e=>{const t=Math.floor(Math.random()*20)+1,n=t>=10;Dt.addToHistory({source:"Sorte",name:"Check Fim Efeito",description:`Rolou ${t}. ${n?"Sucesso (Encerra)":"Falha"} `}),n&&D.update(r=>({...r,effects:r.effects.map(s=>s.id===e?{...s,isActive:!1}:s)}))},joinCampaign:e=>{D.update(t=>({...t,campaignId:e.id,campaignName:e.name,gmName:e.gmName||"Mestre"})),qs(async()=>{const{joinCampaignRoom:t}=await Promise.resolve().then(()=>Ri);return{joinCampaignRoom:t}},void 0,import.meta.url).then(({joinCampaignRoom:t})=>{t(e.id,!1)})},leaveCampaign:()=>{D.update(e=>({...e,campaignId:null,campaignName:null,gmName:null,combatActive:!1}))}};we.subscribe(e=>{});const hc={appId:tc,trackerUrls:["wss://tracker.openwebtorrent.com","wss://tracker.files.fm:7073/announce","wss://tracker.webtorrent.dev","wss://toad.vibe.community:443/announce","wss://tracker.btorrent.xyz"]},Gt=Vt({roomId:null,peers:[],currentCharacterId:null,lastGmUpdate:0,isGM:!1,isConnected:!1}),rf=Bt(Gt,e=>e.lastGmUpdate?Date.now()-e.lastGmUpdate<6e4:!1);let gt=null,zr=null,as=null,us=null,hs=null,fs=null;const sf={appId:"weird-wizard-vault-lobby"},ds=Vt([]);function fc(){if(zr)return;zr=ac(sf,"public-discovery");const[e,t]=zr.makeAction("discovery");return t(n=>{ds.update(r=>{const s=r.findIndex(i=>i.id===n.id);if(s!==-1){const i=[...r];return i[s]={...n,lastSeen:Date.now()},i}return[...r,{...n,lastSeen:Date.now()}]})}),setInterval(()=>{const n=Date.now();ds.update(r=>r.filter(s=>n-s.lastSeen<12e4))},6e4),e}let dc,Ti=!1;function of(){typeof window<"u"&&!Ti&&(Ti=!0,dc=fc())}typeof window<"u"&&of();let Qn=null;function cf(e,t=!1,n=null){if(Qn===`campaign-${e}`){Gt.update(p=>({...p,isGM:t,currentCharacterId:n}));return}gt&&(gt.leave(),gt=null),Qn=`campaign-${e}`,gt=ac(hc,Qn),Gt.set({isConnected:!0,isGM:t,currentCharacterId:n,peers:[],roomId:e,lastGmUpdate:0});const[r,s]=gt.makeAction("combat"),[i,l]=gt.makeAction("history"),[f,h]=gt.makeAction("charUpdate"),[g,u]=gt.makeAction("campaign");return as=r,us=i,hs=f,fs=g,s(p=>{t||D.update(w=>({...w,currentRound:p.round,combatActive:p.active}))}),u(p=>{Gt.update(w=>({...w,lastGmUpdate:Date.now()})),t||D.update(w=>({...w,campaignName:p.name,gmName:p.gmName,passwordHash:p.passwordHash}))}),t&&setInterval(()=>{const p=nn.get(e);p&&p.isPublished&&dc({id:e,name:p.name,gmName:p.gmName||"Mestre",description:p.description})},3e4),l(p=>{Dt.addToHistory(p,!1)}),h(p=>{if(t){const w=nn.get(e);if(w){const b=w.members||[],k=b.findIndex(C=>C.id===p.id);let _;if(k!==-1){_=[...b];const C=_[k],T={...p};C.campaignApproval==="approved"&&p.campaignApproval==="pending"&&delete T.campaignApproval,_[k]={...C,...T,lastUpdate:Date.now()}}else _=[...b,{...p,lastUpdate:Date.now()}];const F=w.activeEnemies||[],lt=F.findIndex(C=>C.id===p.id&&C.type==="player");let Y=F;lt!==-1&&(Y=[...F],Y[lt]={...Y[lt],...p}),nn.set(e,{...w,members:_,activeEnemies:Y})}}else{const w=Qt(Gt),b=Qt(D),k=w.currentCharacterId||b?.id;if(k&&k===p.id){if(p.campaignApproval==="rejected"||p.campaignId===null){D.update(_=>({..._,campaignId:null,campaignName:null,gmName:null,campaignApproval:null}));return}D.update(_=>({..._,name:p.name||_.name,afflictions:p.afflictions||_.afflictions,initiative:p.initiative!==void 0?p.initiative:_.initiative??!1,acted:p.acted!==void 0?p.acted:_.acted??!1,campaignApproval:p.campaignApproval||_.campaignApproval,imageUrl:p.imageUrl||_.imageUrl})),p.damage!==void 0&&we.set(p.damage),p.currentHealth!==void 0&&Ye.set(p.currentHealth),p.normalHealth!==void 0&&Vs.set(p.normalHealth)}}}),gt.onPeerJoin(p=>{if(Gt.update(w=>({...w,peers:[...w.peers,p]})),t){const w=nn.get(e);w&&(w.combat&&r(w.combat),g({name:w.name,gmName:w.gmName||"Mestre",passwordHash:w.passwordHash}))}}),gt.onPeerLeave(p=>{Gt.update(w=>({...w,peers:w.peers.filter(b=>b!==p)}))}),gt}function lf(e,t){as&&as(t)}function af(e,t){fs&&fs({name:t.name,gmName:t.gmName||"Mestre",passwordHash:t.passwordHash})}function uf(e){us&&us(e)}function hf(e){hs&&hs(e)}function ff(){gt&&(gt.leave(),gt=null),Qn=null,Gt.set({isConnected:!1,isGM:!1,currentCharacterId:null,peers:[],roomId:null,lastGmUpdate:0})}const Ri=Object.freeze(Object.defineProperty({__proto__:null,isGmOnline:rf,joinCampaignRoom:cf,joinLobby:fc,leaveCampaignRoom:ff,publicCampaigns:ds,roomConfig:hc,syncCampaign:af,syncCharacter:hf,syncCombat:lf,syncRoll:uf,syncState:Gt},Symbol.toStringTag,{value:"Module"}));export{Sf as A,If as B,Cf as C,Vn as D,Ef as E,kf as F,Qh as G,fe as H,_t as I,Vs as J,Ye as K,Tn as L,bf as M,uc as N,Rf as O,Tf as P,xf as Q,tf as R,yf as S,Af as T,_f as W,cf as a,mf as b,D as c,dh as d,nn as e,ph as f,gh as g,mh as h,rf as i,ac as j,Dt as k,Wr as l,hf as m,af as n,ff as o,ds as p,Di as q,hc as r,Te as s,lf as t,mi as u,nf as v,wh as w,Df as x,we as y,ef as z};
