import"./DsnmJJEf.js";import"./Dcsmm6So.js";import{o as gt,u as pt,v as K,w as V,k as x,x as Pe,R as U,a2 as Ae,L as Le,F as M,z as Se,j as R,B as p,A as _,G as qe,I as v,ad as tt,y as s,t as H,n as Ge,T as bt,b7 as mt}from"./Dw_raXzk.js";import{I as re,s as ae}from"./DjRg1Dji.js";import{l as ne,s as oe,p as D,i as q}from"./C7jdvfZ7.js";import{d as Oe,f as rt,s as F,j as at,e as Be,o as xt,r as _t}from"./Dy4L3Tb7.js";import{s as ve,e as Re,i as nt,$ as ot,j as yt,a as Ee,g as Ue,r as wt}from"./DHvfXG5j.js";import{s as it,a as He}from"./CLDCoJG6.js";import{M as $t,P as At,X as st,T as Mt}from"./DsV61ll_.js";import{v as Me,q as Et,z as It,b as Nt}from"./B9XLtlDm.js";import{t as Ct,s as Lt}from"./CdKeR9oO.js";import{b as Te}from"./Bb9Zu10p.js";import{C as Pt}from"./BNOZTq-o.js";function St(h,o,l){gt(()=>{var d=pt(()=>o(h,l?.())||{});if(d?.destroy)return()=>d.destroy()})}function Br(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 18V5"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"}]];re(h,oe({name:"brain"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Rr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]];re(h,oe({name:"camera"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Tr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"m15 18-6-6 6-6"}]];re(h,oe({name:"chevron-left"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Or(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];re(h,oe({name:"clock"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Bt(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"}],["path",{d:"M6 18h.01"}],["path",{d:"M10 14h.01"}],["path",{d:"M15 6h.01"}],["path",{d:"M18 9h.01"}]];re(h,oe({name:"dices"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Dr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];re(h,oe({name:"eye"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function jr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M9 10h.01"}],["path",{d:"M15 10h.01"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"}]];re(h,oe({name:"ghost"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Ve(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}],["path",{d:"M12 7v5l4 2"}]];re(h,oe({name:"history"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function zr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1"}]];re(h,oe({name:"layout-dashboard"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Rt(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M5 12h14"}]];re(h,oe({name:"minus"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Fr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];re(h,oe({name:"rotate-ccw"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Gr(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"m11 19-6-6"}],["path",{d:"m5 21-2-2"}],["path",{d:"m8 16-4 4"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5"}]];re(h,oe({name:"sword"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}function Tt(h,o){const l=ne(o,["children","$$slots","$$events","$$legacy"]);const d=[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]];re(h,oe({name:"zoom-in"},()=>l,{get iconNode(){return d},children:(u,m)=>{var c=K(),g=V(c);ae(g,o,"default",{}),x(u,c)},$$slots:{default:!0}}))}const Ur={Blinded:{effect:"Make rolls with 3 banes. No sight reactions. Speed halved.",speedMult:.5,rollMod:-3},Confused:{effect:"No reactions. Intellect and Will rolls with 1 bane.",rollMod:-1,attributes:["int","wil"]},Controlled:{effect:"Controller decides your turn. Regard source as ally."},Cursed:{effect:"Luck rolls with 1 bane."},Deafened:{effect:"No hearing reactions. Immune to hearing effects."},Frightened:{effect:"Attribute rolls with 1 bane (while in LOS). Grant 1 boon on rolls against you.",rollMod:-1},Held:{effect:"Speed 0. Cannot increase Speed. Auto-fail Agility defense rolls.",speedFixed:0},Impaired:{effect:"Roll with 1 bane for specified attribute. Grant 1 boon against that attribute.",rollMod:-1},Incapacitated:{effect:"Damage equals or exceeds Health. You cannot use actions or reactions. Speed 0.",speedFixed:0},"On Fire":{effect:"Take 1d6 damage at end of round. Action/Luck roll to extinguish."},Poisoned:{effect:"Attribute rolls with 1 bane. Grant 1 boon against you. Lose 1d6 Health end of round.",rollMod:-1},Prone:{effect:"No reactions. Grant 1 boon to melee vs you, impose 1 bane to ranged vs you."},Slowed:{effect:"Speed drops to 2 (if higher). Cannot benefit from Speed increases.",speedCap:2},Stunned:{effect:"No actions/reactions. Speed 0. Grant 2 boons against you. Attribute rolls with 2 banes.",speedFixed:0,rollMod:-2},Unconscious:{effect:"No actions/reactions. Speed 0. Grant 3 boons against you. Auto-fail attribute rolls.",speedFixed:0,autoFail:!0},Vulnerable:{effect:"Grant 1 boon on attacks/rolls against you."},Weakened:{effect:"Strength/Agility rolls with 1 bane. Grant 1 boon vs Str/Agi. Speed halved.",speedMult:.5,attributes:["str","agi"],rollMod:-1}},Hr={OFF:"Off",ONE:"One",TWO:"Two"},Wr=["NIMBLE","FIREARM","THROWN","BRUTAL","BLUDGEONING","SLASHING","DISARMING","RANGE","SPECIAL","MISFIRE","LARGE","SLOW","LIGHT","LONG","AMMUNITION","PIERCING","RELOAD","VERSATILE"],kr={ANCESTRY:"Ancestry",NOVICE:"Novice",EXPERT:"Expert",MASTER:"Master"};var Ot=R('<div class="w-2 h-2 bg-white rounded-sm"></div>'),Dt=R('<span class="text-[9px] text-slate-400 bg-slate-800 px-1 rounded"> </span>'),jt=R('<div class="flex flex-wrap gap-1 mt-1"></div>'),zt=R('<button><div class="flex items-center gap-3"><div><!></div> <div><span class="text-sm font-bold text-slate-200 block leading-tight"> </span> <!></div></div></button>'),Ft=R('<div class="space-y-2"><h4 class="text-xs font-bold text-slate-500 uppercase px-1"> </h4> <div class="grid grid-cols-1 gap-2 max-h-[150px] overflow-y-auto pr-1 custom-scrollbar"></div></div>'),Gt=R('<div class="space-y-6"><div class="bg-slate-900/50 p-6 rounded-2xl border border-white/5 text-center shadow-inner relative overflow-hidden group"><div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div> <div class="flex justify-center items-center gap-8 mb-4 relative z-10"><button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-red-500/20 text-slate-300 hover:text-red-400 border border-slate-700 hover:border-red-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg" aria-label="Diminuir"><!></button> <div class="flex flex-col items-center min-w-[100px]"><span> </span></div> <button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-green-500/20 text-slate-300 hover:text-green-400 border border-slate-700 hover:border-green-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg" aria-label="Aumentar"><!></button></div> <div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] relative z-10"> </div></div> <!> <!> <button class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-black py-4 rounded-xl flex items-center justify-center gap-3 shadow-lg shadow-indigo-600/20 transition-all active:scale-[0.98] uppercase tracking-widest text-sm"><!> </button></div>');function Zr(h,o){Pe(o,!0);const l=()=>He(ot,"$t",d),[d,u]=it();let m=D(o,"initialModifier",3,0),c=D(o,"label",3,"Boons / Banes"),g=D(o,"rollLabel",3,"ROLAR"),I=D(o,"effects",19,()=>[]),B=U(0),E=U(Ae([]));Le(()=>{o.isOpen?(M(B,m()),M(E,I().map(P=>P.id),!0)):M(E,[],!0)});function N(P){s(E).includes(P)?M(E,s(E).filter(b=>b!==P),!0):M(E,[...s(E),P],!0)}var y=K(),T=V(y);{var O=P=>{$t(P,{get isOpen(){return o.isOpen},get onClose(){return o.onClose},get title(){return o.title},children:(b,i)=>{var n=Gt(),t=p(n),e=_(p(t),2),a=p(e);a.__click=()=>qe(B,-1);var r=p(a);Rt(r,{size:24}),v(a);var C=_(a,2),j=p(C),k=p(j);v(j),v(C);var X=_(C,2);X.__click=()=>qe(B);var ce=p(X);At(ce,{size:24}),v(X),v(e);var J=_(e,2),ge=p(J,!0);v(J),v(t);var L=_(t,2);{var w=Y=>{var ee=Ft(),ue=p(ee),Ie=p(ue,!0);v(ue);var _e=_(ue,2);Re(_e,21,I,pe=>pe.id,(pe,te)=>{var he=zt();he.__click=()=>N(s(te).id);var fe=p(he),be=p(fe),ie=p(be);{var le=W=>{var A=Ot();x(W,A)};q(ie,W=>{s(E).includes(s(te).id)&&W(le)})}v(be);var $e=_(be,2),ye=p($e),f=p(ye,!0);v(ye);var S=_(ye,2);{var z=W=>{var A=jt();Re(A,21,()=>s(te).modifiers,nt,(G,de)=>{var we=Dt(),me=p(we);v(we),H(()=>F(me,`${s(de).target??""}: ${s(de).value??""}`)),x(G,we)}),v(A),x(W,A)};q(S,W=>{s(te).modifiers&&s(te).modifiers.length>0&&W(z)})}v($e),v(fe),v(he),H((W,A)=>{ve(he,1,`flex items-center justify-between p-3 rounded-lg border transition-all text-left ${W??""}`),ve(be,1,`w-4 h-4 rounded border flex items-center justify-center transition-colors ${A??""}`),F(f,s(te).name)},[()=>s(E).includes(s(te).id)?"bg-indigo-900/30 border-indigo-500/50 shadow-sm":"bg-slate-900/50 border-slate-800 opacity-60 hover:opacity-100 hover:border-slate-700",()=>s(E).includes(s(te).id)?"bg-indigo-500 border-indigo-400":"border-slate-600 bg-slate-900"]),x(pe,he)}),v(_e),v(ee),H(pe=>F(Ie,pe),[()=>l()("character.effects.active")]),x(Y,ee)};q(L,Y=>{I().length>0&&Y(w)})}var $=_(L,2);rt($,()=>o.children??tt);var Z=_($,2);Z.__click=()=>{const Y=I().filter(ee=>s(E).includes(ee.id));o.onRoll(s(B),Y)};var Q=p(Z);Bt(Q,{size:18});var se=_(Q);v(Z),v(n),H(()=>{ve(j,1,`text-5xl font-black ${s(B)>0?"text-green-400":s(B)<0?"text-red-400":"text-slate-500"} tabular-nums drop-shadow-sm transition-colors duration-300`),F(k,`${s(B)>0?"+":""}${s(B)??""}`),F(ge,c()),F(se,` ${g()??""}`)}),x(b,n)},$$slots:{default:!0}})};q(T,P=>{o.isOpen&&P(O)})}x(h,y),Se(),u()}Oe(["click"]);var ze={exports:{}},Xe;function Ut(){return Xe||(Xe=1,(function(h,o){(function(l){h.exports=l()})(function(l){var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function u(i,n){var t=i[0],e=i[1],a=i[2],r=i[3];t+=(e&a|~e&r)+n[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[1]-389564586|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[2]+606105819|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[3]-1044525330|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+n[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[6]-1473231341|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[7]-45705983|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+n[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[10]-42063|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[11]-1990404162|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+n[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[13]-40341101|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[14]-1502002290|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[15]+1236535329|0,e=(e<<22|e>>>10)+a|0,t+=(e&r|a&~r)+n[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[11]+643717713|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[0]-373897302|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+n[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[10]+38016083|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[15]-660478335|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[4]-405537848|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+n[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[3]-187363961|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[8]+1163531501|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+n[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[2]-51403784|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[7]+1735328473|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[12]-1926607734|0,e=(e<<20|e>>>12)+a|0,t+=(e^a^r)+n[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[11]+1839030562|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[14]-35309556|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+n[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[7]-155497632|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[10]-1094730640|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+n[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[0]-358537222|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[3]-722521979|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[6]+76029189|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+n[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[12]-421815835|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[15]+530742520|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[2]-995338651|0,e=(e<<23|e>>>9)+a|0,t+=(a^(e|~r))+n[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[14]-1416354905|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[5]-57434055|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+n[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[10]-1051523|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[1]-2054922799|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+n[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[15]-30611744|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[6]-1560198380|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[13]+1309151649|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+n[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[2]+718787259|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[9]-343485551|0,e=(e<<21|e>>>11)+a|0,i[0]=t+i[0]|0,i[1]=e+i[1]|0,i[2]=a+i[2]|0,i[3]=r+i[3]|0}function m(i){var n=[],t;for(t=0;t<64;t+=4)n[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return n}function c(i){var n=[],t;for(t=0;t<64;t+=4)n[t>>2]=i[t]+(i[t+1]<<8)+(i[t+2]<<16)+(i[t+3]<<24);return n}function g(i){var n=i.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,C,j,k;for(e=64;e<=n;e+=64)u(t,m(i.substring(e-64,e)));for(i=i.substring(e-64),a=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return C=n*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),j=parseInt(C[2],16),k=parseInt(C[1],16)||0,r[14]=j,r[15]=k,u(t,r),t}function I(i){var n=i.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,C,j,k;for(e=64;e<=n;e+=64)u(t,c(i.subarray(e-64,e)));for(i=e-64<n?i.subarray(e-64):new Uint8Array(0),a=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=i[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return C=n*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),j=parseInt(C[2],16),k=parseInt(C[1],16)||0,r[14]=j,r[15]=k,u(t,r),t}function B(i){var n="",t;for(t=0;t<4;t+=1)n+=d[i>>t*8+4&15]+d[i>>t*8&15];return n}function E(i){var n;for(n=0;n<i.length;n+=1)i[n]=B(i[n]);return i.join("")}E(g("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function i(n,t){return n=n|0||0,n<0?Math.max(n+t,0):Math.min(n,t)}ArrayBuffer.prototype.slice=function(n,t){var e=this.byteLength,a=i(n,e),r=e,C,j,k,X;return t!==l&&(r=i(t,e)),a>r?new ArrayBuffer(0):(C=r-a,j=new ArrayBuffer(C),k=new Uint8Array(j),X=new Uint8Array(this,a,C),k.set(X),j)}})();function N(i){return/[\u0080-\uFFFF]/.test(i)&&(i=unescape(encodeURIComponent(i))),i}function y(i,n){var t=i.length,e=new ArrayBuffer(t),a=new Uint8Array(e),r;for(r=0;r<t;r+=1)a[r]=i.charCodeAt(r);return n?a:e}function T(i){return String.fromCharCode.apply(null,new Uint8Array(i))}function O(i,n,t){var e=new Uint8Array(i.byteLength+n.byteLength);return e.set(new Uint8Array(i)),e.set(new Uint8Array(n),i.byteLength),e}function P(i){var n=[],t=i.length,e;for(e=0;e<t-1;e+=2)n.push(parseInt(i.substr(e,2),16));return String.fromCharCode.apply(String,n)}function b(){this.reset()}return b.prototype.append=function(i){return this.appendBinary(N(i)),this},b.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var n=this._buff.length,t;for(t=64;t<=n;t+=64)u(this._hash,m(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},b.prototype.end=function(i){var n=this._buff,t=n.length,e,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)a[e>>2]|=n.charCodeAt(e)<<(e%4<<3);return this._finish(a,t),r=E(this._hash),i&&(r=P(r)),this.reset(),r},b.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},b.prototype.setState=function(i){return this._buff=i.buff,this._length=i.length,this._hash=i.hash,this},b.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},b.prototype._finish=function(i,n){var t=n,e,a,r;if(i[t>>2]|=128<<(t%4<<3),t>55)for(u(this._hash,i),t=0;t<16;t+=1)i[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(e[2],16),r=parseInt(e[1],16)||0,i[14]=a,i[15]=r,u(this._hash,i)},b.hash=function(i,n){return b.hashBinary(N(i),n)},b.hashBinary=function(i,n){var t=g(i),e=E(t);return n?P(e):e},b.ArrayBuffer=function(){this.reset()},b.ArrayBuffer.prototype.append=function(i){var n=O(this._buff.buffer,i),t=n.length,e;for(this._length+=i.byteLength,e=64;e<=t;e+=64)u(this._hash,c(n.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(n.buffer.slice(e-64)):new Uint8Array(0),this},b.ArrayBuffer.prototype.end=function(i){var n=this._buff,t=n.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a,r;for(a=0;a<t;a+=1)e[a>>2]|=n[a]<<(a%4<<3);return this._finish(e,t),r=E(this._hash),i&&(r=P(r)),this.reset(),r},b.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.ArrayBuffer.prototype.getState=function(){var i=b.prototype.getState.call(this);return i.buff=T(i.buff),i},b.ArrayBuffer.prototype.setState=function(i){return i.buff=y(i.buff,!0),b.prototype.setState.call(this,i)},b.ArrayBuffer.prototype.destroy=b.prototype.destroy,b.ArrayBuffer.prototype._finish=b.prototype._finish,b.ArrayBuffer.hash=function(i,n){var t=I(new Uint8Array(i)),e=E(t);return n?P(e):e},b})})(ze)),ze.exports}var Ht=Ut();const Wt=yt(Ht),Ye=5;async function qr(h){if(h.size>Ye*1024*1024)throw new Error(`Imagem muito grande. Máximo de ${Ye}MB.`);const o=await h.arrayBuffer(),l=Wt.ArrayBuffer.hash(o);if(Me.has(l))return l;const d=new FileReader,m=await new Promise((c,g)=>{d.onload=()=>c(d.result),d.onerror=g,d.readAsDataURL(h)});return Me.set(l,m),l}function kt(h,o){if(!h)return o(void 0),()=>{};o(Me.get(h));const l=d=>{const u=Me.get(h);o(u)};return Me.observe(l),()=>{Me.unobserve(l)}}var Zt=R('<img class="w-full h-full object-cover rounded-full border border-white/10 shadow-sm"/>'),qt=R('<div class="w-full h-full bg-slate-800 rounded-full border border-white/10 flex items-center justify-center font-black text-slate-500 shadow-sm"> </div>'),Vt=R("<div><!></div>");function Vr(h,o){Pe(o,!0);let l=D(o,"size",3,"md"),d=D(o,"fallbackText",3,"?"),u=U(void 0),m;Le(()=>{m&&m(),o.hash?m=kt(o.hash,N=>{M(u,N,!0)}):M(u,void 0)}),at(()=>{m&&m()});const c={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-16 h-16 text-lg",xl:"w-20 h-20 text-xl",custom:"w-full h-full"};var g=Vt(),I=p(g);{var B=N=>{var y=Zt();H(()=>{Ee(y,"src",s(u)),Ee(y,"alt",o.alt)}),x(N,y)},E=N=>{var y=qt(),T=p(y,!0);v(y),H(()=>F(T,d())),x(N,y)};q(I,N=>{s(u)?N(B):N(E,!1)})}v(g),H(()=>ve(g,1,`${c[l()]??""} relative flex-shrink-0`)),x(h,g),Se()}var Xt=R('<div class="absolute z-50 bottom-full left-1/2 mb-2 w-max max-w-[200px] p-2 bg-slate-800 border border-indigo-500 rounded-lg shadow-xl shadow-black/50 text-[10px] text-slate-300 leading-relaxed text-center pointer-events-none whitespace-normal -translate-x-1/2" style="margin-left: var(--x-offset);"> <div class="absolute -bottom-1 left-1/2 w-2 h-2 bg-slate-800 border-r border-b border-indigo-500 -translate-x-1/2" style="transform: translateX(calc(-50% - var(--x-offset))) rotate(45deg);"></div></div>'),Yt=R('<div role="button" tabindex="0"><!> <!></div>');function Xr(h,o){let l=D(o,"text",3,""),d=D(o,"class",3,""),u=U(!1),m=!1,c=U(0),g,I=U(void 0);function B(){if(!g||!s(I))return;const b=g.getBoundingClientRect(),n=s(I).getBoundingClientRect().width/2;M(c,0);const t=b.left+b.width/2-n;t<10&&M(c,10-t);const e=b.left+b.width/2+n;e>window.innerWidth-10&&M(c,window.innerWidth-10-e)}async function E(){m||(M(u,!0),setTimeout(B,0))}function N(b){m&&(s(u)?M(u,!1):(M(u,!0),setTimeout(B,0)))}var y=Yt();y.__touchstart=()=>m=!0,y.__click=N,y.__keydown=b=>{(b.key==="Enter"||b.key===" ")&&M(u,!s(u))};var T=p(y);rt(T,()=>o.children??tt);var O=_(T,2);{var P=b=>{var i=Xt(),n=p(i);Ge(),v(i),Te(i,t=>M(I,t),()=>s(I)),H(()=>F(n,`${l()??""} `)),Ct(3,i,()=>Lt,()=>({duration:150,start:.95})),x(b,i)};q(O,b=>{s(u)&&l()&&b(P)})}v(y),Te(y,b=>g=b,()=>g),H(()=>{ve(y,1,`relative inline-flex ${d()??""}`),Ue(y,`--x-offset: ${s(c)??""}px;`)}),Be("mouseenter",y,E),Be("mouseleave",y,()=>!m&&M(u,!1)),x(h,y)}Oe(["touchstart","click","keydown"]);var Kt=R('<div class="fixed inset-0 bg-black/50 z-[90] lg:hidden backdrop-blur-sm" role="button" tabindex="-1"></div>'),Jt=R('<div class="flex flex-col items-center justify-center h-full text-slate-600 opacity-50"><div class="w-16 h-16 border-2 border-dashed border-slate-800 rounded-full flex items-center justify-center mb-4"><!></div> <p class="text-sm font-bold uppercase tracking-widest italic"> </p></div>'),Qt=R('<span class="text-[10px] text-white/50 font-black uppercase tracking-tighter"> </span>'),er=R('<div class="text-[10px] text-slate-400 font-medium italic mt-1 leading-relaxed opacity-80 whitespace-pre-wrap"> </div>'),tr=R('<span class="text-[8px] font-black uppercase tracking-widest bg-indigo-500/10 text-indigo-300 px-2 py-0.5 rounded-full border border-indigo-500/20"> </span>'),rr=R('<div class="flex flex-wrap gap-1 mb-3"></div>'),ar=R('<div class="absolute inset-0 bg-yellow-400/5 animate-pulse"></div>'),nr=R('<span class="text-[10px] animate-bounce">✨</span>'),or=R('<div class="relative bg-black/40 rounded-xl p-3 flex justify-between items-center border border-white/5 group-hover:border-white/10 transition-colors overflow-hidden"><!> <div class="flex flex-col"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div class="text-xs font-mono text-indigo-300 font-bold"> </div></div> <div class="flex flex-col items-end"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div> <!></div></div></div>'),ir=R('<div class="relative bg-slate-800/40 hover:bg-slate-800/60 transition-colors rounded-2xl border border-white/5 p-4 shadow-xl overflow-hidden group animate-in slide-in-from-right-8 duration-300"><div></div> <div class="flex justify-between items-start mb-3"><div class="flex flex-col"><div class="flex items-center gap-2"><span> </span> <!></div></div> <span class="text-[9px] text-slate-500 font-black tracking-widest uppercase"> </span></div> <div class="flex items-center gap-3 mb-2"><div class="flex-1"><div class="font-black text-white text-sm uppercase tracking-tight leading-snug"> </div> <!></div></div> <!> <!></div>'),sr=R('<!> <aside><div class="px-6 py-5 border-b border-white/5 flex justify-between items-center bg-slate-950/50"><div class="flex items-center gap-3"><div class="p-2 bg-indigo-500/10 rounded-lg border border-indigo-500/20"><!></div> <div><h3 class="font-black text-white uppercase tracking-widest text-sm"> </h3> <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter"> </p></div></div> <button class="p-2 hover:bg-white/5 rounded-full text-slate-400 hover:text-white transition-all active:scale-90"><!></button></div> <div class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 custom-scrollbar"><!> <!></div> <div class="p-6 border-t border-white/5 bg-slate-950/80"><button class="w-full py-3 text-xs font-black uppercase tracking-[0.2em] text-red-400/70 hover:text-red-400 border border-red-900/30 rounded-xl hover:bg-red-900/20 transition-all flex items-center justify-center gap-3 active:scale-[0.98]"><!> </button></div></aside>',1);function Yr(h,o){Pe(o,!0);const l=()=>He(ot,"$t",u),d=()=>He(It,"$rollHistory",u),[u,m]=it();let c=D(o,"isOpen",3,!1);var g=sr(),I=V(g);{var B=L=>{var w=Kt();w.__click=function(...$){o.onClose?.apply(this,$)},H($=>Ee(w,"aria-label",$),[()=>l()("character.history.close")]),x(L,w)};q(I,L=>{c()&&L(B)})}var E=_(I,2),N=p(E),y=p(N),T=p(y),O=p(T);Ve(O,{size:20,class:"text-indigo-400"}),v(T);var P=_(T,2),b=p(P),i=p(b,!0);v(b);var n=_(b,2),t=p(n);v(n),v(P),v(y);var e=_(y,2);e.__click=function(...L){o.onClose?.apply(this,L)};var a=p(e);st(a,{size:24}),v(e),v(N);var r=_(N,2),C=p(r);{var j=L=>{var w=Jt(),$=p(w),Z=p($);Ve(Z,{size:32}),v($);var Q=_($,2),se=p(Q,!0);v(Q),v(w),H(Y=>F(se,Y),[()=>l()("character.history.none")]),x(L,w)};q(C,L=>{d().length===0&&L(j)})}var k=_(C,2);Re(k,1,d,L=>L.id,(L,w)=>{const $=bt(()=>s(w).source?.toLowerCase());var Z=ir(),Q=p(Z),se=_(Q,2),Y=p(se),ee=p(Y),ue=p(ee),Ie=p(ue,!0);v(ue);var _e=_(ue,2);{var pe=A=>{var G=Qt(),de=p(G,!0);v(G),H(()=>F(de,s(w).charName)),x(A,G)};q(_e,A=>{s(w).charName&&s(w).charName!==s(w).source&&A(pe)})}v(ee),v(Y);var te=_(Y,2),he=p(te,!0);v(te),v(se);var fe=_(se,2),be=p(fe),ie=p(be),le=p(ie,!0);v(ie);var $e=_(ie,2);{var ye=A=>{var G=er(),de=p(G,!0);v(G),H(()=>F(de,s(w).description)),x(A,G)};q($e,A=>{s(w).description&&A(ye)})}v(be),v(fe);var f=_(fe,2);{var S=A=>{var G=rr();Re(G,21,()=>s(w).effectsApplied,nt,(de,we)=>{var me=tr(),Ne=p(me,!0);v(me),H(()=>F(Ne,s(we))),x(de,me)}),v(G),x(A,G)};q(f,A=>{s(w).effectsApplied?.length>0&&A(S)})}var z=_(f,2);{var W=A=>{var G=or(),de=p(G);{var we=xe=>{var Ce=ar();x(xe,Ce)};q(de,xe=>{s(w).crit&&xe(we)})}var me=_(de,2),Ne=p(me),dt=p(Ne,!0);v(Ne);var We=_(Ne,2),ct=p(We,!0);v(We),v(me);var ke=_(me,2),De=p(ke),ut=p(De,!0);v(De);var je=_(De,2),Ze=p(je),ht=_(Ze);{var ft=xe=>{var Ce=nr();x(xe,Ce)};q(ht,xe=>{s(w).crit&&xe(ft)})}v(je),v(ke),v(G),H((xe,Ce,vt)=>{F(dt,xe),F(ct,Ce),F(ut,vt),ve(je,1,`text-3xl font-black font-mono leading-none flex items-baseline gap-1 ${s(w).crit?"text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.3)]":"text-white"}`),F(Ze,`${s(w).total??""} `)},[()=>l()("character.history.formula"),()=>s(w).formula||l()("character.history.fixed"),()=>l()("character.history.total")]),x(A,G)};q(z,A=>{(s(w).formula||s(w).total!==void 0)&&A(W)})}v(Z),H((A,G)=>{ve(Q,1,`absolute left-0 top-0 bottom-0 w-1 ${s(w).source==="GM"?"bg-indigo-500":"bg-emerald-500"}`),ve(ue,1,`text-[10px] px-1.5 py-0.5 rounded ${s(w).source==="GM"?"bg-indigo-500/20 text-indigo-400":"bg-emerald-500/20 text-emerald-400"} uppercase font-black tracking-widest leading-none border border-current opacity-70`),F(Ie,A),F(he,G),F(le,s(w).name)},[()=>l()(`character.history.source.${s($)}`,{default:s(w).source}),()=>new Date(s(w).timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),x(L,Z)}),v(r);var X=_(r,2),ce=p(X);ce.__click=function(...L){Et.clearHistory?.apply(this,L)};var J=p(ce);Mt(J,{size:16});var ge=_(J);v(ce),v(X),v(E),H((L,w,$)=>{ve(E,1,`h-full bg-slate-900/95 backdrop-blur-xl border-l border-white/10 transition-all duration-500 ease-out shadow-[0_0_50px_rgba(0,0,0,0.5)] flex flex-col fixed top-0 right-0 z-[100] w-full sm:w-96 ${c()?"translate-x-0":"translate-x-full"}`),F(i,L),F(t,`${d().length??""} ${w??""}`),F(ge,` ${$??""}`)},[()=>l()("character.history.title"),()=>l()("character.history.rolls_count"),()=>l()("character.history.clear")]),x(h,g),Se(),m()}Oe(["click"]);function Ke(h,o,l){return h>=o*l?{width:o*l,height:o}:{width:h,height:h/l}}function Fe(h,o,l,d){return{x:Je(h.x,o.width,l.width,d),y:Je(h.y,o.height,l.height,d)}}function Je(h,o,l,d){let u=o*d/2-l/2;return d<1&&(u=l/2-o*d/2),Math.min(u,Math.max(h,-u))}function Qe(h,o){return Math.sqrt(Math.pow(h.y-o.y,2)+Math.pow(h.x-o.x,2))}function lr(h,o,l,d,u,m=!0){const c=m?dr:cr,g={x:c(100,((o.width-l.width/u)/2-h.x/u)/o.width*100),y:c(100,((o.height-l.height/u)/2-h.y/u)/o.height*100),width:c(100,l.width/o.width*100/u),height:c(100,l.height/o.height*100/u)},I=c(o.naturalWidth,g.width*o.naturalWidth/100,!0),B=c(o.naturalHeight,g.height*o.naturalHeight/100,!0),N=o.naturalWidth>=o.naturalHeight*d?{width:Math.round(B*d),height:B}:{width:I,height:Math.round(I/d)},y={...N,x:c(o.naturalWidth-N.width,g.x*o.naturalWidth/100,!0),y:c(o.naturalHeight-N.height,g.y*o.naturalHeight/100,!0)};return{croppedAreaPercentages:g,croppedAreaPixels:y}}function dr(h,o,l=!1){const d=l?Math.round(o):o;return Math.min(h,Math.max(0,d))}function cr(h,o){return o}function et(h,o){return{x:(o.x+h.x)/2,y:(o.y+h.y)/2}}var ur=R('<div data-testid="cropper"></div>'),hr=R('<div class="svelte-easy-crop-container svelte-1yetlj5" role="button" data-testid="container"><img class="svelte-easy-crop-image svelte-1yetlj5" alt=""/> <!></div>');function fr(h,o){Pe(o,!0);let l=D(o,"crop",31,()=>Ae({x:0,y:0})),d=D(o,"zoom",15,1),u=D(o,"minZoom",11,1),m=D(o,"maxZoom",11,3),c=D(o,"aspect",3,4/3),g=D(o,"cropSize",3,null),I=D(o,"cropShape",3,"rect"),B=D(o,"showGrid",3,!0),E=D(o,"zoomSpeed",3,1),N=D(o,"crossOrigin",3,null),y=D(o,"restrictPosition",3,!0),T=D(o,"tabindex",3,void 0),O=U(null),P=U(Ae({width:0,height:0,naturalWidth:0,naturalHeight:0})),b=U(null),i=U(null),n=U(null),t=U(Ae({x:0,y:0})),e=U(Ae({x:0,y:0})),a=U(0),r=U(null),C=U(null);xt(()=>{s(n)&&s(n).complete&&X(),s(b)&&(s(b).addEventListener("gesturestart",j),s(b).addEventListener("gesturechange",j))}),at(()=>{s(b)&&(s(b).removeEventListener("gesturestart",j),s(b).removeEventListener("gesturechange",j)),k()});const j=f=>f.preventDefault(),k=()=>{typeof document<"u"&&(document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",ee),document.removeEventListener("touchmove",Q),document.removeEventListener("touchend",ee))},X=()=>{J(),fe()},ce=()=>g()?g().width/g().height:c(),J=()=>{s(n)&&(M(P,{width:s(n).width,height:s(n).height,naturalWidth:s(n).naturalWidth,naturalHeight:s(n).naturalHeight},!0),M(O,g()?g():Ke(s(n).width,s(n).height,c()),!0)),s(b)&&M(i,s(b).getBoundingClientRect(),!0)},ge=f=>({x:Number(f.clientX),y:Number(f.clientY)}),L=f=>({x:Number(f.clientX),y:Number(f.clientY)}),w=f=>{f.preventDefault(),document.addEventListener("mousemove",$),document.addEventListener("mouseup",ee),se(ge(f))},$=f=>Y(ge(f)),Z=f=>{f.preventDefault(),document.addEventListener("touchmove",Q,{passive:!1}),document.addEventListener("touchend",ee),f.touches.length===2?ue(f):f.touches.length===1&&se(L(f.touches[0]))},Q=f=>{f.preventDefault(),f.touches.length===2?Ie(f):f.touches.length===1&&Y(L(f.touches[0]))},se=({x:f,y:S})=>{M(t,{x:f,y:S},!0),M(e,{x:l().x,y:l().y},!0)},Y=({x:f,y:S})=>{s(r)&&window.cancelAnimationFrame(s(r)),M(r,window.requestAnimationFrame(()=>{if(f===void 0||S===void 0||!s(O))return;const z=f-s(t).x,W=S-s(t).y,A={x:s(e).x+z,y:s(e).y+W};l(y()?Fe(A,s(P),s(O),d()):A)}),!0)},ee=()=>{k(),fe()},ue=f=>{const S=L(f.touches[0]),z=L(f.touches[1]);M(a,Qe(S,z),!0),se(et(S,z))},Ie=f=>{const S=L(f.touches[0]),z=L(f.touches[1]),W=et(S,z);Y(W),s(C)&&window.cancelAnimationFrame(s(C)),M(C,window.requestAnimationFrame(()=>{const A=Qe(S,z),G=d()*(A/s(a));he(G,W),M(a,A,!0)}),!0)},_e=f=>{f.preventDefault();const S=ge(f),z=d()-f.deltaY*E()/200;he(z,S)},pe=({x:f,y:S})=>{if(!s(i))throw new Error("The Cropper is not mounted");return{x:s(i).width/2-(f-s(i).left),y:s(i).height/2-(S-s(i).top)}},te=({x:f,y:S})=>({x:(f+l().x)/d(),y:(S+l().y)/d()}),he=(f,S)=>{if(!s(O))return;const z=pe(S),W=te(z);d(Math.min(m(),Math.max(f,u())));const A={x:W.x*d()-z.x,y:W.y*d()-z.y};l(y()?Fe(A,s(P),s(O),d()):A)},fe=()=>{if(!s(O)||s(O).width===0)return;const f=y()?Fe(l(),s(P),s(O),d()):l(),{croppedAreaPercentages:S,croppedAreaPixels:z}=lr(f,s(P),s(O),ce(),d(),y());o.oncropcomplete?.({percent:S,pixels:z})};Le(()=>{s(n)&&M(O,g()?g():Ke(s(n).width,s(n).height,c()),!0)}),Le(()=>{d()&&fe()});const be=f=>{Le(()=>(f.addEventListener("touchstart",Z),f.addEventListener("mousedown",w),f.addEventListener("wheel",_e,{passive:!1}),()=>{f.removeEventListener("touchstart",Z),f.removeEventListener("mousedown",w),f.removeEventListener("wheel",_e)}))};var ie=hr();Be("resize",mt,J);var le=p(ie);Te(le,f=>M(n,f),()=>s(n));var $e=_(le,2);{var ye=f=>{var S=ur();let z;H(()=>{z=ve(S,1,"svelte-easy-crop-area svelte-1yetlj5",null,z,{"svelte-easy-crop-round":I()==="round","svelte-easy-crop-grid":B()}),Ue(S,`width: ${s(O).width??""}px; height: ${s(O).height??""}px;`)}),x(f,S)};q($e,f=>{s(O)&&f(ye)})}v(ie),Te(ie,f=>M(b,f),()=>s(b)),St(ie,f=>be?.(f)),H(()=>{Ee(ie,"tabindex",T()),Ee(le,"src",o.image),Ue(le,`transform: translate(${l().x??""}px, ${l().y??""}px) scale(${d()??""});`),Ee(le,"crossorigin",N())}),Be("load",le,X),_t(le),x(h,ie),Se()}const vr=h=>new Promise((o,l)=>{const d=new Image;d.addEventListener("load",()=>o(d)),d.addEventListener("error",u=>l(u)),d.setAttribute("crossOrigin","anonymous"),d.src=h});function lt(h){return h*Math.PI/180}function gr(h,o,l){const d=lt(l);return{width:Math.abs(Math.cos(d)*h)+Math.abs(Math.sin(d)*o),height:Math.abs(Math.sin(d)*h)+Math.abs(Math.cos(d)*o)}}async function pr(h,o,l=0,d={horizontal:!1,vertical:!1}){const u=await vr(h),m=document.createElement("canvas"),c=m.getContext("2d");if(!c)return null;const g=lt(l),{width:I,height:B}=gr(u.width,u.height,l);m.width=I,m.height=B,c.translate(I/2,B/2),c.rotate(g),c.scale(d.horizontal?-1:1,d.vertical?-1:1),c.translate(-u.width/2,-u.height/2),c.drawImage(u,0,0);const E=c.getImageData(o.x,o.y,o.width,o.height);return m.width=o.width,m.height=o.height,c.putImageData(E,0,0),new Promise((N,y)=>{m.toBlob(T=>{N(T)},"image/jpeg",.8)})}var br=R('<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Processando...',1),mr=R("<!> Salvar Foto",1),xr=R('<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4 animate-in fade-in duration-200" role="dialog" aria-modal="true"><div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl flex flex-col shadow-2xl overflow-hidden max-h-[90vh]"><div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950"><h3 class="font-bold text-white flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-indigo-500"></div> Editar Imagem</h3> <button class="text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-800 transition-colors"><!></button></div> <div class="relative flex-1 bg-black min-h-[400px]"><!></div> <div class="p-4 bg-slate-950 border-t border-slate-800 space-y-4"><div class="flex items-center gap-4"><div class="flex items-center gap-2 text-slate-400 w-full px-4"><!> <input type="range" min="1" max="3" step="0.1" class="w-full accent-indigo-500 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer"/></div></div> <div class="flex justify-end gap-3 pt-2"><button class="px-6 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-bold transition-all text-sm border border-slate-700">Cancelar</button> <button class="px-8 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold transition-all text-sm shadow-lg shadow-indigo-900/20 flex items-center gap-2"><!></button></div></div></div></div>');function Kr(h,o){Pe(o,!0);let l=D(o,"isOpen",3,!1),d=D(o,"imageUrl",3,""),u=D(o,"aspectRatio",3,1),m=U(Ae({x:0,y:0})),c=U(1),g=U(null),I=U(!1);async function B(){if(console.log("handleSave called",{isProcessing:s(I),pixelCrop:s(g)}),!(s(I)||!s(g))){M(I,!0);try{console.log("Calling getCroppedImg with",{imageUrl:d().substring(0,50)+"...",pixelCrop:s(g)});const T=await pr(d(),s(g),0);console.log("getCroppedImg result:",T),T&&o.onCrop(T)}catch(T){console.error("Error in handleSave:",T)}finally{M(I,!1)}}}var E=K(),N=V(E);{var y=T=>{var O=xr(),P=p(O),b=p(P),i=_(p(b),2);i.__click=function(...$){o.onClose?.apply(this,$)};var n=p(i);st(n,{size:20}),v(i),v(b);var t=_(b,2),e=p(t);fr(e,{get image(){return d()},get aspect(){return u()},oncropcomplete:$=>{console.log("oncropcomplete prop data:",$),M(g,$.pixels,!0)},showGrid:!0,get crop(){return s(m)},set crop($){M(m,$,!0)},get zoom(){return s(c)},set zoom($){M(c,$,!0)}}),v(t);var a=_(t,2),r=p(a),C=p(r),j=p(C);Tt(j,{size:16});var k=_(j,2);wt(k),v(C),v(r);var X=_(r,2),ce=p(X);ce.__click=function(...$){o.onClose?.apply(this,$)};var J=_(ce,2);J.__click=B;var ge=p(J);{var L=$=>{var Z=br();Ge(),x($,Z)},w=$=>{var Z=mr(),Q=V(Z);Pt(Q,{size:18}),Ge(),x($,Z)};q(ge,$=>{s(I)?$(L):$(w,!1)})}v(J),v(X),v(a),v(P),v(O),H(()=>J.disabled=s(I)),Nt(k,()=>s(c),$=>M(c,$)),x(T,O)};q(N,T=>{l()&&T(y)})}x(h,E),Se()}Oe(["click"]);export{Ur as A,Br as B,Tr as C,Bt as D,Dr as E,jr as G,Yr as H,Kr as I,zr as L,Rt as M,Fr as R,Gr as S,Xr as T,Wr as W,St as a,Vr as b,Or as c,Rr as d,Ve as e,Zr as f,Hr as g,kr as h,qr as s};
