import"./DsnmJJEf.js";import"./B6lYapqp.js";import{F as Rt,I as mt,B as de,o as J,k as w,x as i,y as z,w as m,z as Se,p as Te,j as E,q as v,A as f,t as U,v as Be,u as A,a2 as Ue,O as We,L as dt,ad as xt,n as at,bt as Lt}from"./X4qjwA50.js";import{I as Ae,s as Me}from"./CRJZpbrG.js";import{l as $e,s as Ce,p as W,i as F}from"./BGpg0XVn.js";import{g as Pt,o as _t,p as it,s as D,d as qe,q as yt,e as Ye,r as Nt}from"./JmLgoKLb.js";import{s as xe,g as Ke,a as _e,$ as ot,e as Je,i as wt,j as Tt,r as Bt}from"./Da70ei3y.js";import{b as ke}from"./BpzvJAE_.js";import{a as st,s as Ze}from"./CjDeeOcX.js";import{f as Dt,g as zt,M as jt,P as At,D as Ot,X as Mt,b as Ut}from"./FGmEFq9w.js";import{v as nt,x as Fe,t as Ft,y as kt,b as Ht}from"./BPjVGcEY.js";import{C as $t}from"./B3i3dWaQ.js";import{t as Gt,s as Wt}from"./J-RRPI-t.js";function Zt(c,n,l){Rt(()=>{var d=mt(()=>n(c,l?.())||{});if(d?.destroy)return()=>d.destroy()})}function oa(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 18V5"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"}]];Ae(c,Ce({name:"brain"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function sa(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]];Ae(c,Ce({name:"camera"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function la(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];Ae(c,Ce({name:"clock"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function da(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];Ae(c,Ce({name:"eye"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function ca(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M9 10h.01"}],["path",{d:"M15 10h.01"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"}]];Ae(c,Ce({name:"ghost"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function ct(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}],["path",{d:"M12 7v5l4 2"}]];Ae(c,Ce({name:"history"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function ua(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1"}]];Ae(c,Ce({name:"layout-dashboard"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function Ct(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M5 12h14"}]];Ae(c,Ce({name:"minus"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function fa(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];Ae(c,Ce({name:"rotate-ccw"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}function qt(c,n){const l=$e(n,["children","$$slots","$$events","$$legacy"]);const d=[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]];Ae(c,Ce({name:"zoom-in"},()=>l,{get iconNode(){return d},children:(u,x)=>{var g=de(),p=J(g);Me(p,n,"default",{}),w(u,g)},$$slots:{default:!0}}))}const va={Blinded:{effect:"Make rolls with 3 banes. No sight reactions. Speed halved.",speedMult:.5,rollMod:-3},Confused:{effect:"No reactions. Intellect and Will rolls with 1 bane.",rollMod:-1,attributes:["int","wil"]},Controlled:{effect:"Controller decides your turn. Regard source as ally."},Cursed:{effect:"Luck rolls with 1 bane."},Deafened:{effect:"No hearing reactions. Immune to hearing effects."},Frightened:{effect:"Attribute rolls with 1 bane (while in LOS). Grant 1 boon on rolls against you.",rollMod:-1},Held:{effect:"Speed 0. Cannot increase Speed. Auto-fail Agility defense rolls.",speedFixed:0},Impaired:{effect:"Roll with 1 bane for specified attribute. Grant 1 boon against that attribute.",rollMod:-1},Incapacitated:{effect:"Damage equals or exceeds Health. You cannot use actions or reactions. Speed 0.",speedFixed:0},"On Fire":{effect:"Take 1d6 damage at end of round. Action/Luck roll to extinguish."},Poisoned:{effect:"Attribute rolls with 1 bane. Grant 1 boon against you. Lose 1d6 Health end of round.",rollMod:-1},Prone:{effect:"No reactions. Grant 1 boon to melee vs you, impose 1 bane to ranged vs you."},Slowed:{effect:"Speed drops to 2 (if higher). Cannot benefit from Speed increases.",speedCap:2},Stunned:{effect:"No actions/reactions. Speed 0. Grant 2 boons against you. Attribute rolls with 2 banes.",speedFixed:0,rollMod:-2},Unconscious:{effect:"No actions/reactions. Speed 0. Grant 3 boons against you. Auto-fail attribute rolls.",speedFixed:0,autoFail:!0},Vulnerable:{effect:"Grant 1 boon on attacks/rolls against you."},Weakened:{effect:"Strength/Agility rolls with 1 bane. Grant 1 boon vs Str/Agi. Speed halved.",speedMult:.5,attributes:["str","agi"],rollMod:-1}},ha={OFF:"Off",ONE:"One",TWO:"Two"},ga=["NIMBLE","FIREARM","THROWN","BRUTAL","BLUDGEONING","SLASHING","DISARMING","RANGE","SPECIAL","MISFIRE","LARGE","SLOW","LIGHT","LONG","AMMUNITION","PIERCING","RELOAD","VERSATILE"],ba={ANCESTRY:"Ancestry",NOVICE:"Novice",EXPERT:"Expert",MASTER:"Master"};function ut(c){const n=Dt[c];return n?{theme_surface:c,theme_customColorset:n.dice,theme_colorset:c}:{}}function Vt(){let c=z(null),n=z("idle"),l=z(null),d=z(null),u=z(null);nt.subscribe(_=>{i(c)&&_.diceTheme&&i(c).updateConfig(ut(_.diceTheme))});const x=Se(()=>i(n)==="ready"),g=Se(()=>i(n)==="rolling");async function p(_){if(!(i(c)||i(n)==="initializing")){m(l,_,!0),m(n,"initializing"),m(u,null);try{const y=Pt(nt);m(c,new zt(_,{assetPath:"/assets/dice-box/",...ut(y.diceTheme||"default"),shadows:!0}),!0),await i(c).initialize(),m(n,"ready")}catch(y){console.error("Failed to initialize DiceBox:",y),m(u,y instanceof Error?y.message:"Unknown error",!0),m(n,"error")}}}async function R(_){if(!i(c)||i(n)!=="ready")throw new Error("DiceBox is not initialized");m(n,"rolling"),m(u,null);try{const y=await i(c).roll(_);return m(d,y,!0),m(n,"ready"),y}catch(y){throw console.error("Roll failed:",y),m(u,y instanceof Error?y.message:"Roll failed",!0),m(n,"ready"),y}}async function j({dicePool:_}){const y=_.map(({shape:h})=>`1${h}`).join("+"),C=_.map(({value:h})=>h).filter(Boolean),L=C.length>0?`${y}@${C.join(",")}`:y;return R(L)}async function I(){if(i(c))try{await i(c).clear(),m(d,null)}catch(_){console.error("Clear failed:",_)}}function M(){i(c)&&(i(c).clear(),m(c,null)),m(l,null),m(n,"idle"),m(d,null),m(u,null)}return{get status(){return i(n)},get isReady(){return i(x)},get isRolling(){return i(g)},get lastResults(){return i(d)},get error(){return i(u)},get container(){return i(l)},initialize:p,roll:R,rollPool:j,clear:I,dispose:M}}const Oe=Vt();var Xt=E('<div class="dice-overlay svelte-10rxhsn"><div class="dice-loader svelte-10rxhsn"><span class="loader-spinner svelte-10rxhsn"></span> <span>Loading dice...</span></div></div>'),Yt=E('<small class="svelte-10rxhsn"> </small>'),Kt=E('<div class="dice-overlay dice-error svelte-10rxhsn"><span>Failed to load dice</span> <!></div>'),Jt=E('<div role="img" aria-label="3D Dice Roller"><!></div>');function Qt(c,n){Te(n,!0);let l=W(n,"height",3,400),d=W(n,"class",3,""),u,x=z(!1);const g=Se(()=>Oe.status),p=Se(()=>Oe.error);_t(async()=>{m(x,!0),u&&await Oe.initialize(u)}),it(()=>{Oe.dispose()});async function R(h){const s=await Oe.roll(h);return n.onRollComplete?.(s),s}async function j(){await Oe.clear()}var I={roll:R,clear:j},M=Jt();let _;var y=v(M);{var C=h=>{var s=Xt();w(h,s)},L=h=>{var s=de(),o=J(s);{var t=e=>{var a=Kt(),r=A(v(a),2);{var P=k=>{var q=Yt(),B=v(q,!0);f(q),U(()=>D(B,i(p))),w(k,q)};F(r,k=>{i(p)&&k(P)})}f(a),w(e,a)};F(o,e=>{i(g)==="error"&&e(t)},!0)}w(h,s)};F(y,h=>{i(g)==="initializing"?h(C):h(L,!1)})}return f(M),ke(M,h=>u=h,()=>u),U(()=>{xe(M,1,`dice-roller ${d()??""}`,"svelte-10rxhsn"),_=Ke(M,"",_,{height:`${l()??""}px`})}),w(c,M),Be(I)}var er=E('<div class="absolute inset-0 bg-transparent z-10"></div>'),tr=E('<div class="rounded-2xl overflow-hidden border border-white/10 relative h-[300px]"><!> <!></div>'),rr=E('<div class="mt-2 text-sm text-slate-400 font-mono bg-black/30 py-1 px-3 rounded-full inline-block border border-white/5"> </div>'),ar=E('<div class="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500"><div class="bg-slate-900/80 p-6 rounded-2xl border border-white/10 text-center shadow-lg relative overflow-hidden group"><div class="absolute inset-0 bg-indigo-500/10 blur-xl"></div> <div class="relative z-10"><div class="text-xs text-slate-400 uppercase tracking-widest font-bold mb-2"> </div> <div class="text-5xl font-black text-white tracking-tighter drop-shadow-lg scale-110 transform transition-transform duration-300"> </div> <!></div></div> <button class="w-full bg-slate-800 hover:bg-slate-700 text-white font-black py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg transition-all active:scale-[0.98] uppercase tracking-widest text-sm border border-slate-700"><!> </button></div>'),nr=E('<div class="w-2 h-2 bg-white rounded-sm"></div>'),ir=E('<span class="text-[9px] text-slate-400 bg-slate-800 px-1 rounded"> </span>'),or=E('<div class="flex flex-wrap gap-1 mt-1"></div>'),sr=E('<button><div class="flex items-center gap-3"><div><!></div> <div><span class="text-sm font-bold text-slate-200 block leading-tight"> </span> <!></div></div></button>'),lr=E('<div class="space-y-2"><h4 class="text-xs font-bold text-slate-500 uppercase px-1"> </h4> <div class="grid grid-cols-1 gap-2 max-h-[150px] overflow-y-auto pr-1 custom-scrollbar"></div></div>'),dr=E('<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> <span> </span>',1),cr=E("<!> ",1),ur=E('<div class="bg-slate-900/50 p-6 rounded-2xl border border-white/5 text-center shadow-inner relative overflow-hidden group"><div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div> <div class="flex justify-center items-center gap-8 mb-4 relative z-10"><button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-red-500/20 text-slate-300 hover:text-red-400 border border-slate-700 hover:border-red-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <div class="flex flex-col items-center min-w-[100px]"><span> </span></div> <button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-green-500/20 text-slate-300 hover:text-green-400 border border-slate-700 hover:border-green-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div> <div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] relative z-10"> </div></div> <!> <!> <button class="w-full bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-700 text-white font-black py-4 rounded-xl flex items-center justify-center gap-3 shadow-lg shadow-indigo-600/20 transition-all active:scale-[0.98] uppercase tracking-widest text-sm disabled:cursor-not-allowed"><!></button>',1),fr=E('<div class="space-y-6"><!> <!></div>');function pa(c,n){Te(n,!0);const l=()=>Ze(ot,"$t",u),d=()=>Ze(nt,"$appSettings",u),[u,x]=st();let g=W(n,"initialModifier",3,0),p=W(n,"effects",19,()=>[]);const R=Se(()=>n.label||l()("common.labels.boons_banes")),j=Se(()=>n.rollLabel||l()("common.buttons.roll"));let I=z(0),M=z(Ue([])),_,y=z(!1),C=z(null),L=z(void 0),h;const s=Se(()=>d().enable3DDice);We(()=>(n.isOpen?(mt(()=>{i(C)||(m(I,g()),m(M,p().map(B=>B.id),!0))}),m(y,!1)):(o(),m(M,[],!0),m(C,null)),()=>o()));function o(){h&&clearTimeout(h),m(L,void 0)}function t(B){i(M).includes(B)?m(M,i(M).filter(Z=>Z!==B),!0):m(M,[...i(M),B],!0)}function e(B,Z=[],H=[]){if(B===void 0&&H.length>0){const ae=H.join(",");return`${H.length}d6@${ae}`}if(B!==void 0){const ae=Z.length,N=[B,...Z].join(",");if(ae===0)return`1d20@${B}`;const $=i(I)>0?"boon":i(I)<0?"bane":"",S=$?`[${$}]`:"";return`1d20+${ae}d6${S}@${N}`}return""}async function a(){const B=p().filter(H=>i(M).includes(H.id)),Z=n.onRoll(i(I),B,{suppressHistory:!0});if(Z){if(m(y,!0),i(s)&&_)try{const H=e(Z.d20,Z.boonBaneDice,Z.damageDice);H&&(await _.roll(H),await new Promise(ae=>setTimeout(ae,500)))}catch(H){console.error("3D dice roll failed:",H)}else await new Promise(H=>setTimeout(H,200));m(y,!1),m(C,Z,!0),Z.commit&&m(L,Z.commit,!0),h=setTimeout(()=>{r()},2500)}else n.onClose()}function r(){h&&clearTimeout(h),i(L)&&(i(L)(),m(L,void 0)),n.onClose(),setTimeout(()=>{m(C,null)},300)}var P=de(),k=J(P);{var q=B=>{{let Z=Se(()=>i(C)?l()("common.labels.result"):n.title);jt(B,{get isOpen(){return n.isOpen},onClose:r,get title(){return i(Z)},children:(H,ae)=>{var N=fr(),$=v(N);{var S=Y=>{var K=tr(),Q=v(K);ke(Qt(Q,{height:300}),le=>_=le,()=>_);var ue=A(Q,2);{var ee=le=>{var se=er();w(le,se)};F(ue,le=>{i(y)&&le(ee)})}f(K),w(Y,K)};F($,Y=>{i(s)&&Y(S)})}var ne=A($,2);{var ce=Y=>{var K=ar(),Q=v(K),ue=A(v(Q),2),ee=v(ue),le=v(ee,!0);f(ee);var se=A(ee,2),ye=v(se,!0);f(se);var ge=A(se,2);{var fe=ve=>{var b=rr(),T=v(b,!0);f(b),U(()=>D(T,i(C).formula)),w(ve,b)};F(ge,ve=>{i(C).formula&&ve(fe)})}f(ue),f(Q);var re=A(Q,2);re.__click=r;var ie=v(re);$t(ie,{size:20});var Le=A(ie);f(re),f(K),U((ve,b)=>{D(le,ve),D(ye,i(C).total),D(Le,` ${b??""}`)},[()=>l()("common.labels.total"),()=>l()("common.buttons.close")]),w(Y,K)},he=Y=>{var K=ur(),Q=J(K),ue=A(v(Q),2),ee=v(ue);ee.__click=()=>dt(I,-1);var le=v(ee);Ct(le,{size:24}),f(ee);var se=A(ee,2),ye=v(se),ge=v(ye);f(ye),f(se);var fe=A(se,2);fe.__click=()=>dt(I);var re=v(fe);At(re,{size:24}),f(fe),f(ue);var ie=A(ue,2),Le=v(ie,!0);f(ie),f(Q);var ve=A(Q,2);{var b=X=>{var oe=lr(),te=v(oe),pe=v(te,!0);f(te);var De=A(te,2);Je(De,21,p,Re=>Re.id,(Re,we)=>{var Ee=sr();Ee.__click=()=>t(i(we).id);var ze=v(Ee),je=v(ze),He=v(je);{var Ve=Ie=>{var Ne=nr();w(Ie,Ne)};F(He,Ie=>{i(M).includes(i(we).id)&&Ie(Ve)})}f(je);var Xe=A(je,2),Ge=v(Xe),me=v(Ge,!0);f(Ge);var Pe=A(Ge,2);{var Qe=Ie=>{var Ne=or();Je(Ne,21,()=>i(we).modifiers,wt,(It,lt)=>{var et=ir(),St=v(et);f(et),U(()=>D(St,`${i(lt).target??""}: ${i(lt).value??""}`)),w(It,et)}),f(Ne),w(Ie,Ne)};F(Pe,Ie=>{i(we).modifiers&&i(we).modifiers.length>0&&Ie(Qe)})}f(Xe),f(ze),f(Ee),U((Ie,Ne)=>{xe(Ee,1,`flex items-center justify-between p-3 rounded-lg border transition-all text-left ${Ie??""}`),Ee.disabled=i(y),xe(je,1,`w-4 h-4 rounded border flex items-center justify-center transition-colors ${Ne??""}`),D(me,i(we).name)},[()=>i(M).includes(i(we).id)?"bg-indigo-900/30 border-indigo-500/50 shadow-sm":"bg-slate-900/50 border-slate-800 opacity-60 hover:opacity-100 hover:border-slate-700",()=>i(M).includes(i(we).id)?"bg-indigo-500 border-indigo-400":"border-slate-600 bg-slate-900"]),w(Re,Ee)}),f(De),f(oe),U(Re=>D(pe,Re),[()=>l()("character.effects.active")]),w(X,oe)};F(ve,X=>{p().length>0&&X(b)})}var T=A(ve,2);yt(T,()=>n.children??xt);var G=A(T,2);G.__click=a;var be=v(G);{var O=X=>{var oe=dr(),te=A(J(oe),2),pe=v(te);f(te),U(De=>D(pe,`${De??""}...`),[()=>l()("character.modals.rolling")]),w(X,oe)},V=X=>{var oe=cr(),te=J(oe);Ot(te,{size:18});var pe=A(te);U(()=>D(pe,` ${i(j)??""}`)),w(X,oe)};F(be,X=>{i(y)?X(O):X(V,!1)})}f(G),U((X,oe)=>{_e(ee,"aria-label",X),ee.disabled=i(y),xe(ye,1,`text-5xl font-black ${i(I)>0?"text-green-400":i(I)<0?"text-red-400":"text-slate-500"} tabular-nums drop-shadow-sm transition-colors duration-300`),D(ge,`${i(I)>0?"+":""}${i(I)??""}`),_e(fe,"aria-label",oe),fe.disabled=i(y),D(Le,i(R)),G.disabled=i(y)},[()=>l()("common.buttons.decrease"),()=>l()("common.buttons.increase")]),w(Y,K)};F(ne,Y=>{i(C)?Y(ce):Y(he,!1)})}f(N),w(H,N)},$$slots:{default:!0}})}};F(k,B=>{n.isOpen&&B(q)})}w(c,P),Be(),x()}qe(["click"]);var tt={exports:{}},ft;function vr(){return ft||(ft=1,(function(c,n){(function(l){c.exports=l()})(function(l){var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function u(s,o){var t=s[0],e=s[1],a=s[2],r=s[3];t+=(e&a|~e&r)+o[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+o[1]-389564586|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+o[2]+606105819|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+o[3]-1044525330|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+o[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+o[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+o[6]-1473231341|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+o[7]-45705983|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+o[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+o[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+o[10]-42063|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+o[11]-1990404162|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+o[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+o[13]-40341101|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+o[14]-1502002290|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+o[15]+1236535329|0,e=(e<<22|e>>>10)+a|0,t+=(e&r|a&~r)+o[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+o[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+o[11]+643717713|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+o[0]-373897302|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+o[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+o[10]+38016083|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+o[15]-660478335|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+o[4]-405537848|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+o[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+o[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+o[3]-187363961|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+o[8]+1163531501|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+o[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+o[2]-51403784|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+o[7]+1735328473|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+o[12]-1926607734|0,e=(e<<20|e>>>12)+a|0,t+=(e^a^r)+o[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+o[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+o[11]+1839030562|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+o[14]-35309556|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+o[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+o[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+o[7]-155497632|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+o[10]-1094730640|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+o[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+o[0]-358537222|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+o[3]-722521979|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+o[6]+76029189|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+o[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+o[12]-421815835|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+o[15]+530742520|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+o[2]-995338651|0,e=(e<<23|e>>>9)+a|0,t+=(a^(e|~r))+o[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+o[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+o[14]-1416354905|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+o[5]-57434055|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+o[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+o[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+o[10]-1051523|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+o[1]-2054922799|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+o[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+o[15]-30611744|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+o[6]-1560198380|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+o[13]+1309151649|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+o[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+o[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+o[2]+718787259|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+o[9]-343485551|0,e=(e<<21|e>>>11)+a|0,s[0]=t+s[0]|0,s[1]=e+s[1]|0,s[2]=a+s[2]|0,s[3]=r+s[3]|0}function x(s){var o=[],t;for(t=0;t<64;t+=4)o[t>>2]=s.charCodeAt(t)+(s.charCodeAt(t+1)<<8)+(s.charCodeAt(t+2)<<16)+(s.charCodeAt(t+3)<<24);return o}function g(s){var o=[],t;for(t=0;t<64;t+=4)o[t>>2]=s[t]+(s[t+1]<<8)+(s[t+2]<<16)+(s[t+3]<<24);return o}function p(s){var o=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,P,k,q;for(e=64;e<=o;e+=64)u(t,x(s.substring(e-64,e)));for(s=s.substring(e-64),a=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=s.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return P=o*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(P[2],16),q=parseInt(P[1],16)||0,r[14]=k,r[15]=q,u(t,r),t}function R(s){var o=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,P,k,q;for(e=64;e<=o;e+=64)u(t,g(s.subarray(e-64,e)));for(s=e-64<o?s.subarray(e-64):new Uint8Array(0),a=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=s[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return P=o*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(P[2],16),q=parseInt(P[1],16)||0,r[14]=k,r[15]=q,u(t,r),t}function j(s){var o="",t;for(t=0;t<4;t+=1)o+=d[s>>t*8+4&15]+d[s>>t*8&15];return o}function I(s){var o;for(o=0;o<s.length;o+=1)s[o]=j(s[o]);return s.join("")}I(p("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function s(o,t){return o=o|0||0,o<0?Math.max(o+t,0):Math.min(o,t)}ArrayBuffer.prototype.slice=function(o,t){var e=this.byteLength,a=s(o,e),r=e,P,k,q,B;return t!==l&&(r=s(t,e)),a>r?new ArrayBuffer(0):(P=r-a,k=new ArrayBuffer(P),q=new Uint8Array(k),B=new Uint8Array(this,a,P),q.set(B),k)}})();function M(s){return/[\u0080-\uFFFF]/.test(s)&&(s=unescape(encodeURIComponent(s))),s}function _(s,o){var t=s.length,e=new ArrayBuffer(t),a=new Uint8Array(e),r;for(r=0;r<t;r+=1)a[r]=s.charCodeAt(r);return o?a:e}function y(s){return String.fromCharCode.apply(null,new Uint8Array(s))}function C(s,o,t){var e=new Uint8Array(s.byteLength+o.byteLength);return e.set(new Uint8Array(s)),e.set(new Uint8Array(o),s.byteLength),e}function L(s){var o=[],t=s.length,e;for(e=0;e<t-1;e+=2)o.push(parseInt(s.substr(e,2),16));return String.fromCharCode.apply(String,o)}function h(){this.reset()}return h.prototype.append=function(s){return this.appendBinary(M(s)),this},h.prototype.appendBinary=function(s){this._buff+=s,this._length+=s.length;var o=this._buff.length,t;for(t=64;t<=o;t+=64)u(this._hash,x(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},h.prototype.end=function(s){var o=this._buff,t=o.length,e,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)a[e>>2]|=o.charCodeAt(e)<<(e%4<<3);return this._finish(a,t),r=I(this._hash),s&&(r=L(r)),this.reset(),r},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},h.prototype.setState=function(s){return this._buff=s.buff,this._length=s.length,this._hash=s.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(s,o){var t=o,e,a,r;if(s[t>>2]|=128<<(t%4<<3),t>55)for(u(this._hash,s),t=0;t<16;t+=1)s[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(e[2],16),r=parseInt(e[1],16)||0,s[14]=a,s[15]=r,u(this._hash,s)},h.hash=function(s,o){return h.hashBinary(M(s),o)},h.hashBinary=function(s,o){var t=p(s),e=I(t);return o?L(e):e},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(s){var o=C(this._buff.buffer,s),t=o.length,e;for(this._length+=s.byteLength,e=64;e<=t;e+=64)u(this._hash,g(o.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(o.buffer.slice(e-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(s){var o=this._buff,t=o.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a,r;for(a=0;a<t;a+=1)e[a>>2]|=o[a]<<(a%4<<3);return this._finish(e,t),r=I(this._hash),s&&(r=L(r)),this.reset(),r},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var s=h.prototype.getState.call(this);return s.buff=y(s.buff),s},h.ArrayBuffer.prototype.setState=function(s){return s.buff=_(s.buff,!0),h.prototype.setState.call(this,s)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(s,o){var t=R(new Uint8Array(s)),e=I(t);return o?L(e):e},h})})(tt)),tt.exports}var hr=vr();const gr=Tt(hr),vt=5;async function ma(c){if(c.size>vt*1024*1024)throw new Error(`Imagem muito grande. Máximo de ${vt}MB.`);const n=await c.arrayBuffer(),l=gr.ArrayBuffer.hash(n);if(Fe.has(l))return l;const d=new FileReader,x=await new Promise((g,p)=>{d.onload=()=>g(d.result),d.onerror=p,d.readAsDataURL(c)});return Fe.set(l,x),l}function br(c,n){if(!c)return n(void 0),()=>{};n(Fe.get(c));const l=d=>{const u=Fe.get(c);n(u)};return Fe.observe(l),()=>{Fe.unobserve(l)}}var pr=E('<img class="w-full h-full object-cover rounded-full border border-white/10 shadow-sm"/>'),mr=E('<div class="w-full h-full bg-slate-800 rounded-full border border-white/10 flex items-center justify-center font-black text-slate-500 shadow-sm"> </div>'),xr=E("<div><!></div>");function xa(c,n){Te(n,!0);let l=W(n,"size",3,"md"),d=W(n,"fallbackText",3,"?"),u=z(void 0),x;We(()=>{x&&x(),n.hash?x=br(n.hash,M=>{m(u,M,!0)}):m(u,void 0)}),it(()=>{x&&x()});const g={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-16 h-16 text-lg",xl:"w-20 h-20 text-xl",custom:"w-full h-full"};var p=xr(),R=v(p);{var j=M=>{var _=pr();U(()=>{_e(_,"src",i(u)),_e(_,"alt",n.alt)}),w(M,_)},I=M=>{var _=mr(),y=v(_,!0);f(_),U(()=>D(y,d())),w(M,_)};F(R,M=>{i(u)?M(j):M(I,!1)})}f(p),U(()=>xe(p,1,`${g[l()]??""} relative flex-shrink-0`)),w(c,p),Be()}var _r=E('<div class="absolute z-50 bottom-full left-1/2 mb-2 w-max max-w-[200px] p-2 bg-slate-800 border border-indigo-500 rounded-lg shadow-xl shadow-black/50 text-[10px] text-slate-300 leading-relaxed text-center pointer-events-none whitespace-normal -translate-x-1/2" style="margin-left: var(--x-offset);"> <div class="absolute -bottom-1 left-1/2 w-2 h-2 bg-slate-800 border-r border-b border-indigo-500 -translate-x-1/2" style="transform: translateX(calc(-50% - var(--x-offset))) rotate(45deg);"></div></div>'),yr=E('<div role="button" tabindex="0"><!> <!></div>');function _a(c,n){let l=W(n,"text",3,""),d=W(n,"class",3,""),u=z(!1),x=!1,g=z(0),p,R=z(void 0);function j(){if(!p||!i(R))return;const h=p.getBoundingClientRect(),o=i(R).getBoundingClientRect().width/2;m(g,0);const t=h.left+h.width/2-o;t<10&&m(g,10-t);const e=h.left+h.width/2+o;e>window.innerWidth-10&&m(g,window.innerWidth-10-e)}async function I(){x||(m(u,!0),setTimeout(j,0))}function M(h){x&&(i(u)?m(u,!1):(m(u,!0),setTimeout(j,0)))}var _=yr();_.__touchstart=()=>x=!0,_.__click=M,_.__keydown=h=>{(h.key==="Enter"||h.key===" ")&&m(u,!i(u))};var y=v(_);yt(y,()=>n.children??xt);var C=A(y,2);{var L=h=>{var s=_r(),o=v(s);at(),f(s),ke(s,t=>m(R,t),()=>i(R)),U(()=>D(o,`${l()??""} `)),Gt(3,s,()=>Wt,()=>({duration:150,start:.95})),w(h,s)};F(C,h=>{i(u)&&l()&&h(L)})}f(_),ke(_,h=>p=h,()=>p),U(()=>{xe(_,1,`relative inline-flex ${d()??""}`),Ke(_,`--x-offset: ${i(g)??""}px;`)}),Ye("mouseenter",_,I),Ye("mouseleave",_,()=>!x&&m(u,!1)),w(c,_)}qe(["touchstart","click","keydown"]);var wr=E('<div class="fixed inset-0 bg-black/50 z-[90] lg:hidden backdrop-blur-sm" role="button" tabindex="-1"></div>'),Ar=E('<div class="flex flex-col items-center justify-center h-full text-slate-600 opacity-50"><div class="w-16 h-16 border-2 border-dashed border-slate-800 rounded-full flex items-center justify-center mb-4"><!></div> <p class="text-sm font-bold uppercase tracking-widest italic"> </p></div>'),Mr=E('<span class="text-[10px] text-white/50 font-black uppercase tracking-tighter"> </span>'),$r=E('<div class="text-[10px] text-slate-400 font-medium italic mt-1 leading-relaxed opacity-80 whitespace-pre-wrap"> </div>'),Cr=E('<span class="text-[8px] font-black uppercase tracking-widest bg-indigo-500/10 text-indigo-300 px-2 py-0.5 rounded-full border border-indigo-500/20"> </span>'),Er=E('<div class="flex flex-wrap gap-1 mb-3"></div>'),Ir=E('<div class="absolute inset-0 bg-yellow-400/5 animate-pulse"></div>'),Sr=E('<span class="text-[10px] animate-bounce">✨</span>'),Rr=E('<div class="relative bg-black/40 rounded-xl p-3 flex justify-between items-center border border-white/5 group-hover:border-white/10 transition-colors overflow-hidden"><!> <div class="flex flex-col"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div class="text-xs font-mono text-indigo-300 font-bold"> </div></div> <div class="flex flex-col items-end"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div> <!></div></div></div>'),Lr=E('<div class="relative bg-slate-800/40 hover:bg-slate-800/60 transition-colors rounded-2xl border border-white/5 p-4 shadow-xl overflow-hidden group animate-in slide-in-from-right-8 duration-300"><div></div> <div class="flex justify-between items-start mb-3"><div class="flex flex-col"><div class="flex items-center gap-2"><span> </span> <!></div></div> <span class="text-[9px] text-slate-500 font-black tracking-widest uppercase"> </span></div> <div class="flex items-center gap-3 mb-2"><div class="flex-1"><div class="font-black text-white text-sm uppercase tracking-tight leading-snug"> </div> <!></div></div> <!> <!></div>'),Pr=E('<!> <aside><div class="px-6 py-5 border-b border-white/5 flex justify-between items-center bg-slate-950/50"><div class="flex items-center gap-3"><div class="p-2 bg-indigo-500/10 rounded-lg border border-indigo-500/20"><!></div> <div><h3 class="font-black text-white uppercase tracking-widest text-sm"> </h3> <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter"> </p></div></div> <button class="p-2 hover:bg-white/5 rounded-full text-slate-400 hover:text-white transition-all active:scale-90"><!></button></div> <div class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 custom-scrollbar"><!> <!></div> <div class="p-6 border-t border-white/5 bg-slate-950/80"><button class="w-full py-3 text-xs font-black uppercase tracking-[0.2em] text-red-400/70 hover:text-red-400 border border-red-900/30 rounded-xl hover:bg-red-900/20 transition-all flex items-center justify-center gap-3 active:scale-[0.98]"><!> </button></div></aside>',1);function ya(c,n){Te(n,!0);const l=()=>Ze(ot,"$t",u),d=()=>Ze(kt,"$rollHistory",u),[u,x]=st();let g=W(n,"isOpen",3,!1);var p=Pr(),R=J(p);{var j=N=>{var $=wr();$.__click=function(...S){n.onClose?.apply(this,S)},U(S=>_e($,"aria-label",S),[()=>l()("character.history.close")]),w(N,$)};F(R,N=>{g()&&N(j)})}var I=A(R,2),M=v(I),_=v(M),y=v(_),C=v(y);ct(C,{size:20,class:"text-indigo-400"}),f(y);var L=A(y,2),h=v(L),s=v(h,!0);f(h);var o=A(h,2),t=v(o);f(o),f(L),f(_);var e=A(_,2);e.__click=function(...N){n.onClose?.apply(this,N)};var a=v(e);Mt(a,{size:24}),f(e),f(M);var r=A(M,2),P=v(r);{var k=N=>{var $=Ar(),S=v($),ne=v(S);ct(ne,{size:32}),f(S);var ce=A(S,2),he=v(ce,!0);f(ce),f($),U(Y=>D(he,Y),[()=>l()("character.history.none")]),w(N,$)};F(P,N=>{d().length===0&&N(k)})}var q=A(P,2);Je(q,1,d,N=>N.id,(N,$)=>{const S=Se(()=>i($).source?.toLowerCase());var ne=Lr(),ce=v(ne),he=A(ce,2),Y=v(he),K=v(Y),Q=v(K),ue=v(Q,!0);f(Q);var ee=A(Q,2);{var le=O=>{var V=Mr(),X=v(V,!0);f(V),U(()=>D(X,i($).charName)),w(O,V)};F(ee,O=>{i($).charName&&i($).charName!==i($).source&&O(le)})}f(K),f(Y);var se=A(Y,2),ye=v(se,!0);f(se),f(he);var ge=A(he,2),fe=v(ge),re=v(fe),ie=v(re,!0);f(re);var Le=A(re,2);{var ve=O=>{var V=$r(),X=v(V,!0);f(V),U(()=>D(X,i($).description)),w(O,V)};F(Le,O=>{i($).description&&O(ve)})}f(fe),f(ge);var b=A(ge,2);{var T=O=>{var V=Er();Je(V,21,()=>i($).effectsApplied,wt,(X,oe)=>{var te=Cr(),pe=v(te,!0);f(te),U(()=>D(pe,i(oe))),w(X,te)}),f(V),w(O,V)};F(b,O=>{i($).effectsApplied?.length>0&&O(T)})}var G=A(b,2);{var be=O=>{var V=Rr(),X=v(V);{var oe=me=>{var Pe=Ir();w(me,Pe)};F(X,me=>{i($).crit&&me(oe)})}var te=A(X,2),pe=v(te),De=v(pe,!0);f(pe);var Re=A(pe,2),we=v(Re,!0);f(Re),f(te);var Ee=A(te,2),ze=v(Ee),je=v(ze,!0);f(ze);var He=A(ze,2),Ve=v(He),Xe=A(Ve);{var Ge=me=>{var Pe=Sr();w(me,Pe)};F(Xe,me=>{i($).crit&&me(Ge)})}f(He),f(Ee),f(V),U((me,Pe,Qe)=>{D(De,me),D(we,Pe),D(je,Qe),xe(He,1,`text-3xl font-black font-mono leading-none flex items-baseline gap-1 ${i($).crit?"text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.3)]":"text-white"}`),D(Ve,`${i($).total??""} `)},[()=>l()("character.history.formula"),()=>i($).formula||l()("character.history.fixed"),()=>l()("character.history.total")]),w(O,V)};F(G,O=>{(i($).formula||i($).total!==void 0)&&O(be)})}f(ne),U((O,V)=>{xe(ce,1,`absolute left-0 top-0 bottom-0 w-1 ${i($).source==="GM"?"bg-indigo-500":"bg-emerald-500"}`),xe(Q,1,`text-[10px] px-1.5 py-0.5 rounded ${i($).source==="GM"?"bg-indigo-500/20 text-indigo-400":"bg-emerald-500/20 text-emerald-400"} uppercase font-black tracking-widest leading-none border border-current opacity-70`),D(ue,O),D(ye,V),D(ie,i($).name)},[()=>l()(`character.history.source.${i(S)}`,{default:i($).source}),()=>new Date(i($).timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),w(N,ne)}),f(r);var B=A(r,2),Z=v(B);Z.__click=function(...N){Ft.clearHistory?.apply(this,N)};var H=v(Z);Ut(H,{size:16});var ae=A(H);f(Z),f(B),f(I),U((N,$,S)=>{xe(I,1,`h-full bg-slate-900/95 backdrop-blur-xl border-l border-white/10 transition-all duration-500 ease-out shadow-[0_0_50px_rgba(0,0,0,0.5)] flex flex-col fixed top-0 right-0 z-[100] w-full sm:w-96 ${g()?"translate-x-0":"translate-x-full"}`),D(s,N),D(t,`${d().length??""} ${$??""}`),D(ae,` ${S??""}`)},[()=>l()("character.history.title"),()=>l()("character.history.rolls_count"),()=>l()("character.history.clear")]),w(c,p),Be(),x()}qe(["click"]);function ht(c,n,l){return c>=n*l?{width:n*l,height:n}:{width:c,height:c/l}}function rt(c,n,l,d){return{x:gt(c.x,n.width,l.width,d),y:gt(c.y,n.height,l.height,d)}}function gt(c,n,l,d){let u=n*d/2-l/2;return d<1&&(u=l/2-n*d/2),Math.min(u,Math.max(c,-u))}function bt(c,n){return Math.sqrt(Math.pow(c.y-n.y,2)+Math.pow(c.x-n.x,2))}function Nr(c,n,l,d,u,x=!0){const g=x?Tr:Br,p={x:g(100,((n.width-l.width/u)/2-c.x/u)/n.width*100),y:g(100,((n.height-l.height/u)/2-c.y/u)/n.height*100),width:g(100,l.width/n.width*100/u),height:g(100,l.height/n.height*100/u)},R=g(n.naturalWidth,p.width*n.naturalWidth/100,!0),j=g(n.naturalHeight,p.height*n.naturalHeight/100,!0),M=n.naturalWidth>=n.naturalHeight*d?{width:Math.round(j*d),height:j}:{width:R,height:Math.round(R/d)},_={...M,x:g(n.naturalWidth-M.width,p.x*n.naturalWidth/100,!0),y:g(n.naturalHeight-M.height,p.y*n.naturalHeight/100,!0)};return{croppedAreaPercentages:p,croppedAreaPixels:_}}function Tr(c,n,l=!1){const d=l?Math.round(n):n;return Math.min(c,Math.max(0,d))}function Br(c,n){return n}function pt(c,n){return{x:(n.x+c.x)/2,y:(n.y+c.y)/2}}var Dr=E('<div data-testid="cropper"></div>'),zr=E('<div class="svelte-easy-crop-container svelte-1yetlj5" role="button" data-testid="container"><img class="svelte-easy-crop-image svelte-1yetlj5" alt=""/> <!></div>');function jr(c,n){Te(n,!0);let l=W(n,"crop",31,()=>Ue({x:0,y:0})),d=W(n,"zoom",15,1),u=W(n,"minZoom",11,1),x=W(n,"maxZoom",11,3),g=W(n,"aspect",3,4/3),p=W(n,"cropSize",3,null),R=W(n,"cropShape",3,"rect"),j=W(n,"showGrid",3,!0),I=W(n,"zoomSpeed",3,1),M=W(n,"crossOrigin",3,null),_=W(n,"restrictPosition",3,!0),y=W(n,"tabindex",3,void 0),C=z(null),L=z(Ue({width:0,height:0,naturalWidth:0,naturalHeight:0})),h=z(null),s=z(null),o=z(null),t=z(Ue({x:0,y:0})),e=z(Ue({x:0,y:0})),a=z(0),r=z(null),P=z(null);_t(()=>{i(o)&&i(o).complete&&B(),i(h)&&(i(h).addEventListener("gesturestart",k),i(h).addEventListener("gesturechange",k))}),it(()=>{i(h)&&(i(h).removeEventListener("gesturestart",k),i(h).removeEventListener("gesturechange",k)),q()});const k=b=>b.preventDefault(),q=()=>{typeof document<"u"&&(document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",K),document.removeEventListener("touchmove",ce),document.removeEventListener("touchend",K))},B=()=>{H(),ge()},Z=()=>p()?p().width/p().height:g(),H=()=>{i(o)&&(m(L,{width:i(o).width,height:i(o).height,naturalWidth:i(o).naturalWidth,naturalHeight:i(o).naturalHeight},!0),m(C,p()?p():ht(i(o).width,i(o).height,g()),!0)),i(h)&&m(s,i(h).getBoundingClientRect(),!0)},ae=b=>({x:Number(b.clientX),y:Number(b.clientY)}),N=b=>({x:Number(b.clientX),y:Number(b.clientY)}),$=b=>{b.preventDefault(),document.addEventListener("mousemove",S),document.addEventListener("mouseup",K),he(ae(b))},S=b=>Y(ae(b)),ne=b=>{b.preventDefault(),document.addEventListener("touchmove",ce,{passive:!1}),document.addEventListener("touchend",K),b.touches.length===2?Q(b):b.touches.length===1&&he(N(b.touches[0]))},ce=b=>{b.preventDefault(),b.touches.length===2?ue(b):b.touches.length===1&&Y(N(b.touches[0]))},he=({x:b,y:T})=>{m(t,{x:b,y:T},!0),m(e,{x:l().x,y:l().y},!0)},Y=({x:b,y:T})=>{i(r)&&window.cancelAnimationFrame(i(r)),m(r,window.requestAnimationFrame(()=>{if(b===void 0||T===void 0||!i(C))return;const G=b-i(t).x,be=T-i(t).y,O={x:i(e).x+G,y:i(e).y+be};l(_()?rt(O,i(L),i(C),d()):O)}),!0)},K=()=>{q(),ge()},Q=b=>{const T=N(b.touches[0]),G=N(b.touches[1]);m(a,bt(T,G),!0),he(pt(T,G))},ue=b=>{const T=N(b.touches[0]),G=N(b.touches[1]),be=pt(T,G);Y(be),i(P)&&window.cancelAnimationFrame(i(P)),m(P,window.requestAnimationFrame(()=>{const O=bt(T,G),V=d()*(O/i(a));ye(V,be),m(a,O,!0)}),!0)},ee=b=>{b.preventDefault();const T=ae(b),G=d()-b.deltaY*I()/200;ye(G,T)},le=({x:b,y:T})=>{if(!i(s))throw new Error("The Cropper is not mounted");return{x:i(s).width/2-(b-i(s).left),y:i(s).height/2-(T-i(s).top)}},se=({x:b,y:T})=>({x:(b+l().x)/d(),y:(T+l().y)/d()}),ye=(b,T)=>{if(!i(C))return;const G=le(T),be=se(G);d(Math.min(x(),Math.max(b,u())));const O={x:be.x*d()-G.x,y:be.y*d()-G.y};l(_()?rt(O,i(L),i(C),d()):O)},ge=()=>{if(!i(C)||i(C).width===0)return;const b=_()?rt(l(),i(L),i(C),d()):l(),{croppedAreaPercentages:T,croppedAreaPixels:G}=Nr(b,i(L),i(C),Z(),d(),_());n.oncropcomplete?.({percent:T,pixels:G})};We(()=>{i(o)&&m(C,p()?p():ht(i(o).width,i(o).height,g()),!0)}),We(()=>{d()&&ge()});const fe=b=>{We(()=>(b.addEventListener("touchstart",ne),b.addEventListener("mousedown",$),b.addEventListener("wheel",ee,{passive:!1}),()=>{b.removeEventListener("touchstart",ne),b.removeEventListener("mousedown",$),b.removeEventListener("wheel",ee)}))};var re=zr();Ye("resize",Lt,H);var ie=v(re);ke(ie,b=>m(o,b),()=>i(o));var Le=A(ie,2);{var ve=b=>{var T=Dr();let G;U(()=>{G=xe(T,1,"svelte-easy-crop-area svelte-1yetlj5",null,G,{"svelte-easy-crop-round":R()==="round","svelte-easy-crop-grid":j()}),Ke(T,`width: ${i(C).width??""}px; height: ${i(C).height??""}px;`)}),w(b,T)};F(Le,b=>{i(C)&&b(ve)})}f(re),ke(re,b=>m(h,b),()=>i(h)),Zt(re,b=>fe?.(b)),U(()=>{_e(re,"tabindex",y()),_e(ie,"src",n.image),Ke(ie,`transform: translate(${l().x??""}px, ${l().y??""}px) scale(${d()??""});`),_e(ie,"crossorigin",M())}),Ye("load",ie,B),Nt(ie),w(c,re),Be()}const Or=c=>new Promise((n,l)=>{const d=new Image;d.addEventListener("load",()=>n(d)),d.addEventListener("error",u=>l(u)),d.setAttribute("crossOrigin","anonymous"),d.src=c});function Et(c){return c*Math.PI/180}function Ur(c,n,l){const d=Et(l);return{width:Math.abs(Math.cos(d)*c)+Math.abs(Math.sin(d)*n),height:Math.abs(Math.sin(d)*c)+Math.abs(Math.cos(d)*n)}}async function Fr(c,n,l=0,d={horizontal:!1,vertical:!1}){const u=await Or(c),x=document.createElement("canvas"),g=x.getContext("2d");if(!g)return null;const p=Et(l),{width:R,height:j}=Ur(u.width,u.height,l);x.width=R,x.height=j,g.translate(R/2,j/2),g.rotate(p),g.scale(d.horizontal?-1:1,d.vertical?-1:1),g.translate(-u.width/2,-u.height/2),g.drawImage(u,0,0);const I=g.getImageData(n.x,n.y,n.width,n.height);return x.width=n.width,x.height=n.height,g.putImageData(I,0,0),new Promise((M,_)=>{x.toBlob(y=>{M(y)},"image/jpeg",.8)})}var kr=E('<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Processando...',1),Hr=E("<!> Salvar Foto",1),Gr=E('<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4 animate-in fade-in duration-200" role="dialog" aria-modal="true"><div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl flex flex-col shadow-2xl overflow-hidden max-h-[90vh]"><div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950"><h3 class="font-bold text-white flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-indigo-500"></div> Editar Imagem</h3> <button class="text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-800 transition-colors"><!></button></div> <div class="relative flex-1 bg-black min-h-[400px]"><!></div> <div class="p-4 bg-slate-950 border-t border-slate-800 space-y-4"><div class="flex items-center gap-4"><div class="flex items-center gap-2 text-slate-400 w-full px-4"><!> <input type="range" min="1" max="3" step="0.1" class="w-full accent-indigo-500 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer"/></div></div> <div class="flex justify-end gap-3 pt-2"><button class="px-6 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-bold transition-all text-sm border border-slate-700">Cancelar</button> <button class="px-8 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold transition-all text-sm shadow-lg shadow-indigo-900/20 flex items-center gap-2"><!></button></div></div></div></div>');function wa(c,n){Te(n,!0);let l=W(n,"isOpen",3,!1),d=W(n,"imageUrl",3,""),u=W(n,"aspectRatio",3,1),x=z(Ue({x:0,y:0})),g=z(1),p=z(null),R=z(!1);async function j(){if(console.log("handleSave called",{isProcessing:i(R),pixelCrop:i(p)}),!(i(R)||!i(p))){m(R,!0);try{console.log("Calling getCroppedImg with",{imageUrl:d().substring(0,50)+"...",pixelCrop:i(p)});const y=await Fr(d(),i(p),0);console.log("getCroppedImg result:",y),y&&n.onCrop(y)}catch(y){console.error("Error in handleSave:",y)}finally{m(R,!1)}}}var I=de(),M=J(I);{var _=y=>{var C=Gr(),L=v(C),h=v(L),s=A(v(h),2);s.__click=function(...S){n.onClose?.apply(this,S)};var o=v(s);Mt(o,{size:20}),f(s),f(h);var t=A(h,2),e=v(t);jr(e,{get image(){return d()},get aspect(){return u()},oncropcomplete:S=>{console.log("oncropcomplete prop data:",S),m(p,S.pixels,!0)},showGrid:!0,get crop(){return i(x)},set crop(S){m(x,S,!0)},get zoom(){return i(g)},set zoom(S){m(g,S,!0)}}),f(t);var a=A(t,2),r=v(a),P=v(r),k=v(P);qt(k,{size:16});var q=A(k,2);Bt(q),f(P),f(r);var B=A(r,2),Z=v(B);Z.__click=function(...S){n.onClose?.apply(this,S)};var H=A(Z,2);H.__click=j;var ae=v(H);{var N=S=>{var ne=kr();at(),w(S,ne)},$=S=>{var ne=Hr(),ce=J(ne);$t(ce,{size:18}),at(),w(S,ne)};F(ae,S=>{i(R)?S(N):S($,!1)})}f(H),f(B),f(a),f(L),f(C),U(()=>H.disabled=i(R)),Ht(q,()=>i(g),S=>m(g,S)),w(y,C)};F(M,y=>{l()&&y(_)})}w(c,I),Be()}qe(["click"]);var Wr=E('<span class="text-[10px] text-indigo-300 uppercase font-bold mb-2 block"> </span>'),Zr=E('<div><!> <div class="flex items-center justify-between bg-black/40 rounded-xl p-1.5 border border-white/5" role="group"><button type="button" class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-all active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <div class="flex flex-col items-center min-w-[3rem]"><span class="text-2xl font-black text-white leading-none tracking-tighter" data-testid="size-display"> </span></div> <button type="button" class="w-10 h-10 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition-all active:scale-90 shadow-lg shadow-indigo-500/20 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div></div>');function Aa(c,n){Te(n,!0);const l=()=>Ze(ot,"$t",d),[d,u]=st(),x=[.125,.5,...Array.from({length:20},(e,a)=>a+1)];function g(){const e=x.indexOf(n.value);if(e>0)n.onUpdate(x[e-1]);else if(e===-1){const a=x.slice().reverse().find(r=>r<n.value);a?n.onUpdate(a):n.onUpdate(x[0])}}function p(){const e=x.indexOf(n.value);if(e!==-1&&e<x.length-1)n.onUpdate(x[e+1]);else if(e===-1){const a=x.find(r=>r>n.value);a?n.onUpdate(a):n.onUpdate(x[x.length-1])}}function R(e){return e===.125?"1/8":e===.5?"1/2":e.toString()}var j=Zr(),I=v(j);{var M=e=>{var a=Wr(),r=v(a,!0);f(a),U(()=>D(r,n.label)),w(e,a)};F(I,e=>{n.label&&e(M)})}var _=A(I,2),y=v(_);y.__click=g;var C=v(y);Ct(C,{size:18}),f(y);var L=A(y,2),h=v(L),s=v(h,!0);f(h),f(L);var o=A(L,2);o.__click=p;var t=v(o);At(t,{size:18}),f(o),f(_),f(j),U((e,a,r,P)=>{_e(_,"aria-label",e),_e(y,"aria-label",a),y.disabled=n.value<=x[0],D(s,r),_e(o,"aria-label",P),o.disabled=n.value>=x[x.length-1]},[()=>l()("common.labels.size_selector"),()=>l()("common.buttons.decrease"),()=>R(n.value),()=>l()("common.buttons.increase")]),w(c,j),Be(),u()}qe(["click"]);export{va as A,oa as B,la as C,pa as D,da as E,ca as G,ya as H,wa as I,ua as L,Ct as M,fa as R,Aa as S,_a as T,ga as W,Zt as a,xa as b,sa as c,ct as d,ha as e,ba as f,ma as s};
