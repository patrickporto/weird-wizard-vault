import"./DsnmJJEf.js";import"./B6lYapqp.js";import{F as Ct,I as gt,B as le,o as Q,k as w,x as o,y as U,w as m,z as Ie,p as Pe,j as C,q as f,A as v,t as z,v as Re,u as A,a2 as De,O as Ue,ad as bt,L as it,n as tt,bt as Et}from"./X4qjwA50.js";import{I as ye,s as we}from"./CRJZpbrG.js";import{l as Ae,s as Me,p as V,i as G}from"./BGpg0XVn.js";import{g as It,o as pt,p as at,s as D,d as Ge,q as mt,e as Ve,r as St}from"./JmLgoKLb.js";import{s as xe,g as Xe,$ as nt,a as _e,e as Ye,i as xt,j as Nt,r as Pt}from"./Da70ei3y.js";import{b as je}from"./BpzvJAE_.js";import{a as ot,s as He}from"./CjDeeOcX.js";import{f as Rt,g as Lt,M as Tt,P as _t,D as Bt,X as yt,b as Dt}from"./CMwilp5d.js";import{v as rt,x as ze,t as zt,y as jt,b as Ot}from"./BPjVGcEY.js";import{r as Ft,C as wt}from"./CNM1CDlp.js";import{t as kt,s as Ut}from"./J-RRPI-t.js";function Ht(c,n,l){Ct(()=>{var d=gt(()=>n(c,l?.())||{});if(d?.destroy)return()=>d.destroy()})}function ia(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 18V5"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"}]];ye(c,Me({name:"brain"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function sa(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18"}],["path",{d:"M16 10h.01"}],["path",{d:"M12 10h.01"}],["path",{d:"M8 10h.01"}],["path",{d:"M12 14h.01"}],["path",{d:"M8 14h.01"}],["path",{d:"M12 18h.01"}],["path",{d:"M8 18h.01"}]];ye(c,Me({name:"calculator"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function la(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]];ye(c,Me({name:"camera"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function da(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];ye(c,Me({name:"clock"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function ca(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];ye(c,Me({name:"eye"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function ua(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M9 10h.01"}],["path",{d:"M15 10h.01"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"}]];ye(c,Me({name:"ghost"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function st(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}],["path",{d:"M12 7v5l4 2"}]];ye(c,Me({name:"history"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function va(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1"}]];ye(c,Me({name:"layout-dashboard"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function At(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M5 12h14"}]];ye(c,Me({name:"minus"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function fa(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];ye(c,Me({name:"rotate-ccw"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}function Gt(c,n){const l=Ae(n,["children","$$slots","$$events","$$legacy"]);const d=[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]];ye(c,Me({name:"zoom-in"},()=>l,{get iconNode(){return d},children:(u,x)=>{var h=le(),p=Q(h);we(p,n,"default",{}),w(u,h)},$$slots:{default:!0}}))}const ha={Blinded:{effect:"Make rolls with 3 banes. No sight reactions. Speed halved.",speedMult:.5,rollMod:-3},Confused:{effect:"No reactions. Intellect and Will rolls with 1 bane.",rollMod:-1,attributes:["int","wil"]},Controlled:{effect:"Controller decides your turn. Regard source as ally."},Cursed:{effect:"Luck rolls with 1 bane."},Deafened:{effect:"No hearing reactions. Immune to hearing effects."},Frightened:{effect:"Attribute rolls with 1 bane (while in LOS). Grant 1 boon on rolls against you.",rollMod:-1},Held:{effect:"Speed 0. Cannot increase Speed. Auto-fail Agility defense rolls.",speedFixed:0},Impaired:{effect:"Roll with 1 bane for specified attribute. Grant 1 boon against that attribute.",rollMod:-1},Incapacitated:{effect:"Damage equals or exceeds Health. You cannot use actions or reactions. Speed 0.",speedFixed:0},"On Fire":{effect:"Take 1d6 damage at end of round. Action/Luck roll to extinguish."},Poisoned:{effect:"Attribute rolls with 1 bane. Grant 1 boon against you. Lose 1d6 Health end of round.",rollMod:-1},Prone:{effect:"No reactions. Grant 1 boon to melee vs you, impose 1 bane to ranged vs you."},Slowed:{effect:"Speed drops to 2 (if higher). Cannot benefit from Speed increases.",speedCap:2},Stunned:{effect:"No actions/reactions. Speed 0. Grant 2 boons against you. Attribute rolls with 2 banes.",speedFixed:0,rollMod:-2},Unconscious:{effect:"No actions/reactions. Speed 0. Grant 3 boons against you. Auto-fail attribute rolls.",speedFixed:0,autoFail:!0},Vulnerable:{effect:"Grant 1 boon on attacks/rolls against you."},Weakened:{effect:"Strength/Agility rolls with 1 bane. Grant 1 boon vs Str/Agi. Speed halved.",speedMult:.5,attributes:["str","agi"],rollMod:-1}},ga={OFF:"Off",ONE:"One",TWO:"Two"},ba=["NIMBLE","FIREARM","THROWN","BRUTAL","BLUDGEONING","SLASHING","DISARMING","RANGE","SPECIAL","MISFIRE","LARGE","SLOW","LIGHT","LONG","AMMUNITION","PIERCING","RELOAD","VERSATILE"],pa={ANCESTRY:"Ancestry",NOVICE:"Novice",EXPERT:"Expert",MASTER:"Master"};function lt(c){const n=Rt[c];return n?{theme_surface:c,theme_customColorset:n.dice,theme_colorset:c}:{}}function Wt(){let c=U(null),n=U("idle"),l=U(null),d=U(null),u=U(null);rt.subscribe(_=>{o(c)&&_.diceTheme&&o(c).updateConfig(lt(_.diceTheme))});const x=Ie(()=>o(n)==="ready"),h=Ie(()=>o(n)==="rolling");async function p(_){if(!(o(c)||o(n)==="initializing")){m(l,_,!0),m(n,"initializing"),m(u,null);try{const y=It(rt);m(c,new Lt(_,{assetPath:Ft("/"),...lt(y.diceTheme||"default"),shadows:!0}),!0),await o(c).initialize(),m(n,"ready")}catch(y){console.error("Failed to initialize DiceBox:",y),m(u,y instanceof Error?y.message:"Unknown error",!0),m(n,"error")}}}async function R(_){if(!o(c)||o(n)!=="ready")throw new Error("DiceBox is not initialized");m(n,"rolling"),m(u,null);try{const y=await o(c).roll(_);return m(d,y,!0),m(n,"ready"),y}catch(y){throw console.error("Roll failed:",y),m(u,y instanceof Error?y.message:"Roll failed",!0),m(n,"ready"),y}}async function H({dicePool:_}){const y=_.map(({shape:g})=>`1${g}`).join("+"),S=_.map(({value:g})=>g).filter(Boolean),L=S.length>0?`${y}@${S.join(",")}`:y;return R(L)}async function N(){if(o(c))try{await o(c).clear(),m(d,null)}catch(_){console.error("Clear failed:",_)}}function M(){o(c)&&(o(c).clear(),m(c,null)),m(l,null),m(n,"idle"),m(d,null),m(u,null)}return{get status(){return o(n)},get isReady(){return o(x)},get isRolling(){return o(h)},get lastResults(){return o(d)},get error(){return o(u)},get container(){return o(l)},initialize:p,roll:R,rollPool:H,clear:N,dispose:M}}const Be=Wt();var Zt=C('<div class="dice-overlay svelte-10rxhsn"><div class="dice-loader svelte-10rxhsn"><span class="loader-spinner svelte-10rxhsn"></span> <span>Loading dice...</span></div></div>'),qt=C('<small class="svelte-10rxhsn"> </small>'),Vt=C('<div class="dice-overlay dice-error svelte-10rxhsn"><span>Failed to load dice</span> <!></div>'),Xt=C('<div role="img" aria-label="3D Dice Roller"><!></div>');function Yt(c,n){Pe(n,!0);let l=V(n,"height",3,400),d=V(n,"class",3,""),u,x=U(!1);const h=Ie(()=>Be.status),p=Ie(()=>Be.error);pt(async()=>{m(x,!0),u&&await Be.initialize(u)}),at(()=>{Be.dispose()});async function R(g){const s=await Be.roll(g);return n.onRollComplete?.(s),s}async function H(){await Be.clear()}var N={roll:R,clear:H},M=Xt();let _;var y=f(M);{var S=g=>{var s=Zt();w(g,s)},L=g=>{var s=le(),i=Q(s);{var t=e=>{var a=Vt(),r=A(f(a),2);{var T=W=>{var X=qt(),F=f(X,!0);v(X),z(()=>D(F,o(p))),w(W,X)};G(r,W=>{o(p)&&W(T)})}v(a),w(e,a)};G(i,e=>{o(h)==="error"&&e(t)},!0)}w(g,s)};G(y,g=>{o(h)==="initializing"?g(S):g(L,!1)})}return v(M),je(M,g=>u=g,()=>u),z(()=>{xe(M,1,`dice-roller ${d()??""}`,"svelte-10rxhsn"),_=Xe(M,"",_,{height:`${l()??""}px`})}),w(c,M),Re(N)}var Kt=C('<div class="absolute inset-0 bg-transparent z-10"></div>'),Jt=C('<div class="rounded-2xl overflow-hidden border border-white/10 relative h-[300px]"><!> <!></div>'),Qt=C('<div class="mt-2 text-sm text-slate-400 font-mono bg-black/30 py-1 px-3 rounded-full inline-block border border-white/5"> </div>'),er=C('<div class="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500"><div class="bg-slate-900/80 p-6 rounded-2xl border border-white/10 text-center shadow-lg relative overflow-hidden group"><div class="absolute inset-0 bg-indigo-500/10 blur-xl"></div> <div class="relative z-10"><div class="text-xs text-slate-400 uppercase tracking-widest font-bold mb-2"> </div> <div class="text-5xl font-black text-white tracking-tighter drop-shadow-lg scale-110 transform transition-transform duration-300"> </div> <!></div></div> <button class="w-full bg-slate-800 hover:bg-slate-700 text-white font-black py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg transition-all active:scale-[0.98] uppercase tracking-widest text-sm border border-slate-700"><!> </button></div>'),tr=C('<div class="flex flex-col items-center"><div class="text-xs font-black text-slate-500 uppercase tracking-widest mb-2"> </div> <div class="text-2xl font-mono font-bold text-white bg-slate-950/50 px-4 py-2 rounded-lg border border-white/10 shadow-inner"> </div></div>'),rr=C('<button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-red-500/20 text-slate-300 hover:text-red-400 border border-slate-700 hover:border-red-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <div class="flex flex-col items-center min-w-[100px]"><span> </span></div> <button class="w-12 h-12 rounded-full bg-slate-800 hover:bg-green-500/20 text-slate-300 hover:text-green-400 border border-slate-700 hover:border-green-500/30 flex items-center justify-center transition-all active:scale-90 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"><!></button>',1),ar=C('<div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] relative z-10"> </div>'),nr=C('<div class="w-2 h-2 bg-white rounded-sm"></div>'),or=C('<span class="text-[9px] text-slate-400 bg-slate-800 px-1 rounded"> </span>'),ir=C('<div class="flex flex-wrap gap-1 mt-1"></div>'),sr=C('<button><div class="flex items-center gap-3"><div><!></div> <div><span class="text-sm font-bold text-slate-200 block leading-tight"> </span> <!></div></div></button>'),lr=C('<div class="space-y-2"><h4 class="text-xs font-bold text-slate-500 uppercase px-1"> </h4> <div class="grid grid-cols-1 gap-2 max-h-[150px] overflow-y-auto pr-1 custom-scrollbar"></div></div>'),dr=C('<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> <span> </span>',1),cr=C("<!> ",1),ur=C('<div class="bg-slate-900/50 p-6 rounded-2xl border border-white/5 text-center shadow-inner relative overflow-hidden group"><div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div> <div class="flex justify-center items-center gap-8 mb-4 relative z-10"><!></div> <!></div> <!> <!> <button class="w-full bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-700 text-white font-black py-4 rounded-xl flex items-center justify-center gap-3 shadow-lg shadow-indigo-600/20 transition-all active:scale-[0.98] uppercase tracking-widest text-sm disabled:cursor-not-allowed"><!></button>',1),vr=C('<div class="space-y-6"><!> <!></div>');function ma(c,n){Pe(n,!0);const l=()=>He(nt,"$t",u),d=()=>He(rt,"$appSettings",u),[u,x]=ot();let h=V(n,"initialModifier",3,0),p=V(n,"effects",19,()=>[]);const R=Ie(()=>n.label||l()("common.labels.boons_banes")),H=Ie(()=>n.rollLabel||l()("common.buttons.roll"));let N=U(0),M=U(De([])),_,y=U(!1),S=U(null),L=U(void 0),g;const s=Ie(()=>d().enable3DDice);Ue(()=>(n.isOpen?(gt(()=>{o(S)||(m(N,h()),m(M,p().map(F=>F.id),!0))}),m(y,!1)):(i(),m(M,[],!0),m(S,null)),()=>i()));function i(){g&&clearTimeout(g),m(L,void 0)}function t(F){o(M).includes(F)?m(M,o(M).filter(q=>q!==F),!0):m(M,[...o(M),F],!0)}function e(F,q=[],Z=[]){if(F!==void 0){const de=q.length,B=[F,...q].join(",");if(de===0)return`1d20@${F}`;const E=o(N)>0?"boon":o(N)<0?"bane":"",P=E?`[${E}]`:"";return`1d20+${de}d6${P}@${B}`}return Z.length>0?`${Z.length}d6@${Z.join(",")}`:""}async function a(){const F=p().filter(Z=>o(M).includes(Z.id)),q=n.onRoll(o(N),F,{suppressHistory:!0});if(q){if(m(y,!0),o(s)&&_)try{const Z=q.notation||e(q.d20,q.boonBaneDice,q.damageDice);Z&&(await _.roll(Z),await new Promise(de=>setTimeout(de,500)))}catch(Z){console.error("3D dice roll failed:",Z)}else await new Promise(Z=>setTimeout(Z,200));m(y,!1),m(S,q,!0),q.commit&&m(L,q.commit,!0),g=setTimeout(()=>{r()},2500)}else n.onClose()}function r(){g&&clearTimeout(g),o(L)&&(o(L)(),m(L,void 0)),n.onClose(),setTimeout(()=>{m(S,null)},300)}var T=le(),W=Q(T);{var X=F=>{{let q=Ie(()=>o(S)?l()("common.labels.result"):n.title);Tt(F,{get isOpen(){return n.isOpen},onClose:r,get title(){return o(q)},children:(Z,de)=>{var B=vr(),E=f(B);{var P=Y=>{var ee=Jt(),re=f(ee);je(Yt(re,{height:300}),ce=>_=ce,()=>_);var ve=A(re,2);{var fe=ce=>{var he=Kt();w(ce,he)};G(ve,ce=>{o(y)&&ce(fe)})}v(ee),w(Y,ee)};G(E,Y=>{o(s)&&Y(P)})}var oe=A(E,2);{var ue=Y=>{var ee=er(),re=f(ee),ve=A(f(re),2),fe=f(ve),ce=f(fe,!0);v(fe);var he=A(fe,2),Se=f(he,!0);v(he);var be=A(he,2);{var Ce=pe=>{var b=Qt(),j=f(b,!0);v(b),z(()=>D(j,o(S).formula)),w(pe,b)};G(be,pe=>{o(S).formula&&pe(Ce)})}v(ve),v(re);var ne=A(re,2);ne.__click=r;var ie=f(ne);wt(ie,{size:20});var $e=A(ie);v(ne),v(ee),z((pe,b)=>{D(ce,pe),D(Se,o(S).total),D($e,` ${b??""}`)},[()=>l()("common.labels.total"),()=>l()("common.buttons.close")]),w(Y,ee)},ge=Y=>{var ee=ur(),re=Q(ee),ve=A(f(re),2),fe=f(ve);{var ce=I=>{var O=tr(),$=f(O),k=f($,!0);v($);var K=A($,2),se=f(K,!0);v(K),v(O),z(J=>{D(k,J),D(se,n.customFormula)},[()=>l()("common.labels.formula")]),w(I,O)},he=I=>{var O=rr(),$=Q(O);$.__click=()=>it(N,-1);var k=f($);At(k,{size:24}),v($);var K=A($,2),se=f(K),J=f(se);v(se),v(K);var te=A(K,2);te.__click=()=>it(N);var Le=f(te);_t(Le,{size:24}),v(te),z((Ee,Oe)=>{_e($,"aria-label",Ee),$.disabled=o(y),xe(se,1,`text-5xl font-black ${o(N)>0?"text-green-400":o(N)<0?"text-red-400":"text-slate-500"} tabular-nums drop-shadow-sm transition-colors duration-300`),D(J,`${o(N)>0?"+":""}${o(N)??""}`),_e(te,"aria-label",Oe),te.disabled=o(y)},[()=>l()("common.buttons.decrease"),()=>l()("common.buttons.increase")]),w(I,O)};G(fe,I=>{n.customFormula?I(ce):I(he,!1)})}v(ve);var Se=A(ve,2);{var be=I=>{var O=ar(),$=f(O,!0);v(O),z(()=>D($,o(R))),w(I,O)};G(Se,I=>{n.customFormula||I(be)})}v(re);var Ce=A(re,2);{var ne=I=>{var O=lr(),$=f(O),k=f($,!0);v($);var K=A($,2);Ye(K,21,p,se=>se.id,(se,J)=>{var te=sr();te.__click=()=>t(o(J).id);var Le=f(te),Ee=f(Le),Oe=f(Ee);{var We=me=>{var ae=nr();w(me,ae)};G(Oe,me=>{o(M).includes(o(J).id)&&me(We)})}v(Ee);var Te=A(Ee,2),Fe=f(Te),ke=f(Fe,!0);v(Fe);var Ze=A(Fe,2);{var Ke=me=>{var ae=ir();Ye(ae,21,()=>o(J).modifiers,xt,(Ne,qe)=>{var Je=or(),$t=f(Je);v(Je),z(()=>D($t,`${o(qe).target??""}: ${o(qe).value??""}`)),w(Ne,Je)}),v(ae),w(me,ae)};G(Ze,me=>{o(J).modifiers&&o(J).modifiers.length>0&&me(Ke)})}v(Te),v(Le),v(te),z((me,ae)=>{xe(te,1,`flex items-center justify-between p-3 rounded-lg border transition-all text-left ${me??""}`),te.disabled=o(y),xe(Ee,1,`w-4 h-4 rounded border flex items-center justify-center transition-colors ${ae??""}`),D(ke,o(J).name)},[()=>o(M).includes(o(J).id)?"bg-indigo-900/30 border-indigo-500/50 shadow-sm":"bg-slate-900/50 border-slate-800 opacity-60 hover:opacity-100 hover:border-slate-700",()=>o(M).includes(o(J).id)?"bg-indigo-500 border-indigo-400":"border-slate-600 bg-slate-900"]),w(se,te)}),v(K),v(O),z(se=>D(k,se),[()=>l()("character.effects.active")]),w(I,O)};G(Ce,I=>{p().length>0&&I(ne)})}var ie=A(Ce,2);mt(ie,()=>n.children??bt);var $e=A(ie,2);$e.__click=a;var pe=f($e);{var b=I=>{var O=dr(),$=A(Q(O),2),k=f($);v($),z(K=>D(k,`${K??""}...`),[()=>l()("character.modals.rolling")]),w(I,O)},j=I=>{var O=cr(),$=Q(O);Bt($,{size:18});var k=A($);z(()=>D(k,` ${o(H)??""}`)),w(I,O)};G(pe,I=>{o(y)?I(b):I(j,!1)})}v($e),z(()=>$e.disabled=o(y)),w(Y,ee)};G(oe,Y=>{o(S)?Y(ue):Y(ge,!1)})}v(B),w(Z,B)},$$slots:{default:!0}})}};G(W,F=>{n.isOpen&&F(X)})}w(c,T),Re(),x()}Ge(["click"]);var Qe={exports:{}},dt;function fr(){return dt||(dt=1,(function(c,n){(function(l){c.exports=l()})(function(l){var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function u(s,i){var t=s[0],e=s[1],a=s[2],r=s[3];t+=(e&a|~e&r)+i[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[1]-389564586|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[2]+606105819|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[3]-1044525330|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+i[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[6]-1473231341|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[7]-45705983|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+i[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[10]-42063|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[11]-1990404162|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+i[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+i[13]-40341101|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+i[14]-1502002290|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+i[15]+1236535329|0,e=(e<<22|e>>>10)+a|0,t+=(e&r|a&~r)+i[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[11]+643717713|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[0]-373897302|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+i[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[10]+38016083|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[15]-660478335|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[4]-405537848|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+i[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[3]-187363961|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[8]+1163531501|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+i[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+i[2]-51403784|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+i[7]+1735328473|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+i[12]-1926607734|0,e=(e<<20|e>>>12)+a|0,t+=(e^a^r)+i[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[11]+1839030562|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[14]-35309556|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+i[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[7]-155497632|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[10]-1094730640|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+i[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[0]-358537222|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[3]-722521979|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[6]+76029189|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+i[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+i[12]-421815835|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+i[15]+530742520|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+i[2]-995338651|0,e=(e<<23|e>>>9)+a|0,t+=(a^(e|~r))+i[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[14]-1416354905|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[5]-57434055|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+i[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[10]-1051523|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[1]-2054922799|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+i[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[15]-30611744|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[6]-1560198380|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[13]+1309151649|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+i[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+i[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+i[2]+718787259|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+i[9]-343485551|0,e=(e<<21|e>>>11)+a|0,s[0]=t+s[0]|0,s[1]=e+s[1]|0,s[2]=a+s[2]|0,s[3]=r+s[3]|0}function x(s){var i=[],t;for(t=0;t<64;t+=4)i[t>>2]=s.charCodeAt(t)+(s.charCodeAt(t+1)<<8)+(s.charCodeAt(t+2)<<16)+(s.charCodeAt(t+3)<<24);return i}function h(s){var i=[],t;for(t=0;t<64;t+=4)i[t>>2]=s[t]+(s[t+1]<<8)+(s[t+2]<<16)+(s[t+3]<<24);return i}function p(s){var i=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,T,W,X;for(e=64;e<=i;e+=64)u(t,x(s.substring(e-64,e)));for(s=s.substring(e-64),a=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=s.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return T=i*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),W=parseInt(T[2],16),X=parseInt(T[1],16)||0,r[14]=W,r[15]=X,u(t,r),t}function R(s){var i=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,T,W,X;for(e=64;e<=i;e+=64)u(t,h(s.subarray(e-64,e)));for(s=e-64<i?s.subarray(e-64):new Uint8Array(0),a=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=s[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(u(t,r),e=0;e<16;e+=1)r[e]=0;return T=i*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),W=parseInt(T[2],16),X=parseInt(T[1],16)||0,r[14]=W,r[15]=X,u(t,r),t}function H(s){var i="",t;for(t=0;t<4;t+=1)i+=d[s>>t*8+4&15]+d[s>>t*8&15];return i}function N(s){var i;for(i=0;i<s.length;i+=1)s[i]=H(s[i]);return s.join("")}N(p("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function s(i,t){return i=i|0||0,i<0?Math.max(i+t,0):Math.min(i,t)}ArrayBuffer.prototype.slice=function(i,t){var e=this.byteLength,a=s(i,e),r=e,T,W,X,F;return t!==l&&(r=s(t,e)),a>r?new ArrayBuffer(0):(T=r-a,W=new ArrayBuffer(T),X=new Uint8Array(W),F=new Uint8Array(this,a,T),X.set(F),W)}})();function M(s){return/[\u0080-\uFFFF]/.test(s)&&(s=unescape(encodeURIComponent(s))),s}function _(s,i){var t=s.length,e=new ArrayBuffer(t),a=new Uint8Array(e),r;for(r=0;r<t;r+=1)a[r]=s.charCodeAt(r);return i?a:e}function y(s){return String.fromCharCode.apply(null,new Uint8Array(s))}function S(s,i,t){var e=new Uint8Array(s.byteLength+i.byteLength);return e.set(new Uint8Array(s)),e.set(new Uint8Array(i),s.byteLength),e}function L(s){var i=[],t=s.length,e;for(e=0;e<t-1;e+=2)i.push(parseInt(s.substr(e,2),16));return String.fromCharCode.apply(String,i)}function g(){this.reset()}return g.prototype.append=function(s){return this.appendBinary(M(s)),this},g.prototype.appendBinary=function(s){this._buff+=s,this._length+=s.length;var i=this._buff.length,t;for(t=64;t<=i;t+=64)u(this._hash,x(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},g.prototype.end=function(s){var i=this._buff,t=i.length,e,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)a[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(a,t),r=N(this._hash),s&&(r=L(r)),this.reset(),r},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},g.prototype.setState=function(s){return this._buff=s.buff,this._length=s.length,this._hash=s.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(s,i){var t=i,e,a,r;if(s[t>>2]|=128<<(t%4<<3),t>55)for(u(this._hash,s),t=0;t<16;t+=1)s[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(e[2],16),r=parseInt(e[1],16)||0,s[14]=a,s[15]=r,u(this._hash,s)},g.hash=function(s,i){return g.hashBinary(M(s),i)},g.hashBinary=function(s,i){var t=p(s),e=N(t);return i?L(e):e},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(s){var i=S(this._buff.buffer,s),t=i.length,e;for(this._length+=s.byteLength,e=64;e<=t;e+=64)u(this._hash,h(i.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(i.buffer.slice(e-64)):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(s){var i=this._buff,t=i.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a,r;for(a=0;a<t;a+=1)e[a>>2]|=i[a]<<(a%4<<3);return this._finish(e,t),r=N(this._hash),s&&(r=L(r)),this.reset(),r},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var s=g.prototype.getState.call(this);return s.buff=y(s.buff),s},g.ArrayBuffer.prototype.setState=function(s){return s.buff=_(s.buff,!0),g.prototype.setState.call(this,s)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(s,i){var t=R(new Uint8Array(s)),e=N(t);return i?L(e):e},g})})(Qe)),Qe.exports}var hr=fr();const gr=Nt(hr),ct=5;async function xa(c){if(c.size>ct*1024*1024)throw new Error(`Imagem muito grande. Máximo de ${ct}MB.`);const n=await c.arrayBuffer(),l=gr.ArrayBuffer.hash(n);if(ze.has(l))return l;const d=new FileReader,x=await new Promise((h,p)=>{d.onload=()=>h(d.result),d.onerror=p,d.readAsDataURL(c)});return ze.set(l,x),l}function br(c,n){if(!c)return n(void 0),()=>{};n(ze.get(c));const l=d=>{const u=ze.get(c);n(u)};return ze.observe(l),()=>{ze.unobserve(l)}}var pr=C('<img class="w-full h-full object-cover rounded-full border border-white/10 shadow-sm"/>'),mr=C('<div class="w-full h-full bg-slate-800 rounded-full border border-white/10 flex items-center justify-center font-black text-slate-500 shadow-sm"> </div>'),xr=C("<div><!></div>");function _a(c,n){Pe(n,!0);let l=V(n,"size",3,"md"),d=V(n,"fallbackText",3,"?"),u=U(void 0),x;Ue(()=>{x&&x(),n.hash?x=br(n.hash,M=>{m(u,M,!0)}):m(u,void 0)}),at(()=>{x&&x()});const h={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-16 h-16 text-lg",xl:"w-20 h-20 text-xl",custom:"w-full h-full"};var p=xr(),R=f(p);{var H=M=>{var _=pr();z(()=>{_e(_,"src",o(u)),_e(_,"alt",n.alt)}),w(M,_)},N=M=>{var _=mr(),y=f(_,!0);v(_),z(()=>D(y,d())),w(M,_)};G(R,M=>{o(u)?M(H):M(N,!1)})}v(p),z(()=>xe(p,1,`${h[l()]??""} relative flex-shrink-0`)),w(c,p),Re()}var _r=C('<div class="absolute z-50 bottom-full left-1/2 mb-2 w-max max-w-[200px] p-2 bg-slate-800 border border-indigo-500 rounded-lg shadow-xl shadow-black/50 text-[10px] text-slate-300 leading-relaxed text-center pointer-events-none whitespace-normal -translate-x-1/2" style="margin-left: var(--x-offset);"> <div class="absolute -bottom-1 left-1/2 w-2 h-2 bg-slate-800 border-r border-b border-indigo-500 -translate-x-1/2" style="transform: translateX(calc(-50% - var(--x-offset))) rotate(45deg);"></div></div>'),yr=C('<div role="button" tabindex="0"><!> <!></div>');function ya(c,n){let l=V(n,"text",3,""),d=V(n,"class",3,""),u=U(!1),x=!1,h=U(0),p,R=U(void 0);function H(){if(!p||!o(R))return;const g=p.getBoundingClientRect(),i=o(R).getBoundingClientRect().width/2;m(h,0);const t=g.left+g.width/2-i;t<10&&m(h,10-t);const e=g.left+g.width/2+i;e>window.innerWidth-10&&m(h,window.innerWidth-10-e)}async function N(){x||(m(u,!0),setTimeout(H,0))}function M(g){x&&(o(u)?m(u,!1):(m(u,!0),setTimeout(H,0)))}var _=yr();_.__touchstart=()=>x=!0,_.__click=M,_.__keydown=g=>{(g.key==="Enter"||g.key===" ")&&m(u,!o(u))};var y=f(_);mt(y,()=>n.children??bt);var S=A(y,2);{var L=g=>{var s=_r(),i=f(s);tt(),v(s),je(s,t=>m(R,t),()=>o(R)),z(()=>D(i,`${l()??""} `)),kt(3,s,()=>Ut,()=>({duration:150,start:.95})),w(g,s)};G(S,g=>{o(u)&&l()&&g(L)})}v(_),je(_,g=>p=g,()=>p),z(()=>{xe(_,1,`relative inline-flex ${d()??""}`),Xe(_,`--x-offset: ${o(h)??""}px;`)}),Ve("mouseenter",_,N),Ve("mouseleave",_,()=>!x&&m(u,!1)),w(c,_)}Ge(["touchstart","click","keydown"]);var wr=C('<div class="fixed inset-0 bg-black/50 z-[90] lg:hidden backdrop-blur-sm" role="button" tabindex="-1"></div>'),Ar=C('<div class="flex flex-col items-center justify-center h-full text-slate-600 opacity-50"><div class="w-16 h-16 border-2 border-dashed border-slate-800 rounded-full flex items-center justify-center mb-4"><!></div> <p class="text-sm font-bold uppercase tracking-widest italic"> </p></div>'),Mr=C('<span class="text-[10px] text-white/50 font-black uppercase tracking-tighter"> </span>'),$r=C('<div class="text-[10px] text-slate-400 font-medium italic mt-1 leading-relaxed opacity-80 whitespace-pre-wrap"> </div>'),Cr=C('<span class="text-[8px] font-black uppercase tracking-widest bg-indigo-500/10 text-indigo-300 px-2 py-0.5 rounded-full border border-indigo-500/20"> </span>'),Er=C('<div class="flex flex-wrap gap-1 mb-3"></div>'),Ir=C('<div class="absolute inset-0 bg-yellow-400/5 animate-pulse"></div>'),Sr=C('<span class="text-[10px] animate-bounce">✨</span>'),Nr=C('<div class="relative bg-black/40 rounded-xl p-3 flex justify-between items-center border border-white/5 group-hover:border-white/10 transition-colors overflow-hidden"><!> <div class="flex flex-col"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div class="text-xs font-mono text-indigo-300 font-bold"> </div></div> <div class="flex flex-col items-end"><span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-0.5"> </span> <div> <!></div></div></div>'),Pr=C('<div class="relative bg-slate-800/40 hover:bg-slate-800/60 transition-colors rounded-2xl border border-white/5 p-4 shadow-xl overflow-hidden group animate-in slide-in-from-right-8 duration-300"><div></div> <div class="flex justify-between items-start mb-3"><div class="flex flex-col"><div class="flex items-center gap-2"><span> </span> <!></div></div> <span class="text-[9px] text-slate-500 font-black tracking-widest uppercase"> </span></div> <div class="flex items-center gap-3 mb-2"><div class="flex-1"><div class="font-black text-white text-sm uppercase tracking-tight leading-snug"> </div> <!></div></div> <!> <!></div>'),Rr=C('<!> <aside><div class="px-6 py-5 border-b border-white/5 flex justify-between items-center bg-slate-950/50"><div class="flex items-center gap-3"><div class="p-2 bg-indigo-500/10 rounded-lg border border-indigo-500/20"><!></div> <div><h3 class="font-black text-white uppercase tracking-widest text-sm"> </h3> <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter"> </p></div></div> <button class="p-2 hover:bg-white/5 rounded-full text-slate-400 hover:text-white transition-all active:scale-90"><!></button></div> <div class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 custom-scrollbar"><!> <!></div> <div class="p-6 border-t border-white/5 bg-slate-950/80"><button class="w-full py-3 text-xs font-black uppercase tracking-[0.2em] text-red-400/70 hover:text-red-400 border border-red-900/30 rounded-xl hover:bg-red-900/20 transition-all flex items-center justify-center gap-3 active:scale-[0.98]"><!> </button></div></aside>',1);function wa(c,n){Pe(n,!0);const l=()=>He(nt,"$t",u),d=()=>He(jt,"$rollHistory",u),[u,x]=ot();let h=V(n,"isOpen",3,!1);var p=Rr(),R=Q(p);{var H=B=>{var E=wr();E.__click=function(...P){n.onClose?.apply(this,P)},z(P=>_e(E,"aria-label",P),[()=>l()("character.history.close")]),w(B,E)};G(R,B=>{h()&&B(H)})}var N=A(R,2),M=f(N),_=f(M),y=f(_),S=f(y);st(S,{size:20,class:"text-indigo-400"}),v(y);var L=A(y,2),g=f(L),s=f(g,!0);v(g);var i=A(g,2),t=f(i);v(i),v(L),v(_);var e=A(_,2);e.__click=function(...B){n.onClose?.apply(this,B)};var a=f(e);yt(a,{size:24}),v(e),v(M);var r=A(M,2),T=f(r);{var W=B=>{var E=Ar(),P=f(E),oe=f(P);st(oe,{size:32}),v(P);var ue=A(P,2),ge=f(ue,!0);v(ue),v(E),z(Y=>D(ge,Y),[()=>l()("character.history.none")]),w(B,E)};G(T,B=>{d().length===0&&B(W)})}var X=A(T,2);Ye(X,1,d,B=>B.id,(B,E)=>{const P=Ie(()=>o(E).source?.toLowerCase());var oe=Pr(),ue=f(oe),ge=A(ue,2),Y=f(ge),ee=f(Y),re=f(ee),ve=f(re,!0);v(re);var fe=A(re,2);{var ce=$=>{var k=Mr(),K=f(k,!0);v(k),z(()=>D(K,o(E).charName)),w($,k)};G(fe,$=>{o(E).charName&&o(E).charName!==o(E).source&&$(ce)})}v(ee),v(Y);var he=A(Y,2),Se=f(he,!0);v(he),v(ge);var be=A(ge,2),Ce=f(be),ne=f(Ce),ie=f(ne,!0);v(ne);var $e=A(ne,2);{var pe=$=>{var k=$r(),K=f(k,!0);v(k),z(()=>D(K,o(E).description)),w($,k)};G($e,$=>{o(E).description&&$(pe)})}v(Ce),v(be);var b=A(be,2);{var j=$=>{var k=Er();Ye(k,21,()=>o(E).effectsApplied,xt,(K,se)=>{var J=Cr(),te=f(J,!0);v(J),z(()=>D(te,o(se))),w(K,J)}),v(k),w($,k)};G(b,$=>{o(E).effectsApplied?.length>0&&$(j)})}var I=A(b,2);{var O=$=>{var k=Nr(),K=f(k);{var se=ae=>{var Ne=Ir();w(ae,Ne)};G(K,ae=>{o(E).crit&&ae(se)})}var J=A(K,2),te=f(J),Le=f(te,!0);v(te);var Ee=A(te,2),Oe=f(Ee,!0);v(Ee),v(J);var We=A(J,2),Te=f(We),Fe=f(Te,!0);v(Te);var ke=A(Te,2),Ze=f(ke),Ke=A(Ze);{var me=ae=>{var Ne=Sr();w(ae,Ne)};G(Ke,ae=>{o(E).crit&&ae(me)})}v(ke),v(We),v(k),z((ae,Ne,qe)=>{D(Le,ae),D(Oe,Ne),D(Fe,qe),xe(ke,1,`text-3xl font-black font-mono leading-none flex items-baseline gap-1 ${o(E).crit?"text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.3)]":"text-white"}`),D(Ze,`${o(E).total??""} `)},[()=>l()("character.history.formula"),()=>o(E).formula||l()("character.history.fixed"),()=>l()("character.history.total")]),w($,k)};G(I,$=>{(o(E).formula||o(E).total!==void 0)&&$(O)})}v(oe),z(($,k)=>{xe(ue,1,`absolute left-0 top-0 bottom-0 w-1 ${o(E).source==="GM"?"bg-indigo-500":"bg-emerald-500"}`),xe(re,1,`text-[10px] px-1.5 py-0.5 rounded ${o(E).source==="GM"?"bg-indigo-500/20 text-indigo-400":"bg-emerald-500/20 text-emerald-400"} uppercase font-black tracking-widest leading-none border border-current opacity-70`),D(ve,$),D(Se,k),D(ie,o(E).name)},[()=>l()(`character.history.source.${o(P)}`,{default:o(E).source}),()=>new Date(o(E).timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),w(B,oe)}),v(r);var F=A(r,2),q=f(F);q.__click=function(...B){zt.clearHistory?.apply(this,B)};var Z=f(q);Dt(Z,{size:16});var de=A(Z);v(q),v(F),v(N),z((B,E,P)=>{xe(N,1,`h-full bg-slate-900/95 backdrop-blur-xl border-l border-white/10 transition-all duration-500 ease-out shadow-[0_0_50px_rgba(0,0,0,0.5)] flex flex-col fixed top-0 right-0 z-[100] w-full sm:w-96 ${h()?"translate-x-0":"translate-x-full"}`),D(s,B),D(t,`${d().length??""} ${E??""}`),D(de,` ${P??""}`)},[()=>l()("character.history.title"),()=>l()("character.history.rolls_count"),()=>l()("character.history.clear")]),w(c,p),Re(),x()}Ge(["click"]);function ut(c,n,l){return c>=n*l?{width:n*l,height:n}:{width:c,height:c/l}}function et(c,n,l,d){return{x:vt(c.x,n.width,l.width,d),y:vt(c.y,n.height,l.height,d)}}function vt(c,n,l,d){let u=n*d/2-l/2;return d<1&&(u=l/2-n*d/2),Math.min(u,Math.max(c,-u))}function ft(c,n){return Math.sqrt(Math.pow(c.y-n.y,2)+Math.pow(c.x-n.x,2))}function Lr(c,n,l,d,u,x=!0){const h=x?Tr:Br,p={x:h(100,((n.width-l.width/u)/2-c.x/u)/n.width*100),y:h(100,((n.height-l.height/u)/2-c.y/u)/n.height*100),width:h(100,l.width/n.width*100/u),height:h(100,l.height/n.height*100/u)},R=h(n.naturalWidth,p.width*n.naturalWidth/100,!0),H=h(n.naturalHeight,p.height*n.naturalHeight/100,!0),M=n.naturalWidth>=n.naturalHeight*d?{width:Math.round(H*d),height:H}:{width:R,height:Math.round(R/d)},_={...M,x:h(n.naturalWidth-M.width,p.x*n.naturalWidth/100,!0),y:h(n.naturalHeight-M.height,p.y*n.naturalHeight/100,!0)};return{croppedAreaPercentages:p,croppedAreaPixels:_}}function Tr(c,n,l=!1){const d=l?Math.round(n):n;return Math.min(c,Math.max(0,d))}function Br(c,n){return n}function ht(c,n){return{x:(n.x+c.x)/2,y:(n.y+c.y)/2}}var Dr=C('<div data-testid="cropper"></div>'),zr=C('<div class="svelte-easy-crop-container svelte-1yetlj5" role="button" data-testid="container"><img class="svelte-easy-crop-image svelte-1yetlj5" alt=""/> <!></div>');function jr(c,n){Pe(n,!0);let l=V(n,"crop",31,()=>De({x:0,y:0})),d=V(n,"zoom",15,1),u=V(n,"minZoom",11,1),x=V(n,"maxZoom",11,3),h=V(n,"aspect",3,4/3),p=V(n,"cropSize",3,null),R=V(n,"cropShape",3,"rect"),H=V(n,"showGrid",3,!0),N=V(n,"zoomSpeed",3,1),M=V(n,"crossOrigin",3,null),_=V(n,"restrictPosition",3,!0),y=V(n,"tabindex",3,void 0),S=U(null),L=U(De({width:0,height:0,naturalWidth:0,naturalHeight:0})),g=U(null),s=U(null),i=U(null),t=U(De({x:0,y:0})),e=U(De({x:0,y:0})),a=U(0),r=U(null),T=U(null);pt(()=>{o(i)&&o(i).complete&&F(),o(g)&&(o(g).addEventListener("gesturestart",W),o(g).addEventListener("gesturechange",W))}),at(()=>{o(g)&&(o(g).removeEventListener("gesturestart",W),o(g).removeEventListener("gesturechange",W)),X()});const W=b=>b.preventDefault(),X=()=>{typeof document<"u"&&(document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",ee),document.removeEventListener("touchmove",ue),document.removeEventListener("touchend",ee))},F=()=>{Z(),be()},q=()=>p()?p().width/p().height:h(),Z=()=>{o(i)&&(m(L,{width:o(i).width,height:o(i).height,naturalWidth:o(i).naturalWidth,naturalHeight:o(i).naturalHeight},!0),m(S,p()?p():ut(o(i).width,o(i).height,h()),!0)),o(g)&&m(s,o(g).getBoundingClientRect(),!0)},de=b=>({x:Number(b.clientX),y:Number(b.clientY)}),B=b=>({x:Number(b.clientX),y:Number(b.clientY)}),E=b=>{b.preventDefault(),document.addEventListener("mousemove",P),document.addEventListener("mouseup",ee),ge(de(b))},P=b=>Y(de(b)),oe=b=>{b.preventDefault(),document.addEventListener("touchmove",ue,{passive:!1}),document.addEventListener("touchend",ee),b.touches.length===2?re(b):b.touches.length===1&&ge(B(b.touches[0]))},ue=b=>{b.preventDefault(),b.touches.length===2?ve(b):b.touches.length===1&&Y(B(b.touches[0]))},ge=({x:b,y:j})=>{m(t,{x:b,y:j},!0),m(e,{x:l().x,y:l().y},!0)},Y=({x:b,y:j})=>{o(r)&&window.cancelAnimationFrame(o(r)),m(r,window.requestAnimationFrame(()=>{if(b===void 0||j===void 0||!o(S))return;const I=b-o(t).x,O=j-o(t).y,$={x:o(e).x+I,y:o(e).y+O};l(_()?et($,o(L),o(S),d()):$)}),!0)},ee=()=>{X(),be()},re=b=>{const j=B(b.touches[0]),I=B(b.touches[1]);m(a,ft(j,I),!0),ge(ht(j,I))},ve=b=>{const j=B(b.touches[0]),I=B(b.touches[1]),O=ht(j,I);Y(O),o(T)&&window.cancelAnimationFrame(o(T)),m(T,window.requestAnimationFrame(()=>{const $=ft(j,I),k=d()*($/o(a));Se(k,O),m(a,$,!0)}),!0)},fe=b=>{b.preventDefault();const j=de(b),I=d()-b.deltaY*N()/200;Se(I,j)},ce=({x:b,y:j})=>{if(!o(s))throw new Error("The Cropper is not mounted");return{x:o(s).width/2-(b-o(s).left),y:o(s).height/2-(j-o(s).top)}},he=({x:b,y:j})=>({x:(b+l().x)/d(),y:(j+l().y)/d()}),Se=(b,j)=>{if(!o(S))return;const I=ce(j),O=he(I);d(Math.min(x(),Math.max(b,u())));const $={x:O.x*d()-I.x,y:O.y*d()-I.y};l(_()?et($,o(L),o(S),d()):$)},be=()=>{if(!o(S)||o(S).width===0)return;const b=_()?et(l(),o(L),o(S),d()):l(),{croppedAreaPercentages:j,croppedAreaPixels:I}=Lr(b,o(L),o(S),q(),d(),_());n.oncropcomplete?.({percent:j,pixels:I})};Ue(()=>{o(i)&&m(S,p()?p():ut(o(i).width,o(i).height,h()),!0)}),Ue(()=>{d()&&be()});const Ce=b=>{Ue(()=>(b.addEventListener("touchstart",oe),b.addEventListener("mousedown",E),b.addEventListener("wheel",fe,{passive:!1}),()=>{b.removeEventListener("touchstart",oe),b.removeEventListener("mousedown",E),b.removeEventListener("wheel",fe)}))};var ne=zr();Ve("resize",Et,Z);var ie=f(ne);je(ie,b=>m(i,b),()=>o(i));var $e=A(ie,2);{var pe=b=>{var j=Dr();let I;z(()=>{I=xe(j,1,"svelte-easy-crop-area svelte-1yetlj5",null,I,{"svelte-easy-crop-round":R()==="round","svelte-easy-crop-grid":H()}),Xe(j,`width: ${o(S).width??""}px; height: ${o(S).height??""}px;`)}),w(b,j)};G($e,b=>{o(S)&&b(pe)})}v(ne),je(ne,b=>m(g,b),()=>o(g)),Ht(ne,b=>Ce?.(b)),z(()=>{_e(ne,"tabindex",y()),_e(ie,"src",n.image),Xe(ie,`transform: translate(${l().x??""}px, ${l().y??""}px) scale(${d()??""});`),_e(ie,"crossorigin",M())}),Ve("load",ie,F),St(ie),w(c,ne),Re()}const Or=c=>new Promise((n,l)=>{const d=new Image;d.addEventListener("load",()=>n(d)),d.addEventListener("error",u=>l(u)),d.setAttribute("crossOrigin","anonymous"),d.src=c});function Mt(c){return c*Math.PI/180}function Fr(c,n,l){const d=Mt(l);return{width:Math.abs(Math.cos(d)*c)+Math.abs(Math.sin(d)*n),height:Math.abs(Math.sin(d)*c)+Math.abs(Math.cos(d)*n)}}async function kr(c,n,l=0,d={horizontal:!1,vertical:!1}){const u=await Or(c),x=document.createElement("canvas"),h=x.getContext("2d");if(!h)return null;const p=Mt(l),{width:R,height:H}=Fr(u.width,u.height,l);x.width=R,x.height=H,h.translate(R/2,H/2),h.rotate(p),h.scale(d.horizontal?-1:1,d.vertical?-1:1),h.translate(-u.width/2,-u.height/2),h.drawImage(u,0,0);const N=h.getImageData(n.x,n.y,n.width,n.height);return x.width=n.width,x.height=n.height,h.putImageData(N,0,0),new Promise((M,_)=>{x.toBlob(y=>{M(y)},"image/jpeg",.8)})}var Ur=C('<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Processando...',1),Hr=C("<!> Salvar Foto",1),Gr=C('<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4 animate-in fade-in duration-200" role="dialog" aria-modal="true"><div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl flex flex-col shadow-2xl overflow-hidden max-h-[90vh]"><div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950"><h3 class="font-bold text-white flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-indigo-500"></div> Editar Imagem</h3> <button class="text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-800 transition-colors"><!></button></div> <div class="relative flex-1 bg-black min-h-[400px]"><!></div> <div class="p-4 bg-slate-950 border-t border-slate-800 space-y-4"><div class="flex items-center gap-4"><div class="flex items-center gap-2 text-slate-400 w-full px-4"><!> <input type="range" min="1" max="3" step="0.1" class="w-full accent-indigo-500 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer"/></div></div> <div class="flex justify-end gap-3 pt-2"><button class="px-6 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-bold transition-all text-sm border border-slate-700">Cancelar</button> <button class="px-8 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold transition-all text-sm shadow-lg shadow-indigo-900/20 flex items-center gap-2"><!></button></div></div></div></div>');function Aa(c,n){Pe(n,!0);let l=V(n,"isOpen",3,!1),d=V(n,"imageUrl",3,""),u=V(n,"aspectRatio",3,1),x=U(De({x:0,y:0})),h=U(1),p=U(null),R=U(!1);async function H(){if(console.log("handleSave called",{isProcessing:o(R),pixelCrop:o(p)}),!(o(R)||!o(p))){m(R,!0);try{console.log("Calling getCroppedImg with",{imageUrl:d().substring(0,50)+"...",pixelCrop:o(p)});const y=await kr(d(),o(p),0);console.log("getCroppedImg result:",y),y&&n.onCrop(y)}catch(y){console.error("Error in handleSave:",y)}finally{m(R,!1)}}}var N=le(),M=Q(N);{var _=y=>{var S=Gr(),L=f(S),g=f(L),s=A(f(g),2);s.__click=function(...P){n.onClose?.apply(this,P)};var i=f(s);yt(i,{size:20}),v(s),v(g);var t=A(g,2),e=f(t);jr(e,{get image(){return d()},get aspect(){return u()},oncropcomplete:P=>{console.log("oncropcomplete prop data:",P),m(p,P.pixels,!0)},showGrid:!0,get crop(){return o(x)},set crop(P){m(x,P,!0)},get zoom(){return o(h)},set zoom(P){m(h,P,!0)}}),v(t);var a=A(t,2),r=f(a),T=f(r),W=f(T);Gt(W,{size:16});var X=A(W,2);Pt(X),v(T),v(r);var F=A(r,2),q=f(F);q.__click=function(...P){n.onClose?.apply(this,P)};var Z=A(q,2);Z.__click=H;var de=f(Z);{var B=P=>{var oe=Ur();tt(),w(P,oe)},E=P=>{var oe=Hr(),ue=Q(oe);wt(ue,{size:18}),tt(),w(P,oe)};G(de,P=>{o(R)?P(B):P(E,!1)})}v(Z),v(F),v(a),v(L),v(S),z(()=>Z.disabled=o(R)),Ot(X,()=>o(h),P=>m(h,P)),w(y,S)};G(M,y=>{l()&&y(_)})}w(c,N),Re()}Ge(["click"]);var Wr=C('<span class="text-[10px] text-indigo-300 uppercase font-bold mb-2 block"> </span>'),Zr=C('<div><!> <div class="flex items-center justify-between bg-black/40 rounded-xl p-1.5 border border-white/5" role="group"><button type="button" class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-all active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <div class="flex flex-col items-center min-w-[3rem]"><span class="text-2xl font-black text-white leading-none tracking-tighter" data-testid="size-display"> </span></div> <button type="button" class="w-10 h-10 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition-all active:scale-90 shadow-lg shadow-indigo-500/20 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div></div>');function Ma(c,n){Pe(n,!0);const l=()=>He(nt,"$t",d),[d,u]=ot(),x=[.125,.5,...Array.from({length:20},(e,a)=>a+1)];function h(){const e=x.indexOf(n.value);if(e>0)n.onUpdate(x[e-1]);else if(e===-1){const a=x.slice().reverse().find(r=>r<n.value);a?n.onUpdate(a):n.onUpdate(x[0])}}function p(){const e=x.indexOf(n.value);if(e!==-1&&e<x.length-1)n.onUpdate(x[e+1]);else if(e===-1){const a=x.find(r=>r>n.value);a?n.onUpdate(a):n.onUpdate(x[x.length-1])}}function R(e){return e===.125?"1/8":e===.5?"1/2":e.toString()}var H=Zr(),N=f(H);{var M=e=>{var a=Wr(),r=f(a,!0);v(a),z(()=>D(r,n.label)),w(e,a)};G(N,e=>{n.label&&e(M)})}var _=A(N,2),y=f(_);y.__click=h;var S=f(y);At(S,{size:18}),v(y);var L=A(y,2),g=f(L),s=f(g,!0);v(g),v(L);var i=A(L,2);i.__click=p;var t=f(i);_t(t,{size:18}),v(i),v(_),v(H),z((e,a,r,T)=>{_e(_,"aria-label",e),_e(y,"aria-label",a),y.disabled=n.value<=x[0],D(s,r),_e(i,"aria-label",T),i.disabled=n.value>=x[x.length-1]},[()=>l()("common.labels.size_selector"),()=>l()("common.buttons.decrease"),()=>R(n.value),()=>l()("common.buttons.increase")]),w(c,H),Re(),u()}Ge(["click"]);export{ha as A,ia as B,da as C,ma as D,ca as E,ua as G,wa as H,Aa as I,va as L,At as M,fa as R,Ma as S,ya as T,ba as W,Ht as a,_a as b,la as c,st as d,sa as e,ga as f,pa as g,xa as s};
