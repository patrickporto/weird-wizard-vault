import{n as xr}from"./B3FtJd8P.js";function Ns(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Hr={exports:{}},F=Hr.exports={},rt,it;function Cn(){throw new Error("setTimeout has not been defined")}function Dn(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?rt=setTimeout:rt=Cn}catch{rt=Cn}try{typeof clearTimeout=="function"?it=clearTimeout:it=Dn}catch{it=Dn}})();function Wr(e){if(rt===setTimeout)return setTimeout(e,0);if((rt===Cn||!rt)&&setTimeout)return rt=setTimeout,setTimeout(e,0);try{return rt(e,0)}catch{try{return rt.call(null,e,0)}catch{return rt.call(this,e,0)}}}function $s(e){if(it===clearTimeout)return clearTimeout(e);if((it===Dn||!it)&&clearTimeout)return it=clearTimeout,clearTimeout(e);try{return it(e)}catch{try{return it.call(null,e)}catch{return it.call(this,e)}}}var at=[],Vt=!1,It,Ce=-1;function Vs(){!Vt||!It||(Vt=!1,It.length?at=It.concat(at):Ce=-1,at.length&&Xr())}function Xr(){if(!Vt){var e=Wr(Vs);Vt=!0;for(var t=at.length;t;){for(It=at,at=[];++Ce<t;)It&&It[Ce].run();Ce=-1,t=at.length}It=null,Vt=!1,$s(e)}}F.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];at.push(new qr(e,t)),at.length===1&&!Vt&&Wr(Xr)};function qr(e,t){this.fun=e,this.array=t}qr.prototype.run=function(){this.fun.apply(null,this.array)};F.title="browser";F.browser=!0;F.env={};F.argv=[];F.version="";F.versions={};function dt(){}F.on=dt;F.addListener=dt;F.once=dt;F.off=dt;F.removeListener=dt;F.removeAllListeners=dt;F.emit=dt;F.prependListener=dt;F.prependOnceListener=dt;F.listeners=function(e){return[]};F.binding=function(e){throw new Error("process.binding is not supported")};F.cwd=function(){return"/"};F.chdir=function(e){throw new Error("process.chdir is not supported")};F.umask=function(){return 0};var js=Hr.exports;const St=Ns(js);var vs={},Ke={};Ke.byteLength=zs;Ke.toByteArray=Ks;Ke.fromByteArray=Xs;var st=[],W=[],Gs=typeof Uint8Array<"u"?Uint8Array:Array,dn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ot=0,Js=dn.length;Ot<Js;++Ot)st[Ot]=dn[Ot],W[dn.charCodeAt(Ot)]=Ot;W[45]=62;W[95]=63;function Pr(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function zs(e){var t=Pr(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Ys(e,t,n){return(t+n)*3/4-n}function Ks(e){var t,n=Pr(e),r=n[0],s=n[1],c=new Gs(Ys(e,r,s)),h=0,f=s>0?r-4:r,d;for(d=0;d<f;d+=4)t=W[e.charCodeAt(d)]<<18|W[e.charCodeAt(d+1)]<<12|W[e.charCodeAt(d+2)]<<6|W[e.charCodeAt(d+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=t&255;return s===2&&(t=W[e.charCodeAt(d)]<<2|W[e.charCodeAt(d+1)]>>4,c[h++]=t&255),s===1&&(t=W[e.charCodeAt(d)]<<10|W[e.charCodeAt(d+1)]<<4|W[e.charCodeAt(d+2)]>>2,c[h++]=t>>8&255,c[h++]=t&255),c}function Hs(e){return st[e>>18&63]+st[e>>12&63]+st[e>>6&63]+st[e&63]}function Ws(e,t,n){for(var r,s=[],c=t;c<n;c+=3)r=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(e[c+2]&255),s.push(Hs(r));return s.join("")}function Xs(e){for(var t,n=e.length,r=n%3,s=[],c=16383,h=0,f=n-r;h<f;h+=c)s.push(Ws(e,h,h+c>f?f:h+c));return r===1?(t=e[n-1],s.push(st[t>>2]+st[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],s.push(st[t>>10]+st[t>>4&63]+st[t<<2&63]+"=")),s.join("")}var $n={};$n.read=function(e,t,n,r,s){var c,h,f=s*8-r-1,d=(1<<f)-1,g=d>>1,u=-7,m=n?s-1:0,E=n?-1:1,_=e[t+m];for(m+=E,c=_&(1<<-u)-1,_>>=-u,u+=f;u>0;c=c*256+e[t+m],m+=E,u-=8);for(h=c&(1<<-u)-1,c>>=-u,u+=r;u>0;h=h*256+e[t+m],m+=E,u-=8);if(c===0)c=1-g;else{if(c===d)return h?NaN:(_?-1:1)*(1/0);h=h+Math.pow(2,r),c=c-g}return(_?-1:1)*h*Math.pow(2,c-r)};$n.write=function(e,t,n,r,s,c){var h,f,d,g=c*8-s-1,u=(1<<g)-1,m=u>>1,E=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=r?0:c-1,k=r?1:-1,S=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,h=u):(h=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-h))<1&&(h--,d*=2),h+m>=1?t+=E/d:t+=E*Math.pow(2,1-m),t*d>=2&&(h++,d/=2),h+m>=u?(f=0,h=u):h+m>=1?(f=(t*d-1)*Math.pow(2,s),h=h+m):(f=t*Math.pow(2,m-1)*Math.pow(2,s),h=0));s>=8;e[n+_]=f&255,_+=k,f/=256,s-=8);for(h=h<<s|f,g+=s;g>0;e[n+_]=h&255,_+=k,h/=256,g-=8);e[n+_-k]|=S*128};(function(e){const t=Ke,n=$n,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=ys,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s;const{Uint8Array:c,ArrayBuffer:h,SharedArrayBuffer:f}=globalThis;u.TYPED_ARRAY_SUPPORT=d(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{const l=new c(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,c.prototype),Object.setPrototypeOf(l,i),l.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function g(l){if(l>s)throw new RangeError('The value "'+l+'" is invalid for option "size"');const i=new c(l);return Object.setPrototypeOf(i,u.prototype),i}function u(l,i,o){if(typeof l=="number"){if(typeof i=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return k(l)}return m(l,i,o)}u.poolSize=8192;function m(l,i,o){if(typeof l=="string")return S(l,i);if(h.isView(l))return gs(l);if(l==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l);if(et(l,h)||l&&et(l.buffer,h)||typeof f<"u"&&(et(l,f)||l&&et(l.buffer,f)))return ln(l,i,o);if(typeof l=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const a=l.valueOf&&l.valueOf();if(a!=null&&a!==l)return u.from(a,i,o);const p=ws(l);if(p)return p;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof l[Symbol.toPrimitive]=="function")return u.from(l[Symbol.toPrimitive]("string"),i,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l)}u.from=function(l,i,o){return m(l,i,o)},Object.setPrototypeOf(u.prototype,c.prototype),Object.setPrototypeOf(u,c);function E(l){if(typeof l!="number")throw new TypeError('"size" argument must be of type number');if(l<0)throw new RangeError('The value "'+l+'" is invalid for option "size"')}function _(l,i,o){return E(l),l<=0?g(l):i!==void 0?typeof o=="string"?g(l).fill(i,o):g(l).fill(i):g(l)}u.alloc=function(l,i,o){return _(l,i,o)};function k(l){return E(l),g(l<0?0:hn(l)|0)}u.allocUnsafe=function(l){return k(l)},u.allocUnsafeSlow=function(l){return k(l)};function S(l,i){if((typeof i!="string"||i==="")&&(i="utf8"),!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i);const o=ur(l,i)|0;let a=g(o);const p=a.write(l,i);return p!==o&&(a=a.slice(0,p)),a}function tt(l){const i=l.length<0?0:hn(l.length)|0,o=g(i);for(let a=0;a<i;a+=1)o[a]=l[a]&255;return o}function gs(l){if(et(l,c)){const i=new c(l);return ln(i.buffer,i.byteOffset,i.byteLength)}return tt(l)}function ln(l,i,o){if(i<0||l.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(l.byteLength<i+(o||0))throw new RangeError('"length" is outside of buffer bounds');let a;return i===void 0&&o===void 0?a=new c(l):o===void 0?a=new c(l,i):a=new c(l,i,o),Object.setPrototypeOf(a,u.prototype),a}function ws(l){if(u.isBuffer(l)){const i=hn(l.length)|0,o=g(i);return o.length===0||l.copy(o,0,0,i),o}if(l.length!==void 0)return typeof l.length!="number"||fn(l.length)?g(0):tt(l);if(l.type==="Buffer"&&Array.isArray(l.data))return tt(l.data)}function hn(l){if(l>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return l|0}function ys(l){return+l!=l&&(l=0),u.alloc(+l)}u.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==u.prototype},u.compare=function(i,o){if(et(i,c)&&(i=u.from(i,i.offset,i.byteLength)),et(o,c)&&(o=u.from(o,o.offset,o.byteLength)),!u.isBuffer(i)||!u.isBuffer(o))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===o)return 0;let a=i.length,p=o.length;for(let w=0,y=Math.min(a,p);w<y;++w)if(i[w]!==o[w]){a=i[w],p=o[w];break}return a<p?-1:p<a?1:0},u.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(i,o){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return u.alloc(0);let a;if(o===void 0)for(o=0,a=0;a<i.length;++a)o+=i[a].length;const p=u.allocUnsafe(o);let w=0;for(a=0;a<i.length;++a){let y=i[a];if(et(y,c))w+y.length>p.length?(u.isBuffer(y)||(y=u.from(y)),y.copy(p,w)):c.prototype.set.call(p,y,w);else if(u.isBuffer(y))y.copy(p,w);else throw new TypeError('"list" argument must be an Array of Buffers');w+=y.length}return p};function ur(l,i){if(u.isBuffer(l))return l.length;if(h.isView(l)||et(l,h))return l.byteLength;if(typeof l!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof l);const o=l.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&o===0)return 0;let p=!1;for(;;)switch(i){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":return an(l).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o*2;case"hex":return o>>>1;case"base64":return br(l).length;default:if(p)return a?-1:an(l).length;i=(""+i).toLowerCase(),p=!0}}u.byteLength=ur;function ms(l,i,o){let a=!1;if((i===void 0||i<0)&&(i=0),i>this.length||((o===void 0||o>this.length)&&(o=this.length),o<=0)||(o>>>=0,i>>>=0,o<=i))return"";for(l||(l="utf8");;)switch(l){case"hex":return As(this,i,o);case"utf8":case"utf-8":return dr(this,i,o);case"ascii":return Cs(this,i,o);case"latin1":case"binary":return Ds(this,i,o);case"base64":return Ss(this,i,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Bs(this,i,o);default:if(a)throw new TypeError("Unknown encoding: "+l);l=(l+"").toLowerCase(),a=!0}}u.prototype._isBuffer=!0;function xt(l,i,o){const a=l[i];l[i]=l[o],l[o]=a}u.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let o=0;o<i;o+=2)xt(this,o,o+1);return this},u.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let o=0;o<i;o+=4)xt(this,o,o+3),xt(this,o+1,o+2);return this},u.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let o=0;o<i;o+=8)xt(this,o,o+7),xt(this,o+1,o+6),xt(this,o+2,o+5),xt(this,o+3,o+4);return this},u.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?dr(this,0,i):ms.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(i){if(!u.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:u.compare(this,i)===0},u.prototype.inspect=function(){let i="";const o=e.INSPECT_MAX_BYTES;return i=this.toString("hex",0,o).replace(/(.{2})/g,"$1 ").trim(),this.length>o&&(i+=" ... "),"<Buffer "+i+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(i,o,a,p,w){if(et(i,c)&&(i=u.from(i,i.offset,i.byteLength)),!u.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(o===void 0&&(o=0),a===void 0&&(a=i?i.length:0),p===void 0&&(p=0),w===void 0&&(w=this.length),o<0||a>i.length||p<0||w>this.length)throw new RangeError("out of range index");if(p>=w&&o>=a)return 0;if(p>=w)return-1;if(o>=a)return 1;if(o>>>=0,a>>>=0,p>>>=0,w>>>=0,this===i)return 0;let y=w-p,x=a-o;const T=Math.min(y,x),B=this.slice(p,w),U=i.slice(o,a);for(let D=0;D<T;++D)if(B[D]!==U[D]){y=B[D],x=U[D];break}return y<x?-1:x<y?1:0};function ar(l,i,o,a,p){if(l.length===0)return-1;if(typeof o=="string"?(a=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),o=+o,fn(o)&&(o=p?0:l.length-1),o<0&&(o=l.length+o),o>=l.length){if(p)return-1;o=l.length-1}else if(o<0)if(p)o=0;else return-1;if(typeof i=="string"&&(i=u.from(i,a)),u.isBuffer(i))return i.length===0?-1:fr(l,i,o,a,p);if(typeof i=="number")return i=i&255,typeof c.prototype.indexOf=="function"?p?c.prototype.indexOf.call(l,i,o):c.prototype.lastIndexOf.call(l,i,o):fr(l,[i],o,a,p);throw new TypeError("val must be string, number or Buffer")}function fr(l,i,o,a,p){let w=1,y=l.length,x=i.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(l.length<2||i.length<2)return-1;w=2,y/=2,x/=2,o/=2}function T(U,D){return w===1?U[D]:U.readUInt16BE(D*w)}let B;if(p){let U=-1;for(B=o;B<y;B++)if(T(l,B)===T(i,U===-1?0:B-U)){if(U===-1&&(U=B),B-U+1===x)return U*w}else U!==-1&&(B-=B-U),U=-1}else for(o+x>y&&(o=y-x),B=o;B>=0;B--){let U=!0;for(let D=0;D<x;D++)if(T(l,B+D)!==T(i,D)){U=!1;break}if(U)return B}return-1}u.prototype.includes=function(i,o,a){return this.indexOf(i,o,a)!==-1},u.prototype.indexOf=function(i,o,a){return ar(this,i,o,a,!0)},u.prototype.lastIndexOf=function(i,o,a){return ar(this,i,o,a,!1)};function Es(l,i,o,a){o=Number(o)||0;const p=l.length-o;a?(a=Number(a),a>p&&(a=p)):a=p;const w=i.length;a>w/2&&(a=w/2);let y;for(y=0;y<a;++y){const x=parseInt(i.substr(y*2,2),16);if(fn(x))return y;l[o+y]=x}return y}function _s(l,i,o,a){return be(an(i,l.length-o),l,o,a)}function ks(l,i,o,a){return be(Ls(i),l,o,a)}function bs(l,i,o,a){return be(br(i),l,o,a)}function xs(l,i,o,a){return be(Rs(i,l.length-o),l,o,a)}u.prototype.write=function(i,o,a,p){if(o===void 0)p="utf8",a=this.length,o=0;else if(a===void 0&&typeof o=="string")p=o,a=this.length,o=0;else if(isFinite(o))o=o>>>0,isFinite(a)?(a=a>>>0,p===void 0&&(p="utf8")):(p=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const w=this.length-o;if((a===void 0||a>w)&&(a=w),i.length>0&&(a<0||o<0)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");p||(p="utf8");let y=!1;for(;;)switch(p){case"hex":return Es(this,i,o,a);case"utf8":case"utf-8":return _s(this,i,o,a);case"ascii":case"latin1":case"binary":return ks(this,i,o,a);case"base64":return bs(this,i,o,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xs(this,i,o,a);default:if(y)throw new TypeError("Unknown encoding: "+p);p=(""+p).toLowerCase(),y=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ss(l,i,o){return i===0&&o===l.length?t.fromByteArray(l):t.fromByteArray(l.slice(i,o))}function dr(l,i,o){o=Math.min(l.length,o);const a=[];let p=i;for(;p<o;){const w=l[p];let y=null,x=w>239?4:w>223?3:w>191?2:1;if(p+x<=o){let T,B,U,D;switch(x){case 1:w<128&&(y=w);break;case 2:T=l[p+1],(T&192)===128&&(D=(w&31)<<6|T&63,D>127&&(y=D));break;case 3:T=l[p+1],B=l[p+2],(T&192)===128&&(B&192)===128&&(D=(w&15)<<12|(T&63)<<6|B&63,D>2047&&(D<55296||D>57343)&&(y=D));break;case 4:T=l[p+1],B=l[p+2],U=l[p+3],(T&192)===128&&(B&192)===128&&(U&192)===128&&(D=(w&15)<<18|(T&63)<<12|(B&63)<<6|U&63,D>65535&&D<1114112&&(y=D))}}y===null?(y=65533,x=1):y>65535&&(y-=65536,a.push(y>>>10&1023|55296),y=56320|y&1023),a.push(y),p+=x}return Is(a)}const pr=4096;function Is(l){const i=l.length;if(i<=pr)return String.fromCharCode.apply(String,l);let o="",a=0;for(;a<i;)o+=String.fromCharCode.apply(String,l.slice(a,a+=pr));return o}function Cs(l,i,o){let a="";o=Math.min(l.length,o);for(let p=i;p<o;++p)a+=String.fromCharCode(l[p]&127);return a}function Ds(l,i,o){let a="";o=Math.min(l.length,o);for(let p=i;p<o;++p)a+=String.fromCharCode(l[p]);return a}function As(l,i,o){const a=l.length;(!i||i<0)&&(i=0),(!o||o<0||o>a)&&(o=a);let p="";for(let w=i;w<o;++w)p+=Ms[l[w]];return p}function Bs(l,i,o){const a=l.slice(i,o);let p="";for(let w=0;w<a.length-1;w+=2)p+=String.fromCharCode(a[w]+a[w+1]*256);return p}u.prototype.slice=function(i,o){const a=this.length;i=~~i,o=o===void 0?a:~~o,i<0?(i+=a,i<0&&(i=0)):i>a&&(i=a),o<0?(o+=a,o<0&&(o=0)):o>a&&(o=a),o<i&&(o=i);const p=this.subarray(i,o);return Object.setPrototypeOf(p,u.prototype),p};function O(l,i,o){if(l%1!==0||l<0)throw new RangeError("offset is not uint");if(l+i>o)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(i,o,a){i=i>>>0,o=o>>>0,a||O(i,o,this.length);let p=this[i],w=1,y=0;for(;++y<o&&(w*=256);)p+=this[i+y]*w;return p},u.prototype.readUintBE=u.prototype.readUIntBE=function(i,o,a){i=i>>>0,o=o>>>0,a||O(i,o,this.length);let p=this[i+--o],w=1;for(;o>0&&(w*=256);)p+=this[i+--o]*w;return p},u.prototype.readUint8=u.prototype.readUInt8=function(i,o){return i=i>>>0,o||O(i,1,this.length),this[i]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(i,o){return i=i>>>0,o||O(i,2,this.length),this[i]|this[i+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(i,o){return i=i>>>0,o||O(i,2,this.length),this[i]<<8|this[i+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(i,o){return i=i>>>0,o||O(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(i,o){return i=i>>>0,o||O(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},u.prototype.readBigUInt64LE=yt(function(i){i=i>>>0,Mt(i,"offset");const o=this[i],a=this[i+7];(o===void 0||a===void 0)&&re(i,this.length-8);const p=o+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,w=this[++i]+this[++i]*2**8+this[++i]*2**16+a*2**24;return BigInt(p)+(BigInt(w)<<BigInt(32))}),u.prototype.readBigUInt64BE=yt(function(i){i=i>>>0,Mt(i,"offset");const o=this[i],a=this[i+7];(o===void 0||a===void 0)&&re(i,this.length-8);const p=o*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],w=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+a;return(BigInt(p)<<BigInt(32))+BigInt(w)}),u.prototype.readIntLE=function(i,o,a){i=i>>>0,o=o>>>0,a||O(i,o,this.length);let p=this[i],w=1,y=0;for(;++y<o&&(w*=256);)p+=this[i+y]*w;return w*=128,p>=w&&(p-=Math.pow(2,8*o)),p},u.prototype.readIntBE=function(i,o,a){i=i>>>0,o=o>>>0,a||O(i,o,this.length);let p=o,w=1,y=this[i+--p];for(;p>0&&(w*=256);)y+=this[i+--p]*w;return w*=128,y>=w&&(y-=Math.pow(2,8*o)),y},u.prototype.readInt8=function(i,o){return i=i>>>0,o||O(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},u.prototype.readInt16LE=function(i,o){i=i>>>0,o||O(i,2,this.length);const a=this[i]|this[i+1]<<8;return a&32768?a|4294901760:a},u.prototype.readInt16BE=function(i,o){i=i>>>0,o||O(i,2,this.length);const a=this[i+1]|this[i]<<8;return a&32768?a|4294901760:a},u.prototype.readInt32LE=function(i,o){return i=i>>>0,o||O(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},u.prototype.readInt32BE=function(i,o){return i=i>>>0,o||O(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},u.prototype.readBigInt64LE=yt(function(i){i=i>>>0,Mt(i,"offset");const o=this[i],a=this[i+7];(o===void 0||a===void 0)&&re(i,this.length-8);const p=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(a<<24);return(BigInt(p)<<BigInt(32))+BigInt(o+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),u.prototype.readBigInt64BE=yt(function(i){i=i>>>0,Mt(i,"offset");const o=this[i],a=this[i+7];(o===void 0||a===void 0)&&re(i,this.length-8);const p=(o<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(p)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+a)}),u.prototype.readFloatLE=function(i,o){return i=i>>>0,o||O(i,4,this.length),n.read(this,i,!0,23,4)},u.prototype.readFloatBE=function(i,o){return i=i>>>0,o||O(i,4,this.length),n.read(this,i,!1,23,4)},u.prototype.readDoubleLE=function(i,o){return i=i>>>0,o||O(i,8,this.length),n.read(this,i,!0,52,8)},u.prototype.readDoubleBE=function(i,o){return i=i>>>0,o||O(i,8,this.length),n.read(this,i,!1,52,8)};function J(l,i,o,a,p,w){if(!u.isBuffer(l))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>p||i<w)throw new RangeError('"value" argument is out of bounds');if(o+a>l.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(i,o,a,p){if(i=+i,o=o>>>0,a=a>>>0,!p){const x=Math.pow(2,8*a)-1;J(this,i,o,a,x,0)}let w=1,y=0;for(this[o]=i&255;++y<a&&(w*=256);)this[o+y]=i/w&255;return o+a},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(i,o,a,p){if(i=+i,o=o>>>0,a=a>>>0,!p){const x=Math.pow(2,8*a)-1;J(this,i,o,a,x,0)}let w=a-1,y=1;for(this[o+w]=i&255;--w>=0&&(y*=256);)this[o+w]=i/y&255;return o+a},u.prototype.writeUint8=u.prototype.writeUInt8=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,1,255,0),this[o]=i&255,o+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,2,65535,0),this[o]=i&255,this[o+1]=i>>>8,o+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,2,65535,0),this[o]=i>>>8,this[o+1]=i&255,o+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,4,4294967295,0),this[o+3]=i>>>24,this[o+2]=i>>>16,this[o+1]=i>>>8,this[o]=i&255,o+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,4,4294967295,0),this[o]=i>>>24,this[o+1]=i>>>16,this[o+2]=i>>>8,this[o+3]=i&255,o+4};function gr(l,i,o,a,p){kr(i,a,p,l,o,7);let w=Number(i&BigInt(4294967295));l[o++]=w,w=w>>8,l[o++]=w,w=w>>8,l[o++]=w,w=w>>8,l[o++]=w;let y=Number(i>>BigInt(32)&BigInt(4294967295));return l[o++]=y,y=y>>8,l[o++]=y,y=y>>8,l[o++]=y,y=y>>8,l[o++]=y,o}function wr(l,i,o,a,p){kr(i,a,p,l,o,7);let w=Number(i&BigInt(4294967295));l[o+7]=w,w=w>>8,l[o+6]=w,w=w>>8,l[o+5]=w,w=w>>8,l[o+4]=w;let y=Number(i>>BigInt(32)&BigInt(4294967295));return l[o+3]=y,y=y>>8,l[o+2]=y,y=y>>8,l[o+1]=y,y=y>>8,l[o]=y,o+8}u.prototype.writeBigUInt64LE=yt(function(i,o=0){return gr(this,i,o,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=yt(function(i,o=0){return wr(this,i,o,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(i,o,a,p){if(i=+i,o=o>>>0,!p){const T=Math.pow(2,8*a-1);J(this,i,o,a,T-1,-T)}let w=0,y=1,x=0;for(this[o]=i&255;++w<a&&(y*=256);)i<0&&x===0&&this[o+w-1]!==0&&(x=1),this[o+w]=(i/y>>0)-x&255;return o+a},u.prototype.writeIntBE=function(i,o,a,p){if(i=+i,o=o>>>0,!p){const T=Math.pow(2,8*a-1);J(this,i,o,a,T-1,-T)}let w=a-1,y=1,x=0;for(this[o+w]=i&255;--w>=0&&(y*=256);)i<0&&x===0&&this[o+w+1]!==0&&(x=1),this[o+w]=(i/y>>0)-x&255;return o+a},u.prototype.writeInt8=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,1,127,-128),i<0&&(i=255+i+1),this[o]=i&255,o+1},u.prototype.writeInt16LE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,2,32767,-32768),this[o]=i&255,this[o+1]=i>>>8,o+2},u.prototype.writeInt16BE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,2,32767,-32768),this[o]=i>>>8,this[o+1]=i&255,o+2},u.prototype.writeInt32LE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,4,2147483647,-2147483648),this[o]=i&255,this[o+1]=i>>>8,this[o+2]=i>>>16,this[o+3]=i>>>24,o+4},u.prototype.writeInt32BE=function(i,o,a){return i=+i,o=o>>>0,a||J(this,i,o,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[o]=i>>>24,this[o+1]=i>>>16,this[o+2]=i>>>8,this[o+3]=i&255,o+4},u.prototype.writeBigInt64LE=yt(function(i,o=0){return gr(this,i,o,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=yt(function(i,o=0){return wr(this,i,o,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function yr(l,i,o,a,p,w){if(o+a>l.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function mr(l,i,o,a,p){return i=+i,o=o>>>0,p||yr(l,i,o,4),n.write(l,i,o,a,23,4),o+4}u.prototype.writeFloatLE=function(i,o,a){return mr(this,i,o,!0,a)},u.prototype.writeFloatBE=function(i,o,a){return mr(this,i,o,!1,a)};function Er(l,i,o,a,p){return i=+i,o=o>>>0,p||yr(l,i,o,8),n.write(l,i,o,a,52,8),o+8}u.prototype.writeDoubleLE=function(i,o,a){return Er(this,i,o,!0,a)},u.prototype.writeDoubleBE=function(i,o,a){return Er(this,i,o,!1,a)},u.prototype.copy=function(i,o,a,p){if(!u.isBuffer(i))throw new TypeError("argument should be a Buffer");if(a||(a=0),!p&&p!==0&&(p=this.length),o>=i.length&&(o=i.length),o||(o=0),p>0&&p<a&&(p=a),p===a||i.length===0||this.length===0)return 0;if(o<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("sourceEnd out of bounds");p>this.length&&(p=this.length),i.length-o<p-a&&(p=i.length-o+a);const w=p-a;return this===i&&typeof c.prototype.copyWithin=="function"?this.copyWithin(o,a,p):c.prototype.set.call(i,this.subarray(a,p),o),w},u.prototype.fill=function(i,o,a,p){if(typeof i=="string"){if(typeof o=="string"?(p=o,o=0,a=this.length):typeof a=="string"&&(p=a,a=this.length),p!==void 0&&typeof p!="string")throw new TypeError("encoding must be a string");if(typeof p=="string"&&!u.isEncoding(p))throw new TypeError("Unknown encoding: "+p);if(i.length===1){const y=i.charCodeAt(0);(p==="utf8"&&y<128||p==="latin1")&&(i=y)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(o<0||this.length<o||this.length<a)throw new RangeError("Out of range index");if(a<=o)return this;o=o>>>0,a=a===void 0?this.length:a>>>0,i||(i=0);let w;if(typeof i=="number")for(w=o;w<a;++w)this[w]=i;else{const y=u.isBuffer(i)?i:u.from(i,p),x=y.length;if(x===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(w=0;w<a-o;++w)this[w+o]=y[w%x]}return this};const Rt={};function un(l,i,o){Rt[l]=class extends o{constructor(){super(),Object.defineProperty(this,"message",{value:i.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${l}]`,this.stack,delete this.name}get code(){return l}set code(p){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:p,writable:!0})}toString(){return`${this.name} [${l}]: ${this.message}`}}}un("ERR_BUFFER_OUT_OF_BOUNDS",function(l){return l?`${l} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),un("ERR_INVALID_ARG_TYPE",function(l,i){return`The "${l}" argument must be of type number. Received type ${typeof i}`},TypeError),un("ERR_OUT_OF_RANGE",function(l,i,o){let a=`The value of "${l}" is out of range.`,p=o;return Number.isInteger(o)&&Math.abs(o)>2**32?p=_r(String(o)):typeof o=="bigint"&&(p=String(o),(o>BigInt(2)**BigInt(32)||o<-(BigInt(2)**BigInt(32)))&&(p=_r(p)),p+="n"),a+=` It must be ${i}. Received ${p}`,a},RangeError);function _r(l){let i="",o=l.length;const a=l[0]==="-"?1:0;for(;o>=a+4;o-=3)i=`_${l.slice(o-3,o)}${i}`;return`${l.slice(0,o)}${i}`}function Ts(l,i,o){Mt(i,"offset"),(l[i]===void 0||l[i+o]===void 0)&&re(i,l.length-(o+1))}function kr(l,i,o,a,p,w){if(l>o||l<i){const y=typeof i=="bigint"?"n":"";let x;throw i===0||i===BigInt(0)?x=`>= 0${y} and < 2${y} ** ${(w+1)*8}${y}`:x=`>= -(2${y} ** ${(w+1)*8-1}${y}) and < 2 ** ${(w+1)*8-1}${y}`,new Rt.ERR_OUT_OF_RANGE("value",x,l)}Ts(a,p,w)}function Mt(l,i){if(typeof l!="number")throw new Rt.ERR_INVALID_ARG_TYPE(i,"number",l)}function re(l,i,o){throw Math.floor(l)!==l?(Mt(l,o),new Rt.ERR_OUT_OF_RANGE("offset","an integer",l)):i<0?new Rt.ERR_BUFFER_OUT_OF_BOUNDS:new Rt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${i}`,l)}const Us=/[^+/0-9A-Za-z-_]/g;function Fs(l){if(l=l.split("=")[0],l=l.trim().replace(Us,""),l.length<2)return"";for(;l.length%4!==0;)l=l+"=";return l}function an(l,i){i=i||1/0;let o;const a=l.length;let p=null;const w=[];for(let y=0;y<a;++y){if(o=l.charCodeAt(y),o>55295&&o<57344){if(!p){if(o>56319){(i-=3)>-1&&w.push(239,191,189);continue}else if(y+1===a){(i-=3)>-1&&w.push(239,191,189);continue}p=o;continue}if(o<56320){(i-=3)>-1&&w.push(239,191,189),p=o;continue}o=(p-55296<<10|o-56320)+65536}else p&&(i-=3)>-1&&w.push(239,191,189);if(p=null,o<128){if((i-=1)<0)break;w.push(o)}else if(o<2048){if((i-=2)<0)break;w.push(o>>6|192,o&63|128)}else if(o<65536){if((i-=3)<0)break;w.push(o>>12|224,o>>6&63|128,o&63|128)}else if(o<1114112){if((i-=4)<0)break;w.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else throw new Error("Invalid code point")}return w}function Ls(l){const i=[];for(let o=0;o<l.length;++o)i.push(l.charCodeAt(o)&255);return i}function Rs(l,i){let o,a,p;const w=[];for(let y=0;y<l.length&&!((i-=2)<0);++y)o=l.charCodeAt(y),a=o>>8,p=o%256,w.push(p),w.push(a);return w}function br(l){return t.toByteArray(Fs(l))}function be(l,i,o,a){let p;for(p=0;p<a&&!(p+o>=i.length||p>=l.length);++p)i[p+o]=l[p];return p}function et(l,i){return l instanceof i||l!=null&&l.constructor!=null&&l.constructor.name!=null&&l.constructor.name===i.name}function fn(l){return l!==l}const Ms=(function(){const l="0123456789abcdef",i=new Array(256);for(let o=0;o<16;++o){const a=o*16;for(let p=0;p<16;++p)i[a+p]=l[o]+l[p]}return i})();function yt(l){return typeof BigInt>"u"?Os:l}function Os(){throw new Error("BigInt not supported")}})(vs);const z=()=>new Map,An=e=>{const t=z();return e.forEach((n,r)=>{t.set(r,n)}),t},pt=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},qs=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},Ps=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Dt=()=>new Set,pn=e=>e[e.length-1],Zs=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},_t=Array.from,Vn=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},Zr=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},Qs=(e,t)=>{const n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n},He=Array.isArray;class to{constructor(){this._observers=z()}on(t,n){return pt(this._observers,t,Dt).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return _t((this._observers.get(t)||z()).values()).forEach(r=>r(...n))}destroy(){this._observers=z()}}class eo{constructor(){this._observers=z()}on(t,n){pt(this._observers,t,Dt).add(n)}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return _t((this._observers.get(t)||z()).values()).forEach(r=>r(...n))}destroy(){this._observers=z()}}const ct=Math.floor,De=Math.abs,Qr=(e,t)=>e<t?e:t,Ut=(e,t)=>e>t?e:t,ti=e=>e!==0?e<0:1/e<0,Sr=1,Ir=2,gn=4,wn=8,oe=32,ft=64,H=128,We=31,Bn=63,Ct=127,no=2147483647,Le=Number.MAX_SAFE_INTEGER,Cr=Number.MIN_SAFE_INTEGER,ro=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ct(e)===e),io=String.fromCharCode,so=e=>e.toLowerCase(),oo=/^\s*/g,co=e=>e.replace(oo,""),lo=/([A-Z])/g,Dr=(e,t)=>co(e.replace(lo,n=>`${t}${so(n)}`)),ho=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},ce=typeof TextEncoder<"u"?new TextEncoder:null,uo=e=>ce.encode(e),ao=ce?uo:ho;let se=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});se&&se.decode(new Uint8Array).length===1&&(se=null);const fo=(e,t)=>Qs(t,()=>e).join("");class we{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Xe=()=>new we,po=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ot=e=>{const t=new Uint8Array(po(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},go=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Ut(n,t)*2),e.cpos=0)},N=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Tn=N,C=(e,t)=>{for(;t>Ct;)N(e,H|Ct&t),t=ct(t/128);N(e,Ct&t)},jn=(e,t)=>{const n=ti(t);for(n&&(t=-t),N(e,(t>Bn?H:0)|(n?ft:0)|Bn&t),t=ct(t/64);t>0;)N(e,(t>Ct?H:0)|Ct&t),t=ct(t/128)},Un=new Uint8Array(3e4),wo=Un.length/3,yo=(e,t)=>{if(t.length<wo){const n=ce.encodeInto(t,Un).written||0;C(e,n);for(let r=0;r<n;r++)N(e,Un[r])}else Y(e,ao(t))},mo=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;C(e,r);for(let s=0;s<r;s++)N(e,n.codePointAt(s))},jt=ce&&ce.encodeInto?yo:mo,qe=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Qr(n-r,t.length),c=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,c>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Ut(n*2,c)),e.cbuf.set(t.subarray(s)),e.cpos=c)},Y=(e,t)=>{C(e,t.byteLength),qe(e,t)},vn=(e,t)=>{go(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Eo=(e,t)=>vn(e,4).setFloat32(0,t,!1),_o=(e,t)=>vn(e,8).setFloat64(0,t,!1),ko=(e,t)=>vn(e,8).setBigInt64(0,t,!1),Ar=new DataView(new ArrayBuffer(4)),bo=e=>(Ar.setFloat32(0,e),Ar.getFloat32(0)===e),le=(e,t)=>{switch(typeof t){case"string":N(e,119),jt(e,t);break;case"number":ro(t)&&De(t)<=no?(N(e,125),jn(e,t)):bo(t)?(N(e,124),Eo(e,t)):(N(e,123),_o(e,t));break;case"bigint":N(e,122),ko(e,t);break;case"object":if(t===null)N(e,126);else if(He(t)){N(e,117),C(e,t.length);for(let n=0;n<t.length;n++)le(e,t[n])}else if(t instanceof Uint8Array)N(e,116),Y(e,t);else{N(e,118);const n=Object.keys(t);C(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];jt(e,s),le(e,t[s])}}break;case"boolean":N(e,t?120:121);break;default:N(e,127)}};class Br extends we{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&C(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Tr=e=>{e.count>0&&(jn(e.encoder,e.count===1?e.s:-e.s),e.count>1&&C(e.encoder,e.count-2))};class Ae{constructor(){this.encoder=new we,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Tr(this),this.count=1,this.s=t)}toUint8Array(){return Tr(this),ot(this.encoder)}}const Ur=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);jn(e.encoder,t),e.count>1&&C(e.encoder,e.count-2)}};class yn{constructor(){this.encoder=new we,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Ur(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Ur(this),ot(this.encoder)}}class xo{constructor(){this.sarr=[],this.s="",this.lensE=new Ae}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new we;return this.sarr.push(this.s),this.s="",jt(t,this.sarr.join("")),qe(t,this.lensE.toUint8Array()),ot(t)}}const Q=e=>new Error(e),Z=()=>{throw Q("Method unimplemented")},P=()=>{throw Q("Unexpected case")},ei=Q("Unexpected end of array"),ni=Q("Integer out of Range");class Pe{constructor(t){this.arr=t,this.pos=0}}const Zt=e=>new Pe(e),So=e=>e.pos!==e.arr.length,Io=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},K=e=>Io(e,b(e)),Yt=e=>e.arr[e.pos++],b=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&Ct)*n,n*=128,s<H)return t;if(t>Le)throw ni}throw ei},Gn=e=>{let t=e.arr[e.pos++],n=t&Bn,r=64;const s=(t&ft)>0?-1:1;if((t&H)===0)return s*n;const c=e.arr.length;for(;e.pos<c;){if(t=e.arr[e.pos++],n=n+(t&Ct)*r,r*=128,t<H)return s*n;if(n>Le)throw ni}throw ei},Co=e=>{let t=b(e);if(t===0)return"";{let n=String.fromCodePoint(Yt(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Yt(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Do=e=>se.decode(K(e)),vt=se?Do:Co,Jn=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Ao=e=>Jn(e,4).getFloat32(0,!1),Bo=e=>Jn(e,8).getFloat64(0,!1),To=e=>Jn(e,8).getBigInt64(0,!1),Uo=[e=>{},e=>null,Gn,Ao,Bo,To,e=>!1,e=>!0,vt,e=>{const t=b(e),n={};for(let r=0;r<t;r++){const s=vt(e);n[s]=he(e)}return n},e=>{const t=b(e),n=[];for(let r=0;r<t;r++)n.push(he(e));return n},K],he=e=>Uo[127-Yt(e)](e);class Fr extends Pe{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),So(this)?this.count=b(this)+1:this.count=-1),this.count--,this.s}}class Be extends Pe{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Gn(this);const t=ti(this.s);this.count=1,t&&(this.s=-this.s,this.count=b(this)+2)}return this.count--,this.s}}class mn extends Pe{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Gn(this),n=t&1;this.diff=ct(t/2),this.count=1,n&&(this.count=b(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Fo{constructor(t){this.decoder=new Be(t),this.str=vt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Lo=crypto.getRandomValues.bind(crypto),ri=()=>Lo(new Uint32Array(1))[0],Ro="10000000-1000-4000-8000"+-1e11,Mo=()=>Ro.replace(/[018]/g,e=>(e^ri()&15>>e/4).toString(16)),Kt=e=>new Promise(e);Promise.all.bind(Promise);const Lr=e=>e===void 0?null:e;class Oo{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let ii=new Oo,No=!0;try{typeof localStorage<"u"&&localStorage&&(ii=localStorage,No=!1)}catch{}const $o=ii,ue=Symbol("Equality"),si=(e,t)=>e===t||!!e?.[ue]?.(t)||!1,Vo=e=>typeof e=="object",jo=Object.assign,vo=Object.keys,Go=(e,t)=>{for(const n in e)t(e[n],n)},Re=e=>vo(e).length,Jo=e=>{for(const t in e)return!1;return!0},ye=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},zn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),zo=(e,t)=>e===t||Re(e)===Re(t)&&ye(e,(n,r)=>(n!==void 0||zn(t,r))&&si(t[r],n)),Yo=Object.freeze,oi=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&oi(e[t])}return Yo(e)},Yn=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Yn(e,t,n+1)}},Ko=e=>e,Te=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(e[ue]!=null)return e[ue](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Te(e.get(n),t.get(n)))return!1;break}case void 0:case Object:if(Re(e)!==Re(t))return!1;for(const n in e)if(!zn(e,n)||!Te(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Te(e[n],t[n]))return!1;break;default:return!1}return!0},Ho=(e,t)=>t.includes(e);var ci={};const ae=typeof St<"u"&&St.release&&/node|io\.js/.test(St.release.name)&&Object.prototype.toString.call(typeof St<"u"?St:0)==="[object process]";let nt;const Wo=()=>{if(nt===void 0)if(ae){nt=z();const e=St.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&nt.set(t,""),t=r):t!==null&&(nt.set(t,r),t=null)}t!==null&&nt.set(t,"")}else typeof location=="object"?(nt=z(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");nt.set(`--${Dr(t,"-")}`,n),nt.set(`-${Dr(t,"-")}`,n)}})):nt=z();return nt},Fn=e=>Wo().has(e),Me=e=>Lr(ae?ci[e.toUpperCase().replaceAll("-","_")]:$o.getItem(e)),li=e=>Fn("--"+e)||Me(e)!==null,Xo=li("production"),qo=ae&&Ho(ci.FORCE_COLOR,["true","1","2"]),Po=qo||!Fn("--no-colors")&&!li("no-color")&&(!ae||St.stdout.isTTY)&&(!ae||Fn("--color")||Me("COLORTERM")!==null||(Me("TERM")||"").includes("color")),Zo=e=>new Uint8Array(e),Qo=e=>{const t=Zo(e.byteLength);return t.set(e),t};class tc{constructor(t,n){this.left=t,this.right=n}}const ut=(e,t)=>new tc(e,t),Rr=e=>e.next()>=.5,En=(e,t,n)=>ct(e.next()*(n+1-t)+t),hi=(e,t,n)=>ct(e.next()*(n+1-t)+t),Kn=(e,t,n)=>hi(e,t,n),ec=e=>io(Kn(e,97,122)),nc=(e,t=0,n=20)=>{const r=Kn(e,t,n);let s="";for(let c=0;c<r;c++)s+=ec(e);return s},_n=(e,t)=>t[Kn(e,0,t.length-1)],rc=Symbol("0schema");class ic{constructor(){this._rerrs=[]}extend(t,n,r,s=null){this._rerrs.push({path:t,expected:n,has:r,message:s})}toString(){const t=[];for(let n=this._rerrs.length-1;n>0;n--){const r=this._rerrs[n];t.push(fo(" ",(this._rerrs.length-n)*2)+`${r.path!=null?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return t.join(`
`)}}const Ln=(e,t)=>e===t?!0:e==null||t==null||e.constructor!==t.constructor?!1:e[ue]?si(e,t):He(e)?Vn(e,n=>Zr(t,r=>Ln(n,r))):Vo(e)?ye(e,(n,r)=>Ln(n,t[r])):!1;class G{static _dilutes=!1;extends(t){let[n,r]=[this.shape,t.shape];return this.constructor._dilutes&&([r,n]=[n,r]),Ln(n,r)}equals(t){return this.constructor===t.constructor&&Te(this.shape,t.shape)}[rc](){return!0}[ue](t){return this.equals(t)}validate(t){return this.check(t)}check(t,n){Z()}get nullable(){return Qt(this,nn)}get optional(){return new fi(this)}cast(t){return Mr(t,this),t}expect(t){return Mr(t,this),t}}class Hn extends G{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n=void 0){const r=t?.constructor===this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name,t?.constructor!==this.shape?"Constructor match failed":"Check failed"),r}}const L=(e,t=null)=>new Hn(e,t);L(Hn);class Wn extends G{constructor(t){super(),this.shape=t}check(t,n){const r=this.shape(t);return!r&&n?.extend(null,"custom prop",t?.constructor.name,"failed to check custom prop"),r}}const V=e=>new Wn(e);L(Wn);class Ze extends G{constructor(t){super(),this.shape=t}check(t,n){const r=this.shape.some(s=>s===t);return!r&&n?.extend(null,this.shape.join(" | "),t.toString()),r}}const Qe=(...e)=>new Ze(e),ui=L(Ze),sc=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,t=>"\\"+t)),ai=e=>{if(Ht.check(e))return[sc(e)];if(ui.check(e))return e.shape.map(t=>t+"");if(ki.check(e))return["[+-]?\\d+.?\\d*"];if(bi.check(e))return[".*"];if(Oe.check(e))return e.shape.map(ai).flat(1);P()};class oc extends G{constructor(t){super(),this.shape=t,this._r=new RegExp("^"+t.map(ai).map(n=>`(${n.join("|")})`).join("")+"$")}check(t,n){const r=this._r.exec(t)!=null;return!r&&n?.extend(null,this._r.toString(),t.toString(),"String doesn't match string template."),r}}L(oc);const cc=Symbol("optional");class fi extends G{constructor(t){super(),this.shape=t}check(t,n){const r=t===void 0||this.shape.check(t);return!r&&n?.extend(null,"undefined (optional)","()"),r}get[cc](){return!0}}const lc=L(fi);class hc extends G{check(t,n){return n?.extend(null,"never",typeof t),!1}}L(hc);class tn extends G{constructor(t,n=!1){super(),this.shape=t,this._isPartial=n}static _dilutes=!0;get partial(){return new tn(this.shape,!0)}check(t,n){return t==null?(n?.extend(null,"object","null"),!1):ye(this.shape,(r,s)=>{const c=this._isPartial&&!zn(t,s)||r.check(t[s],n);return!c&&n?.extend(s.toString(),r.toString(),typeof t[s],"Object property does not match"),c})}}const uc=e=>new tn(e),ac=L(tn),fc=V(e=>e!=null&&(e.constructor===Object||e.constructor==null));class di extends G{constructor(t,n){super(),this.shape={keys:t,values:n}}check(t,n){return t!=null&&ye(t,(r,s)=>{const c=this.shape.keys.check(s,n);return!c&&n?.extend(s+"","Record",typeof t,c?"Key doesn't match schema":"Value doesn't match value"),c&&this.shape.values.check(r,n)})}}const pi=(e,t)=>new di(e,t),dc=L(di);class gi extends G{constructor(t){super(),this.shape=t}check(t,n){return t!=null&&ye(this.shape,(r,s)=>{const c=r.check(t[s],n);return!c&&n?.extend(s.toString(),"Tuple",typeof r),c})}}const pc=(...e)=>new gi(e);L(gi);class wi extends G{constructor(t){super(),this.shape=t.length===1?t[0]:new Xn(t)}check(t,n){const r=He(t)&&Vn(t,s=>this.shape.check(s));return!r&&n?.extend(null,"Array",""),r}}const yi=(...e)=>new wi(e),gc=L(wi),wc=V(e=>He(e));class mi extends G{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n){const r=t instanceof this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name),r}}const yc=(e,t=null)=>new mi(e,t);L(mi);const mc=yc(G);class Ec extends G{constructor(t){super(),this.len=t.length-1,this.args=pc(...t.slice(-1)),this.res=t[this.len]}check(t,n){const r=t.constructor===Function&&t.length<=this.len;return!r&&n?.extend(null,"function",typeof t),r}}const _c=L(Ec),kc=V(e=>typeof e=="function");class bc extends G{constructor(t){super(),this.shape=t}check(t,n){const r=Vn(this.shape,s=>s.check(t,n));return!r&&n?.extend(null,"Intersectinon",typeof t),r}}L(bc,e=>e.shape.length>0);class Xn extends G{static _dilutes=!0;constructor(t){super(),this.shape=t}check(t,n){const r=Zr(this.shape,s=>s.check(t,n));return n?.extend(null,"Union",typeof t),r}}const Qt=(...e)=>e.findIndex(t=>Oe.check(t))>=0?Qt(...e.map(t=>fe(t)).map(t=>Oe.check(t)?t.shape:[t]).flat(1)):e.length===1?e[0]:new Xn(e),Oe=L(Xn),Ei=()=>!0,Ne=V(Ei),xc=L(Wn,e=>e.shape===Ei),qn=V(e=>typeof e=="bigint"),Sc=V(e=>e===qn),_i=V(e=>typeof e=="symbol");V(e=>e===_i);const Gt=V(e=>typeof e=="number"),ki=V(e=>e===Gt),Ht=V(e=>typeof e=="string"),bi=V(e=>e===Ht),en=V(e=>typeof e=="boolean"),Ic=V(e=>e===en),xi=Qe(void 0);L(Ze,e=>e.shape.length===1&&e.shape[0]===void 0);Qe(void 0);const nn=Qe(null),Cc=L(Ze,e=>e.shape.length===1&&e.shape[0]===null);L(Uint8Array);L(Hn,e=>e.shape===Uint8Array);const Dc=Qt(Gt,Ht,nn,xi,qn,en,_i);(()=>{const e=yi(Ne),t=pi(Ht,Ne),n=Qt(Gt,Ht,nn,en,e,t);return e.shape=n,t.shape.values=n,n})();const fe=e=>{if(mc.check(e))return e;if(fc.check(e)){const t={};for(const n in e)t[n]=fe(e[n]);return uc(t)}else{if(wc.check(e))return Qt(...e.map(fe));if(Dc.check(e))return Qe(e);if(kc.check(e))return L(e)}P()},Mr=Xo?()=>{}:(e,t)=>{const n=new ic;if(!t.check(e,n))throw Q(`Expected value to be of type ${t.constructor.name}.
${n.toString()}`)};class Ac{constructor(t){this.patterns=[],this.$state=t}if(t,n){return this.patterns.push({if:fe(t),h:n}),this}else(t){return this.if(Ne,t)}done(){return(t,n)=>{for(let r=0;r<this.patterns.length;r++){const s=this.patterns[r];if(s.if.check(t))return s.h(t,n)}throw Q("Unhandled pattern")}}}const Bc=e=>new Ac(e),Si=Bc(Ne).if(ki,(e,t)=>En(t,Cr,Le)).if(bi,(e,t)=>nc(t)).if(Ic,(e,t)=>Rr(t)).if(Sc,(e,t)=>BigInt(En(t,Cr,Le))).if(Oe,(e,t)=>Nt(t,_n(t,e.shape))).if(ac,(e,t)=>{const n={};for(const r in e.shape){let s=e.shape[r];if(lc.check(s)){if(Rr(t))continue;s=s.shape}n[r]=Si(s,t)}return n}).if(gc,(e,t)=>{const n=[],r=hi(t,0,42);for(let s=0;s<r;s++)n.push(Nt(t,e.shape));return n}).if(ui,(e,t)=>_n(t,e.shape)).if(Cc,(e,t)=>null).if(_c,(e,t)=>{const n=Nt(t,e.res);return()=>n}).if(xc,(e,t)=>Nt(t,_n(t,[Gt,Ht,nn,xi,qn,en,yi(Gt),pi(Qt("a","b","c"),Gt)]))).if(dc,(e,t)=>{const n={},r=En(t,0,3);for(let s=0;s<r;s++){const c=Nt(t,e.shape.keys),h=Nt(t,e.shape.values);n[c]=h}return n}).done(),Nt=(e,t)=>Si(fe(t),e),rn=typeof document<"u"?document:{};V(e=>e.nodeType===Rc);typeof DOMParser<"u"&&new DOMParser;V(e=>e.nodeType===Uc);V(e=>e.nodeType===Fc);const Tc=e=>qs(e,(t,n)=>`${n}:${t};`).join(""),Uc=rn.ELEMENT_NODE,Fc=rn.TEXT_NODE,Lc=rn.DOCUMENT_NODE,Rc=rn.DOCUMENT_FRAGMENT_NODE;V(e=>e.nodeType===Lc);const gt=Symbol,Ii=gt(),Ci=gt(),Mc=gt(),Oc=gt(),Nc=gt(),Di=gt(),$c=gt(),Pn=gt(),Vc=gt(),jc=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},vc={[Ii]:ut("font-weight","bold"),[Ci]:ut("font-weight","normal"),[Mc]:ut("color","blue"),[Nc]:ut("color","green"),[Oc]:ut("color","grey"),[Di]:ut("color","red"),[$c]:ut("color","purple"),[Pn]:ut("color","orange"),[Vc]:ut("color","black")},Gc=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[],r=z();let s=[],c=0;for(;c<e.length;c++){const h=e[c],f=vc[h];if(f!==void 0)r.set(f.left,f.right);else{if(h===void 0)break;if(h.constructor===String||h.constructor===Number){const d=Tc(r);c>0||d.length>0?(t.push("%c"+h),n.push(d)):t.push(h)}else break}}for(c>0&&(s=n,s.unshift(t.join("")));c<e.length;c++){const h=e[c];h instanceof Symbol||s.push(h)}return s},Ai=Po?Gc:jc,Jc=(...e)=>{console.log(...Ai(e)),Bi.forEach(t=>t.print(e))},zc=(...e)=>{console.warn(...Ai(e)),e.unshift(Pn),Bi.forEach(t=>t.print(e))},Bi=Dt(),Ti=e=>({[Symbol.iterator](){return this},next:e}),Yc=(e,t)=>Ti(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),kn=(e,t)=>Ti(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Zn{constructor(t,n){this.clock=t,this.len=n}}class me{constructor(){this.clients=new Map}}const Ui=(e,t,n)=>t.clients.forEach((r,s)=>{const c=e.doc.store.clients.get(s);if(c!=null){const h=c[c.length-1],f=h.id.clock+h.length;for(let d=0,g=r[d];d<r.length&&g.clock<f;g=r[++d])Gi(e,c,g.clock,g.len,n)}}),Kc=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=ct((n+r)/2),c=e[s],h=c.clock;if(h<=t){if(t<h+c.len)return s;n=s+1}else r=s-1}return null},Fi=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Kc(n,t.clock)!==null},Qn=e=>{e.clients.forEach(t=>{t.sort((s,c)=>s.clock-c.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],c=t[n];s.clock+s.len>=c.clock?s.len=Ut(s.len,c.clock+c.len-s.clock):(r<n&&(t[r]=c),r++)}t.length=r})},Hc=e=>{const t=new me;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const c=r.slice();for(let h=n+1;h<e.length;h++)Zs(c,e[h].clients.get(s)||[]);t.clients.set(s,c)}});return Qn(t),t},$e=(e,t,n,r)=>{pt(e.clients,t,()=>[]).push(new Zn(n,r))},Wc=()=>new me,Xc=e=>{const t=Wc();return e.clients.forEach((n,r)=>{const s=[];for(let c=0;c<n.length;c++){const h=n[c];if(h.deleted){const f=h.id.clock;let d=h.length;if(c+1<n.length)for(let g=n[c+1];c+1<n.length&&g.deleted;g=n[++c+1])d+=g.length;s.push(new Zn(f,d))}}s.length>0&&t.clients.set(r,s)}),t},te=(e,t)=>{C(e.restEncoder,t.clients.size),_t(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),C(e.restEncoder,n);const s=r.length;C(e.restEncoder,s);for(let c=0;c<s;c++){const h=r[c];e.writeDsClock(h.clock),e.writeDsLen(h.len)}})},tr=e=>{const t=new me,n=b(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=b(e.restDecoder),c=b(e.restDecoder);if(c>0){const h=pt(t.clients,s,()=>[]);for(let f=0;f<c;f++)h.push(new Zn(e.readDsClock(),e.readDsLen()))}}return t},Or=(e,t,n)=>{const r=new me,s=b(e.restDecoder);for(let c=0;c<s;c++){e.resetDsCurVal();const h=b(e.restDecoder),f=b(e.restDecoder),d=n.clients.get(h)||[],g=$(n,h);for(let u=0;u<f;u++){const m=e.readDsClock(),E=m+e.readDsLen();if(m<g){g<E&&$e(r,h,g,E-g);let _=lt(d,m),k=d[_];for(!k.deleted&&k.id.clock<m&&(d.splice(_+1,0,Ye(t,k,m-k.id.clock)),_++);_<d.length&&(k=d[_++],k.id.clock<E);)k.deleted||(E<k.id.clock+k.length&&d.splice(_,0,Ye(t,k,E-k.id.clock)),k.delete(t))}else $e(r,h,m,E-m)}}if(r.clients.size>0){const c=new At;return C(c.restEncoder,0),te(c,r),c.toUint8Array()}return null},Li=ri;class ee extends to{constructor({guid:t=Mo(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:c=null,autoLoad:h=!1,shouldLoad:f=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Li(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new ji,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=f,this.autoLoad=h,this.meta=c,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Kt(g=>{this.on("load",()=>{this.isLoaded=!0,g(this)})});const d=()=>Kt(g=>{const u=m=>{(m===void 0||m===!0)&&(this.off("sync",u),g())};this.on("sync",u)});this.on("sync",g=>{g===!1&&this.isSynced&&(this.whenSynced=d()),this.isSynced=g===void 0||g===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=d()}load(){const t=this._item;t!==null&&!this.shouldLoad&&A(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(_t(this.subdocs).map(t=>t.guid))}transact(t,n=null){return A(this,t,n)}get(t,n=j){const r=pt(this.share,t,()=>{const c=new n;return c._integrate(this,null),c}),s=r.constructor;if(n!==j&&s!==n)if(s===j){const c=new n;c._map=r._map,r._map.forEach(h=>{for(;h!==null;h=h.left)h.parent=c}),c._start=r._start;for(let h=c._start;h!==null;h=h.right)h.parent=c;return c._length=r._length,this.share.set(t,c),c._integrate(this,null),c}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,zt)}getText(t=""){return this.get(t,qt)}getMap(t=""){return this.get(t,Xt)}getXmlElement(t=""){return this.get(t,Pt)}getXmlFragment(t=""){return this.get(t,Bt)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,_t(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new ee({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,A(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ri{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return b(this.restDecoder)}readDsLen(){return b(this.restDecoder)}}class Mi extends Ri{readLeftID(){return I(b(this.restDecoder),b(this.restDecoder))}readRightID(){return I(b(this.restDecoder),b(this.restDecoder))}readClient(){return b(this.restDecoder)}readInfo(){return Yt(this.restDecoder)}readString(){return vt(this.restDecoder)}readParentInfo(){return b(this.restDecoder)===1}readTypeRef(){return b(this.restDecoder)}readLen(){return b(this.restDecoder)}readAny(){return he(this.restDecoder)}readBuf(){return Qo(K(this.restDecoder))}readJSON(){return JSON.parse(vt(this.restDecoder))}readKey(){return vt(this.restDecoder)}}class qc{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=b(this.restDecoder),this.dsCurrVal}readDsLen(){const t=b(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Wt extends qc{constructor(t){super(t),this.keys=[],b(t),this.keyClockDecoder=new mn(K(t)),this.clientDecoder=new Be(K(t)),this.leftClockDecoder=new mn(K(t)),this.rightClockDecoder=new mn(K(t)),this.infoDecoder=new Fr(K(t),Yt),this.stringDecoder=new Fo(K(t)),this.parentInfoDecoder=new Fr(K(t),Yt),this.typeRefDecoder=new Be(K(t)),this.lenDecoder=new Be(K(t))}readLeftID(){return new Jt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Jt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return he(this.restDecoder)}readBuf(){return K(this.restDecoder)}readJSON(){return he(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Pc{constructor(){this.restEncoder=Xe()}toUint8Array(){return ot(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){C(this.restEncoder,t)}writeDsLen(t){C(this.restEncoder,t)}}class Ee extends Pc{writeLeftID(t){C(this.restEncoder,t.client),C(this.restEncoder,t.clock)}writeRightID(t){C(this.restEncoder,t.client),C(this.restEncoder,t.clock)}writeClient(t){C(this.restEncoder,t)}writeInfo(t){Tn(this.restEncoder,t)}writeString(t){jt(this.restEncoder,t)}writeParentInfo(t){C(this.restEncoder,t?1:0)}writeTypeRef(t){C(this.restEncoder,t)}writeLen(t){C(this.restEncoder,t)}writeAny(t){le(this.restEncoder,t)}writeBuf(t){Y(this.restEncoder,t)}writeJSON(t){jt(this.restEncoder,JSON.stringify(t))}writeKey(t){jt(this.restEncoder,t)}}class Zc{constructor(){this.restEncoder=Xe(),this.dsCurrVal=0}toUint8Array(){return ot(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,C(this.restEncoder,n)}writeDsLen(t){t===0&&P(),C(this.restEncoder,t-1),this.dsCurrVal+=t}}class At extends Zc{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new yn,this.clientEncoder=new Ae,this.leftClockEncoder=new yn,this.rightClockEncoder=new yn,this.infoEncoder=new Br(Tn),this.stringEncoder=new xo,this.parentInfoEncoder=new Br(Tn),this.typeRefEncoder=new Ae,this.lenEncoder=new Ae}toUint8Array(){const t=Xe();return C(t,0),Y(t,this.keyClockEncoder.toUint8Array()),Y(t,this.clientEncoder.toUint8Array()),Y(t,this.leftClockEncoder.toUint8Array()),Y(t,this.rightClockEncoder.toUint8Array()),Y(t,ot(this.infoEncoder)),Y(t,this.stringEncoder.toUint8Array()),Y(t,ot(this.parentInfoEncoder)),Y(t,this.typeRefEncoder.toUint8Array()),Y(t,this.lenEncoder.toUint8Array()),qe(t,ot(this.restEncoder)),ot(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){le(this.restEncoder,t)}writeBuf(t){Y(this.restEncoder,t)}writeJSON(t){le(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Qc=(e,t,n,r)=>{r=Ut(r,t[0].id.clock);const s=lt(t,r);C(e.restEncoder,t.length-s),e.writeClient(n),C(e.restEncoder,r);const c=t[s];c.write(e,r-c.id.clock);for(let h=s+1;h<t.length;h++)t[h].write(e,0)},er=(e,t,n)=>{const r=new Map;n.forEach((s,c)=>{$(t,c)>s&&r.set(c,s)}),nr(t).forEach((s,c)=>{n.has(c)||r.set(c,0)}),C(e.restEncoder,r.size),_t(r.entries()).sort((s,c)=>c[0]-s[0]).forEach(([s,c])=>{Qc(e,t.clients.get(s),s,c)})},tl=(e,t)=>{const n=z(),r=b(e.restDecoder);for(let s=0;s<r;s++){const c=b(e.restDecoder),h=new Array(c),f=e.readClient();let d=b(e.restDecoder);n.set(f,{i:0,refs:h});for(let g=0;g<c;g++){const u=e.readInfo();switch(We&u){case 0:{const m=e.readLen();h[g]=new X(I(f,d),m),d+=m;break}case 10:{const m=b(e.restDecoder);h[g]=new q(I(f,d),m),d+=m;break}default:{const m=(u&(ft|H))===0,E=new R(I(f,d),null,(u&H)===H?e.readLeftID():null,null,(u&ft)===ft?e.readRightID():null,m?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,m&&(u&oe)===oe?e.readString():null,cs(e,u));h[g]=E,d+=E.length}}}}return n},el=(e,t,n)=>{const r=[];let s=_t(n.keys()).sort((_,k)=>_-k);if(s.length===0)return null;const c=()=>{if(s.length===0)return null;let _=n.get(s[s.length-1]);for(;_.refs.length===_.i;)if(s.pop(),s.length>0)_=n.get(s[s.length-1]);else return null;return _};let h=c();if(h===null)return null;const f=new ji,d=new Map,g=(_,k)=>{const S=d.get(_);(S==null||S>k)&&d.set(_,k)};let u=h.refs[h.i++];const m=new Map,E=()=>{for(const _ of r){const k=_.id.client,S=n.get(k);S?(S.i--,f.clients.set(k,S.refs.slice(S.i)),n.delete(k),S.i=0,S.refs=[]):f.clients.set(k,[_]),s=s.filter(tt=>tt!==k)}r.length=0};for(;;){if(u.constructor!==q){const k=pt(m,u.id.client,()=>$(t,u.id.client))-u.id.clock;if(k<0)r.push(u),g(u.id.client,u.id.clock-1),E();else{const S=u.getMissing(e,t);if(S!==null){r.push(u);const tt=n.get(S)||{refs:[],i:0};if(tt.refs.length===tt.i)g(S,$(t,S)),E();else{u=tt.refs[tt.i++];continue}}else(k===0||k<u.length)&&(u.integrate(e,k),m.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(h!==null&&h.i<h.refs.length)u=h.refs[h.i++];else{if(h=c(),h===null)break;u=h.refs[h.i++]}}if(f.clients.size>0){const _=new At;return er(_,f,new Map),C(_.restEncoder,0),{missing:d,update:_.toUint8Array()}}return null},nl=(e,t)=>er(e,t.doc.store,t.beforeState),rl=(e,t,n,r=new Wt(e))=>A(t,s=>{s.local=!1;let c=!1;const h=s.doc,f=h.store,d=tl(r,h),g=el(s,f,d),u=f.pendingStructs;if(u){for(const[E,_]of u.missing)if(_<$(f,E)){c=!0;break}if(g){for(const[E,_]of g.missing){const k=u.missing.get(E);(k==null||k>_)&&u.missing.set(E,_)}u.update=Ve([u.update,g.update])}}else f.pendingStructs=g;const m=Or(r,s,f);if(f.pendingDs){const E=new Wt(Zt(f.pendingDs));b(E.restDecoder);const _=Or(E,s,f);m&&_?f.pendingDs=Ve([m,_]):f.pendingDs=m||_}else f.pendingDs=m;if(c){const E=f.pendingStructs.update;f.pendingStructs=null,Oi(s.doc,E)}},n,!1),Oi=(e,t,n,r=Wt)=>{const s=Zt(t);rl(s,e,n,new r(s))},il=(e,t,n)=>Oi(e,t,n,Mi),sl=(e,t,n=new Map)=>{er(e,t.store,n),te(e,Xc(t.store))},ol=(e,t=new Uint8Array([0]),n=new At)=>{const r=$i(t);sl(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(ml(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Ee)return wl(s.map((c,h)=>h===0?c:_l(c)));if(n.constructor===At)return Ve(s)}return s[0]},Ni=(e,t)=>ol(e,t,new Ee),cl=e=>{const t=new Map,n=b(e.restDecoder);for(let r=0;r<n;r++){const s=b(e.restDecoder),c=b(e.restDecoder);t.set(s,c)}return t},$i=e=>cl(new Ri(Zt(e)));class ll{constructor(){this.l=[]}}const Nr=()=>new ll,$r=(e,t)=>e.l.push(t),Vr=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Vi=(e,t,n)=>Yn(e.l,[t,n]);class Jt{constructor(t,n){this.client=t,this.clock=n}}const xe=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,I=(e,t)=>new Jt(e,t),hl=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw P()},$t=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Fi(t.ds,e.id),Rn=(e,t)=>{const n=pt(e.meta,Rn,Dt),r=e.doc.store;n.has(t)||(t.sv.forEach((s,c)=>{s<$(r,c)&&kt(e,I(c,s))}),Ui(e,t.ds,s=>{}),n.add(t))};class ji{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const nr=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},$=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},vi=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw P()}n.push(t)},lt=(e,t)=>{let n=0,r=e.length-1,s=e[r],c=s.id.clock;if(c===t)return r;let h=ct(t/(c+s.length-1)*r);for(;n<=r;){if(s=e[h],c=s.id.clock,c<=t){if(t<c+s.length)return h;n=h+1}else r=h-1;h=ct((n+r)/2)}throw P()},ul=(e,t)=>{const n=e.clients.get(t.client);return n[lt(n,t.clock)]},bn=ul,Mn=(e,t,n)=>{const r=lt(t,n),s=t[r];return s.id.clock<n&&s instanceof R?(t.splice(r+1,0,Ye(e,s,n-s.id.clock)),r+1):r},kt=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Mn(e,n,t.clock)]},jr=(e,t,n)=>{const r=t.clients.get(n.client),s=lt(r,n.clock),c=r[s];return n.clock!==c.id.clock+c.length-1&&c.constructor!==X&&r.splice(s+1,0,Ye(e,c,n.clock-c.id.clock+1)),c},al=(e,t,n)=>{const r=e.clients.get(t.id.client);r[lt(r,t.id.clock)]=n},Gi=(e,t,n,r,s)=>{if(r===0)return;const c=n+r;let h=Mn(e,t,n),f;do f=t[h++],c<f.id.clock+f.length&&Mn(e,t,c),s(f);while(h<t.length&&t[h].id.clock<c)};class fl{constructor(t,n,r){this.doc=t,this.deleteSet=new me,this.beforeState=nr(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const vr=(e,t)=>t.deleteSet.clients.size===0&&!Ps(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Qn(t.deleteSet),nl(e,t),te(e,t.deleteSet),!0),Gr=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&pt(e.changed,t,Dt).add(n)},Ue=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof R&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const c=t-s;return c&&e.splice(t+1-c,c),c},dl=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const c=t.clients.get(r);for(let h=s.length-1;h>=0;h--){const f=s[h],d=f.clock+f.len;for(let g=lt(c,f.clock),u=c[g];g<c.length&&u.id.clock<d;u=c[++g]){const m=c[g];if(f.clock+f.len<=m.id.clock)break;m instanceof R&&m.deleted&&!m.keep&&n(m)&&m.gc(t,!1)}}}},pl=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let c=n.length-1;c>=0;c--){const h=n[c],f=Qr(s.length-1,1+lt(s,h.clock+h.len-1));for(let d=f,g=s[d];d>0&&g.id.clock>=h.clock;g=s[d])d-=1+Ue(s,d)}})},Ji=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,c=n.deleteSet,h=n._mergeStructs;try{Qn(c),n.afterState=nr(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const f=[];n.changed.forEach((d,g)=>f.push(()=>{(g._item===null||!g._item.deleted)&&g._callObserver(n,d)})),f.push(()=>{n.changedParentTypes.forEach((d,g)=>{g._dEH.l.length>0&&(g._item===null||!g._item.deleted)&&(d=d.filter(u=>u.target._item===null||!u.target._item.deleted),d.forEach(u=>{u.currentTarget=g,u._path=null}),d.sort((u,m)=>u.path.length-m.path.length),Vi(g._dEH,d,n))})}),f.push(()=>r.emit("afterTransaction",[n,r])),Yn(f,[]),n._needFormattingCleanup&&Rl(n)}finally{r.gc&&dl(c,s,r.gcFilter),pl(c,s),n.afterState.forEach((u,m)=>{const E=n.beforeState.get(m)||0;if(E!==u){const _=s.clients.get(m),k=Ut(lt(_,E),1);for(let S=_.length-1;S>=k;)S-=1+Ue(_,S)}});for(let u=h.length-1;u>=0;u--){const{client:m,clock:E}=h[u].id,_=s.clients.get(m),k=lt(_,E);k+1<_.length&&Ue(_,k+1)>1||k>0&&Ue(_,k)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Jc(Pn,Ii,"[yjs] ",Ci,Di,"Changed the client-id because another client seems to be using it."),r.clientID=Li()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ee;vr(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new At;vr(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:f,subdocsLoaded:d,subdocsRemoved:g}=n;(f.size>0||g.size>0||d.size>0)&&(f.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),g.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:d,added:f,removed:g},r,n]),g.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Ji(e,t+1)}}},A=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let c=!1,h=null;e._transaction===null&&(c=!0,e._transaction=new fl(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{h=t(e._transaction)}finally{if(c){const f=e._transaction===s[0];e._transaction=null,f&&Ji(s,0)}}return h};function*gl(e){const t=b(e.restDecoder);for(let n=0;n<t;n++){const r=b(e.restDecoder),s=e.readClient();let c=b(e.restDecoder);for(let h=0;h<r;h++){const f=e.readInfo();if(f===10){const d=b(e.restDecoder);yield new q(I(s,c),d),c+=d}else if((We&f)!==0){const d=(f&(ft|H))===0,g=new R(I(s,c),null,(f&H)===H?e.readLeftID():null,null,(f&ft)===ft?e.readRightID():null,d?e.readParentInfo()?e.readString():e.readLeftID():null,d&&(f&oe)===oe?e.readString():null,cs(e,f));yield g,c+=g.length}else{const d=e.readLen();yield new X(I(s,c),d),c+=d}}}}class rr{constructor(t,n){this.gen=gl(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===q);return this.curr}}class ir{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const wl=e=>Ve(e,Mi,Ee),yl=(e,t)=>{if(e.constructor===X){const{client:n,clock:r}=e.id;return new X(I(n,r+t),e.length-t)}else if(e.constructor===q){const{client:n,clock:r}=e.id;return new q(I(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new R(I(r,s+t),null,I(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ve=(e,t=Wt,n=At)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Zt(u)));let s=r.map(u=>new rr(u,!0)),c=null;const h=new n,f=new ir(h);for(;s=s.filter(E=>E.curr!==null),s.sort((E,_)=>{if(E.curr.id.client===_.curr.id.client){const k=E.curr.id.clock-_.curr.id.clock;return k===0?E.curr.constructor===_.curr.constructor?0:E.curr.constructor===q?1:-1:k}else return _.curr.id.client-E.curr.id.client}),s.length!==0;){const u=s[0],m=u.curr.id.client;if(c!==null){let E=u.curr,_=!1;for(;E!==null&&E.id.clock+E.length<=c.struct.id.clock+c.struct.length&&E.id.client>=c.struct.id.client;)E=u.next(),_=!0;if(E===null||E.id.client!==m||_&&E.id.clock>c.struct.id.clock+c.struct.length)continue;if(m!==c.struct.id.client)mt(f,c.struct,c.offset),c={struct:E,offset:0},u.next();else if(c.struct.id.clock+c.struct.length<E.id.clock)if(c.struct.constructor===q)c.struct.length=E.id.clock+E.length-c.struct.id.clock;else{mt(f,c.struct,c.offset);const k=E.id.clock-c.struct.id.clock-c.struct.length;c={struct:new q(I(m,c.struct.id.clock+c.struct.length),k),offset:0}}else{const k=c.struct.id.clock+c.struct.length-E.id.clock;k>0&&(c.struct.constructor===q?c.struct.length-=k:E=yl(E,k)),c.struct.mergeWith(E)||(mt(f,c.struct,c.offset),c={struct:E,offset:0},u.next())}}else c={struct:u.curr,offset:0},u.next();for(let E=u.curr;E!==null&&E.id.client===m&&E.id.clock===c.struct.id.clock+c.struct.length&&E.constructor!==q;E=u.next())mt(f,c.struct,c.offset),c={struct:E,offset:0}}c!==null&&(mt(f,c.struct,c.offset),c=null),sr(f);const d=r.map(u=>tr(u)),g=Hc(d);return te(h,g),h.toUint8Array()},ml=(e,t,n=Wt,r=At)=>{const s=$i(t),c=new r,h=new ir(c),f=new n(Zt(e)),d=new rr(f,!1);for(;d.curr;){const u=d.curr,m=u.id.client,E=s.get(m)||0;if(d.curr.constructor===q){d.next();continue}if(u.id.clock+u.length>E)for(mt(h,u,Ut(E-u.id.clock,0)),d.next();d.curr&&d.curr.id.client===m;)mt(h,d.curr,0),d.next();else for(;d.curr&&d.curr.id.client===m&&d.curr.id.clock+d.curr.length<=E;)d.next()}sr(h);const g=tr(f);return te(c,g),c.toUint8Array()},zi=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:ot(e.encoder.restEncoder)}),e.encoder.restEncoder=Xe(),e.written=0)},mt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&zi(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),C(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},sr=e=>{zi(e);const t=e.encoder.restEncoder;C(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];C(t,r.written),qe(t,r.restEncoder)}},El=(e,t,n,r)=>{const s=new n(Zt(e)),c=new rr(s,!1),h=new r,f=new ir(h);for(let g=c.curr;g!==null;g=c.next())mt(f,t(g),0);sr(f);const d=tr(s);return te(h,d),h.toUint8Array()},_l=e=>El(e,Ko,Wt,Ee),Jr="You must not compute changes after the event-handler fired.";class sn{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=kl(this.currentTarget,this.target))}deletes(t){return Fi(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Q(Jr);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const c=n._map.get(s);let h,f;if(this.adds(c)){let d=c.left;for(;d!==null&&this.adds(d);)d=d.left;if(this.deletes(c))if(d!==null&&this.deletes(d))h="delete",f=pn(d.content.getContent());else return;else d!==null&&this.deletes(d)?(h="update",f=pn(d.content.getContent())):(h="add",f=void 0)}else if(this.deletes(c))h="delete",f=pn(c.content.getContent());else return;t.set(s,{action:h,oldValue:f})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Q(Jr);const n=this.target,r=Dt(),s=Dt(),c=[];if(t={added:r,deleted:s,delta:c,keys:this.keys},this.transaction.changed.get(n).has(null)){let f=null;const d=()=>{f&&c.push(f)};for(let g=n._start;g!==null;g=g.right)g.deleted?this.deletes(g)&&!this.adds(g)&&((f===null||f.delete===void 0)&&(d(),f={delete:0}),f.delete+=g.length,s.add(g)):this.adds(g)?((f===null||f.insert===void 0)&&(d(),f={insert:[]}),f.insert=f.insert.concat(g.content.getContent()),r.add(g)):((f===null||f.retain===void 0)&&(d(),f={retain:0}),f.retain+=g.length);f!==null&&f.retain===void 0&&d()}this._changes=t}return t}}const kl=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},v=()=>{zc("Invalid access: Add Yjs type to a document before reading data.")},Yi=80;let or=0;class bl{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=or++}}const xl=e=>{e.timestamp=or++},Ki=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=or++},Sl=(e,t,n)=>{if(e.length>=Yi){const r=e.reduce((s,c)=>s.timestamp<c.timestamp?s:c);return Ki(r,t,n),r}else{const r=new bl(t,n);return e.push(r),r}},on=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((c,h)=>De(t-c.index)<De(t-h.index)?c:h);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,xl(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&De(n.index-s)<r.parent.length/Yi?(Ki(n,r,s),n):Sl(e._searchMarker,r,s)},de=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let c=s.p;for(c.marker=!1;c&&(c.deleted||!c.countable);)c=c.left,c&&!c.deleted&&c.countable&&(s.index-=c.length);if(c===null||c.marker===!0){e.splice(r,1);continue}s.p=c,c.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Ut(t,s.index+n))}},cn=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;pt(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Vi(r._eH,n,t)};class j{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Nr(),this._dEH=Nr(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Z()}clone(){throw Z()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){$r(this._eH,t)}observeDeep(t){$r(this._dEH,t)}unobserve(t){Vr(this._eH,t)}unobserveDeep(t){Vr(this._dEH,t)}toJSON(){}}const Hi=(e,t,n)=>{e.doc??v(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let c=e._start;for(;c!==null&&r>0;){if(c.countable&&!c.deleted){const h=c.content.getContent();if(h.length<=t)t-=h.length;else{for(let f=t;f<h.length&&r>0;f++)s.push(h[f]),r--;t=0}}c=c.right}return s},Wi=e=>{e.doc??v();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},pe=(e,t)=>{let n=0,r=e._start;for(e.doc??v();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let c=0;c<s.length;c++)t(s[c],n++,e)}r=r.right}},Xi=(e,t)=>{const n=[];return pe(e,(r,s)=>{n.push(t(r,s,e))}),n},Il=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},qi=(e,t)=>{e.doc??v();const n=on(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},je=(e,t,n,r)=>{let s=n;const c=e.doc,h=c.clientID,f=c.store,d=n===null?t._start:n.right;let g=[];const u=()=>{g.length>0&&(s=new R(I(h,$(f,h)),s,s&&s.lastId,d,d&&d.id,t,null,new Tt(g)),s.integrate(e,0),g=[])};r.forEach(m=>{if(m===null)g.push(m);else switch(m.constructor){case Number:case Object:case Boolean:case Array:case String:g.push(m);break;default:switch(u(),m.constructor){case Uint8Array:case ArrayBuffer:s=new R(I(h,$(f,h)),s,s&&s.lastId,d,d&&d.id,t,null,new _e(new Uint8Array(m))),s.integrate(e,0);break;case ee:s=new R(I(h,$(f,h)),s,s&&s.lastId,d,d&&d.id,t,null,new ke(m)),s.integrate(e,0);break;default:if(m instanceof j)s=new R(I(h,$(f,h)),s,s&&s.lastId,d,d&&d.id,t,null,new wt(m)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Pi=()=>Q("Length exceeded!"),Zi=(e,t,n,r)=>{if(n>t._length)throw Pi();if(n===0)return t._searchMarker&&de(t._searchMarker,n,r.length),je(e,t,null,r);const s=n,c=on(t,n);let h=t._start;for(c!==null&&(h=c.p,n-=c.index,n===0&&(h=h.prev,n+=h&&h.countable&&!h.deleted?h.length:0));h!==null;h=h.right)if(!h.deleted&&h.countable){if(n<=h.length){n<h.length&&kt(e,I(h.id.client,h.id.clock+n));break}n-=h.length}return t._searchMarker&&de(t._searchMarker,s,r.length),je(e,t,h,r)},Cl=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((c,h)=>h.index>c.index?h:c,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return je(e,t,s,n)},Qi=(e,t,n,r)=>{if(r===0)return;const s=n,c=r,h=on(t,n);let f=t._start;for(h!==null&&(f=h.p,n-=h.index);f!==null&&n>0;f=f.right)!f.deleted&&f.countable&&(n<f.length&&kt(e,I(f.id.client,f.id.clock+n)),n-=f.length);for(;r>0&&f!==null;)f.deleted||(r<f.length&&kt(e,I(f.id.client,f.id.clock+r)),f.delete(e),r-=f.length),f=f.right;if(r>0)throw Pi();t._searchMarker&&de(t._searchMarker,s,-c+r)},ve=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},cr=(e,t,n,r)=>{const s=t._map.get(n)||null,c=e.doc,h=c.clientID;let f;if(r==null)f=new Tt([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:f=new Tt([r]);break;case Uint8Array:f=new _e(r);break;case ee:f=new ke(r);break;default:if(r instanceof j)f=new wt(r);else throw new Error("Unexpected content type")}new R(I(h,$(c.store,h)),s,s&&s.lastId,null,null,t,n,f).integrate(e,0)},lr=(e,t)=>{e.doc??v();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},ts=e=>{const t={};return e.doc??v(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},es=(e,t)=>{e.doc??v();const n=e._map.get(t);return n!==void 0&&!n.deleted},Dl=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let c=r;for(;c!==null&&(!t.sv.has(c.id.client)||c.id.clock>=(t.sv.get(c.id.client)||0));)c=c.left;c!==null&&$t(c,t)&&(n[s]=c.content.getContent()[c.length-1])}),n},Se=e=>(e.doc??v(),Yc(e._map.entries(),t=>!t[1].deleted));class Al extends sn{}class zt extends j{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new zt;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new zt}clone(){const t=new zt;return t.insert(0,this.toArray().map(n=>n instanceof j?n.clone():n)),t}get length(){return this.doc??v(),this._length}_callObserver(t,n){super._callObserver(t,n),cn(this,t,new Al(this,t))}insert(t,n){this.doc!==null?A(this.doc,r=>{Zi(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?A(this.doc,n=>{Cl(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?A(this.doc,r=>{Qi(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return qi(this,t)}toArray(){return Wi(this)}slice(t=0,n=this.length){return Hi(this,t,n)}toJSON(){return this.map(t=>t instanceof j?t.toJSON():t)}map(t){return Xi(this,t)}forEach(t){pe(this,t)}[Symbol.iterator](){return Il(this)}_write(t){t.writeTypeRef(Ql)}}const Bl=e=>new zt;class Tl extends sn{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Xt extends j{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Xt}clone(){const t=new Xt;return this.forEach((n,r)=>{t.set(r,n instanceof j?n.clone():n)}),t}_callObserver(t,n){cn(this,t,new Tl(this,t,n))}toJSON(){this.doc??v();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof j?s.toJSON():s}}),t}get size(){return[...Se(this)].length}keys(){return kn(Se(this),t=>t[0])}values(){return kn(Se(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return kn(Se(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??v(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?A(this.doc,n=>{ve(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?A(this.doc,r=>{cr(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return lr(this,t)}has(t){return es(this,t)}clear(){this.doc!==null?A(this.doc,t=>{this.forEach(function(n,r,s){ve(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(th)}}const Ul=e=>new Xt,Et=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&zo(e,t);class On{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&P(),this.right.content.constructor){case M:this.right.deleted||ne(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const zr=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case M:t.right.deleted||ne(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&kt(e,I(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ie=(e,t,n,r)=>{const s=new Map,c=r?on(t,n):null;if(c){const h=new On(c.p.left,c.p,c.index,s);return zr(e,h,n-c.index)}else{const h=new On(null,t._start,0,s);return zr(e,h,n)}},ns=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===M&&Et(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,c=s.clientID;r.forEach((h,f)=>{const d=n.left,g=n.right,u=new R(I(c,$(s.store,c)),d,d&&d.lastId,g,g&&g.id,t,null,new M(f,h));u.integrate(e,0),n.right=u,n.forward()})},ne=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},rs=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===M&&Et(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},is=(e,t,n,r)=>{const s=e.doc,c=s.clientID,h=new Map;for(const f in r){const d=r[f],g=n.currentAttributes.get(f)??null;if(!Et(g,d)){h.set(f,g);const{left:u,right:m}=n;n.right=new R(I(c,$(s.store,c)),u,u&&u.lastId,m,m&&m.id,t,null,new M(f,d)),n.right.integrate(e,0),n.forward()}}return h},xn=(e,t,n,r,s)=>{n.currentAttributes.forEach((E,_)=>{s[_]===void 0&&(s[_]=null)});const c=e.doc,h=c.clientID;rs(n,s);const f=is(e,t,n,s),d=r.constructor===String?new ht(r):r instanceof j?new wt(r):new Ft(r);let{left:g,right:u,index:m}=n;t._searchMarker&&de(t._searchMarker,n.index,d.getLength()),u=new R(I(h,$(c.store,h)),g,g&&g.lastId,u,u&&u.id,t,null,d),u.integrate(e,0),n.right=u,n.index=m,n.forward(),ns(e,t,n,f)},Yr=(e,t,n,r,s)=>{const c=e.doc,h=c.clientID;rs(n,s);const f=is(e,t,n,s);t:for(;n.right!==null&&(r>0||f.size>0&&(n.right.deleted||n.right.content.constructor===M));){if(!n.right.deleted)switch(n.right.content.constructor){case M:{const{key:d,value:g}=n.right.content,u=s[d];if(u!==void 0){if(Et(u,g))f.delete(d);else{if(r===0)break t;f.set(d,g)}n.right.delete(e)}else n.currentAttributes.set(d,g);break}default:r<n.right.length&&kt(e,I(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let d="";for(;r>0;r--)d+=`
`;n.right=new R(I(h,$(c.store,h)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new ht(d)),n.right.integrate(e,0),n.forward()}ns(e,t,n,f)},ss=(e,t,n,r,s)=>{let c=t;const h=z();for(;c&&(!c.countable||c.deleted);){if(!c.deleted&&c.content.constructor===M){const g=c.content;h.set(g.key,g)}c=c.right}let f=0,d=!1;for(;t!==c;){if(n===t&&(d=!0),!t.deleted){const g=t.content;switch(g.constructor){case M:{const{key:u,value:m}=g,E=r.get(u)??null;(h.get(u)!==g||E===m)&&(t.delete(e),f++,!d&&(s.get(u)??null)===m&&E!==m&&(E===null?s.delete(u):s.set(u,E))),!d&&!t.deleted&&ne(s,g);break}}}t=t.right}return f},Fl=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===M){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Ll=e=>{let t=0;return A(e.doc,n=>{let r=e._start,s=e._start,c=z();const h=An(c);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case M:ne(h,s.content);break;default:t+=ss(n,r,s,c,h),c=An(h),r=s;break}s=s.right}}),t},Rl=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const c=e.beforeState.get(r)||0;s!==c&&Gi(e,n.store.clients.get(r),c,s,h=>{!h.deleted&&h.content.constructor===M&&h.constructor!==X&&t.add(h.parent)})}A(n,r=>{Ui(e,e.deleteSet,s=>{if(s instanceof X||!s.parent._hasFormatting||t.has(s.parent))return;const c=s.parent;s.content.constructor===M?t.add(c):Fl(r,s)});for(const s of t)Ll(s)})},Kr=(e,t,n)=>{const r=n,s=An(t.currentAttributes),c=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case wt:case Ft:case ht:n<t.right.length&&kt(e,I(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}c&&ss(e,c,t.right,s,t.currentAttributes);const h=(t.left||t.right).parent;return h._searchMarker&&de(h._searchMarker,t.index,-r+n),t};class Ml extends sn{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];A(t,r=>{const s=new Map,c=new Map;let h=this.target._start,f=null;const d={};let g="",u=0,m=0;const E=()=>{if(f!==null){let _=null;switch(f){case"delete":m>0&&(_={delete:m}),m=0;break;case"insert":(typeof g=="object"||g.length>0)&&(_={insert:g},s.size>0&&(_.attributes={},s.forEach((k,S)=>{k!==null&&(_.attributes[S]=k)}))),g="";break;case"retain":u>0&&(_={retain:u},Jo(d)||(_.attributes=jo({},d))),u=0;break}_&&n.push(_),f=null}};for(;h!==null;){switch(h.content.constructor){case wt:case Ft:this.adds(h)?this.deletes(h)||(E(),f="insert",g=h.content.getContent()[0],E()):this.deletes(h)?(f!=="delete"&&(E(),f="delete"),m+=1):h.deleted||(f!=="retain"&&(E(),f="retain"),u+=1);break;case ht:this.adds(h)?this.deletes(h)||(f!=="insert"&&(E(),f="insert"),g+=h.content.str):this.deletes(h)?(f!=="delete"&&(E(),f="delete"),m+=h.length):h.deleted||(f!=="retain"&&(E(),f="retain"),u+=h.length);break;case M:{const{key:_,value:k}=h.content;if(this.adds(h)){if(!this.deletes(h)){const S=s.get(_)??null;Et(S,k)?k!==null&&h.delete(r):(f==="retain"&&E(),Et(k,c.get(_)??null)?delete d[_]:d[_]=k)}}else if(this.deletes(h)){c.set(_,k);const S=s.get(_)??null;Et(S,k)||(f==="retain"&&E(),d[_]=S)}else if(!h.deleted){c.set(_,k);const S=d[_];S!==void 0&&(Et(S,k)?S!==null&&h.delete(r):(f==="retain"&&E(),k===null?delete d[_]:d[_]=k))}h.deleted||(f==="insert"&&E(),ne(s,h.content));break}}h=h.right}for(E();n.length>0;){const _=n[n.length-1];if(_.retain!==void 0&&_.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class qt extends j{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??v(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new qt}clone(){const t=new qt;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Ml(this,t,n);cn(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??v();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ht&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?A(this.doc,r=>{const s=new On(null,this._start,0,new Map);for(let c=0;c<t.length;c++){const h=t[c];if(h.insert!==void 0){const f=!n&&typeof h.insert=="string"&&c===t.length-1&&s.right===null&&h.insert.slice(-1)===`
`?h.insert.slice(0,-1):h.insert;(typeof f!="string"||f.length>0)&&xn(r,this,s,f,h.attributes||{})}else h.retain!==void 0?Yr(r,this,s,h.retain,h.attributes||{}):h.delete!==void 0&&Kr(r,s,h.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??v();const s=[],c=new Map,h=this.doc;let f="",d=this._start;function g(){if(f.length>0){const m={};let E=!1;c.forEach((k,S)=>{E=!0,m[S]=k});const _={insert:f};E&&(_.attributes=m),s.push(_),f=""}}const u=()=>{for(;d!==null;){if($t(d,t)||n!==void 0&&$t(d,n))switch(d.content.constructor){case ht:{const m=c.get("ychange");t!==void 0&&!$t(d,t)?(m===void 0||m.user!==d.id.client||m.type!=="removed")&&(g(),c.set("ychange",r?r("removed",d.id):{type:"removed"})):n!==void 0&&!$t(d,n)?(m===void 0||m.user!==d.id.client||m.type!=="added")&&(g(),c.set("ychange",r?r("added",d.id):{type:"added"})):m!==void 0&&(g(),c.delete("ychange")),f+=d.content.str;break}case wt:case Ft:{g();const m={insert:d.content.getContent()[0]};if(c.size>0){const E={};m.attributes=E,c.forEach((_,k)=>{E[k]=_})}s.push(m);break}case M:$t(d,t)&&(g(),ne(c,d.content));break}d=d.right}g()};return t||n?A(h,m=>{t&&Rn(m,t),n&&Rn(m,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?A(s,c=>{const h=Ie(c,this,t,!r);r||(r={},h.currentAttributes.forEach((f,d)=>{r[d]=f})),xn(c,this,h,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?A(s,c=>{const h=Ie(c,this,t,!r);xn(c,this,h,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?A(r,s=>{Kr(s,Ie(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?A(s,c=>{const h=Ie(c,this,t,!1);h.right!==null&&Yr(c,this,h,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?A(this.doc,n=>{ve(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?A(this.doc,r=>{cr(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return lr(this,t)}getAttributes(){return ts(this)}_write(t){t.writeTypeRef(eh)}}const Ol=e=>new qt;class Sn{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??v()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Pt||n.constructor===Bt)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Bt extends j{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Bt}clone(){const t=new Bt;return t.insert(0,this.toArray().map(n=>n instanceof j?n.clone():n)),t}get length(){return this.doc??v(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Sn(this,t)}querySelector(t){t=t.toUpperCase();const r=new Sn(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),_t(new Sn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){cn(this,t,new Vl(this,n,t))}toString(){return Xi(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),pe(this,c=>{s.insertBefore(c.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?A(this.doc,r=>{Zi(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)A(this.doc,r=>{const s=t&&t instanceof j?t._item:t;je(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(c=>c===t)+1;if(s===0&&t!==null)throw Q("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?A(this.doc,r=>{Qi(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Wi(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return qi(this,t)}slice(t=0,n=this.length){return Hi(this,t,n)}forEach(t){pe(this,t)}_write(t){t.writeTypeRef(rh)}}const Nl=e=>new Bt;class Pt extends Bt{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Pt(this.nodeName)}clone(){const t=new Pt(this.nodeName),n=this.getAttributes();return Go(n,(r,s)=>{t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof j?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const f in t)r.push(f);r.sort();const s=r.length;for(let f=0;f<s;f++){const d=r[f];n.push(d+'="'+t[d]+'"')}const c=this.nodeName.toLocaleLowerCase(),h=n.length>0?" "+n.join(" "):"";return`<${c}${h}>${super.toString()}</${c}>`}removeAttribute(t){this.doc!==null?A(this.doc,n=>{ve(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?A(this.doc,r=>{cr(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return lr(this,t)}hasAttribute(t){return es(this,t)}getAttributes(t){return t?Dl(this,t):ts(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),c=this.getAttributes();for(const h in c){const f=c[h];typeof f=="string"&&s.setAttribute(h,f)}return pe(this,h=>{s.appendChild(h.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(nh),t.writeKey(this.nodeName)}}const $l=e=>new Pt(e.readKey());class Vl extends sn{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Ge extends Xt{constructor(t){super(),this.hookName=t}_copy(){return new Ge(this.hookName)}clone(){const t=new Ge(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let c;return s!==void 0?c=s.createDom(this):c=document.createElement(this.hookName),c.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(c,this),c}_write(t){t.writeTypeRef(ih),t.writeKey(this.hookName)}}const jl=e=>new Ge(e.readKey());class Je extends qt{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Je}clone(){const t=new Je;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const c=[];for(const h in t.attributes[s])c.push({key:h,value:t.attributes[s][h]});c.sort((h,f)=>h.key<f.key?-1:1),n.push({nodeName:s,attrs:c})}n.sort((s,c)=>s.nodeName<c.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const c=n[s];r+=`<${c.nodeName}`;for(let h=0;h<c.attrs.length;h++){const f=c.attrs[h];r+=` ${f.key}="${f.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(sh)}}const vl=e=>new Je;class hr{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Z()}mergeWith(t){return!1}write(t,n,r){throw Z()}integrate(t,n){throw Z()}}const Gl=0;class X extends hr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),vi(t.doc.store,this)}write(t,n){t.writeInfo(Gl),t.writeLen(this.length-n)}getMissing(t,n){return null}}class _e{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new _e(this.content)}splice(t){throw Z()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Jl=e=>new _e(e.readBuf());class ge{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ge(this.len)}splice(t){const n=new ge(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){$e(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const zl=e=>new ge(e.readLen()),os=(e,t)=>new ee({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class ke{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ke(os(this.doc.guid,this.opts))}splice(t){throw Z()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Yl=e=>new ke(os(e.readString(),e.readAny()));class Ft{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ft(this.embed)}splice(t){throw Z()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Kl=e=>new Ft(e.readJSON());class M{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new M(this.key,this.value)}splice(t){throw Z()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Hl=e=>new M(e.readKey(),e.readJSON());class ze{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ze(this.arr)}splice(t){const n=new ze(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const c=this.arr[s];t.writeString(c===void 0?"undefined":JSON.stringify(c))}}getRef(){return 2}}const Wl=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new ze(n)},Xl=Me("node_env")==="development";class Tt{constructor(t){this.arr=t,Xl&&oi(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Tt(this.arr)}splice(t){const n=new Tt(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const c=this.arr[s];t.writeAny(c)}}getRef(){return 8}}const ql=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Tt(n)};class ht{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ht(this.str)}splice(t){const n=new ht(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Pl=e=>new ht(e.readString()),Zl=[Bl,Ul,Ol,$l,Nl,jl,vl],Ql=0,th=1,eh=2,nh=3,rh=4,ih=5,sh=6;class wt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new wt(this.type._copy())}splice(t){throw Z()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const oh=e=>new wt(Zl[e.readTypeRef()](e)),Ye=(e,t,n)=>{const{client:r,clock:s}=t.id,c=new R(I(r,s+n),t,I(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&c.markDeleted(),t.keep&&(c.keep=!0),t.redone!==null&&(c.redone=I(t.redone.client,t.redone.clock+n)),t.right=c,c.right!==null&&(c.right.left=c),e._mergeStructs.push(c),c.parentSub!==null&&c.right===null&&c.parent._map.set(c.parentSub,c),t.length=n,c};class R extends hr{constructor(t,n,r,s,c,h,f,d){super(t,d.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=c,this.parent=h,this.parentSub=f,this.redone=null,this.content=d,this.info=this.content.isCountable()?Ir:0}set marker(t){(this.info&wn)>0!==t&&(this.info^=wn)}get marker(){return(this.info&wn)>0}get keep(){return(this.info&Sr)>0}set keep(t){this.keep!==t&&(this.info^=Sr)}get countable(){return(this.info&Ir)>0}get deleted(){return(this.info&gn)>0}set deleted(t){this.deleted!==t&&(this.info^=gn)}markDeleted(){this.info|=gn}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=$(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=$(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Jt&&this.id.client!==this.parent.client&&this.parent.clock>=$(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=jr(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=kt(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===X||this.right&&this.right.constructor===X)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===R?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===R&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Jt){const r=bn(n,this.parent);r.constructor===X?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=jr(t,t.doc.store,I(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const c=new Set,h=new Set;for(;s!==null&&s!==this.right;){if(h.add(s),c.add(s),xe(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,c.clear();else if(xe(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&h.has(bn(t.doc.store,s.origin)))c.has(bn(t.doc.store,s.origin))||(r=s,c.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),vi(t.doc.store,this),this.content.integrate(t,this),Gr(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new X(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:I(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&xe(t.origin,this.lastId)&&this.right===t&&xe(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),$e(t.deleteSet,this.id.client,this.id.clock,this.length),Gr(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw P();this.content.gc(t),n?al(t,this,new X(this.id,this.length)):this.content=new ge(this.length)}write(t,n){const r=n>0?I(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,c=this.parentSub,h=this.content.getRef()&We|(r===null?0:H)|(s===null?0:ft)|(c===null?0:oe);if(t.writeInfo(h),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const f=this.parent;if(f._item!==void 0){const d=f._item;if(d===null){const g=hl(f);t.writeParentInfo(!0),t.writeString(g)}else t.writeParentInfo(!1),t.writeLeftID(d.id)}else f.constructor===String?(t.writeParentInfo(!0),t.writeString(f)):f.constructor===Jt?(t.writeParentInfo(!1),t.writeLeftID(f)):P();c!==null&&t.writeString(c)}this.content.write(t,n)}}const cs=(e,t)=>ch[t&We](e),ch=[()=>{P()},zl,Wl,Jl,Pl,Kl,Hl,oh,ql,Yl,()=>{P()}],lh=10;class q extends hr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){P()}write(t,n){t.writeInfo(lh),C(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof xr<"u"?xr:{},hs="__ $YJS$ __";ls[hs]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ls[hs]=!0;const Lt=e=>Kt((t,n)=>{e.onerror=r=>n(new Error(r.target.error)),e.onsuccess=r=>t(r.target.result)}),hh=(e,t)=>Kt((n,r)=>{const s=indexedDB.open(e);s.onupgradeneeded=c=>t(c.target.result),s.onerror=c=>r(Q(c.target.error)),s.onsuccess=c=>{const h=c.target.result;h.onversionchange=()=>{h.close()},n(h)}}),uh=e=>Lt(indexedDB.deleteDatabase(e)),ah=(e,t)=>t.forEach(n=>e.createObjectStore.apply(e,n)),ie=(e,t,n="readwrite")=>{const r=e.transaction(t,n);return t.map(s=>Eh(r,s))},us=(e,t)=>Lt(e.count(t)),fh=(e,t)=>Lt(e.get(t)),as=(e,t)=>Lt(e.delete(t)),dh=(e,t,n)=>Lt(e.put(t,n)),Nn=(e,t)=>Lt(e.add(t)),ph=(e,t,n)=>Lt(e.getAll(t,n)),gh=(e,t,n)=>{let r=null;return mh(e,t,s=>(r=s,!1),n).then(()=>r)},wh=(e,t=null)=>gh(e,t,"prev"),yh=(e,t)=>Kt((n,r)=>{e.onerror=r,e.onsuccess=async s=>{const c=s.target.result;if(c===null||await t(c)===!1)return n();c.continue()}}),mh=(e,t,n,r="next")=>yh(e.openKeyCursor(t,r),s=>n(s.key)),Eh=(e,t)=>e.objectStore(t),_h=(e,t)=>IDBKeyRange.upperBound(e,t),kh=(e,t)=>IDBKeyRange.lowerBound(e,t),In="custom",fs="updates",ds=500,ps=(e,t=()=>{},n=()=>{})=>{const[r]=ie(e.db,[fs]);return ph(r,kh(e._dbref,!1)).then(s=>{e._destroyed||(t(r),A(e.doc,()=>{s.forEach(c=>il(e.doc,c))},e,!1),n(r))}).then(()=>wh(r).then(s=>{e._dbref=s+1})).then(()=>us(r).then(s=>{e._dbsize=s})).then(()=>r)},bh=(e,t=!0)=>ps(e).then(n=>{(t||e._dbsize>=ds)&&Nn(n,Ni(e.doc)).then(()=>as(n,_h(e._dbref,!0))).then(()=>us(n).then(r=>{e._dbsize=r}))});class xh extends eo{constructor(t,n){super(),this.doc=n,this.name=t,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=hh(t,r=>ah(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Kt(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,ps(this,h=>Nn(h,Ni(n)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){const[c]=ie(this.db,[fs]);Nn(c,r),++this._dbsize>=ds&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{bh(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},n.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{uh(this.name)})}get(t){return this._db.then(n=>{const[r]=ie(n,[In],"readonly");return fh(r,t)})}set(t,n){return this._db.then(r=>{const[s]=ie(r,[In]);return dh(s,n,t)})}del(t){return this._db.then(n=>{const[r]=ie(n,[In]);return as(r,t)})}}const Sh="schwalbvault",bt=new ee,Ih=typeof window<"u",Fe=Ih?new xh(Sh,bt):null,Ch=bt.getMap("characters"),Dh=bt.getMap("campaigns"),Ah=bt.getMap("enemies"),Bh=bt.getMap("encounters"),Th=bt.getMap("images"),Uh=bt.getMap("deletedIds"),Fh=()=>new Promise(e=>{if(!Fe){e();return}Fe.synced?e():Fe.on("synced",()=>{e()})}),Mh=Object.freeze(Object.defineProperty({__proto__:null,campaignsMap:Dh,charactersMap:Ch,deletedIdsMap:Uh,doc:bt,encountersMap:Bh,enemiesMap:Ah,imagesMap:Th,provider:Fe,waitForSync:Fh},Symbol.toStringTag,{value:"Module"}));export{Dh as a,Bh as b,Ch as c,Sh as d,Ah as e,Uh as f,Mh as g,Th as i,Fh as w};
