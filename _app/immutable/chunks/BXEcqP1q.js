import"./DsnmJJEf.js";import"./ChbcetSK.js";import{u as x,v as h,k as w}from"./DfayzYqb.js";import{I as $,s as v}from"./tM_ceOsH.js";import{l as C,s as S}from"./C746LlRB.js";import{w as T}from"./Cx0o8vWd.js";import{a as d,c as m}from"./CdkHlkWG.js";function E(e,a){const l=C(a,["children","$$slots","$$events","$$legacy"]);const n=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21"}]];$(e,S({name:"swords"},()=>l,{get iconNode(){return n},children:(r,p)=>{var u=x(),f=h(u);v(f,a,"default",{}),w(r,u)},$$slots:{default:!0}}))}const _=T(null);let i=null,c=null;function b(e){typeof window>"u"||(i&&c!==e&&(i.close(),i=null),c=e,i=new BroadcastChannel(`campaign-${e}`),i.onmessage=a=>{const{type:l,data:n}=a.data;if(console.log("[TabSync] Received:",l,n),l==="combat-update")_.set(n);else if(l==="campaign-update"){const r=d.get(e);r&&(console.log("[TabSync] Updating campaign, current:",r,"new data:",n),d.set(e,{...r,...n}),setTimeout(()=>{const p=d.get(e);p&&d.set(e,{...p})},0))}else if(l==="character-update"){const r=m.get(n.id);r&&m.set(n.id,{...r,...n})}},i.postMessage({type:"request-state"}))}function I(e,a){(!i||c!==e)&&b(e),i&&(console.log("[TabSync] Broadcasting campaign-update:",a),i.postMessage({type:"campaign-update",data:a}))}function q(e,a){(!i||c!==e)&&b(e),i&&i.postMessage({type:"character-update",data:a})}function z(){i&&(i.close(),i=null),c=null}function W(e,a,l){const n=l.map(t=>({...t,type:"enemy"}));if(e==="standard"){const t=a.filter(s=>s.initiative).map(s=>({...s,type:"player",isFast:!0})),o=a.filter(s=>!s.initiative).map(s=>({...s,type:"player",isFast:!1})),y=n.filter(s=>s.initiative).map(s=>({...s,isFast:!0})),g=n.filter(s=>!s.initiative).map(s=>({...s,isFast:!1}));return[...t,...y,...o,...g]}if(e==="individual")return[...a.map(o=>({...o,type:"player",totalInit:(o.initiativeRoll||0)+(o.attributes?.agility||10)-10})),...n.map(o=>({...o,type:"enemy",totalInit:(o.initiativeRoll||0)+(o.attributes?.agility||10)-10}))].sort((o,y)=>y.totalInit-o.totalInit);const r=a.filter(t=>t&&t.initiative).map(t=>({...t,type:"player"})),p=a.filter(t=>t&&!t.initiative).map(t=>({...t,type:"player"})),u=[...r,...n,...p],f=new Set;return u.filter(t=>{if(!t)return!1;const o=t.type==="player"?t.id:t.instanceId;return f.has(o)?!1:(f.add(o),!0)})}export{E as S,W as a,q as b,I as c,b as s,z as u};
