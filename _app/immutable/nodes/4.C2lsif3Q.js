import{f as Xt,a as wt}from"../chunks/BxXi4Znt.js";import"../chunks/waaCRLeK.js";import{o as Mn}from"../chunks/BWB19hXm.js";import{Q as rt,a2 as Nn,Z as qe,j as re,R as Rn,O as Bn,g as Z,z as On,aE as Dn,a4 as Un,ag as xt,au as je,W as Re,a3 as Hn,az as $n,ae as In,aB as be,a5 as at,aD as Kn,aH as $e,$ as kt,aL as Vn,aC as Yt,a7 as Zn,aM as Xn,aN as Yn,aO as We,ax as Jt,as as Jn,aP as zn,aQ as Fn,aw as Gn,af as qn,aR as jn,aS as Wn,aJ as Qn,b as es,a0 as ts,aT as ns,I as ss,t as _t,J as rs,s as _e,K as ue,x as Be,aU as At,M as ie}from"../chunks/DWmaoMlr.js";import{e as Tt,s as Qe}from"../chunks/BWmJog2z.js";import{r as as}from"../chunks/D25Eur1q.js";import{i as os}from"../chunks/CU-omtc-.js";function cs(e,t){return t}function is(e,t,n){for(var r=[],s=t.length,a=0;a<s;a++)zn(t[a].e,r,!0);Fn(r,()=>{var c=r.length===0&&n!==null;if(c){var i=n,y=i.parentNode;Gn(y),y.append(i),e.items.clear(),F(e,t[0].prev,t[s-1].next)}for(var d=0;d<s;d++){var f=t[d];c||(e.items.delete(f.k),F(e,f.prev,f.next)),qn(f.e,!c)}e.first===t[0]&&(e.first=t[0].prev)})}function fs(e,t,n,r,s,a=null){var c=e,i=new Map,y=null;{var d=e;c=re?qe(Rn(d)):d.appendChild(rt())}re&&Bn();var f=null,o=On(()=>{var k=n();return jn(k)?k:k==null?[]:Jt(k)}),l,g=!0;function h(){ls(S,l,c,t,r),f!==null&&(l.length===0?(f.fragment?(c.before(f.fragment),f.fragment=null):Yt(f.effect),x.first=f.effect):Zn(f.effect,()=>{f=null}))}var x=Nn(()=>{l=Z(o);var k=l.length;let _=!1;if(re){var T=Dn(c)===Un;T!==(k===0)&&(c=xt(),qe(c),je(!1),_=!0)}for(var B=new Set,C=be,N=null,X=Kn(),H=0;H<k;H+=1){re&&Re.nodeType===Hn&&Re.data===$n&&(c=Re,_=!0,je(!1));var z=l[H],W=r(z,H),$=g?null:i.get(W);$?(In($.v,z),$.i=H,X&&C.skipped_effects.delete($.e)):($=us(g?c:null,N,z,W,H,s,t,n),g&&($.o=!0,N===null?y=$:N.next=$,N=$),i.set(W,$)),B.add(W)}if(k===0&&a&&!f)if(g)f={fragment:null,effect:at(()=>a(c))};else{var u=document.createDocumentFragment(),m=rt();u.append(m),f={fragment:u,effect:at(()=>a(m))}}if(re&&k>0&&qe(xt()),!g)if(X){for(const[w,A]of i)B.has(w)||C.skipped_effects.add(A.e);C.oncommit(h),C.ondiscard(()=>{})}else h();_&&je(!0),Z(o)}),S={effect:x,items:i,first:y};g=!1,re&&(c=Re)}function ls(e,t,n,r,s){var a=t.length,c=e.items,i=e.first,y,d=null,f=[],o=[],l,g,h,x;for(x=0;x<a;x+=1){if(l=t[x],g=s(l,x),h=c.get(g),e.first??=h,!h.o){h.o=!0;var S=d?d.next:i;F(e,d,h),F(e,h,S),et(h,S,n),d=h,f=[],o=[],i=d.next;continue}if((h.e.f&We)!==0&&Yt(h.e),h!==i){if(y!==void 0&&y.has(h)){if(f.length<o.length){var k=o[0],_;d=k.prev;var T=f[0],B=f[f.length-1];for(_=0;_<f.length;_+=1)et(f[_],k,n);for(_=0;_<o.length;_+=1)y.delete(o[_]);F(e,T.prev,B.next),F(e,d,T),F(e,B,k),i=k,d=B,x-=1,f=[],o=[]}else y.delete(h),et(h,i,n),F(e,h.prev,h.next),F(e,h,d===null?e.first:d.next),F(e,d,h),d=h;continue}for(f=[],o=[];i!==null&&i.k!==g;)(i.e.f&We)===0&&(y??=new Set).add(i),o.push(i),i=i.next;if(i===null)continue;h=i}f.push(h),d=h,i=h.next}let C=c.size>a;if(i!==null||y!==void 0){for(var N=y===void 0?[]:Jt(y);i!==null;)(i.e.f&We)===0&&N.push(i),i=i.next;var X=N.length;if(C=c.size-X>a,X>0){var H=a===0?n:null;is(e,N,H)}}if(C)for(const z of c.values())z.o||(F(e,d,z),d=z);e.effect.last=d&&d.e}function us(e,t,n,r,s,a,c,i){var y=(c&Xn)!==0,d=(c&Yn)===0,f=y?d?$e(n,!1,!1):kt(n):n,o=(c&Vn)===0?s:kt(s),l={i:o,v:f,k:r,a:null,e:null,o:!1,prev:t,next:null};try{if(e===null){var g=document.createDocumentFragment();g.append(e=rt())}return l.e=at(()=>a(e,f,o,i)),t!==null&&(t.next=l),l}finally{}}function et(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,a=e.e.nodes_start;a!==null&&a!==r;){var c=Jn(a);s.before(a),a=c}}function F(e,t,n){t===null?(e.first=n,e.effect.first=n&&n.e):(t.e.next&&(t.e.next.prev=null),t.next=n,t.e.next=n&&n.e),n!==null&&(n.e.prev&&(n.e.prev.next=null),n.prev=t,n.e.prev=t&&t.e)}function ds(e,t,n){var r=e==null?"":""+e;return r===""?null:r}function St(e,t,n,r,s,a){var c=e.__className;if(re||c!==n||c===void 0){var i=ds(n);(!re||i!==e.getAttribute("class"))&&(i==null?e.removeAttribute("class"):e.className=i),e.__className=n}return a}function ys(e,t,n=t){var r=new WeakSet;Wn(e,"input",async s=>{var a=s?e.defaultValue:e.value;if(a=tt(e)?nt(a):a,n(a),be!==null&&r.add(be),await Qn(),a!==(a=t())){var c=e.selectionStart,i=e.selectionEnd,y=e.value.length;if(e.value=a??"",i!==null){var d=e.value.length;c===i&&i===y&&d>y?(e.selectionStart=d,e.selectionEnd=d):(e.selectionStart=c,e.selectionEnd=Math.min(i,d))}}}),(re&&e.defaultValue!==e.value||es(t)==null&&e.value)&&(n(tt(e)?nt(e.value):e.value),be!==null&&r.add(be)),ts(()=>{var s=t();if(e===document.activeElement){var a=ns??be;if(r.has(a))return}tt(e)&&s===nt(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function tt(e){var t=e.type;return t==="number"||t==="range"}function nt(e){return e===""?null:+e}const zt={p:0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,n:0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,h:1n,a:0n,b:7n,Gx:0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy:0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n},{p:le,n:Ne,Gx:ps,Gy:hs,b:Ft}=zt,J=32,Pe=64,ot={publicKey:J+1,publicKeyUncompressed:Pe+1,seed:J+J/2},ms=(...e)=>{"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(...e)},M=(e="")=>{const t=new Error(e);throw ms(t,M),t},gs=e=>typeof e=="bigint",vs=e=>typeof e=="string",bs=e=>e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array",q=(e,t,n="")=>{const r=bs(e),s=e?.length,a=t!==void 0;if(!r||a&&s!==t){const c=n&&`"${n}" `,i=a?` of length ${t}`:"",y=r?`length=${s}`:`type=${typeof e}`;M(c+"expected Uint8Array"+i+", got "+y)}return e},Ce=e=>new Uint8Array(e),Gt=(e,t)=>e.toString(16).padStart(t,"0"),qt=e=>Array.from(q(e)).map(t=>Gt(t,2)).join(""),se={_0:48,_9:57,A:65,F:70,a:97,f:102},Et=e=>{if(e>=se._0&&e<=se._9)return e-se._0;if(e>=se.A&&e<=se.F)return e-(se.A-10);if(e>=se.a&&e<=se.f)return e-(se.a-10)},jt=e=>{const t="hex invalid";if(!vs(e))return M(t);const n=e.length,r=n/2;if(n%2)return M(t);const s=Ce(r);for(let a=0,c=0;a<r;a++,c+=2){const i=Et(e.charCodeAt(c)),y=Et(e.charCodeAt(c+1));if(i===void 0||y===void 0)return M(t);s[a]=i*16+y}return s},Wt=()=>globalThis?.crypto,Pt=()=>Wt()?.subtle??M("crypto.subtle must be defined, consider polyfill"),xe=(...e)=>{const t=Ce(e.reduce((r,s)=>r+q(s).length,0));let n=0;return e.forEach(r=>{t.set(r,n),n+=r.length}),t},pt=(e=J)=>Wt().getRandomValues(Ce(e)),Ye=BigInt,he=(e,t,n,r="bad number: out of range")=>gs(e)&&t<=e&&e<n?e:M(r),p=(e,t=le)=>{const n=e%t;return n>=0n?n:t+n},Ge=e=>p(e,Ne),ws=(e,t)=>{(e===0n||t<=0n)&&M("no inverse n="+e+" mod="+t);let n=p(e,t),r=t,s=0n,a=1n;for(;n!==0n;){const c=r/n,i=r%n,y=s-a*c;r=n,n=i,s=a,a=y}return r===1n?p(s,t):M("no inverse")},xs=e=>{const t=nn[e];return typeof t!="function"&&M("hashes."+e+" not set"),t},st=e=>e instanceof Y?e:M("Point expected"),Qt=e=>p(p(e*e)*e+Ft),Ct=e=>he(e,0n,le),Ie=e=>he(e,1n,le),ks=e=>he(e,1n,Ne),ke=e=>(e&1n)===0n,en=e=>Uint8Array.of(e),_s=e=>en(ke(e)?2:3),tn=e=>{const t=Qt(Ie(e));let n=1n;for(let r=t,s=(le+1n)/4n;s>0n;s>>=1n)s&1n&&(n=n*r%le),r=r*r%le;return p(n*n)===t?n:M("sqrt invalid")};class Y{static BASE;static ZERO;X;Y;Z;constructor(t,n,r){this.X=Ct(t),this.Y=Ie(n),this.Z=Ct(r),Object.freeze(this)}static CURVE(){return zt}static fromAffine(t){const{x:n,y:r}=t;return n===0n&&r===0n?ye:new Y(n,r,1n)}static fromBytes(t){q(t);const{publicKey:n,publicKeyUncompressed:r}=ot;let s;const a=t.length,c=t[0],i=t.subarray(1),y=Je(i,0,J);if(a===n&&(c===2||c===3)){let d=tn(y);const f=ke(d);ke(Ye(c))!==f&&(d=p(-d)),s=new Y(y,d,1n)}return a===r&&c===4&&(s=new Y(y,Je(i,J,Pe),1n)),s?s.assertValidity():M("bad point: not on curve")}static fromHex(t){return Y.fromBytes(jt(t))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(t){const{X:n,Y:r,Z:s}=this,{X:a,Y:c,Z:i}=st(t),y=p(n*i),d=p(a*s),f=p(r*i),o=p(c*s);return y===d&&f===o}is0(){return this.equals(ye)}negate(){return new Y(this.X,p(-this.Y),this.Z)}double(){return this.add(this)}add(t){const{X:n,Y:r,Z:s}=this,{X:a,Y:c,Z:i}=st(t),y=0n,d=Ft;let f=0n,o=0n,l=0n;const g=p(d*3n);let h=p(n*a),x=p(r*c),S=p(s*i),k=p(n+r),_=p(a+c);k=p(k*_),_=p(h+x),k=p(k-_),_=p(n+s);let T=p(a+i);return _=p(_*T),T=p(h+S),_=p(_-T),T=p(r+s),f=p(c+i),T=p(T*f),f=p(x+S),T=p(T-f),l=p(y*_),f=p(g*S),l=p(f+l),f=p(x-l),l=p(x+l),o=p(f*l),x=p(h+h),x=p(x+h),S=p(y*S),_=p(g*_),x=p(x+S),S=p(h-S),S=p(y*S),_=p(_+S),h=p(x*_),o=p(o+h),h=p(T*_),f=p(k*f),f=p(f-h),h=p(k*x),l=p(T*l),l=p(l+h),new Y(f,o,l)}subtract(t){return this.add(st(t).negate())}multiply(t,n=!0){if(!n&&t===0n)return ye;if(ks(t),t===1n)return this;if(this.equals(me))return Os(t).p;let r=ye,s=me;for(let a=this;t>0n;a=a.double(),t>>=1n)t&1n?r=r.add(a):n&&(s=s.add(a));return r}multiplyUnsafe(t){return this.multiply(t,!1)}toAffine(){const{X:t,Y:n,Z:r}=this;if(this.equals(ye))return{x:0n,y:0n};if(r===1n)return{x:t,y:n};const s=ws(r,le);return p(r*s)!==1n&&M("inverse invalid"),{x:p(t*s),y:p(n*s)}}assertValidity(){const{x:t,y:n}=this.toAffine();return Ie(t),Ie(n),p(n*n)===Qt(t)?this:M("bad point: not on curve")}toBytes(t=!0){const{x:n,y:r}=this.assertValidity().toAffine(),s=j(n);return t?xe(_s(r),s):xe(en(4),s,j(r))}toHex(t){return qt(this.toBytes(t))}}const me=new Y(ps,hs,1n),ye=new Y(0n,1n,0n);Y.BASE=me;Y.ZERO=ye;const As=(e,t,n)=>me.multiply(t,!1).add(e.multiply(n,!1)).assertValidity(),ge=e=>Ye("0x"+(qt(e)||"0")),Je=(e,t,n)=>ge(e.subarray(t,n)),Ts=2n**256n,j=e=>jt(Gt(he(e,0n,Ts),Pe)),Ss=e=>{const t=ge(q(e,J,"secret key"));return he(t,1n,Ne,"invalid secret key: outside of range")},Lt="SHA-256",nn={hmacSha256Async:async(e,t)=>{const n=Pt(),r="HMAC",s=await n.importKey("raw",e,{name:r,hash:{name:Lt}},!1,["sign"]);return Ce(await n.sign(r,s,t))},hmacSha256:void 0,sha256Async:async e=>Ce(await Pt().digest(Lt,e)),sha256:void 0},Es=(e=pt(ot.seed))=>{q(e),(e.length<ot.seed||e.length>1024)&&M("expected 40-1024b");const t=p(ge(e),Ne-1n);return j(t+1n)},Ps=e=>t=>{const n=Es(t);return{secretKey:n,publicKey:e(n)}},sn=e=>Uint8Array.from("BIP0340/"+e,t=>t.charCodeAt(0)),rn="aux",an="nonce",on="challenge",ct=(e,...t)=>{const n=xs("sha256"),r=n(sn(e));return n(xe(r,r,...t))},it=async(e,...t)=>{const n=nn.sha256Async,r=await n(sn(e));return await n(xe(r,r,...t))},ht=e=>{const t=Ss(e),n=me.multiply(t),{x:r,y:s}=n.assertValidity().toAffine(),a=ke(s)?t:Ge(-t),c=j(r);return{d:a,px:c}},mt=e=>Ge(ge(e)),cn=(...e)=>mt(ct(on,...e)),fn=async(...e)=>mt(await it(on,...e)),ln=e=>ht(e).px,Cs=Ps(ln),un=(e,t,n)=>{const{px:r,d:s}=ht(t);return{m:q(e),px:r,d:s,a:q(n,J)}},dn=e=>{const t=mt(e);t===0n&&M("sign failed: k is zero");const{px:n,d:r}=ht(j(t));return{rx:n,k:r}},yn=(e,t,n,r)=>xe(t,j(Ge(e+n*r))),pn="invalid signature produced",Ls=(e,t,n=pt(J))=>{const{m:r,px:s,d:a,a:c}=un(e,t,n),i=ct(rn,c),y=j(a^ge(i)),d=ct(an,y,s,r),{rx:f,k:o}=dn(d),l=cn(f,s,r),g=yn(o,f,l,a);return mn(g,r,s)||M(pn),g},Ms=async(e,t,n=pt(J))=>{const{m:r,px:s,d:a,a:c}=un(e,t,n),i=await it(rn,c),y=j(a^ge(i)),d=await it(an,y,s,r),{rx:f,k:o}=dn(d),l=await fn(f,s,r),g=yn(o,f,l,a);return await gn(g,r,s)||M(pn),g},Ns=(e,t)=>e instanceof Promise?e.then(t):t(e),hn=(e,t,n,r)=>{const s=q(e,Pe,"signature"),a=q(t,void 0,"message"),c=q(n,J,"publicKey");try{const i=ge(c),y=tn(i),d=ke(y)?y:p(-y),f=new Y(i,d,1n).assertValidity(),o=j(f.toAffine().x),l=Je(s,0,J);he(l,1n,le);const g=Je(s,J,Pe);he(g,1n,Ne);const h=xe(j(l),o,a);return Ns(r(h),x=>{const{x:S,y:k}=As(f,g,Ge(-x)).toAffine();return!(!ke(k)||S!==l)})}catch{return!1}},mn=(e,t,n)=>hn(e,t,n,cn),gn=async(e,t,n)=>hn(e,t,n,fn),vn={keygen:Cs,getPublicKey:ln,sign:Ls,verify:mn,signAsync:Ms,verifyAsync:gn},ze=8,Rs=256,bn=Math.ceil(Rs/ze)+1,ft=2**(ze-1),Bs=()=>{const e=[];let t=me,n=t;for(let r=0;r<bn;r++){n=t,e.push(n);for(let s=1;s<ft;s++)n=n.add(t),e.push(n);t=n.double()}return e};let Mt;const Nt=(e,t)=>{const n=t.negate();return e?n:t},Os=e=>{const t=Mt||(Mt=Bs());let n=ye,r=me;const s=2**ze,a=s,c=Ye(s-1),i=Ye(ze);for(let y=0;y<bn;y++){let d=Number(e&c);e>>=i,d>ft&&(d-=a,e+=1n);const f=y*ft,o=f,l=f+Math.abs(d)-1,g=y%2!==0,h=d<0;d===0?r=r.add(Nt(g,t[o])):n=n.add(Nt(h,t[l]))}return e!==0n&&M("invalid wnaf"),{p:n,f:r}},{floor:lt,random:Ds,sin:Us}=Math,Le="Trystero",Me=(e,t)=>Array(e).fill().map(t),Rt="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",ut=e=>Me(e,()=>Rt[lt(Ds()*Rt.length)]).join(""),fe=ut(20),pe=Promise.all.bind(Promise),wn=typeof window<"u",{entries:Bt,fromEntries:Hs,keys:$s}=Object,ae=()=>{},oe=e=>new Error(`${Le}: ${e}`),Is=new TextEncoder,Ks=new TextDecoder,we=e=>Is.encode(e),Ke=e=>Ks.decode(e),dt=e=>e.reduce((t,n)=>t+n.toString(16).padStart(2,"0"),""),Oe=(...e)=>e.join("@"),Vs=(e,t)=>{const n=[...e],r=()=>{const a=Us(t++)*1e4;return a-lt(a)};let s=n.length;for(;s;){const a=lt(r()*s--);[n[s],n[a]]=[n[a],n[s]]}return n},Zs=(e,t,n,r)=>(e.relayUrls||Vs(t,xn(e.appId))).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||n),ce=JSON.stringify,Fe=JSON.parse,xn=(e,t=Number.MAX_SAFE_INTEGER)=>e.split("").reduce((n,r)=>n+r.charCodeAt(0),0)%t,Ot=3333,De={};let Ee=null,yt=null;const Xs=()=>{Ee||(Ee=new Promise(e=>{yt=e}).finally(()=>{yt=null,Ee=null}))},Ys=()=>yt?.(),Js=(e,t)=>{const n={},r=()=>{const s=new WebSocket(e);s.onclose=()=>{if(Ee){Ee.then(r);return}De[e]??=Ot,setTimeout(r,De[e]),De[e]*=2},s.onmessage=a=>t(a.data),n.socket=s,n.url=s.url,n.ready=new Promise(a=>s.onopen=()=>{a(n),De[e]=Ot}),n.send=a=>{s.readyState===1&&s.send(a)}};return r(),n},zs=()=>{if(wn){const e=new AbortController;return addEventListener("online",Ys,{signal:e.signal}),addEventListener("offline",Xs,{signal:e.signal}),()=>e.abort()}return ae},gt="AES-GCM",Fs={},Gs=e=>btoa(String.fromCharCode.apply(null,new Uint8Array(e))),qs=e=>{const t=atob(e);return new Uint8Array(t.length).map((n,r)=>t.charCodeAt(r)).buffer},kn=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,we(t))),Ue=async e=>Fs[e]||=Array.from(await kn("SHA-1",e)).map(t=>t.toString(36)).join(""),js=async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},we(`${e}:${t}:${n}`)),{name:gt},!1,["encrypt","decrypt"]),_n="$",An=",",Ws=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));return n.join(An)+_n+Gs(await crypto.subtle.encrypt({name:gt,iv:n},await e,we(t)))},Qs=async(e,t)=>{const[n,r]=t.split(_n);return Ke(await crypto.subtle.decrypt({name:gt,iv:new Uint8Array(n.split(An))},await e,qs(r)))},er=5e3,Dt="icegatheringstatechange",Ut="offer",tr="answer",Ht=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:r})=>{const s=new(n||RTCPeerConnection)({iceServers:nr.concat(r||[]),...t}),a={};let c=!1,i=!1,y=null;const d=o=>{o.binaryType="arraybuffer",o.bufferedAmountLowThreshold=65535,o.onmessage=l=>a.data?.(l.data),o.onopen=()=>a.connect?.(),o.onclose=()=>a.close?.(),o.onerror=l=>a.error?.(l)},f=o=>Promise.race([new Promise(l=>{const g=()=>{o.iceGatheringState==="complete"&&(o.removeEventListener(Dt,g),l())};o.addEventListener(Dt,g),g()}),new Promise(l=>setTimeout(l,er))]).then(()=>({type:o.localDescription.type,sdp:o.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return e?(y=s.createDataChannel("data"),d(y)):s.ondatachannel=({channel:o})=>{y=o,d(o)},s.onnegotiationneeded=async()=>{try{c=!0,await s.setLocalDescription();const o=await f(s);a.signal?.(o)}catch(o){a.error?.(o)}finally{c=!1}},s.onconnectionstatechange=()=>{["disconnected","failed","closed"].includes(s.connectionState)&&a.close?.()},s.ontrack=o=>{a.track?.(o.track,o.streams[0]),a.stream?.(o.streams[0])},s.onremovestream=o=>a.stream?.(o.stream),e&&(s.canTrickleIceCandidates||s.onnegotiationneeded()),{created:Date.now(),connection:s,get channel(){return y},get isDead(){return s.connectionState==="closed"},async signal(o){if(!(y?.readyState==="open"&&!o.sdp?.includes("a=rtpmap")))try{if(o.type===Ut){if(c||s.signalingState!=="stable"&&!i){if(e)return;await pe([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(o)])}else await s.setRemoteDescription(o);await s.setLocalDescription();const l=await f(s);return a.signal?.(l),l}else if(o.type===tr){i=!0;try{await s.setRemoteDescription(o)}finally{i=!1}}}catch(l){a.error?.(l)}},sendData:o=>y.send(o),destroy:()=>{y?.close(),s.close(),c=!1,i=!1},setHandlers:o=>Object.assign(a,o),offerPromise:e?new Promise(o=>a.signal=l=>{l.type===Ut&&o(l)}):Promise.resolve(),addStream:o=>o.getTracks().forEach(l=>s.addTrack(l,o)),removeStream:o=>s.getSenders().filter(l=>o.getTracks().includes(l.track)).forEach(l=>s.removeTrack(l)),addTrack:(o,l)=>s.addTrack(o,l),removeTrack:o=>{const l=s.getSenders().find(g=>g.track===o);l&&s.removeTrack(l)},replaceTrack:(o,l)=>{const g=s.getSenders().find(h=>h.track===o);if(g)return g.replaceTrack(l)}}},nr=[...Me(3,(e,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(e=>({urls:e})),sr=Object.getPrototypeOf(Uint8Array),Ve=12,Tn=0,Ze=Tn+Ve,Xe=Ze+1,Te=Xe+1,Se=Te+1,de=16*2**10-Se,He=255,$t="bufferedamountlow",ve=e=>"@_"+e,rr=(e,t,n)=>{const r={},s={},a={},c={},i={},y={},d={},f={onPeerJoin:ae,onPeerLeave:ae,onPeerStream:ae,onPeerTrack:ae},o=(u,m)=>(u?Array.isArray(u)?u:[u]:$s(r)).flatMap(w=>{const A=r[w];return A?m(w,A):(console.warn(`${Le}: no peer with id ${w} found`),[])}),l=u=>{r[u]&&(r[u].destroy(),delete r[u],delete c[u],delete i[u],f.onPeerLeave(u),t(u))},g=u=>{if(s[u])return a[u];if(!u)throw oe("action type argument is required");const m=we(u);if(m.byteLength>Ve)throw oe(`action type string "${u}" (${m.byteLength}b) exceeds byte limit (${Ve}). Hint: choose a shorter name.`);const w=new Uint8Array(Ve);w.set(m);let A=0;return s[u]={onComplete:ae,onProgress:ae,setOnComplete:P=>s[u]={...s[u],onComplete:P},setOnProgress:P=>s[u]={...s[u],onProgress:P},send:async(P,v,b,L)=>{if(b&&typeof b!="object")throw oe("action meta argument must be an object");const V=typeof P;if(V==="undefined")throw oe("action data cannot be undefined");const O=V!=="string",Q=P instanceof Blob,E=Q||P instanceof ArrayBuffer||P instanceof sr;if(b&&!E)throw oe("action meta argument can only be used with binary data");const I=E?new Uint8Array(Q?await P.arrayBuffer():P):we(O?ce(P):P),G=b?we(ce(b)):null,R=Math.ceil(I.byteLength/de)+(b?1:0)||1,D=Me(R,(U,K)=>{const ee=K===R-1,te=b&&K===0,ne=new Uint8Array(Se+(te?G.byteLength:ee?I.byteLength-de*(R-(b?2:1)):de));return ne.set(w),ne.set([A],Ze),ne.set([ee|te<<1|E<<2|O<<3],Xe),ne.set([Math.round((K+1)/R*He)],Te),ne.set(b?te?G:I.subarray((K-1)*de,K*de):I.subarray(K*de,(K+1)*de),Se),ne});return A=A+1&He,pe(o(v,async(U,K)=>{const{channel:ee}=K;let te=0;for(;te<R;){const ne=D[te];if(ee.bufferedAmount>ee.bufferedAmountLowThreshold&&await new Promise(Ln=>{const bt=()=>{ee.removeEventListener($t,bt),Ln()};ee.addEventListener($t,bt)}),!r[U])break;K.sendData(ne),te++,L?.(ne[Te]/He,U,b)}}))}},a[u]||=[s[u].send,s[u].setOnComplete,s[u].setOnProgress]},h=(u,m)=>{const w=new Uint8Array(m),A=Ke(w.subarray(Tn,Ze)).replaceAll("\0",""),[P]=w.subarray(Ze,Xe),[v]=w.subarray(Xe,Te),[b]=w.subarray(Te,Se),L=w.subarray(Se),V=!!(v&1),O=!!(v&2),Q=!!(v&4),E=!!(v&8);if(!s[A]){console.warn(`${Le}: received message with unregistered type (${A})`);return}c[u]||={},c[u][A]||={};const I=c[u][A][P]||={chunks:[]};if(O?I.meta=Fe(Ke(L)):I.chunks.push(L),s[A].onProgress(b/He,u,I.meta),!V)return;const G=new Uint8Array(I.chunks.reduce((R,D)=>R+D.byteLength,0));if(I.chunks.reduce((R,D)=>(G.set(D,R),R+D.byteLength),0),delete c[u][A][P],Q)s[A].onComplete(G,u,I.meta);else{const R=Ke(G);s[A].onComplete(E?Fe(R):R,u)}},x=async()=>{await W(""),await new Promise(u=>setTimeout(u,99)),Bt(r).forEach(([u,m])=>{m.destroy(),delete r[u]}),n()},[S,k]=g(ve("ping")),[_,T]=g(ve("pong")),[B,C]=g(ve("signal")),[N,X]=g(ve("stream")),[H,z]=g(ve("track")),[W,$]=g(ve("leave"));return e((u,m)=>{r[m]||(r[m]=u,u.setHandlers({data:w=>h(m,w),stream:w=>{f.onPeerStream(w,m,y[m]),delete y[m]},track:(w,A)=>{f.onPeerTrack(w,A,m,d[m]),delete d[m]},signal:w=>B(w,m),close:()=>l(m),error:w=>{console.error(w),l(m)}}),f.onPeerJoin(m))}),k((u,m)=>_("",m)),T((u,m)=>{i[m]?.(),delete i[m]}),C((u,m)=>r[m]?.signal(u)),X((u,m)=>y[m]=u),z((u,m)=>d[m]=u),$((u,m)=>l(m)),wn&&addEventListener("beforeunload",x),{makeAction:g,leave:x,ping:async u=>{if(!u)throw oe("ping() must be called with target peer ID");const m=Date.now();return S("",u),await new Promise(w=>i[u]=w),Date.now()-m},getPeers:()=>Hs(Bt(r).map(([u,m])=>[u,m.connection])),addStream:(u,m,w)=>o(m,async(A,P)=>{w&&await N(w,A),P.addStream(u)}),removeStream:(u,m)=>o(m,(w,A)=>A.removeStream(u)),addTrack:(u,m,w,A)=>o(w,async(P,v)=>{A&&await H(A,P),v.addTrack(u,m)}),removeTrack:(u,m)=>o(m,(w,A)=>A.removeTrack(u)),replaceTrack:(u,m,w,A)=>o(w,async(P,v)=>{A&&await H(A,P),v.replaceTrack(u,m)}),onPeerJoin:u=>f.onPeerJoin=u,onPeerLeave:u=>f.onPeerLeave=u,onPeerStream:u=>f.onPeerStream=u,onPeerTrack:u=>f.onPeerTrack=u}},ar=20,or=5333,It=57333,cr=({init:e,subscribe:t,announce:n})=>{const r={};let s=!1,a,c,i,y;return(d,f,o)=>{const{appId:l}=d;if(r[l]?.[f])return r[l][f];const g={},h={},x=Oe(Le,l,f),S=Ue(x),k=Ue(Oe(x,fe)),_=js(d.password||"",l,f),T=v=>async b=>({type:b.type,sdp:await v(_,b.sdp)}),B=T(Qs),C=T(Ws),N=()=>Ht(!0,d),X=(v,b,L)=>{if(h[b]){h[b]!==v&&v.destroy();return}h[b]=v,P(v,b),g[b]?.forEach((V,O)=>{O!==L&&V.destroy()}),delete g[b]},H=(v,b)=>{h[b]===v&&delete h[b]},z=(v,b)=>{if(h[v])return;const L=g[v]?.[b];L&&(delete g[v][b],L.destroy())},W=v=>(c.push(...Me(v,N)),pe(c.splice(0,v).map(b=>b.offerPromise.then(C).then(L=>({peer:b,offer:L}))))),$=(v,b)=>o?.({error:`incorrect password (${d.password}) when decrypting ${b}`,appId:l,peerId:v,roomId:f}),u=v=>async(b,L,V)=>{const[O,Q]=await pe([S,k]);if(b!==O&&b!==Q)return;const{peerId:E,offer:I,answer:G,peer:R}=typeof L=="string"?Fe(L):L;if(!(E===fe||h[E])){if(E&&!I&&!G){if(g[E]?.[v])return;const[[{peer:D,offer:U}],K]=await pe([W(1),Ue(Oe(x,E))]);g[E]||=[],g[E][v]=D,setTimeout(()=>z(E,v),m[v]*.9),D.setHandlers({connect:()=>X(D,E,v),close:()=>H(D,E)}),V(K,ce({peerId:fe,offer:U}))}else if(I){if(g[E]?.[v]&&fe>E)return;const U=Ht(!1,d);U.setHandlers({connect:()=>X(U,E,v),close:()=>H(U,E)});let K;try{K=await B(I)}catch{$(E,"offer");return}if(U.isDead)return;const[ee,te]=await pe([Ue(Oe(x,E)),U.signal(K)]);V(ee,ce({peerId:fe,answer:await C(te)}))}else if(G){let D;try{D=await B(G)}catch{$(E,"answer");return}if(R)R.setHandlers({connect:()=>X(R,E,v),close:()=>H(R,E)}),R.signal(D);else{const U=g[E]?.[v];U&&!U.isDead&&U.signal(D)}}}};if(!d)throw oe("requires a config map as the first argument");if(!l&&!d.firebaseApp)throw oe("config map is missing appId field");if(!f)throw oe("roomId argument required");if(!s){const v=e(d);c=Me(ar,N),a=Array.isArray(v)?v:[v],s=!0,i=setInterval(()=>c=c.filter(b=>{const L=Date.now()-b.created<It;return L||b.destroy(),L}),It*1.03),y=d.manualRelayReconnection?ae:zs()}const m=a.map(()=>or),w=[],A=a.map(async(v,b)=>t(await v,await S,await k,u(b),W));pe([S,k]).then(([v,b])=>{const L=async(V,O)=>{const Q=await n(V,v,b);typeof Q=="number"&&(m[O]=Q),w[O]=setTimeout(()=>L(V,O),m[O])};A.forEach(async(V,O)=>{await V,L(await a[O],O)})});let P=ae;return r[l]||={},r[l][f]=rr(v=>P=v,v=>delete h[v],()=>{delete r[l][f],w.forEach(clearTimeout),A.forEach(async v=>(await v)()),clearInterval(i),y(),s=!1})}},ir=5,Sn="x",En="EVENT",{secretKey:fr,publicKey:lr}=vn.keygen(),ur=dt(lr),vt={},Ae={},dr={},Pn=()=>Math.floor(Date.now()/1e3),Cn=e=>dr[e]??=xn(e,1e4)+2e4,Kt=async(e,t)=>{const n={kind:Cn(e),tags:[[Sn,e]],created_at:Pn(),content:t,pubkey:ur},r=await kn("SHA-256",ce([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]));return ce([En,{...n,id:dt(r),sig:dt(await vn.signAsync(r,fr))}])},Vt=(e,t)=>(vt[e]=t,ce(["REQ",e,{kinds:[Cn(t)],since:Pn(),["#"+Sn]:[t]}])),Zt=e=>(delete vt[e],ce(["CLOSE",e])),yr=cr({init:e=>Zs(e,pr,ir).map(t=>{const n=Js(t,r=>{const[s,a,c,i]=Fe(r);if(s!==En){const y=`${Le}: relay failure from ${n.url} - `;s==="NOTICE"?console.warn(y+a):s==="OK"&&!c&&console.warn(y+i);return}Ae[a]?.(vt[a],c.content)});return n.ready}),subscribe:(e,t,n,r)=>{const s=ut(64),a=ut(64);return Ae[s]=Ae[a]=(c,i)=>r(c,i,async(y,d)=>e.send(await Kt(y,d))),e.send(Vt(s,t)),e.send(Vt(a,n)),()=>{e.send(Zt(s)),e.send(Zt(a)),delete Ae[s],delete Ae[a]}},announce:async(e,t)=>e.send(await Kt(t,ce({peerId:fe})))}),pr=["black.nostrcity.club","ftp.halifax.rwth-aachen.de/nostr","nos.lol","nostr.cool110.xyz","nostr.data.haus","nostr.sathoarder.com","nostr.vulpem.com","relay.agorist.space","relay.binaryrobot.com","relay.damus.io","relay.fountain.fm","relay.mostro.network","relay.nostraddress.com","relay.nostrdice.com","relay.nostromo.social","relay.oldenburg.cool","relay.verified-nostr.com","yabu.me/v2"].map(e=>"wss://"+e);var hr=Xt("<div><span> </span></div>"),mr=Xt('<main class="p-4 max-w-lg mx-auto"><div class="mb-4 p-2 bg-gray-100 rounded"><h1 class="font-bold text-xl">Chat Trystero (Serverless)</h1> <p class="text-sm text-gray-600"> </p> <p class="text-xs text-gray-400"> </p></div> <div class="h-64 border rounded overflow-y-auto p-2 mb-4 bg-white"></div> <div class="flex gap-2"><input class="flex-1 border p-2 rounded" placeholder="Digite algo..."/> <button class="bg-blue-600 text-white px-4 rounded">Enviar</button></div></main>');function Ar(e,t){ss(t,!1);const n={appId:"weird-wizard-vault"};let r,s,a=$e([]),c=$e(""),i=$e(0);Mn(()=>{r=yr(n,"sala-geral");const[T,B]=r.makeAction("message");s=T,B((C,N)=>{Be(a,[...Z(a),{sender:"Amigo",text:C,id:N}])}),r.onPeerJoin(C=>{At(i),console.log(`Peer ${C} entrou`)}),r.onPeerLeave(C=>{At(i,-1),console.log(`Peer ${C} saiu`)})});function y(){Z(c)&&(s(Z(c)),Be(a,[...Z(a),{sender:"Eu",text:Z(c),id:fe}]),Be(c,""))}os();var d=mr(),f=ue(d),o=_e(ue(f),2),l=ue(o);ie(o);var g=_e(o,2),h=ue(g);ie(g),ie(f);var x=_e(f,2);fs(x,5,()=>Z(a),cs,(T,B)=>{var C=hr(),N=ue(C),X=ue(N,!0);ie(N),ie(C),_t(()=>{St(C,1,`mb-2 ${Z(B).sender==="Eu"?"text-right":"text-left"}`),St(N,1,`inline-block px-3 py-1 rounded text-sm
          ${Z(B).sender==="Eu"?"bg-blue-600 text-white":"bg-gray-200 text-black"}`),Qe(X,Z(B).text)}),wt(T,C)}),ie(x);var S=_e(x,2),k=ue(S);as(k);var _=_e(k,2);ie(S),ie(d),_t(()=>{Qe(l,`Status: ${Z(i)>0?"ðŸŸ¢ Conectado":"ðŸŸ¡ Aguardando peers..."} 
      (${Z(i)??""} online)`),Qe(h,`ID: ${fe??""}`)}),ys(k,()=>Z(c),T=>Be(c,T)),Tt("keydown",k,T=>T.key==="Enter"&&y()),Tt("click",_,y),wt(e,d),rs()}export{Ar as component};
