import"../chunks/DsnmJJEf.js";import{s as p,o as ke}from"../chunks/CE5Oy5gg.js";import{w as ue,j as b,x as r,B as e,E as s,y as v,F as a,t as M,k as n,z as _e,u as pe,v as ce,$ as ze,a0 as De}from"../chunks/EigO5Itq.js";import{s as G,e as he,i as Ee,$ as xe,b as Pe}from"../chunks/B3FtJd8P.js";import{p as fe,i as g}from"../chunks/EUrPnace.js";import{h as je}from"../chunks/CjajxMkz.js";import{a as ge,s as $}from"../chunks/x7t77AVd.js";import{p as Se}from"../chunks/Besq1sGQ.js";import{a as Ae,l as He}from"../chunks/BPReyIlN.js";import{S as be,s as Ie,u as Te,a as Ue}from"../chunks/eOqvUlZi.js";import{k as Be}from"../chunks/CSpwhPtH.js";import{A as Fe,C as Re}from"../chunks/CEcYnnFh.js";import{S as Ve}from"../chunks/B41T8Fmh.js";import{C as We}from"../chunks/CEAxk489.js";var qe=b('<div class="absolute top-0 right-0 bg-gradient-to-l from-yellow-600/20 to-transparent border-l border-b border-yellow-500/30 text-yellow-500 text-[8px] font-black tracking-widest px-2 py-0.5 rounded-bl-lg z-20 uppercase"> </div>'),Ge=b('<div class="absolute inset-0 bg-red-950/40 animate-pulse z-0 pointer-events-none"></div>'),Je=b('<span class="text-[8px] font-black bg-red-950/40 text-red-500 px-1 py-0.5 rounded border border-red-900/30 uppercase"> </span>'),Ke=b('<div><div class="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent"></div></div>'),Le=b('<div class="absolute inset-0 bg-gradient-to-r from-emerald-500/20 via-emerald-400/30 to-emerald-500/20 z-10"><div class="absolute inset-0 bg-gradient-to-b from-white/10 to-transparent"></div></div>'),Ne=b('<div class="relative w-full h-2.5 bg-slate-950 rounded-full border border-white/5 overflow-hidden shadow-inner"><!> <!></div>'),Oe=b("<div> </div>"),Qe=b('<span class="text-[8px] bg-red-500/10 text-red-400 px-1.5 py-0.5 rounded border border-red-500/20"> </span>'),Xe=b('<div class="flex flex-wrap gap-1 mt-2"></div>'),Ye=b('<div><!> <!> <div class="relative z-10 p-3"><div class="flex items-center gap-3"><div class="relative flex-shrink-0"><div><!></div> <div><!></div></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><h3> </h3> <!></div> <!></div></div> <!></div></div>');function Ze(se,o){ue(o,!0);const D=()=>$(xe,"$t",oe),[oe,le]=ge();let k=fe(o,"healthDisplayModePlayer",3,"bar"),F=fe(o,"healthDisplayModeEnemy",3,"bar"),E=s(()=>o.entity.type==="player"),z=s(()=>o.entity.damage||0),_=s(()=>o.entity.normalHealth||o.entity.health||10),S=s(()=>o.entity.currentHealth??e(_)),de=s(()=>e(E)?k():F()),h=s(()=>e(z)>=e(S)),T=s(()=>e(z)>=e(S)*.8&&!e(h)),R=s(()=>e(z)>=e(S)*.5&&!e(T)&&!e(h)),ee=s(()=>e(z)>0&&!e(R)&&!e(T)&&!e(h)),J=s(()=>e(S)>0?Math.min(100,Math.max(0,e(z)/e(S)*100)):100),ne=s(()=>()=>e(h)?D()("session.combat_viewer.health_estimates.incapacitated"):e(T)?D()("session.combat_viewer.health_estimates.critical"):e(R)?D()("session.combat_viewer.health_estimates.injured"):e(ee)?D()("session.combat_viewer.health_estimates.wounded"):D()("session.combat_viewer.health_estimates.healthy")),ve=s(()=>()=>e(h)?"text-red-600":e(T)?"text-red-400":e(R)?"text-orange-400":e(ee)?"text-amber-400":"text-emerald-400");var V=Ye(),K=r(V);{var L=t=>{var i=qe(),d=r(i,!0);a(i),M(m=>p(d,m),[()=>D()("session.combat_card.initiative")]),n(t,i)};g(K,t=>{e(E)&&o.entity.initiative&&t(L)})}var W=v(K,2);{var te=t=>{var i=Ge();n(t,i)};g(W,t=>{e(h)&&t(te)})}var N=v(W,2),U=r(N),O=r(U),B=r(O),Q=r(B);Be(Q,()=>o.entity.imageUrl,t=>{{let i=s(()=>o.entity.name.charAt(0));Fe(t,{get hash(){return o.entity.imageUrl},get alt(){return o.entity.name},size:"custom",get fallbackText(){return e(i)}})}}),a(B);var X=v(B,2),ae=r(X);{var me=t=>{Ve(t,{size:10})},re=t=>{var i=pe(),d=ce(i);{var m=u=>{We(u,{size:10})},f=u=>{be(u,{size:10})};g(d,u=>{o.entity.acted?u(m):u(f,!1)},!0)}n(t,i)};g(ae,t=>{e(h)?t(me):t(re,!1)})}a(X),a(O);var ie=v(O,2),Y=r(ie),q=r(Y),l=r(q,!0);a(q);var c=v(q,2);{var y=t=>{var i=Je(),d=r(i);a(i),M(m=>p(d,`${m??""} ${o.entity.difficulty??""}`),[()=>D()("session.combat_card.difficulty")]),n(t,i)};g(c,t=>{e(E)||t(y)})}a(Y);var w=v(Y,2);{var P=t=>{var i=Ne(),d=r(i);{var m=x=>{var I=Ke();M(()=>{G(I,1,`absolute top-0 left-0 h-full transition-all duration-500 ease-out
                                ${e(h)?"bg-gradient-to-r from-red-600 via-red-500 to-rose-500 animate-pulse":e(J)>=80?"bg-gradient-to-r from-red-600 to-rose-500":e(R)?"bg-gradient-to-r from-amber-600 to-orange-500":"bg-gradient-to-r from-orange-500 to-amber-400"}`),Pe(I,`width: ${e(J)??""}%`)}),n(x,I)};g(d,x=>{e(J)>0&&x(m)})}var f=v(d,2);{var u=x=>{var I=Le();n(x,I)};g(f,x=>{e(z)===0&&x(u)})}a(i),n(t,i)},A=t=>{var i=Oe(),d=r(i,!0);a(i),M((m,f)=>{G(i,1,`text-xs font-bold uppercase tracking-wider ${m??""}`),p(d,f)},[()=>e(ve)(),()=>e(ne)()]),n(t,i)};g(w,t=>{e(de)==="bar"?t(P):t(A,!1)})}a(ie),a(U);var H=v(U,2);{var j=t=>{var i=Xe();he(i,21,()=>o.entity.afflictions||[],Ee,(d,m)=>{var f=Qe(),u=r(f,!0);a(f),M(()=>p(u,e(m))),n(d,f)}),a(i),n(t,i)};g(H,t=>{(o.entity.afflictions||[]).length>0&&t(j)})}a(N),a(V),M(()=>{G(V,1,`group relative overflow-hidden transition-all duration-300 rounded-xl border ${e(E)?"bg-slate-900/80 border-indigo-500/30":"bg-slate-950/80 border-red-900/30"} shadow-md`),G(B,1,`w-10 h-10 rounded-xl overflow-hidden border-2 shadow-lg ${e(h)?"border-red-600 grayscale brightness-50":e(E)?"border-indigo-500/50":"border-red-900/50"}`),G(X,1,`absolute -bottom-1 -right-1 w-5 h-5 rounded-md flex items-center justify-center border shadow-md z-20 ${o.entity.acted?"bg-slate-800 border-slate-600 text-slate-500":e(E)?"bg-indigo-600 border-indigo-400 text-white":"bg-red-600 border-red-400 text-white"}`),G(q,1,`text-sm font-bold truncate ${e(E)?"text-white":"text-red-100"}`),p(l,o.entity.name)}),n(se,V),_e(),le()}var $e=b('<div class="text-center text-slate-500 italic py-8"> </div>'),et=b('<div class="flex items-center justify-center gap-3 mb-6 py-4 bg-slate-900/50 rounded-xl border border-slate-800"><!> <div class="text-center"><div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest"> </div> <div class="text-4xl font-mono font-bold text-white leading-none"> </div></div></div> <div class="space-y-3"><!> <!></div>',1),tt=b('<div class="text-center py-24"><div class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-600"><!></div> <p class="text-xl text-slate-400 font-bold"> </p> <p class="text-sm text-slate-500 mt-2"> </p></div>'),at=b('<div class="text-center py-24"><p class="text-slate-500"> </p></div>'),rt=b('<div class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white"><header class="sticky top-0 z-50 bg-slate-900/80 backdrop-blur-xl border-b border-white/5"><div class="max-w-2xl mx-auto px-4 py-3 flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-indigo-600/20 border border-indigo-500/30 rounded-xl flex items-center justify-center text-indigo-400"><!></div> <div><h1 class="text-lg font-bold"> </h1> <p class="text-xs text-slate-400"> </p></div></div></div></header> <main class="max-w-2xl mx-auto px-4 py-6"><!></main></div>');function ht(se,o){ue(o,!0);const D=()=>$(Se,"$page",F),oe=()=>$(Ae,"$liveCampaigns",F),le=()=>$(He,"$liveCharacters",F),k=()=>$(xe,"$t",F),[F,E]=ge();let z=s(()=>D().params.id),_=s(()=>oe().find(l=>l.id===e(z)));ke(()=>(e(z)&&Ie(e(z)),()=>{Te()}));let S=s(()=>e(_)?.combat||{active:!1,round:1}),de=s(()=>e(_)?.activeEnemies||[]),h=s(()=>e(_)?.sessionRoster||[]),T=s(()=>e(_)?.members||[]),R=s(()=>e(_)?.initiativeStyle||"dle"),ee=s(()=>e(_)?.healthDisplayModePlayer||"bar"),J=s(()=>e(_)?.healthDisplayModeEnemy||"bar"),ne=s(()=>Array.from(new Set([...e(h),...e(T).map(c=>c.id)])).map(c=>{const y=le().find(P=>P.id===c),w=e(T).find(P=>P.id===c);return y&&w?{...y,...w,type:"player",lastUpdate:w.lastUpdate}:y?{...y,type:"player"}:w?{...w,type:"player"}:null}).filter(Boolean)),ve=s(()=>e(ne).filter(l=>!l.campaignApproval||l.campaignApproval==="approved")),V=s(()=>e(ve).filter(l=>e(h).includes(l.id))),K=s(()=>Ue(e(R),e(V),e(de)));var L=rt();je("a21hpv",l=>{ze(c=>{De.title=c??""},[()=>e(_)?.name?`${k()("session.combat_viewer.title")} - ${e(_).name}`:k()("session.combat_viewer.title")])});var W=r(L),te=r(W),N=r(te),U=r(N),O=r(U);be(O,{size:20}),a(U);var B=v(U,2),Q=r(B),X=r(Q,!0);a(Q);var ae=v(Q,2),me=r(ae,!0);a(ae),a(B),a(N),a(te),a(W);var re=v(W,2),ie=r(re);{var Y=l=>{var c=pe(),y=ce(c);{var w=A=>{var H=et(),j=ce(H),t=r(j);Re(t,{size:24,class:"text-indigo-400"});var i=v(t,2),d=r(i),m=r(d,!0);a(d);var f=v(d,2),u=r(f,!0);a(f),a(i),a(j);var x=v(j,2),I=r(x);he(I,17,()=>e(K),C=>C.type==="player"?C.id:C.instanceId,(C,Z)=>{Ze(C,{get entity(){return e(Z)},get healthDisplayModePlayer(){return e(ee)},get healthDisplayModeEnemy(){return e(J)}})});var ye=v(I,2);{var we=C=>{var Z=$e(),Ce=r(Z,!0);a(Z),M(Me=>p(Ce,Me),[()=>k()("session.combat.empty")]),n(C,Z)};g(ye,C=>{e(K).length===0&&C(we)})}a(x),M(C=>{p(m,C),p(u,e(S).round)},[()=>k()("session.combat.round")]),n(A,H)},P=A=>{var H=tt(),j=r(H),t=r(j);be(t,{size:40}),a(j);var i=v(j,2),d=r(i,!0);a(i);var m=v(i,2),f=r(m,!0);a(m),a(H),M((u,x)=>{p(d,u),p(f,x)},[()=>k()("session.combat_viewer.no_combat"),()=>k()("session.combat_viewer.waiting")]),n(A,H)};g(y,A=>{e(S).active?A(w):A(P,!1)})}n(l,c)},q=l=>{var c=at(),y=r(c),w=r(y,!0);a(y),a(c),M(P=>p(w,P),[()=>k()("campaign.not_found.title")]),n(l,c)};g(ie,l=>{e(_)?l(Y):l(q,!1)})}a(re),a(L),M(l=>{p(X,l),p(me,e(_)?.name||"")},[()=>k()("session.combat_viewer.title")]),n(se,L),_e(),E()}export{ht as component};
